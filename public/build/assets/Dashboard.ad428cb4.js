import{_ as _sfc_main$2}from"./AppLayout.70177c07.js";import{D as commonjsGlobal,E as getAugmentedNamespace,d as ref,o as openBlock,e as createElementBlock,a as createBaseVNode,c as createBlock,w as withCtx,b as createVNode}from"./app.3f5b02a9.js";import"./_plugin-vue_export-helper.cdc0426e.js";var build$2={},AllHighestVideoBandwidthPolicy$1={},DefaultVideoStreamIdSet$1={};Object.defineProperty(DefaultVideoStreamIdSet$1,"__esModule",{value:!0});class DefaultVideoStreamIdSet{constructor(t){this.ids=new Set(t)}add(t){this.ids.add(t)}array(){return Array.from(this.ids.values()).sort((e,n)=>e-n)}contain(t){return this.ids.has(t)}forEach(t){this.ids.forEach(t)}empty(){return this.ids.size===0}size(){return this.ids.size}equal(t){if(!t)return this.ids.size===0;const e=this.array(),n=t.array();if(e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==n[o])return!1;return!0}clone(){return new DefaultVideoStreamIdSet(this.array())}remove(t){this.ids.delete(t)}toJSON(){return this.array()}truncate(t){const e=this.array();return new DefaultVideoStreamIdSet(e.splice(0,t))}}DefaultVideoStreamIdSet$1.default=DefaultVideoStreamIdSet;Object.defineProperty(AllHighestVideoBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoStreamIdSet_1$3=DefaultVideoStreamIdSet$1;class AllHighestVideoBandwidthPolicy{constructor(t){this.selfAttendeeId=t,this.reset()}reset(){this.optimalReceiveSet=new DefaultVideoStreamIdSet_1$3.default,this.subscribedReceiveSet=new DefaultVideoStreamIdSet_1$3.default,this.videoSources=void 0}updateIndex(t){this.videoIndex=t,this.optimalReceiveSet=this.calculateOptimalReceiveSet(t)}updateMetrics(t){}wantsResubscribe(){return!this.subscribedReceiveSet.equal(this.optimalReceiveSet)}chooseSubscriptions(){return this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveSet.clone()}chooseRemoteVideoSources(t){this.videoSources=t,this.optimalReceiveSet=this.calculateOptimalReceiveSet(this.videoIndex).clone()}calculateOptimalReceiveSet(t){const e=new DefaultVideoStreamIdSet_1$3.default;if(!this.videoIndex||this.videoIndex.allStreams().empty())return e;const n=t.highestQualityStreamFromEachGroupExcludingSelf(this.selfAttendeeId);if(this.videoSources===void 0)return n;const o=this.videoIndex.remoteStreamDescriptions(),a=new Map;for(const s of o)n.contain(s.streamId)&&a.set(s.attendeeId,s.streamId);for(const s of this.videoSources){const d=s.attendee.attendeeId;a.has(d)&&e.add(a.get(d))}return e}}AllHighestVideoBandwidthPolicy$1.default=AllHighestVideoBandwidthPolicy;var ApplicationMetadata$1={};Object.defineProperty(ApplicationMetadata$1,"__esModule",{value:!0});class ApplicationMetadata{constructor(t,e){this.appName=t,this.appVersion=e}static create(t,e){const n=/^[a-zA-Z0-9]+[a-zA-Z0-9_-]*[a-zA-Z0-9]+$/g;if(!t||t.length>32)throw new Error("appName should be a valid string and 1 to 32 characters in length");if(!n.test(t))throw new Error(`appName must satisfy ${n} regular expression`);const o=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/gm;if(!e||e.length>32)throw new Error("appVersion should be a valid string and 1 to 32 characters in length");if(!o.test(e))throw new Error("appVersion must satisfy Semantic Versioning format");return new ApplicationMetadata(t,e)}}ApplicationMetadata$1.default=ApplicationMetadata;var AsyncScheduler$1={},TimeoutScheduler$1={};Object.defineProperty(TimeoutScheduler$1,"__esModule",{value:!0});class TimeoutScheduler{constructor(t){this.timeoutMs=t,this.timer=null}start(t){this.stop(),this.timer=setTimeout(()=>{clearTimeout(this.timer),t()},this.timeoutMs)}stop(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}}TimeoutScheduler$1.default=TimeoutScheduler;Object.defineProperty(AsyncScheduler$1,"__esModule",{value:!0});const TimeoutScheduler_1$3=TimeoutScheduler$1;class AsyncScheduler extends TimeoutScheduler_1$3.default{constructor(){super(0)}static nextTick(t){setTimeout(t,0)}}AsyncScheduler$1.default=AsyncScheduler;var AttachMediaInputTask$1={},VideoLogEvent={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.VideoLogEvent=void 0;var t;(function(e){e[e.InputAttached=0]="InputAttached",e[e.SendingFailed=1]="SendingFailed",e[e.SendingSuccess=2]="SendingSuccess"})(t=r.VideoLogEvent||(r.VideoLogEvent={})),r.default=t})(VideoLogEvent);var BaseTask$1={},OnceTask$1={},LogLevel={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.LogLevel=void 0;var t;(function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.OFF=4]="OFF"})(t=r.LogLevel||(r.LogLevel={})),r.default=t})(LogLevel);Object.defineProperty(OnceTask$1,"__esModule",{value:!0});const LogLevel_1$8=LogLevel,AsyncScheduler_1$7=AsyncScheduler$1;class OnceTask{constructor(t,e,n){this.logger=t,this.task=e,this.dependencies=n,this.canceled=!1}name(){return`${this.task.name()} (once)`}cancel(){if(!this.canceled){if(this.dependencies)for(const t of this.dependencies)t.cancel();this.logger.info(`Canceling ${this.name()}`),AsyncScheduler_1$7.default.nextTick(()=>this.task.cancel()),this.canceled=!0,this.cancelPromise&&AsyncScheduler_1$7.default.nextTick(()=>this.cancelPromise(new Error(`canceling ${this.name()}`)))}}logDependencies(){if(this.logger.getLogLevel()>LogLevel_1$8.default.INFO||!this.dependencies)return;const t=this.dependencies.filter(e=>e).map(e=>e.name()).join(", ");this.logger.info(`${this.task.name()} waiting for dependencies: ${t}`)}run(){if(this.promise)return this.promise;const t=this.dependencies?Promise.all(this.dependencies.map(e=>e==null?void 0:e.run())):Promise.resolve();return this.logDependencies(),this.ongoing=t.then(()=>this.task.run()),this.promise=new Promise((e,n)=>{this.cancelPromise=n,this.ongoing.then(e).catch(n)})}setParent(t){this.task.setParent(t)}}OnceTask$1.default=OnceTask;var TaskStatus$1={};Object.defineProperty(TaskStatus$1,"__esModule",{value:!0});var TaskStatus;(function(r){r.IDLE="IDLE",r.RUNNING="RUNNING",r.CANCELED="CANCELED",r.FINISHED="FINISHED"})(TaskStatus||(TaskStatus={}));TaskStatus$1.default=TaskStatus;var __awaiter$11=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BaseTask$1,"__esModule",{value:!0});const OnceTask_1=OnceTask$1,TaskStatus_1$1=TaskStatus$1;class BaseTask{constructor(t){this.logger=t,this.taskName="BaseTask",this.parentTask=null,this.status=TaskStatus_1$1.default.IDLE,this.run=this.baseRun.bind(this,this.run),this.cancel=this.baseCancel.bind(this,this.cancel)}once(...t){return new OnceTask_1.default(this.logger,this,t)}cancel(){}name(){return this.parentTask?`${this.parentTask.name()}/${this.taskName}`:this.taskName}setParent(t){this.parentTask=t}getStatus(){return this.status}logAndThrow(t){throw this.logger.info(t),new Error(t)}baseRun(t){return __awaiter$11(this,void 0,void 0,function*(){try{const e=Date.now();switch(this.logger.info(`running task ${this.name()}`),this.status){case TaskStatus_1$1.default.RUNNING:this.logAndThrow(`${this.name()} is already running`);case TaskStatus_1$1.default.CANCELED:this.logAndThrow(`${this.name()} was canceled before running`);case TaskStatus_1$1.default.FINISHED:this.logAndThrow(`${this.name()} was already finished`)}this.status=TaskStatus_1$1.default.RUNNING,yield t.call(this),this.logger.info(`${this.name()} took ${Math.round(Date.now()-e)} ms`)}catch(e){throw e}finally{this.status!==TaskStatus_1$1.default.CANCELED&&(this.status=TaskStatus_1$1.default.FINISHED)}})}baseCancel(t){if(this.status===TaskStatus_1$1.default.CANCELED||this.status===TaskStatus_1$1.default.FINISHED){this.logger.info(`Not canceling ${this.name()}: state is ${this.status}`);return}this.logger.info(`canceling task ${this.name()}`),this.status=TaskStatus_1$1.default.CANCELED,t.call(this)}}BaseTask$1.default=BaseTask;var __awaiter$10=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(AttachMediaInputTask$1,"__esModule",{value:!0});const VideoLogEvent_1$1=VideoLogEvent,BaseTask_1$o=BaseTask$1;class AttachMediaInputTask extends BaseTask_1$o.default{constructor(t){super(t.logger),this.context=t,this.taskName="AttachMediaInputTask"}run(){return __awaiter$10(this,void 0,void 0,function*(){const t=this.context.transceiverController;t.setPeer(this.context.peer),t.setupLocalTransceivers();const e=this.context.activeAudioInput;if(e){const o=e.getAudioTracks();this.context.logger.info("attaching audio track to peer connection"),yield t.setAudioInput(o.length?o[0]:null)}else yield t.setAudioInput(null),this.context.logger.info("no audio track");const n=this.context.activeVideoInput;if(n){const o=n.getVideoTracks(),a=o.length?o[0]:null;if(this.context.logger.info("attaching video track to peer connection"),yield t.setVideoInput(a),this.context.enableSimulcast&&this.context.videoUplinkBandwidthPolicy){const s=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();t.setEncodingParameters(s)}a&&(this.context.statsCollector.logVideoEvent(VideoLogEvent_1$1.default.InputAttached,this.context.videoDeviceInformation),this.context.videoInputAttachedTimestampMs=Date.now())}else yield t.setVideoInput(null),this.context.logger.info("no video track");this.context.videoSubscriptions=t.updateVideoTransceivers(this.context.videoStreamIndex,this.context.videosToReceive)})}}AttachMediaInputTask$1.default=AttachMediaInputTask;var Attendee$1={};Object.defineProperty(Attendee$1,"__esModule",{value:!0});class Attendee{}Attendee$1.default=Attendee;var AudioLogEvent={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.AudioLogEvent=void 0;var t;(function(e){e[e.DeviceChanged=0]="DeviceChanged",e[e.MutedLocal=1]="MutedLocal",e[e.UnmutedLocal=2]="UnmutedLocal",e[e.Connected=3]="Connected",e[e.ConnectFailed=4]="ConnectFailed",e[e.RedmicStartLoss=5]="RedmicStartLoss",e[e.RedmicEndLoss=6]="RedmicEndLoss"})(t=r.AudioLogEvent||(r.AudioLogEvent={})),r.default=t})(AudioLogEvent);var AudioProfile$1={};Object.defineProperty(AudioProfile$1,"__esModule",{value:!0});class AudioProfile{constructor(t=null){this.audioBitrateBps=t}static fullbandSpeechMono(){return new AudioProfile(4e4)}static fullbandMusicMono(){return new AudioProfile(64e3)}static fullbandMusicStereo(){return new AudioProfile(128e3)}isStereo(){return this.audioBitrateBps===128e3}}AudioProfile$1.default=AudioProfile;var AudioVideoControllerState$1={};Object.defineProperty(AudioVideoControllerState$1,"__esModule",{value:!0});class AudioVideoControllerState{constructor(){this.logger=null,this.browserBehavior=null,this.signalingClient=null,this.meetingSessionConfiguration=null,this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.audioVideoController=null,this.realtimeController=null,this.videoTileController=null,this.mediaStreamBroker=null,this.audioMixController=null,this.activeAudioInput=void 0,this.activeVideoInput=void 0,this.transceiverController=null,this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.iceGatheringStateEventHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.reconnectController=null,this.removableObservers=[],this.audioProfile=null,this.videoStreamIndex=null,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.lastKnownVideoAvailability=null,this.videoCaptureAndEncodeParameter=null,this.videosToReceive=null,this.lastVideosToReceive=null,this.videoSubscriptions=null,this.videoSubscriptionLimit=25,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.videoSendCodecPreferences=[],this.meetingSupportedVideoSendCodecPreferences=void 0,this.videosPaused=null,this.videoDuplexMode=null,this.volumeIndicatorAdapter=null,this.statsCollector=null,this.connectionMonitor=null,this.videoInputAttachedTimestampMs=0,this.audioDeviceInformation={},this.videoDeviceInformation={},this.enableSimulcast=!1,this.eventController=null,this.signalingOpenDurationMs=null,this.iceGatheringDurationMs=null,this.startAudioVideoTimestamp=null,this.attendeePresenceDurationMs=null,this.meetingStartDurationMs=null,this.poorConnectionCount=0,this.maxVideoTileCount=0,this.startTimeMs=null}}AudioVideoControllerState$1.default=AudioVideoControllerState;var BackgroundBlurStrength={};Object.defineProperty(BackgroundBlurStrength,"__esModule",{value:!0});BackgroundBlurStrength.BlurStrengthMapper=void 0;const BlurStrength={LOW:7,MEDIUM:15,HIGH:30};class BlurStrengthMapper{static getBlurAmount(t,e){if(t<=0)throw new Error(`invalid value for blur strength: ${t}`);return Math.round(t*e.height/this.BLUR_STRENGTH_DIVISOR)}}BackgroundBlurStrength.BlurStrengthMapper=BlurStrengthMapper;BlurStrengthMapper.BLUR_STRENGTH_DIVISOR=540;BackgroundBlurStrength.default=BlurStrength;var BackgroundBlurVideoFrameProcessor$1={},BackgroundFilterVideoFrameProcessor$1={},loader={},fetch$1={};Object.defineProperty(fetch$1,"__esModule",{value:!0});fetch$1.isValidRevisionID=fetch$1.isValidAssetGroup=fetch$1.resolveURL=fetch$1.addQueryParams=fetch$1.withQueryString=fetch$1.withRequestHeaders=fetch$1.fetchWithBehavior=void 0;function fetchWithBehavior(r,t,e){if(!e)return fetch(r,t);const n=withQueryString(r,e),o=withRequestHeaders(t,e);return fetch(n,o)}fetch$1.fetchWithBehavior=fetchWithBehavior;function withRequestHeaders(r,t){return t!=null&&t.headers?r?Object.assign(Object.assign({},r),{headers:Object.assign(Object.assign({},r.headers||{}),t.headers)}):{headers:t.headers}:r}fetch$1.withRequestHeaders=withRequestHeaders;function withQueryString(r,t){if(!(t!=null&&t.escapedQueryString))return r;const e=r.lastIndexOf("?")!==-1;return`${r}${e?"&":"?"}${t.escapedQueryString}`}fetch$1.withQueryString=withQueryString;function addQueryParams(r,t){const e=Object.keys(t);if(!e.length)return r;const n=new URLSearchParams(r==null?void 0:r.escapedQueryString);for(const o of e)n.append(o,t[o]);return Object.assign(Object.assign({},r),{escapedQueryString:n.toString()})}fetch$1.addQueryParams=addQueryParams;const HEAD_OPTIONS={method:"HEAD",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"origin"};function resolveURL(r,t){return fetchWithBehavior(r,HEAD_OPTIONS,t).then(e=>e.redirected?e.url:r)}fetch$1.resolveURL=resolveURL;function isValidAssetGroup(r){return!!r&&/^[-.a-zA-Z0-9]+$/.test(r)}fetch$1.isValidAssetGroup=isValidAssetGroup;function isValidRevisionID(r){return!!r&&/^[123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ]{22}$/.test(r)}fetch$1.isValidRevisionID=isValidRevisionID;Object.defineProperty(loader,"__esModule",{value:!0});loader.loadWorker=void 0;const fetch_js_1$1=fetch$1,WORKER_FETCH_OPTIONS={method:"GET",mode:"cors",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"},loadWorker=(r,t,e,n)=>{n==null||n.debug(`Loading ${t} worker from ${r}.`);let o=!1;try{o=self.origin===new URL(r).origin}catch(a){n==null||n.error("Could not compare origins.",a)}if(o){const a=fetch_js_1$1.withQueryString(r,e);return Promise.resolve(new Worker(a,{name:t}))}return fetch_js_1$1.fetchWithBehavior(r,WORKER_FETCH_OPTIONS,e).then(a=>{if(a.ok)return a.blob().then(s=>new Worker(window.URL.createObjectURL(s)));throw new Error("Fetch failed.")})};loader.loadWorker=loadWorker;var support={};(function(r){var t=commonjsGlobal&&commonjsGlobal.__awaiter||function(S,g,y,E){function T(C){return C instanceof y?C:new y(function(P){P(C)})}return new(y||(y=Promise))(function(C,P){function x(A){try{I(E.next(A))}catch(v){P(v)}}function $(A){try{I(E.throw(A))}catch(v){P(v)}}function I(A){A.done?C(A.value):T(A.value).then(x,$)}I((E=E.apply(S,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.isOldChrome=r.supportsWASMStreaming=r.supportsSharedArrayBuffer=r.supportsWASM=r.supportsAudioWorklet=r.supportsWorker=r.supportsVoiceFocusWorker=r.supportsWASMPostMessage=r.isSafari=void 0;const e=loader,n=(S=globalThis)=>!!S.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/),o=(S=globalThis)=>{const g=S.navigator.userAgent,y=g.match(/Safari\//),E=g.match(/Chrom(?:e|ium)\//);return!!(y&&!E)};r.isSafari=o;const a=(S=globalThis)=>r.isSafari(S)?!1:n(S)?(p(S)||0)<95:!0;r.supportsWASMPostMessage=a;const s=(S=globalThis,g,y)=>t(void 0,void 0,void 0,function*(){if(!r.supportsWorker(S,y))return!1;const E=`${g.paths.workers}worker-v1.js`;try{const T=yield e.loadWorker(E,"VoiceFocusTestWorker",g,y);try{T.terminate()}catch(C){y==null||y.debug("Failed to terminate worker.",C)}return!0}catch(T){return y==null||y.info("Failed to fetch and instantiate test worker",T),!1}});r.supportsVoiceFocusWorker=s;const d=(S=globalThis,g)=>{try{return!!S.Worker}catch(y){return g==null||g.info("Does not support Worker",y),!1}};r.supportsWorker=d;const u=(S=globalThis,g)=>{try{return!!S.AudioWorklet&&!!S.AudioWorkletNode}catch(y){return g==null||g.info("Does not support Audio Worklet",y),!1}};r.supportsAudioWorklet=u;const c=(S=globalThis,g)=>{try{return!!S.WebAssembly&&(!!S.WebAssembly.compile||!!S.WebAssembly.compileStreaming)}catch(y){return g==null||g.info("Does not support WASM",y),!1}};r.supportsWASM=c;const l=(S=globalThis,g=globalThis,y)=>{try{return!!S.SharedArrayBuffer&&(!!g.chrome||!!S.crossOriginIsolated)}catch{return y==null||y.info("Does not support SharedArrayBuffer."),!1}};r.supportsSharedArrayBuffer=l;const f=(S=globalThis,g)=>{var y;try{return!!(!((y=S.WebAssembly)===null||y===void 0)&&y.compileStreaming)}catch(E){return g==null||g.info("Does not support WASM streaming compilation",E),!1}};r.supportsWASMStreaming=f;const h=90,p=(S=globalThis)=>{try{if(!S.chrome)return}catch{}const g=S.navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)/);if(!!g)return parseInt(g[1],10)},m=(S=globalThis,g)=>{const y=p(S);return y&&y<h?(g==null||g.debug(`Chrome ${y} has incomplete SIMD support.`),!0):!1};r.isOldChrome=m})(support);var ModelSpecBuilder$1={};Object.defineProperty(ModelSpecBuilder$1,"__esModule",{value:!0});class ModelSpecBuilder{constructor(){this.path=null,this.input=null,this.output=null}static builder(){return new ModelSpecBuilder}withDefaultModel(){return this.withSelfieSegmentationDefaults()}withSelfieSegmentationDefaults(){const t={height:144,width:256,range:[0,1],channels:3},e={height:144,width:256,range:[0,1],channels:1},n="https://static.sdkassets.chime.aws/bgblur/models/selfie_segmentation_landscape.tflite";return this.path=n,this.input=t,this.output=e,this}withPath(t){return this.path=t,this}withInput(t){return this.input=t,this}withOutput(t){return this.output=t,this}validate(){if(!this.path)throw new Error("model spec path is not set");if(!this.input)throw new Error("model spec input is not set");if(!this.output)throw new Error("model spec output is not set")}build(){return this.validate(),{path:this.path,input:this.input,output:this.output}}}ModelSpecBuilder$1.default=ModelSpecBuilder;var DefaultBrowserBehavior$1={},__spreadArray=globalThis&&globalThis.__spreadArray||function(r,t,e){if(e||arguments.length===2)for(var n=0,o=t.length,a;n<o;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return r.concat(a||Array.prototype.slice.call(t))},BrowserInfo=function(){function r(t,e,n){this.name=t,this.version=e,this.os=n,this.type="browser"}return r}(),NodeInfo=function(){function r(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return r}(),SearchBotDeviceInfo=function(){function r(t,e,n,o){this.name=t,this.version=e,this.os=n,this.bot=o,this.type="bot-device"}return r}(),BotInfo=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),ReactNativeInfo=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(r){return r?parseUserAgent(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(r){return r!==""&&userAgentRules.reduce(function(t,e){var n=e[0],o=e[1];if(t)return t;var a=o.exec(r);return!!a&&[n,a]},!1)}function browserName(r){var t=matchUserAgent(r);return t?t[0]:null}function parseUserAgent(r){var t=matchUserAgent(r);if(!t)return null;var e=t[0],n=t[1];if(e==="searchbot")return new BotInfo;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<REQUIRED_VERSION_PARTS&&(o=__spreadArray(__spreadArray([],o,!0),createVersionParts(REQUIRED_VERSION_PARTS-o.length),!0)):o=[];var a=o.join("."),s=detectOS(r),d=SEARCHBOT_OS_REGEX.exec(r);return d&&d[1]?new SearchBotDeviceInfo(e,a,s,d[1]):new BrowserInfo(e,a,s)}function detectOS(r){for(var t=0,e=operatingSystemRules.length;t<e;t++){var n=operatingSystemRules[t],o=n[0],a=n[1],s=a.exec(r);if(s)return o}return null}function getNodeVersion(){var r=typeof process<"u"&&process.version;return r?new NodeInfo(process.version.slice(1)):null}function createVersionParts(r){for(var t=[],e=0;e<r;e++)t.push("0");return t}const es=Object.freeze(Object.defineProperty({__proto__:null,BrowserInfo,NodeInfo,SearchBotDeviceInfo,BotInfo,ReactNativeInfo,detect,browserName,parseUserAgent,detectOS,getNodeVersion},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(es);var __awaiter$$=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultBrowserBehavior$1,"__esModule",{value:!0});const detect_browser_1=require$$0$1;class DefaultBrowserBehavior{constructor(){this.browser=detect_browser_1.detect(),this.browserSupport={chrome:78,"edge-chromium":79,electron:7,firefox:75,ios:13,safari:13,opera:66,samsung:12,crios:86,fxios:23,"ios-webview":605,"chromium-webview":92},this.browserName={chrome:"Google Chrome","edge-chromium":"Microsoft Edge",electron:"Electron",firefox:"Mozilla Firefox",ios:"Safari iOS",safari:"Safari",opera:"Opera",samsung:"Samsung Internet",crios:"Chrome iOS",fxios:"Firefox iOS","ios-webview":"WKWebView iOS","chromium-webview":"Chrome WebView"},this.chromeLike=["chrome","edge-chromium","chromium-webview","opera","samsung"],this.webkitBrowsers=["crios","fxios","safari","ios","ios-webview"]}version(){return this.browser.version}majorVersion(){return parseInt(this.version().split(".")[0])}name(){return this.browser.name}hasChromiumWebRTC(){for(const t of this.chromeLike)if(t===this.browser.name)return!0;return!1}hasWebKitWebRTC(){for(const t of this.webkitBrowsers)if(t===this.browser.name)return!0;return!1}hasFirefoxWebRTC(){return this.isFirefox()}supportsCanvasCapturedStreamPlayback(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}supportsBackgroundFilter(){return!(this.name()==="safari"&&this.majorVersion()===15||!this.supportsCanvasCapturedStreamPlayback())}supportsVideoLayersAllocationRtpHeaderExtension(){return this.hasChromiumWebRTC()}requiresResolutionAlignment(t,e){return this.isAndroid()&&this.isPixel3()?[Math.ceil(t/64)*64,Math.ceil(e/64)*64]:[t,e]}requiresCheckForSdpConnectionAttributes(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}requiresIceCandidateGatheringTimeoutWorkaround(){return this.hasChromiumWebRTC()}requiresBundlePolicy(){return"max-bundle"}requiresNoExactMediaStreamConstraints(){return this.isSamsungInternet()}requiresGroupIdMediaStreamConstraints(){return this.isSamsungInternet()}getDisplayMediaAudioCaptureSupport(){return this.isChrome()||this.isEdge()}doesNotSupportMediaDeviceLabels(){return this.browser.name==="chromium-webview"}isSupported(){return!(!this.browserSupport[this.browser.name]||this.majorVersion()<this.browserSupport[this.browser.name]||this.browser.name==="firefox"&&this.isAndroid())}isSimulcastSupported(){return this.hasChromiumWebRTC()}supportDownlinkBandwidthEstimation(){return!this.isFirefox()}supportString(){if(this.isAndroid())return`${this.browserName.chrome} ${this.browserSupport.chrome}+, ${this.browserName.samsung} ${this.browserSupport.samsung}+`;const t=[];for(const e in this.browserSupport)t.push(`${this.browserName[e]} ${this.browserSupport[e]}+`);return t.join(", ")}supportedVideoCodecs(){return __awaiter$$(this,void 0,void 0,function*(){const t=new RTCPeerConnection;return t.addTransceiver("video",{direction:"inactive",streams:[]}),(yield t.createOffer({offerToReceiveVideo:!0})).sdp.split(`\r
`).filter(e=>e.includes("a=rtpmap:")).map(e=>e.replace(/.* /,"").replace(/\/.*/,"")).filter((e,n,o)=>o.indexOf(e)===n).filter(e=>e!=="rtx"&&e!=="red"&&e!=="ulpfec")})}supportsSetSinkId(){return"setSinkId"in HTMLAudioElement.prototype}disableResolutionScaleDown(){return this.isAndroid()}disable480pResolutionScaleDown(){return/( Chrome\/98\.)/i.test(navigator.userAgent)&&this.browser.os.startsWith("Windows")}requiresDisablingH264Encoding(){return(this.isIOSSafari()||this.isIOSChrome()||this.isIOSFirefox())&&(this.version()==="15.1.0"||/( OS 15_1)/i.test(navigator.userAgent))}requiresVideoPlayWorkaround(){return this.isSafari()}isIOSSafari(){return this.browser.name==="ios"||this.browser.name==="ios-webview"||this.browser.name==="safari"&&/( Mac )/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1}isSafari(){return this.browser.name==="safari"||this.isIOSSafari()}isFirefox(){return this.browser.name==="firefox"}isIOSFirefox(){return this.browser.name==="fxios"}isIOSChrome(){return this.browser.name==="crios"}isChrome(){return this.browser.name==="chrome"}isEdge(){return this.browser.name==="edge-chromium"}isSamsungInternet(){return this.browser.name==="samsung"}isAndroid(){return/(android)/i.test(navigator.userAgent)}isPixel3(){return/( pixel 3)/i.test(navigator.userAgent)}}DefaultBrowserBehavior$1.default=DefaultBrowserBehavior;var Versioning$1={},version={};Object.defineProperty(version,"__esModule",{value:!0});version.default={hash:"8ebe622",raw:"v3.6.0",semverString:"3.6.0"};Object.defineProperty(Versioning$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$a=DefaultBrowserBehavior$1,version_1=version;class Versioning{static get sdkName(){return"amazon-chime-sdk-js"}static get sdkVersion(){return version_1.default.semverString}static get sdkVersionSemVer(){var t,e,n,o;const a=version_1.default.semverString.match(/^(?<major>[0-9]+)\.(?<minor>[0-9]+)((?:\.(?<patch>[0-9]+))(?:-(?<preRelease>[a-zA-Z]+(\.[0-9])*))?)?/);return{major:(t=a==null?void 0:a.groups)===null||t===void 0?void 0:t.major,minor:(e=a==null?void 0:a.groups)===null||e===void 0?void 0:e.minor,patch:(n=a==null?void 0:a.groups)===null||n===void 0?void 0:n.patch,preRelease:(o=a==null?void 0:a.groups)===null||o===void 0?void 0:o.preRelease}}static get buildSHA(){return version_1.default.hash.substr(1)}static get sdkUserAgentLowResolution(){const t=new DefaultBrowserBehavior_1$a.default;return`${t.name()}-${t.majorVersion()}`}static urlWithVersion(t){const e=new URL(t);return e.searchParams.append(Versioning.X_AMZN_VERSION,Versioning.sdkVersion),e.searchParams.append(Versioning.X_AMZN_USER_AGENT,Versioning.sdkUserAgentLowResolution),e.toString()}}Versioning$1.default=Versioning;Versioning.X_AMZN_VERSION="X-Amzn-Version";Versioning.X_AMZN_USER_AGENT="X-Amzn-User-Agent";var __awaiter$_=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BackgroundFilterVideoFrameProcessor$1,"__esModule",{value:!0});const loader_1$1=loader,support_1=support,ModelSpecBuilder_1=ModelSpecBuilder$1,DefaultBrowserBehavior_1$9=DefaultBrowserBehavior$1,Versioning_1$7=Versioning$1,CREATE_DEFAULT_MODEL_SPEC=()=>ModelSpecBuilder_1.default.builder().withSelfieSegmentationDefaults().build(),DEFAULT_CDN$1="https://static.sdkassets.chime.aws",DEFAULT_PATHS$1={worker:`${DEFAULT_CDN$1}/bgblur/workers/worker.js`,wasm:`${DEFAULT_CDN$1}/bgblur/wasm/_cwt-wasm.wasm`,simd:`${DEFAULT_CDN$1}/bgblur/wasm/_cwt-wasm-simd.wasm`};class BackgroundFilterVideoFrameProcessor{static defaultAssetSpec(){const t=Versioning_1$7.default.sdkVersionSemVer;return{assetGroup:`sdk-${t.major}.${t.minor}`}}static createUrlWithParams(t,e){const n=new URL(t),o=Object.keys(e);for(const a of o)e[a]!==void 0&&n.searchParams.set(a,e[a]);return n.toString()}static resolveSpec(t){const{paths:e=DEFAULT_PATHS$1,model:n=CREATE_DEFAULT_MODEL_SPEC(),assetGroup:o=this.defaultAssetSpec().assetGroup,revisionID:a=this.defaultAssetSpec().revisionID}=t||{},s={assetGroup:o,revisionID:a,sdk:encodeURIComponent(Versioning_1$7.default.sdkVersion),ua:encodeURIComponent(Versioning_1$7.default.sdkUserAgentLowResolution)};return e.worker=this.createUrlWithParams(e.worker,s),e.wasm=this.createUrlWithParams(e.wasm,s),e.simd=this.createUrlWithParams(e.simd,s),n.path=this.createUrlWithParams(n.path,s),{paths:e,model:n,assetGroup:o,revisionID:a}}static resolveOptions(t){t.reportingPeriodMillis||(t.reportingPeriodMillis=1e3);const e=30;return t.filterCPUUtilization?(t.filterCPUUtilization<0||t.filterCPUUtilization>100)&&(t.logger.warn(`filterCPUUtilization must be set to a range between 0 and 100 percent. Falling back to default of ${e} percent`),t.filterCPUUtilization=e):t.filterCPUUtilization=e,t}static isSupported(t,e){const{logger:n}=e;return typeof globalThis>"u"?(n.info("Browser does not have globalThis."),Promise.resolve(!1)):new DefaultBrowserBehavior_1$9.default().supportsBackgroundFilter()?support_1.supportsWASM(globalThis,n)?this.supportsBackgroundFilter(globalThis,t,n):(n.info("Browser does not support WASM."),Promise.resolve(!1)):(n.info("Browser is not supported."),Promise.resolve(!1))}static supportsBackgroundFilter(t=globalThis,e,n){return __awaiter$_(this,void 0,void 0,function*(){if(!support_1.supportsWorker(t,n))return n.info("Browser does not support web workers."),!1;const o=e.paths.worker;try{const a=yield loader_1$1.loadWorker(o,"BackgroundFilterWorker",{},null);try{a.terminate()}catch(s){n.info(`Failed to terminate worker. ${s.message}`)}return!0}catch(a){return n.info(`Failed to fetch and instantiate test worker ${a.message}`),!1}})}}BackgroundFilterVideoFrameProcessor$1.default=BackgroundFilterVideoFrameProcessor;var ConsoleLogger$1={};Object.defineProperty(ConsoleLogger$1,"__esModule",{value:!0});const LogLevel_1$7=LogLevel;class ConsoleLogger{constructor(t,e=LogLevel_1$7.default.WARN){this.name=t,this.level=e}info(t){this.log(LogLevel_1$7.default.INFO,t)}warn(t){this.log(LogLevel_1$7.default.WARN,t)}error(t){this.log(LogLevel_1$7.default.ERROR,t)}debug(t){LogLevel_1$7.default.DEBUG<this.level||(typeof t=="string"?this.log(LogLevel_1$7.default.DEBUG,t):t?this.log(LogLevel_1$7.default.DEBUG,t()):this.log(LogLevel_1$7.default.DEBUG,""+t))}setLogLevel(t){this.level=t}getLogLevel(){return this.level}log(t,e){if(t<this.level)return;const o=`${new Date().toISOString()} [${LogLevel_1$7.default[t]}] ${this.name} - ${e}`;switch(t){case LogLevel_1$7.default.ERROR:console.error(o);break;case LogLevel_1$7.default.WARN:console.warn(o);break;case LogLevel_1$7.default.DEBUG:console.debug(o.replace(/\\r\\n/g,`
`));break;case LogLevel_1$7.default.INFO:console.info(o);break}}}ConsoleLogger$1.default=ConsoleLogger;var NoOpVideoFrameProcessor$1={},__awaiter$Z=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(NoOpVideoFrameProcessor$1,"__esModule",{value:!0});class NoOpVideoFrameProcessor{process(t){return __awaiter$Z(this,void 0,void 0,function*(){return t})}destroy(){return __awaiter$Z(this,void 0,void 0,function*(){})}}NoOpVideoFrameProcessor$1.default=NoOpVideoFrameProcessor;var BackgroundBlurProcessorBuiltIn$1={},BackgroundBlurProcessorProvided$1={},BackgroundFilterProcessor$1={},CanvasVideoFrameBuffer$1={},__awaiter$Y=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(CanvasVideoFrameBuffer$1,"__esModule",{value:!0});class CanvasVideoFrameBuffer{constructor(t){this.canvas=t,this.destroyed=!1}destroy(){this.canvas=null,this.destroyed=!0}asCanvasImageSource(){return __awaiter$Y(this,void 0,void 0,function*(){return this.destroyed?Promise.reject("canvas buffer is destroyed"):Promise.resolve(this.canvas)})}asCanvasElement(){return this.canvas}}CanvasVideoFrameBuffer$1.default=CanvasVideoFrameBuffer;var BackgroundFilterFrameCounter$1={};Object.defineProperty(BackgroundFilterFrameCounter$1,"__esModule",{value:!0});const FILTER_DURATION_FACTOR=.8;class BackgroundFilterFrameCounter{constructor(t,e,n,o){this.delegate=t,this.reportingPeriodMillis=e,this.filterCPUUtilization=n,this.logger=o,this._processingFilter=!0,this.lastReportedEventTimestamp=0,this.lastFilterCompleteTimestamp=0,this.filterTotalMillis=0,this.filterCount=0,this.framerate=0,this.filterDurationNotifyMillis=0,this.setSegmentationDuration()}reportEvent(t){const e=t-this.lastReportedEventTimestamp;if(e>=this.reportingPeriodMillis){const n=this.filterCount,o=this.filterTotalMillis;if(this.filterCount=0,this.filterTotalMillis=0,this.lastReportedEventTimestamp=t,this.framerate===0||n===0)return;const a=Math.round(o/n),s=Math.round(this.framerate*(e/1e3))-n,d=Math.round(100*o/e);a>=this.filterDurationNotifyMillis&&this.delegate.filterFrameDurationHigh({framesDropped:s,avgFilterDurationMillis:a,framerate:this.framerate,periodMillis:e}),d>=this.filterCPUUtilization&&this.delegate.filterCPUUtilizationHigh({cpuUtilization:d,filterMillis:o,periodMillis:e})}}setSegmentationDuration(){this.filterDurationNotifyMillis=Math.round(1e3/this.framerate*FILTER_DURATION_FACTOR)}frameReceived(t){t!==this.framerate&&(this.framerate=t,this.logger.info(`frame counter setting frame rate to ${this.framerate}`),this.setSegmentationDuration());const e=Date.now();this.reportEvent(e)}filterSubmitted(){this._processingFilter=!0,this.lastFilterCompleteTimestamp=Date.now()}filterComplete(){this.filterTotalMillis+=Date.now()-this.lastFilterCompleteTimestamp,this._processingFilter=!1,this.filterCount++}get processingSegment(){return this._processingFilter}}BackgroundFilterFrameCounter$1.default=BackgroundFilterFrameCounter;var __awaiter$X=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BackgroundFilterProcessor$1,"__esModule",{value:!0});BackgroundFilterProcessor$1.BackgroundFilterMonitor=void 0;const loader_1=loader,CanvasVideoFrameBuffer_1$1=CanvasVideoFrameBuffer$1,BackgroundFilterFrameCounter_1=BackgroundFilterFrameCounter$1;class DeferredObservable{constructor(){this.value=void 0,this.resolve=null}whenNext(){return this.promise||(this.promise=new Promise(t=>this.resolve=t)),this.promise}next(t){this.value=t,this.resolve(t),delete this.promise}}class BackgroundFilterProcessor{constructor(t,e,n,o){this.targetCanvas=document.createElement("canvas"),this.canvasCtx=this.targetCanvas.getContext("2d"),this.canvasVideoFrameBuffer=new CanvasVideoFrameBuffer_1$1.default(this.targetCanvas),this.mask$=new DeferredObservable,this.sourceWidth=0,this.sourceHeight=0,this.frameNumber=0,this.videoFramesPerFilterUpdate=1,this.initWorkerPromise=BackgroundFilterProcessor.createWorkerPromise(),this.loadModelPromise=BackgroundFilterProcessor.createWorkerPromise(),this.modelInitialized=!1,this.destroyed=!1,this.filterType=t,this.validateSpec(e),this.validateOptions(n),this.spec=e,this.logger=n.logger,this.delegate=o,this.initCPUMonitor(n)}static createWorkerPromise(){const t={resolve:null,reject:null,promise:null};return t.promise=new Promise((e,n)=>{t.resolve=e,t.reject=n}),t}validateSpec(t){if(!t)throw new Error("processor has null spec");if(!t.model)throw new Error("processor spec has null model");if(!t.paths)throw new Error("processor spec has null paths")}validateOptions(t){if(!t)throw new Error("processor has null options");if(!t.logger)throw new Error("processor has null options - logger");if(!t.reportingPeriodMillis)throw new Error("processor has null options - reportingPeriodMillis");if(!t.filterCPUUtilization)throw new Error("processor has null options - filterCPUUtilization")}initCPUMonitor(t){this.videoFramesPerFilterUpdate=1,this.frameCounter=new BackgroundFilterFrameCounter_1.default(this.delegate,t.reportingPeriodMillis,t.filterCPUUtilization,this.logger),this.cpuMonitor=new BackgroundFilterMonitor(5e3,{reduceCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.min(this.videoFramesPerFilterUpdate+1,10))},increaseCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.max(this.videoFramesPerFilterUpdate-1,1))}}),this.delegate.addObserver(this.cpuMonitor)}stringify(t){return JSON.stringify(t,null,2)}handleInitialize(t){if(this.logger.info(`received initialize message: ${this.stringify(t)}`),!t.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}const e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:0}}),this.initWorkerPromise.resolve({})}handleLoadModel(t){if(this.logger.info(`received load model message: ${this.stringify(t)}`),t.payload!==2){this.logger.error("failed to load model! status: "+t.payload),this.loadModelPromise.reject(new Error("failed to load model! status: "+t.payload));return}this.modelInitialized=!0,this.loadModelPromise.resolve({})}handlePredict(t){this.mask$.next(t.payload.output)}handleWorkerEvent(t){const e=t.data;switch(e.msg){case"initialize":this.handleInitialize(e);break;case"loadModel":this.handleLoadModel(e);break;case"predict":this.handlePredict(e);break;default:this.logger.info(`unexpected event msg: ${this.stringify(e)}`);break}}loadAssets(){return __awaiter$X(this,void 0,void 0,function*(){this.logger.info("start initializing the processor");try{this.worker=yield loader_1.loadWorker(this.spec.paths.worker,"BackgroundFilterWorker",{},null),this.worker.addEventListener("message",t=>this.handleWorkerEvent(t)),this.worker.postMessage({msg:"initialize",payload:{wasmPath:this.spec.paths.wasm,simdPath:this.spec.paths.simd}}),yield this.initWorkerPromise.promise,this.logger.info(`successfully initialized the ${this.filterType} worker`),yield this.loadModelPromise.promise,this.logger.info(`successfully loaded ${this.filterType} worker segmentation model`)}catch(t){throw new Error(`could not initialize the ${this.filterType} video frame processor due to '${t.message}'`)}this.logger.info(`successfully initialized the ${this.filterType} processor`)})}process(t){return __awaiter$X(this,void 0,void 0,function*(){if(this.destroyed)return t;this.frameCounter.frameReceived(t[0].framerate),this.cpuMonitor.frameReceived();const e=t[0].asCanvasElement();if(!e)return t;if(!this.modelInitialized)return t[0]=this.canvasVideoFrameBuffer,t;const n=e.width,o=e.height;if(n===0||o===0)return t;this.sourceWidth===0&&(this.sourceWidth=n,this.sourceHeight=o,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight,this.logger.info(`${this.filterType} source width: ${this.sourceWidth}`),this.logger.info(`${this.filterType} source height: ${this.sourceHeight}`),this.initOnFirstExecution()),(this.sourceWidth!==n||this.sourceHeight!==o)&&(this.sourceWidth=n,this.sourceHeight=o,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight);try{this.frameCounter.filterSubmitted();let a=this.mask$.value;const s=this.spec.model.input.width/e.width,d=this.spec.model.input.height/e.height;this.scaledCanvas===void 0&&(this.scaledCanvas=document.createElement("canvas"),this.scaledCanvas.width=this.spec.model.input.width,this.scaledCanvas.height=this.spec.model.input.height);const u=this.scaledCanvas.getContext("2d");u.save(),u.scale(s,d),u.drawImage(e,0,0),u.restore();const c=u.getImageData(0,0,this.scaledCanvas.width,this.scaledCanvas.height);if(this.frameNumber%this.videoFramesPerFilterUpdate===0){const l=this.mask$.whenNext();this.worker.postMessage({msg:"predict",payload:c},[c.data.buffer]),a=yield l}this.destroyed||this.drawImageWithMask(e,a)}catch(a){return this.logger.error(`could not process ${this.filterType} frame buffer due to ${a}`),t}finally{this.frameCounter.filterComplete(),this.frameNumber++}return t[0]=this.canvasVideoFrameBuffer,t})}updateVideoFramesPerFilterUpdate(t){t!==this.videoFramesPerFilterUpdate&&(this.videoFramesPerFilterUpdate=t,this.logger.info(`Adjusting filter rate to compensate for CPU utilization. Filter rate is ${this.videoFramesPerFilterUpdate} video frames per filter.`))}destroy(){var t,e,n,o;return __awaiter$X(this,void 0,void 0,function*(){this.destroyed=!0,this.delegate.removeObserver(this.cpuMonitor),this.canvasVideoFrameBuffer.destroy(),(t=this.worker)===null||t===void 0||t.postMessage({msg:"destroy"}),(e=this.worker)===null||e===void 0||e.postMessage({msg:"stop"}),(n=this.targetCanvas)===null||n===void 0||n.remove(),this.targetCanvas=void 0,(o=this.scaledCanvas)===null||o===void 0||o.remove(),this.scaledCanvas=void 0,this.logger.info(`${this.filterType} frame process destroyed`)})}}BackgroundFilterProcessor$1.default=BackgroundFilterProcessor;class BackgroundFilterMonitor{constructor(t,e){this.monitoringPeriodMillis=t,this.observer=e,this.lastCPUChangeTimestamp=0}filterCPUUtilizationHigh(){const t=Date.now();t-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=t,this.observer.reduceCPUUtilization())}frameReceived(){const t=Date.now();t-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis*2&&(this.lastCPUChangeTimestamp=t,this.observer.increaseCPUUtilization())}}BackgroundFilterProcessor$1.BackgroundFilterMonitor=BackgroundFilterMonitor;var BackgroundBlurVideoFrameProcessorDelegate$1={},BackgroundFilterVideoFrameProcessorDelegate$1={};Object.defineProperty(BackgroundFilterVideoFrameProcessorDelegate$1,"__esModule",{value:!0});class BackgroundFilterVideoFrameProcessorDelegate{constructor(){this.observers=new Set}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}filterFrameDurationHigh(t){var e;for(const n of this.observers)(e=n.filterFrameDurationHigh)===null||e===void 0||e.call(n,t)}filterCPUUtilizationHigh(t){var e;for(const n of this.observers)(e=n.filterCPUUtilizationHigh)===null||e===void 0||e.call(n,t)}}BackgroundFilterVideoFrameProcessorDelegate$1.default=BackgroundFilterVideoFrameProcessorDelegate;Object.defineProperty(BackgroundBlurVideoFrameProcessorDelegate$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessorDelegate_1$1=BackgroundFilterVideoFrameProcessorDelegate$1;class BackgroundBlurVideoFrameProcessorDelegate extends BackgroundFilterVideoFrameProcessorDelegate_1$1.default{}BackgroundBlurVideoFrameProcessorDelegate$1.default=BackgroundBlurVideoFrameProcessorDelegate;var __awaiter$W=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BackgroundBlurProcessorProvided$1,"__esModule",{value:!0});const BackgroundFilterProcessor_1$1=BackgroundFilterProcessor$1,BackgroundBlurStrength_1$2=BackgroundBlurStrength,BackgroundBlurVideoFrameProcessorDelegate_1=BackgroundBlurVideoFrameProcessorDelegate$1;class BackgroundBlurProcessorProvided extends BackgroundFilterProcessor_1$1.default{constructor(t,e){super("background blur",t,e,new BackgroundBlurVideoFrameProcessorDelegate_1.default),this.blurAmount=0,this.setBlurStrength(e.blurStrength),this.logger.info("BackgroundBlur processor successfully created"),this.logger.info(`BackgroundBlur spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundBlur options: ${this.stringify(e)}`)}validateOptions(t){if(super.validateOptions(t),!t.blurStrength)throw new Error("processor has null options - blurStrength")}initOnFirstExecution(){this.setBlurPixels()}drawImageWithMask(t,e){e||(e=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(e,0,0);const{canvasCtx:o,targetCanvas:a}=this,{width:s,height:d}=a;o.save(),o.clearRect(0,0,s,d),o.drawImage(this.scaledCanvas,0,0,s,d),o.globalCompositeOperation="source-in",o.drawImage(t,0,0,s,d),o.globalCompositeOperation="destination-over",o.filter=`blur(${this.blurAmount}px)`,o.drawImage(t,0,0,a.width,a.height),o.restore()}setBlurStrength(t){this._blurStrength=t,this.logger.info(`blur strength set to ${this._blurStrength}`),this.setBlurPixels()}setBlurPixels(){this.blurAmount=BackgroundBlurStrength_1$2.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:this.sourceHeight}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}static isSupported(){return __awaiter$W(this,void 0,void 0,function*(){const t=document.createElement("canvas"),e=t.getContext("2d").filter!==void 0;return t.remove(),e})}}BackgroundBlurProcessorProvided$1.default=BackgroundBlurProcessorProvided;var __awaiter$V=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BackgroundBlurProcessorBuiltIn$1,"__esModule",{value:!0});const BackgroundBlurProcessorProvided_1$1=BackgroundBlurProcessorProvided$1,BackgroundBlurStrength_1$1=BackgroundBlurStrength;class BackgroundBlurProcessorBuiltIn extends BackgroundBlurProcessorProvided_1$1.default{constructor(t,e){super(t,e),this.blurCanvas=document.createElement("canvas"),this.blurCanvasCtx=this.blurCanvas.getContext("2d"),this.blurCanvas.width=this.spec.model.input.width,this.blurCanvas.height=this.spec.model.input.height,this.logger.info("BackgroundBlur processor using builtin blur")}drawImageWithMask(t,e){const n=this.blurredImage,{canvasCtx:o,targetCanvas:a}=this,{width:s,height:d}=a;if(!e||!n){o.clearRect(0,0,s,d);return}this.scaledCanvas.getContext("2d").putImageData(e,0,0),this.blurCanvasCtx.putImageData(this.blurredImage,0,0),o.save(),o.clearRect(0,0,s,d),o.drawImage(this.scaledCanvas,0,0,s,d),o.globalCompositeOperation="source-in",o.drawImage(t,0,0,s,d),o.globalCompositeOperation="destination-over",o.drawImage(this.blurCanvas,0,0,s,d),o.restore()}setBlurStrength(t){if(super.setBlurStrength(t),this.worker){this.modelInitialized=!1,this.worker.postMessage({msg:"destroy"});const e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}})}}setBlurPixels(){this.blurAmount=BackgroundBlurStrength_1$1.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:540}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}handleInitialize(t){if(this.logger.info(`received initialize message: ${this.stringify(t)}`),!t.payload){this.logger.error("failed to initialize module"),this.initWorkerPromise.reject(new Error("failed to initialize the module"));return}const e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}}),this.initWorkerPromise.resolve({})}handlePredict(t){this.blurredImage=t.payload.blurOutput,super.handlePredict(t)}destroy(){const t=Object.create(null,{destroy:{get:()=>super.destroy}});var e;return __awaiter$V(this,void 0,void 0,function*(){t.destroy.call(this),(e=this.blurCanvas)===null||e===void 0||e.remove(),this.blurCanvas=void 0})}}BackgroundBlurProcessorBuiltIn$1.default=BackgroundBlurProcessorBuiltIn;var __awaiter$U=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BackgroundBlurVideoFrameProcessor$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessor_1$1=BackgroundFilterVideoFrameProcessor$1,ConsoleLogger_1$1=ConsoleLogger$1,LogLevel_1$6=LogLevel,NoOpVideoFrameProcessor_1$1=NoOpVideoFrameProcessor$1,BackgroundBlurProcessorBuiltIn_1=BackgroundBlurProcessorBuiltIn$1,BackgroundBlurProcessorProvided_1=BackgroundBlurProcessorProvided$1,BackgroundBlurStrength_1=BackgroundBlurStrength;class NoOpBackgroundBlurProcessor extends NoOpVideoFrameProcessor_1$1.default{setBlurStrength(){}loadAssets(){return __awaiter$U(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}}class BackgroundBlurVideoFrameProcessor extends BackgroundFilterVideoFrameProcessor_1$1.default{static create(t,e){return __awaiter$U(this,void 0,void 0,function*(){t=BackgroundBlurVideoFrameProcessor.resolveSpec(t),e=BackgroundBlurVideoFrameProcessor.resolveOptions(e);const{logger:n}=e,o=yield BackgroundBlurVideoFrameProcessor.isSupported(t,e);if(n.info(`processor is ${o?"":"not"} supported`),!o)return n.warn("Using no-op processor because background blur is not supported"),new NoOpBackgroundBlurProcessor;let a;return(yield BackgroundBlurProcessorProvided_1.default.isSupported())?(n.info("Using browser-provided background blur"),a=new BackgroundBlurProcessorProvided_1.default(t,e)):(n.info("Using built-in background blur"),a=new BackgroundBlurProcessorBuiltIn_1.default(t,e)),yield a.loadAssets(),a})}static resolveOptions(t={}){let e=Object.assign({},t);return e.blurStrength||(e.blurStrength=BackgroundBlurStrength_1.default.MEDIUM),e.logger||(e.logger=new ConsoleLogger_1$1.default("BackgroundBlurProcessor",LogLevel_1$6.default.INFO)),e=super.resolveOptions(e),e}static isSupported(t,e){return t=BackgroundBlurVideoFrameProcessor.resolveSpec(t),e=BackgroundBlurVideoFrameProcessor.resolveOptions(e),super.isSupported(t,e)}}BackgroundBlurVideoFrameProcessor$1.default=BackgroundBlurVideoFrameProcessor;var BackgroundReplacementVideoFrameProcessor$1={},BackgroundReplacementFilter$1={},BackgroundReplacementVideoFrameProcessorDelegate$1={};Object.defineProperty(BackgroundReplacementVideoFrameProcessorDelegate$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessorDelegate_1=BackgroundFilterVideoFrameProcessorDelegate$1;class BackgroundReplacementVideoFrameProcessorDelegate extends BackgroundFilterVideoFrameProcessorDelegate_1.default{}BackgroundReplacementVideoFrameProcessorDelegate$1.default=BackgroundReplacementVideoFrameProcessorDelegate;var __awaiter$T=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BackgroundReplacementFilter$1,"__esModule",{value:!0});const BackgroundFilterProcessor_1=BackgroundFilterProcessor$1,BackgroundReplacementVideoFrameProcessorDelegate_1=BackgroundReplacementVideoFrameProcessorDelegate$1;class BackgroundReplacementFilter extends BackgroundFilterProcessor_1.default{constructor(t,e){super("background replacement",t,e,new BackgroundReplacementVideoFrameProcessorDelegate_1.default),this.replacementBlob=e.imageBlob,this.logger.info("BackgroundReplacement processor successfully created"),this.logger.info(`BackgroundReplacement spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundReplacement options: ${this.stringify(e)}`)}setImageBlob(t){return __awaiter$T(this,void 0,void 0,function*(){this.replacementBlob=t,this.replacementImage=yield BackgroundReplacementFilter.loadImage(this.createReplacementObjectUrl())})}initOnFirstExecution(){}drawImageWithMask(t,e){e||(e=new ImageData(this.spec.model.input.width,this.spec.model.input.height)),this.scaledCanvas.getContext("2d").putImageData(e,0,0);const{canvasCtx:o,targetCanvas:a}=this,{width:s,height:d}=a;o.save(),o.clearRect(0,0,s,d),o.drawImage(this.scaledCanvas,0,0,s,d),o.globalCompositeOperation="source-in",o.drawImage(t,0,0,s,d),o.globalCompositeOperation="destination-over",o.drawImage(this.replacementImage,0,0,a.width,a.height),o.restore()}static loadImageExecutor(t,e,n){const o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",()=>{t(o)},!1),o.addEventListener("error",a=>{e(new Error(`Could not load replacement image ${o.src}: ${a.message}`))},!1),o.src=n}static loadImage(t){return __awaiter$T(this,void 0,void 0,function*(){return new Promise((e,n)=>this.loadImageExecutor(e,n,t))})}revokeReplacementObjectUrl(){this.replacementObjectUrl&&URL.revokeObjectURL(this.replacementObjectUrl)}createReplacementObjectUrl(){return this.revokeReplacementObjectUrl(),this.replacementObjectUrl=URL.createObjectURL(this.replacementBlob),this.replacementObjectUrl}loadAssets(){const t=Object.create(null,{loadAssets:{get:()=>super.loadAssets}});return __awaiter$T(this,void 0,void 0,function*(){this.replacementImage=yield BackgroundReplacementFilter.loadImage(this.createReplacementObjectUrl()),t.loadAssets.call(this)})}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}destroy(){const t=Object.create(null,{destroy:{get:()=>super.destroy}});return __awaiter$T(this,void 0,void 0,function*(){t.destroy.call(this),this.revokeReplacementObjectUrl()})}}BackgroundReplacementFilter$1.default=BackgroundReplacementFilter;var __awaiter$S=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(BackgroundReplacementVideoFrameProcessor$1,"__esModule",{value:!0});const BackgroundFilterVideoFrameProcessor_1=BackgroundFilterVideoFrameProcessor$1,ConsoleLogger_1=ConsoleLogger$1,LogLevel_1$5=LogLevel,NoOpVideoFrameProcessor_1=NoOpVideoFrameProcessor$1,BackgroundReplacementFilter_1=BackgroundReplacementFilter$1;class NoOpBackgroundReplacementProcessor extends NoOpVideoFrameProcessor_1.default{loadAssets(){return __awaiter$S(this,void 0,void 0,function*(){})}addObserver(){}removeObserver(){}setImageBlob(){return __awaiter$S(this,void 0,void 0,function*(){})}}class BackgroundReplacementVideoFrameProcessor extends BackgroundFilterVideoFrameProcessor_1.default{static create(t,e){return __awaiter$S(this,void 0,void 0,function*(){t=this.resolveSpec(t),e=this.resolveOptions(e),yield this.resolveOptionsAsync(e);const{logger:n}=e;if(!(yield BackgroundReplacementVideoFrameProcessor.isSupported(t,e)))return n.warn("Using no-op processor because background replacement is not supported"),new NoOpBackgroundReplacementProcessor;n.info("Using background replacement filter");const a=new BackgroundReplacementFilter_1.default(t,e);return yield a.loadAssets(),a})}static resolveOptions(t={}){const e=Object.assign({},t);return e.logger||(e.logger=new ConsoleLogger_1.default("BackgroundReplacementProcessor",LogLevel_1$5.default.INFO)),super.resolveOptions(e)}static resolveOptionsAsync(t){return __awaiter$S(this,void 0,void 0,function*(){if(!t.imageBlob){const e=document.createElement("canvas");e.width=100,e.height=100;const n=e.getContext("2d");n.fillStyle="blue",n.fillRect(0,0,100,100);const o=yield new Promise(a=>{e.toBlob(a)});t.imageBlob=o}})}static isSupported(t,e){const n=Object.create(null,{isSupported:{get:()=>super.isSupported}});return __awaiter$S(this,void 0,void 0,function*(){t=this.resolveSpec(t),e=this.resolveOptions(e),yield this.resolveOptionsAsync(e);const o=e.imageBlob,a=URL.createObjectURL(o);try{yield BackgroundReplacementFilter_1.default.loadImage(a)}catch(s){return e.logger.info(`Failed to fetch load replacement image ${s.message}`),!1}finally{URL.revokeObjectURL(a)}return n.isSupported.call(this,t,e)})}}BackgroundReplacementVideoFrameProcessor$1.default=BackgroundReplacementVideoFrameProcessor;var BaseConnectionHealthPolicy$1={};Object.defineProperty(BaseConnectionHealthPolicy$1,"__esModule",{value:!0});class BaseConnectionHealthPolicy{constructor(t,e){this.minHealth=t.minHealth,this.maxHealth=t.maxHealth,this.currentHealth=t.initialHealth,this.currentData=e.clone()}minimumHealth(){return this.minHealth}maximumHealth(){return this.maxHealth}health(){return this.maximumHealth()}update(t){this.currentData=t}getConnectionHealthData(){return this.currentData.clone()}healthy(){return this.health()>this.minimumHealth()}healthIfChanged(){const t=this.health();return t!==this.currentHealth?(this.currentHealth=t,t):null}}BaseConnectionHealthPolicy$1.default=BaseConnectionHealthPolicy;var BitrateParameters$1={};Object.defineProperty(BitrateParameters$1,"__esModule",{value:!0});class BitrateParameters{}BitrateParameters$1.default=BitrateParameters;var CSPMonitor$1={};Object.defineProperty(CSPMonitor$1,"__esModule",{value:!0});class CSPMonitor{static register(){!("document"in commonjsGlobal)||!document.addEventListener||CSPMonitor.shouldRegisterCSPMonitor&&(CSPMonitor.added||(document.addEventListener("securitypolicyviolation",CSPMonitor.listener),CSPMonitor.added=!0))}static unregister(){!("document"in commonjsGlobal)||!document.removeEventListener||(document.removeEventListener("securitypolicyviolation",CSPMonitor.listener),CSPMonitor.loggers=new Set,CSPMonitor.added=!1)}static disable(){CSPMonitor.shouldRegisterCSPMonitor=!1,CSPMonitor.unregister()}static addLogger(t){t&&CSPMonitor.loggers.add(t)}static removeLogger(t){t&&CSPMonitor.loggers.delete(t)}}CSPMonitor$1.default=CSPMonitor;CSPMonitor.loggers=new Set;CSPMonitor.shouldRegisterCSPMonitor=!0;CSPMonitor.added=!1;CSPMonitor.listener=r=>{const t=`Security Policy Violation
Blocked URI: ${r.blockedURI}
Violated Directive: ${r.violatedDirective}
Original Policy: ${r.originalPolicy}
Document URI: ${r.documentURI}
Source File: ${r.sourceFile}
Line No.: ${r.lineNumber}
`;for(const e of CSPMonitor.loggers)e.error(t);CSPMonitor.loggers.size===0&&console.error(t)};var CheckAudioConnectivityFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckAudioConnectivityFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.AudioInputRequestFailed=1]="AudioInputRequestFailed",e[e.AudioInputPermissionDenied=2]="AudioInputPermissionDenied",e[e.ConnectionFailed=3]="ConnectionFailed",e[e.AudioNotReceived=4]="AudioNotReceived"})(t=r.CheckAudioConnectivityFeedback||(r.CheckAudioConnectivityFeedback={})),r.default=t})(CheckAudioConnectivityFeedback);var CheckAudioInputFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckAudioInputFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.PermissionDenied=2]="PermissionDenied"})(t=r.CheckAudioInputFeedback||(r.CheckAudioInputFeedback={})),r.default=t})(CheckAudioInputFeedback);var CheckAudioOutputFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckAudioOutputFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed"})(t=r.CheckAudioOutputFeedback||(r.CheckAudioOutputFeedback={})),r.default=t})(CheckAudioOutputFeedback);var CheckCameraResolutionFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckCameraResolutionFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.ResolutionNotSupported=2]="ResolutionNotSupported",e[e.PermissionDenied=3]="PermissionDenied"})(t=r.CheckCameraResolutionFeedback||(r.CheckCameraResolutionFeedback={})),r.default=t})(CheckCameraResolutionFeedback);var CheckContentShareConnectivityFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckContentShareConnectivityFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.PermissionDenied=2]="PermissionDenied",e[e.TimedOut=3]="TimedOut",e[e.ConnectionFailed=4]="ConnectionFailed"})(t=r.CheckContentShareConnectivityFeedback||(r.CheckContentShareConnectivityFeedback={})),r.default=t})(CheckContentShareConnectivityFeedback);var CheckNetworkTCPConnectivityFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckNetworkTCPConnectivityFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",e[e.ConnectionFailed=2]="ConnectionFailed",e[e.ICENegotiationFailed=3]="ICENegotiationFailed"})(t=r.CheckNetworkTCPConnectivityFeedback||(r.CheckNetworkTCPConnectivityFeedback={})),r.default=t})(CheckNetworkTCPConnectivityFeedback);var CheckNetworkUDPConnectivityFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckNetworkUDPConnectivityFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.MeetingSessionURLsNotInitialized=1]="MeetingSessionURLsNotInitialized",e[e.ConnectionFailed=2]="ConnectionFailed",e[e.ICENegotiationFailed=3]="ICENegotiationFailed"})(t=r.CheckNetworkUDPConnectivityFeedback||(r.CheckNetworkUDPConnectivityFeedback={})),r.default=t})(CheckNetworkUDPConnectivityFeedback);var CheckVideoConnectivityFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckVideoConnectivityFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.VideoInputRequestFailed=1]="VideoInputRequestFailed",e[e.VideoInputPermissionDenied=2]="VideoInputPermissionDenied",e[e.ConnectionFailed=3]="ConnectionFailed",e[e.VideoNotSent=4]="VideoNotSent"})(t=r.CheckVideoConnectivityFeedback||(r.CheckVideoConnectivityFeedback={})),r.default=t})(CheckVideoConnectivityFeedback);var CheckVideoInputFeedback={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckVideoInputFeedback=void 0;var t;(function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.PermissionDenied=2]="PermissionDenied"})(t=r.CheckVideoInputFeedback||(r.CheckVideoInputFeedback={})),r.default=t})(CheckVideoInputFeedback);var CleanRestartedSessionTask$1={},__awaiter$R=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(CleanRestartedSessionTask$1,"__esModule",{value:!0});const BaseTask_1$n=BaseTask$1;class CleanRestartedSessionTask extends BaseTask_1$n.default{constructor(t){super(t.logger),this.context=t,this.taskName="CleanRestartedSessionTask"}run(){return __awaiter$R(this,void 0,void 0,function*(){this.context.peer&&this.context.peer.close(),this.context.transceiverController.reset(),this.context.peer=null,this.context.videoDownlinkBandwidthPolicy.reset(),this.context.videoUplinkBandwidthPolicy.reset&&this.context.videoUplinkBandwidthPolicy.reset(),this.context.iceCandidateHandler=null,this.context.iceCandidates=[],this.context.previousSdpOffer=null})}}CleanRestartedSessionTask$1.default=CleanRestartedSessionTask;var CleanStoppedSessionTask$1={},SignalingClientEventType={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SignalingClientEventType=void 0;var t;(function(e){e[e.WebSocketConnecting=0]="WebSocketConnecting",e[e.WebSocketOpen=1]="WebSocketOpen",e[e.WebSocketError=2]="WebSocketError",e[e.WebSocketClosing=3]="WebSocketClosing",e[e.WebSocketClosed=4]="WebSocketClosed",e[e.WebSocketFailed=5]="WebSocketFailed",e[e.WebSocketMessage=6]="WebSocketMessage",e[e.WebSocketSendMessageFailure=7]="WebSocketSendMessageFailure",e[e.WebSocketSentMessage=8]="WebSocketSentMessage",e[e.ProtocolDecodeFailure=9]="ProtocolDecodeFailure",e[e.ReceivedSignalFrame=10]="ReceivedSignalFrame",e[e.WebSocketSkippedMessage=11]="WebSocketSkippedMessage"})(t=r.SignalingClientEventType||(r.SignalingClientEventType={})),r.default=t})(SignalingClientEventType);var __awaiter$Q=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(CleanStoppedSessionTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$b=SignalingClientEventType,BaseTask_1$m=BaseTask$1;class CleanStoppedSessionTask extends BaseTask_1$m.default{constructor(t){super(t.logger),this.context=t,this.taskName="CleanStoppedSessionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$Q(this,void 0,void 0,function*(){try{this.context.signalingClient.ready()&&(this.context.signalingClient.closeConnection(),yield this.receiveWebSocketClosedEvent())}catch(t){throw t}finally{for(const e of this.context.removableObservers)e.removeObserver();this.context.statsCollector.stop(),this.context.statsCollector=null,this.context.connectionMonitor.stop(),this.context.connectionMonitor=null,this.context.peer&&this.context.peer.close(),this.context.peer=null,this.context.sdpAnswer=null,this.context.sdpOfferInit=null,this.context.indexFrame=null,this.context.videoDownlinkBandwidthPolicy.reset(),this.context.videoUplinkBandwidthPolicy.reset&&this.context.videoUplinkBandwidthPolicy.reset(),this.context.iceCandidateHandler=null,this.context.iceCandidates=[],this.context.turnCredentials=null,this.context.videoSubscriptions=null,this.context.transceiverController.reset(),this.context.videoUplinkBandwidthPolicy.setTransceiverController&&this.context.videoUplinkBandwidthPolicy.setTransceiverController(void 0),this.context.videoDownlinkBandwidthPolicy.bindToTileController&&this.context.videoDownlinkBandwidthPolicy.bindToTileController(void 0);const t=this.context.videoTileController.getLocalVideoTile();t&&t.bindVideoStream("",!0,null,null,null,null),this.context.videoTileController.removeAllVideoTiles()}})}receiveWebSocketClosedEvent(){return new Promise((t,e)=>{class n{constructor(s){this.signalingClient=s}cancel(){this.signalingClient.removeObserver(this),e(new Error("CleanStoppedSessionTask got canceled while waiting for the WebSocket closed event"))}handleSignalingClientEvent(s){s.type===SignalingClientEventType_1$b.default.WebSocketClosed&&(this.signalingClient.removeObserver(this),t())}}const o=new n(this.context.signalingClient);this.taskCanceler=o,this.context.signalingClient.registerObserver(o)})}}CleanStoppedSessionTask$1.default=CleanStoppedSessionTask;var ClientMetricReport$1={},minimal$1={exports:{}},indexMinimal={},minimal={},aspromise=asPromise;function asPromise(r,t){for(var e=new Array(arguments.length-1),n=0,o=2,a=!0;o<arguments.length;)e[n++]=arguments[o++];return new Promise(function(d,u){e[n]=function(l){if(a)if(a=!1,l)u(l);else{for(var f=new Array(arguments.length-1),h=0;h<f.length;)f[h++]=arguments[h];d.apply(null,f)}};try{r.apply(t||null,e)}catch(c){a&&(a=!1,u(c))}})}var base64$1={};(function(r){var t=r;t.length=function(d){var u=d.length;if(!u)return 0;for(var c=0;--u%4>1&&d.charAt(u)==="=";)++c;return Math.ceil(d.length*3)/4-c};for(var e=new Array(64),n=new Array(123),o=0;o<64;)n[e[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;t.encode=function(d,u,c){for(var l=null,f=[],h=0,p=0,m;u<c;){var S=d[u++];switch(p){case 0:f[h++]=e[S>>2],m=(S&3)<<4,p=1;break;case 1:f[h++]=e[m|S>>4],m=(S&15)<<2,p=2;break;case 2:f[h++]=e[m|S>>6],f[h++]=e[S&63],p=0;break}h>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,f)),h=0)}return p&&(f[h++]=e[m],f[h++]=61,p===1&&(f[h++]=61)),l?(h&&l.push(String.fromCharCode.apply(String,f.slice(0,h))),l.join("")):String.fromCharCode.apply(String,f.slice(0,h))};var a="invalid encoding";t.decode=function(d,u,c){for(var l=c,f=0,h,p=0;p<d.length;){var m=d.charCodeAt(p++);if(m===61&&f>1)break;if((m=n[m])===void 0)throw Error(a);switch(f){case 0:h=m,f=1;break;case 1:u[c++]=h<<2|(m&48)>>4,h=m,f=2;break;case 2:u[c++]=(h&15)<<4|(m&60)>>2,h=m,f=3;break;case 3:u[c++]=(h&3)<<6|m,f=0;break}}if(f===1)throw Error(a);return c-l},t.test=function(d){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(d)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this};EventEmitter.prototype.off=function(t,e){if(t===void 0)this._listeners={};else if(e===void 0)this._listeners[t]=[];else for(var n=this._listeners[t],o=0;o<n.length;)n[o].fn===e?n.splice(o,1):++o;return this};EventEmitter.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],o=1;o<arguments.length;)n.push(arguments[o++]);for(o=0;o<e.length;)e[o].fn.apply(e[o++].ctx,n)}return this};var float=factory(factory);function factory(r){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),e=new Uint8Array(t.buffer),n=e[3]===128;function o(u,c,l){t[0]=u,c[l]=e[0],c[l+1]=e[1],c[l+2]=e[2],c[l+3]=e[3]}function a(u,c,l){t[0]=u,c[l]=e[3],c[l+1]=e[2],c[l+2]=e[1],c[l+3]=e[0]}r.writeFloatLE=n?o:a,r.writeFloatBE=n?a:o;function s(u,c){return e[0]=u[c],e[1]=u[c+1],e[2]=u[c+2],e[3]=u[c+3],t[0]}function d(u,c){return e[3]=u[c],e[2]=u[c+1],e[1]=u[c+2],e[0]=u[c+3],t[0]}r.readFloatLE=n?s:d,r.readFloatBE=n?d:s}():function(){function t(n,o,a,s){var d=o<0?1:0;if(d&&(o=-o),o===0)n(1/o>0?0:2147483648,a,s);else if(isNaN(o))n(2143289344,a,s);else if(o>34028234663852886e22)n((d<<31|2139095040)>>>0,a,s);else if(o<11754943508222875e-54)n((d<<31|Math.round(o/1401298464324817e-60))>>>0,a,s);else{var u=Math.floor(Math.log(o)/Math.LN2),c=Math.round(o*Math.pow(2,-u)*8388608)&8388607;n((d<<31|u+127<<23|c)>>>0,a,s)}}r.writeFloatLE=t.bind(null,writeUintLE),r.writeFloatBE=t.bind(null,writeUintBE);function e(n,o,a){var s=n(o,a),d=(s>>31)*2+1,u=s>>>23&255,c=s&8388607;return u===255?c?NaN:d*(1/0):u===0?d*1401298464324817e-60*c:d*Math.pow(2,u-150)*(c+8388608)}r.readFloatLE=e.bind(null,readUintLE),r.readFloatBE=e.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),e=new Uint8Array(t.buffer),n=e[7]===128;function o(u,c,l){t[0]=u,c[l]=e[0],c[l+1]=e[1],c[l+2]=e[2],c[l+3]=e[3],c[l+4]=e[4],c[l+5]=e[5],c[l+6]=e[6],c[l+7]=e[7]}function a(u,c,l){t[0]=u,c[l]=e[7],c[l+1]=e[6],c[l+2]=e[5],c[l+3]=e[4],c[l+4]=e[3],c[l+5]=e[2],c[l+6]=e[1],c[l+7]=e[0]}r.writeDoubleLE=n?o:a,r.writeDoubleBE=n?a:o;function s(u,c){return e[0]=u[c],e[1]=u[c+1],e[2]=u[c+2],e[3]=u[c+3],e[4]=u[c+4],e[5]=u[c+5],e[6]=u[c+6],e[7]=u[c+7],t[0]}function d(u,c){return e[7]=u[c],e[6]=u[c+1],e[5]=u[c+2],e[4]=u[c+3],e[3]=u[c+4],e[2]=u[c+5],e[1]=u[c+6],e[0]=u[c+7],t[0]}r.readDoubleLE=n?s:d,r.readDoubleBE=n?d:s}():function(){function t(n,o,a,s,d,u){var c=s<0?1:0;if(c&&(s=-s),s===0)n(0,d,u+o),n(1/s>0?0:2147483648,d,u+a);else if(isNaN(s))n(0,d,u+o),n(2146959360,d,u+a);else if(s>17976931348623157e292)n(0,d,u+o),n((c<<31|2146435072)>>>0,d,u+a);else{var l;if(s<22250738585072014e-324)l=s/5e-324,n(l>>>0,d,u+o),n((c<<31|l/4294967296)>>>0,d,u+a);else{var f=Math.floor(Math.log(s)/Math.LN2);f===1024&&(f=1023),l=s*Math.pow(2,-f),n(l*4503599627370496>>>0,d,u+o),n((c<<31|f+1023<<20|l*1048576&1048575)>>>0,d,u+a)}}}r.writeDoubleLE=t.bind(null,writeUintLE,0,4),r.writeDoubleBE=t.bind(null,writeUintBE,4,0);function e(n,o,a,s,d){var u=n(s,d+o),c=n(s,d+a),l=(c>>31)*2+1,f=c>>>20&2047,h=4294967296*(c&1048575)+u;return f===2047?h?NaN:l*(1/0):f===0?l*5e-324*h:l*Math.pow(2,f-1075)*(h+4503599627370496)}r.readDoubleLE=e.bind(null,readUintLE,0,4),r.readDoubleBE=e.bind(null,readUintBE,4,0)}(),r}function writeUintLE(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function writeUintBE(r,t,e){t[e]=r>>>24,t[e+1]=r>>>16&255,t[e+2]=r>>>8&255,t[e+3]=r&255}function readUintLE(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16|r[t+3]<<24)>>>0}function readUintBE(r,t){return(r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}var utf8$2={};(function(r){var t=r;t.length=function(n){for(var o=0,a=0,s=0;s<n.length;++s)a=n.charCodeAt(s),a<128?o+=1:a<2048?o+=2:(a&64512)===55296&&(n.charCodeAt(s+1)&64512)===56320?(++s,o+=4):o+=3;return o},t.read=function(n,o,a){var s=a-o;if(s<1)return"";for(var d=null,u=[],c=0,l;o<a;)l=n[o++],l<128?u[c++]=l:l>191&&l<224?u[c++]=(l&31)<<6|n[o++]&63:l>239&&l<365?(l=((l&7)<<18|(n[o++]&63)<<12|(n[o++]&63)<<6|n[o++]&63)-65536,u[c++]=55296+(l>>10),u[c++]=56320+(l&1023)):u[c++]=(l&15)<<12|(n[o++]&63)<<6|n[o++]&63,c>8191&&((d||(d=[])).push(String.fromCharCode.apply(String,u)),c=0);return d?(c&&d.push(String.fromCharCode.apply(String,u.slice(0,c))),d.join("")):String.fromCharCode.apply(String,u.slice(0,c))},t.write=function(n,o,a){for(var s=a,d,u,c=0;c<n.length;++c)d=n.charCodeAt(c),d<128?o[a++]=d:d<2048?(o[a++]=d>>6|192,o[a++]=d&63|128):(d&64512)===55296&&((u=n.charCodeAt(c+1))&64512)===56320?(d=65536+((d&1023)<<10)+(u&1023),++c,o[a++]=d>>18|240,o[a++]=d>>12&63|128,o[a++]=d>>6&63|128,o[a++]=d&63|128):(o[a++]=d>>12|224,o[a++]=d>>6&63|128,o[a++]=d&63|128);return a-s}})(utf8$2);var pool_1=pool;function pool(r,t,e){var n=e||8192,o=n>>>1,a=null,s=n;return function(u){if(u<1||u>o)return r(u);s+u>n&&(a=r(n),s=0);var c=t.call(a,s,s+=u);return s&7&&(s=(s|7)+1),c}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var r=requireMinimal();function t(a,s){this.lo=a>>>0,this.hi=s>>>0}var e=t.zero=new t(0,0);e.toNumber=function(){return 0},e.zzEncode=e.zzDecode=function(){return this},e.length=function(){return 1};var n=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(s){if(s===0)return e;var d=s<0;d&&(s=-s);var u=s>>>0,c=(s-u)/4294967296>>>0;return d&&(c=~c>>>0,u=~u>>>0,++u>4294967295&&(u=0,++c>4294967295&&(c=0))),new t(u,c)},t.from=function(s){if(typeof s=="number")return t.fromNumber(s);if(r.isString(s))if(r.Long)s=r.Long.fromString(s);else return t.fromNumber(parseInt(s,10));return s.low||s.high?new t(s.low>>>0,s.high>>>0):e},t.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var d=~this.lo+1>>>0,u=~this.hi>>>0;return d||(u=u+1>>>0),-(d+u*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(s){return r.Long?new r.Long(this.lo|0,this.hi|0,Boolean(s)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(s)}};var o=String.prototype.charCodeAt;return t.fromHash=function(s){return s===n?e:new t((o.call(s,0)|o.call(s,1)<<8|o.call(s,2)<<16|o.call(s,3)<<24)>>>0,(o.call(s,4)|o.call(s,5)<<8|o.call(s,6)<<16|o.call(s,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},t.prototype.zzDecode=function(){var s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},t.prototype.length=function(){var s=this.lo,d=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?d===0?s<16384?s<128?1:2:s<2097152?3:4:d<16384?d<128?5:6:d<2097152?7:8:u<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(r){var t=r;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=Boolean(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a},t.isString=function(a){return typeof a=="string"||a instanceof String},t.isObject=function(a){return a&&typeof a=="object"},t.isset=t.isSet=function(a,s){var d=a[s];return d!=null&&a.hasOwnProperty(s)?typeof d!="object"||(Array.isArray(d)?d.length:Object.keys(d).length)>0:!1},t.Buffer=function(){try{var o=t.inquire("buffer").Buffer;return o.prototype.utf8Write?o:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(a){return typeof a=="number"?t.Buffer?t._Buffer_allocUnsafe(a):new t.Array(a):t.Buffer?t._Buffer_from(a):typeof Uint8Array>"u"?a:new Uint8Array(a)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(a){return a?t.LongBits.from(a).toHash():t.LongBits.zeroHash},t.longFromHash=function(a,s){var d=t.LongBits.fromHash(a);return t.Long?t.Long.fromBits(d.lo,d.hi,s):d.toNumber(Boolean(s))};function e(o,a,s){for(var d=Object.keys(a),u=0;u<d.length;++u)(o[d[u]]===void 0||!s)&&(o[d[u]]=a[d[u]]);return o}t.merge=e,t.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)};function n(o){function a(s,d){if(!(this instanceof a))return new a(s,d);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,a):Object.defineProperty(this,"stack",{value:new Error().stack||""}),d&&e(this,d)}return(a.prototype=Object.create(Error.prototype)).constructor=a,Object.defineProperty(a.prototype,"name",{get:function(){return o}}),a.prototype.toString=function(){return this.name+": "+this.message},a}t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(a){for(var s={},d=0;d<a.length;++d)s[a[d]]=1;return function(){for(var u=Object.keys(this),c=u.length-1;c>-1;--c)if(s[u[c]]===1&&this[u[c]]!==void 0&&this[u[c]]!==null)return u[c]}},t.oneOfSetter=function(a){return function(s){for(var d=0;d<a.length;++d)a[d]!==s&&delete this[a[d]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var o=t.Buffer;if(!o){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=o.from!==Uint8Array.from&&o.from||function(s,d){return new o(s,d)},t._Buffer_allocUnsafe=o.allocUnsafe||function(s){return new o(s)}}}(minimal)),minimal}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(r,t,e){this.fn=r,this.len=t,this.next=void 0,this.val=e}function noop(){}function State(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function r(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function r(t){return new util$4.Array(t)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function r(t,e,n){return this.tail=this.tail.next=new Op(t,e,n),this.len+=e,this};function writeByte(r,t,e){t[e]=r&255}function writeVarint32(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}function VarintOp(r,t){this.len=r,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function r(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$1.prototype.int32=function r(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)};Writer$1.prototype.sint32=function r(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(r,t,e){for(;r.hi;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}Writer$1.prototype.uint64=function r(t){var e=LongBits$1.from(t);return this._push(writeVarint64,e.length(),e)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function r(t){var e=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,e.length(),e)};Writer$1.prototype.bool=function r(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}Writer$1.prototype.fixed32=function r(t){return this._push(writeFixed32,4,t>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function r(t){var e=LongBits$1.from(t);return this._push(writeFixed32,4,e.lo)._push(writeFixed32,4,e.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function r(t){return this._push(util$4.float.writeFloatLE,4,t)};Writer$1.prototype.double=function r(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function r(t,e,n){e.set(t,n)}:function r(t,e,n){for(var o=0;o<t.length;++o)e[n+o]=t[o]};Writer$1.prototype.bytes=function r(t){var e=t.length>>>0;if(!e)return this._push(writeByte,1,0);if(util$4.isString(t)){var n=Writer$1.alloc(e=base64.length(t));base64.decode(t,n,0),t=n}return this.uint32(e)._push(writeBytes,e,t)};Writer$1.prototype.string=function r(t){var e=utf8$1.length(t);return e?this.uint32(e)._push(utf8$1.write,e,t):this._push(writeByte,1,0)};Writer$1.prototype.fork=function r(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function r(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function r(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this};Writer$1.prototype.finish=function r(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e};Writer$1._configure=function(r){BufferWriter$1=r,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var o=0;o<t.length;)e[n++]=t[o++]}};BufferWriter.prototype.bytes=function r(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(BufferWriter.writeBytesBuffer,e,t),this};function writeStringBuffer(r,t,e){r.length<40?util$3.utf8.write(r,t,e):t.utf8Write?t.utf8Write(r,e):t.write(r,e)}BufferWriter.prototype.string=function r(t){var e=util$3.Buffer.byteLength(t);return this.uint32(e),e&&this._push(writeStringBuffer,e,t),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(r,t){return RangeError("index out of range: "+r.pos+" + "+(t||1)+" > "+r.len)}function Reader$1(r){this.buf=r,this.pos=0,this.len=r.length}var create_array=typeof Uint8Array<"u"?function r(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function r(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function r(){return util$2.Buffer?function(e){return(Reader$1.create=function(o){return util$2.Buffer.isBuffer(o)?new BufferReader$1(o):create_array(o)})(e)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function r(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}();Reader$1.prototype.int32=function r(){return this.uint32()|0};Reader$1.prototype.sint32=function r(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var r=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,r}if(this.len-this.pos>4){for(;t<5;++t)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function r(){return this.uint32()!==0};function readFixed32_end(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function r(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function r(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function r(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$1.prototype.double=function r(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$1.prototype.bytes=function r(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw indexOutOfRange(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)};Reader$1.prototype.string=function r(){var t=this.bytes();return utf8.read(t,0,t.length)};Reader$1.prototype.skip=function r(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};Reader$1._configure=function(r){BufferReader$1=r,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(r){Reader.call(this,r)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function r(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(r,t,e){if(typeof r!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(e)}Service.prototype.rpcCall=function r(t,e,n,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return util.asPromise(r,s,t,e,n,o);if(!s.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return s.rpcImpl(t,e[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(u,c){if(u)return s.emit("error",u,t),a(u);if(c===null){s.end(!0);return}if(!(c instanceof n))try{c=n[s.responseDelimited?"decodeDelimited":"decode"](c)}catch(l){return s.emit("error",l,t),a(l)}return s.emit("data",c,t),a(null,c)})}catch(d){s.emit("error",d,t),setTimeout(function(){a(d)},0);return}};Service.prototype.end=function r(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(r){var t=r;t.Service=service})(rpc);var roots={};(function(r){var t=r;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=e;function e(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}e()})(indexMinimal);(function(r){r.exports=indexMinimal})(minimal$1);var $protobuf=minimal$1.exports,$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={});$root.SdkSignalFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.timestampMs=$util.Long?$util.Long.fromBits(0,0,!0):0,r.prototype.type=1,r.prototype.error=null,r.prototype.join=null,r.prototype.joinack=null,r.prototype.sub=null,r.prototype.suback=null,r.prototype.index=null,r.prototype.pause=null,r.prototype.leave=null,r.prototype.leaveAck=null,r.prototype.bitrates=null,r.prototype.audioControl=null,r.prototype.audioMetadata=null,r.prototype.audioStreamIdInfo=null,r.prototype.pingPong=null,r.prototype.audioStatus=null,r.prototype.clientMetric=null,r.prototype.dataMessage=null,r.prototype.remoteVideoUpdate=null,r.prototype.primaryMeetingJoin=null,r.prototype.primaryMeetingJoinAck=null,r.prototype.primaryMeetingLeave=null,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),n.uint32(8).uint64(e.timestampMs),n.uint32(16).int32(e.type),e.error!=null&&Object.hasOwnProperty.call(e,"error")&&$root.SdkErrorFrame.encode(e.error,n.uint32(26).fork()).ldelim(),e.join!=null&&Object.hasOwnProperty.call(e,"join")&&$root.SdkJoinFrame.encode(e.join,n.uint32(34).fork()).ldelim(),e.joinack!=null&&Object.hasOwnProperty.call(e,"joinack")&&$root.SdkJoinAckFrame.encode(e.joinack,n.uint32(42).fork()).ldelim(),e.sub!=null&&Object.hasOwnProperty.call(e,"sub")&&$root.SdkSubscribeFrame.encode(e.sub,n.uint32(50).fork()).ldelim(),e.suback!=null&&Object.hasOwnProperty.call(e,"suback")&&$root.SdkSubscribeAckFrame.encode(e.suback,n.uint32(58).fork()).ldelim(),e.index!=null&&Object.hasOwnProperty.call(e,"index")&&$root.SdkIndexFrame.encode(e.index,n.uint32(66).fork()).ldelim(),e.pause!=null&&Object.hasOwnProperty.call(e,"pause")&&$root.SdkPauseResumeFrame.encode(e.pause,n.uint32(82).fork()).ldelim(),e.leave!=null&&Object.hasOwnProperty.call(e,"leave")&&$root.SdkLeaveFrame.encode(e.leave,n.uint32(90).fork()).ldelim(),e.leaveAck!=null&&Object.hasOwnProperty.call(e,"leaveAck")&&$root.SdkLeaveAckFrame.encode(e.leaveAck,n.uint32(98).fork()).ldelim(),e.bitrates!=null&&Object.hasOwnProperty.call(e,"bitrates")&&$root.SdkBitrateFrame.encode(e.bitrates,n.uint32(114).fork()).ldelim(),e.audioControl!=null&&Object.hasOwnProperty.call(e,"audioControl")&&$root.SdkAudioControlFrame.encode(e.audioControl,n.uint32(138).fork()).ldelim(),e.audioMetadata!=null&&Object.hasOwnProperty.call(e,"audioMetadata")&&$root.SdkAudioMetadataFrame.encode(e.audioMetadata,n.uint32(146).fork()).ldelim(),e.audioStreamIdInfo!=null&&Object.hasOwnProperty.call(e,"audioStreamIdInfo")&&$root.SdkAudioStreamIdInfoFrame.encode(e.audioStreamIdInfo,n.uint32(154).fork()).ldelim(),e.pingPong!=null&&Object.hasOwnProperty.call(e,"pingPong")&&$root.SdkPingPongFrame.encode(e.pingPong,n.uint32(162).fork()).ldelim(),e.audioStatus!=null&&Object.hasOwnProperty.call(e,"audioStatus")&&$root.SdkAudioStatusFrame.encode(e.audioStatus,n.uint32(170).fork()).ldelim(),e.clientMetric!=null&&Object.hasOwnProperty.call(e,"clientMetric")&&$root.SdkClientMetricFrame.encode(e.clientMetric,n.uint32(178).fork()).ldelim(),e.dataMessage!=null&&Object.hasOwnProperty.call(e,"dataMessage")&&$root.SdkDataMessageFrame.encode(e.dataMessage,n.uint32(186).fork()).ldelim(),e.remoteVideoUpdate!=null&&Object.hasOwnProperty.call(e,"remoteVideoUpdate")&&$root.SdkRemoteVideoUpdateFrame.encode(e.remoteVideoUpdate,n.uint32(202).fork()).ldelim(),e.primaryMeetingJoin!=null&&Object.hasOwnProperty.call(e,"primaryMeetingJoin")&&$root.SdkPrimaryMeetingJoinFrame.encode(e.primaryMeetingJoin,n.uint32(210).fork()).ldelim(),e.primaryMeetingJoinAck!=null&&Object.hasOwnProperty.call(e,"primaryMeetingJoinAck")&&$root.SdkPrimaryMeetingJoinAckFrame.encode(e.primaryMeetingJoinAck,n.uint32(218).fork()).ldelim(),e.primaryMeetingLeave!=null&&Object.hasOwnProperty.call(e,"primaryMeetingLeave")&&$root.SdkPrimaryMeetingLeaveFrame.encode(e.primaryMeetingLeave,n.uint32(226).fork()).ldelim(),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkSignalFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.timestampMs=e.uint64();break;case 2:a.type=e.int32();break;case 3:a.error=$root.SdkErrorFrame.decode(e,e.uint32());break;case 4:a.join=$root.SdkJoinFrame.decode(e,e.uint32());break;case 5:a.joinack=$root.SdkJoinAckFrame.decode(e,e.uint32());break;case 6:a.sub=$root.SdkSubscribeFrame.decode(e,e.uint32());break;case 7:a.suback=$root.SdkSubscribeAckFrame.decode(e,e.uint32());break;case 8:a.index=$root.SdkIndexFrame.decode(e,e.uint32());break;case 10:a.pause=$root.SdkPauseResumeFrame.decode(e,e.uint32());break;case 11:a.leave=$root.SdkLeaveFrame.decode(e,e.uint32());break;case 12:a.leaveAck=$root.SdkLeaveAckFrame.decode(e,e.uint32());break;case 14:a.bitrates=$root.SdkBitrateFrame.decode(e,e.uint32());break;case 17:a.audioControl=$root.SdkAudioControlFrame.decode(e,e.uint32());break;case 18:a.audioMetadata=$root.SdkAudioMetadataFrame.decode(e,e.uint32());break;case 19:a.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.decode(e,e.uint32());break;case 20:a.pingPong=$root.SdkPingPongFrame.decode(e,e.uint32());break;case 21:a.audioStatus=$root.SdkAudioStatusFrame.decode(e,e.uint32());break;case 22:a.clientMetric=$root.SdkClientMetricFrame.decode(e,e.uint32());break;case 23:a.dataMessage=$root.SdkDataMessageFrame.decode(e,e.uint32());break;case 25:a.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.decode(e,e.uint32());break;case 26:a.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.decode(e,e.uint32());break;case 27:a.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.decode(e,e.uint32());break;case 28:a.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.decode(e,e.uint32());break;default:e.skipType(s&7);break}}if(!a.hasOwnProperty("timestampMs"))throw $util.ProtocolError("missing required 'timestampMs'",{instance:a});if(!a.hasOwnProperty("type"))throw $util.ProtocolError("missing required 'type'",{instance:a});return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(!$util.isInteger(e.timestampMs)&&!(e.timestampMs&&$util.isInteger(e.timestampMs.low)&&$util.isInteger(e.timestampMs.high)))return"timestampMs: integer|Long expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 13:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 24:case 25:case 26:case 27:break}if(e.error!=null&&e.hasOwnProperty("error")){var n=$root.SdkErrorFrame.verify(e.error);if(n)return"error."+n}if(e.join!=null&&e.hasOwnProperty("join")){var n=$root.SdkJoinFrame.verify(e.join);if(n)return"join."+n}if(e.joinack!=null&&e.hasOwnProperty("joinack")){var n=$root.SdkJoinAckFrame.verify(e.joinack);if(n)return"joinack."+n}if(e.sub!=null&&e.hasOwnProperty("sub")){var n=$root.SdkSubscribeFrame.verify(e.sub);if(n)return"sub."+n}if(e.suback!=null&&e.hasOwnProperty("suback")){var n=$root.SdkSubscribeAckFrame.verify(e.suback);if(n)return"suback."+n}if(e.index!=null&&e.hasOwnProperty("index")){var n=$root.SdkIndexFrame.verify(e.index);if(n)return"index."+n}if(e.pause!=null&&e.hasOwnProperty("pause")){var n=$root.SdkPauseResumeFrame.verify(e.pause);if(n)return"pause."+n}if(e.leave!=null&&e.hasOwnProperty("leave")){var n=$root.SdkLeaveFrame.verify(e.leave);if(n)return"leave."+n}if(e.leaveAck!=null&&e.hasOwnProperty("leaveAck")){var n=$root.SdkLeaveAckFrame.verify(e.leaveAck);if(n)return"leaveAck."+n}if(e.bitrates!=null&&e.hasOwnProperty("bitrates")){var n=$root.SdkBitrateFrame.verify(e.bitrates);if(n)return"bitrates."+n}if(e.audioControl!=null&&e.hasOwnProperty("audioControl")){var n=$root.SdkAudioControlFrame.verify(e.audioControl);if(n)return"audioControl."+n}if(e.audioMetadata!=null&&e.hasOwnProperty("audioMetadata")){var n=$root.SdkAudioMetadataFrame.verify(e.audioMetadata);if(n)return"audioMetadata."+n}if(e.audioStreamIdInfo!=null&&e.hasOwnProperty("audioStreamIdInfo")){var n=$root.SdkAudioStreamIdInfoFrame.verify(e.audioStreamIdInfo);if(n)return"audioStreamIdInfo."+n}if(e.pingPong!=null&&e.hasOwnProperty("pingPong")){var n=$root.SdkPingPongFrame.verify(e.pingPong);if(n)return"pingPong."+n}if(e.audioStatus!=null&&e.hasOwnProperty("audioStatus")){var n=$root.SdkAudioStatusFrame.verify(e.audioStatus);if(n)return"audioStatus."+n}if(e.clientMetric!=null&&e.hasOwnProperty("clientMetric")){var n=$root.SdkClientMetricFrame.verify(e.clientMetric);if(n)return"clientMetric."+n}if(e.dataMessage!=null&&e.hasOwnProperty("dataMessage")){var n=$root.SdkDataMessageFrame.verify(e.dataMessage);if(n)return"dataMessage."+n}if(e.remoteVideoUpdate!=null&&e.hasOwnProperty("remoteVideoUpdate")){var n=$root.SdkRemoteVideoUpdateFrame.verify(e.remoteVideoUpdate);if(n)return"remoteVideoUpdate."+n}if(e.primaryMeetingJoin!=null&&e.hasOwnProperty("primaryMeetingJoin")){var n=$root.SdkPrimaryMeetingJoinFrame.verify(e.primaryMeetingJoin);if(n)return"primaryMeetingJoin."+n}if(e.primaryMeetingJoinAck!=null&&e.hasOwnProperty("primaryMeetingJoinAck")){var n=$root.SdkPrimaryMeetingJoinAckFrame.verify(e.primaryMeetingJoinAck);if(n)return"primaryMeetingJoinAck."+n}if(e.primaryMeetingLeave!=null&&e.hasOwnProperty("primaryMeetingLeave")){var n=$root.SdkPrimaryMeetingLeaveFrame.verify(e.primaryMeetingLeave);if(n)return"primaryMeetingLeave."+n}return null},r.fromObject=function(e){if(e instanceof $root.SdkSignalFrame)return e;var n=new $root.SdkSignalFrame;switch(e.timestampMs!=null&&($util.Long?(n.timestampMs=$util.Long.fromValue(e.timestampMs)).unsigned=!0:typeof e.timestampMs=="string"?n.timestampMs=parseInt(e.timestampMs,10):typeof e.timestampMs=="number"?n.timestampMs=e.timestampMs:typeof e.timestampMs=="object"&&(n.timestampMs=new $util.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0))),e.type){case"JOIN":case 1:n.type=1;break;case"JOIN_ACK":case 2:n.type=2;break;case"SUBSCRIBE":case 3:n.type=3;break;case"SUBSCRIBE_ACK":case 4:n.type=4;break;case"INDEX":case 5:n.type=5;break;case"PAUSE":case 7:n.type=7;break;case"RESUME":case 8:n.type=8;break;case"LEAVE":case 9:n.type=9;break;case"LEAVE_ACK":case 10:n.type=10;break;case"BITRATES":case 13:n.type=13;break;case"AUDIO_CONTROL":case 16:n.type=16;break;case"AUDIO_METADATA":case 17:n.type=17;break;case"AUDIO_STREAM_ID_INFO":case 18:n.type=18;break;case"PING_PONG":case 19:n.type=19;break;case"AUDIO_STATUS":case 20:n.type=20;break;case"CLIENT_METRIC":case 21:n.type=21;break;case"DATA_MESSAGE":case 22:n.type=22;break;case"REMOTE_VIDEO_UPDATE":case 24:n.type=24;break;case"PRIMARY_MEETING_JOIN":case 25:n.type=25;break;case"PRIMARY_MEETING_JOIN_ACK":case 26:n.type=26;break;case"PRIMARY_MEETING_LEAVE":case 27:n.type=27;break}if(e.error!=null){if(typeof e.error!="object")throw TypeError(".SdkSignalFrame.error: object expected");n.error=$root.SdkErrorFrame.fromObject(e.error)}if(e.join!=null){if(typeof e.join!="object")throw TypeError(".SdkSignalFrame.join: object expected");n.join=$root.SdkJoinFrame.fromObject(e.join)}if(e.joinack!=null){if(typeof e.joinack!="object")throw TypeError(".SdkSignalFrame.joinack: object expected");n.joinack=$root.SdkJoinAckFrame.fromObject(e.joinack)}if(e.sub!=null){if(typeof e.sub!="object")throw TypeError(".SdkSignalFrame.sub: object expected");n.sub=$root.SdkSubscribeFrame.fromObject(e.sub)}if(e.suback!=null){if(typeof e.suback!="object")throw TypeError(".SdkSignalFrame.suback: object expected");n.suback=$root.SdkSubscribeAckFrame.fromObject(e.suback)}if(e.index!=null){if(typeof e.index!="object")throw TypeError(".SdkSignalFrame.index: object expected");n.index=$root.SdkIndexFrame.fromObject(e.index)}if(e.pause!=null){if(typeof e.pause!="object")throw TypeError(".SdkSignalFrame.pause: object expected");n.pause=$root.SdkPauseResumeFrame.fromObject(e.pause)}if(e.leave!=null){if(typeof e.leave!="object")throw TypeError(".SdkSignalFrame.leave: object expected");n.leave=$root.SdkLeaveFrame.fromObject(e.leave)}if(e.leaveAck!=null){if(typeof e.leaveAck!="object")throw TypeError(".SdkSignalFrame.leaveAck: object expected");n.leaveAck=$root.SdkLeaveAckFrame.fromObject(e.leaveAck)}if(e.bitrates!=null){if(typeof e.bitrates!="object")throw TypeError(".SdkSignalFrame.bitrates: object expected");n.bitrates=$root.SdkBitrateFrame.fromObject(e.bitrates)}if(e.audioControl!=null){if(typeof e.audioControl!="object")throw TypeError(".SdkSignalFrame.audioControl: object expected");n.audioControl=$root.SdkAudioControlFrame.fromObject(e.audioControl)}if(e.audioMetadata!=null){if(typeof e.audioMetadata!="object")throw TypeError(".SdkSignalFrame.audioMetadata: object expected");n.audioMetadata=$root.SdkAudioMetadataFrame.fromObject(e.audioMetadata)}if(e.audioStreamIdInfo!=null){if(typeof e.audioStreamIdInfo!="object")throw TypeError(".SdkSignalFrame.audioStreamIdInfo: object expected");n.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.fromObject(e.audioStreamIdInfo)}if(e.pingPong!=null){if(typeof e.pingPong!="object")throw TypeError(".SdkSignalFrame.pingPong: object expected");n.pingPong=$root.SdkPingPongFrame.fromObject(e.pingPong)}if(e.audioStatus!=null){if(typeof e.audioStatus!="object")throw TypeError(".SdkSignalFrame.audioStatus: object expected");n.audioStatus=$root.SdkAudioStatusFrame.fromObject(e.audioStatus)}if(e.clientMetric!=null){if(typeof e.clientMetric!="object")throw TypeError(".SdkSignalFrame.clientMetric: object expected");n.clientMetric=$root.SdkClientMetricFrame.fromObject(e.clientMetric)}if(e.dataMessage!=null){if(typeof e.dataMessage!="object")throw TypeError(".SdkSignalFrame.dataMessage: object expected");n.dataMessage=$root.SdkDataMessageFrame.fromObject(e.dataMessage)}if(e.remoteVideoUpdate!=null){if(typeof e.remoteVideoUpdate!="object")throw TypeError(".SdkSignalFrame.remoteVideoUpdate: object expected");n.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.fromObject(e.remoteVideoUpdate)}if(e.primaryMeetingJoin!=null){if(typeof e.primaryMeetingJoin!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoin: object expected");n.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.fromObject(e.primaryMeetingJoin)}if(e.primaryMeetingJoinAck!=null){if(typeof e.primaryMeetingJoinAck!="object")throw TypeError(".SdkSignalFrame.primaryMeetingJoinAck: object expected");n.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.fromObject(e.primaryMeetingJoinAck)}if(e.primaryMeetingLeave!=null){if(typeof e.primaryMeetingLeave!="object")throw TypeError(".SdkSignalFrame.primaryMeetingLeave: object expected");n.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.fromObject(e.primaryMeetingLeave)}return n},r.toObject=function(e,n){n||(n={});var o={};if(n.defaults){if($util.Long){var a=new $util.Long(0,0,!0);o.timestampMs=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.timestampMs=n.longs===String?"0":0;o.type=n.enums===String?"JOIN":1,o.error=null,o.join=null,o.joinack=null,o.sub=null,o.suback=null,o.index=null,o.pause=null,o.leave=null,o.leaveAck=null,o.bitrates=null,o.audioControl=null,o.audioMetadata=null,o.audioStreamIdInfo=null,o.pingPong=null,o.audioStatus=null,o.clientMetric=null,o.dataMessage=null,o.remoteVideoUpdate=null,o.primaryMeetingJoin=null,o.primaryMeetingJoinAck=null,o.primaryMeetingLeave=null}return e.timestampMs!=null&&e.hasOwnProperty("timestampMs")&&(typeof e.timestampMs=="number"?o.timestampMs=n.longs===String?String(e.timestampMs):e.timestampMs:o.timestampMs=n.longs===String?$util.Long.prototype.toString.call(e.timestampMs):n.longs===Number?new $util.LongBits(e.timestampMs.low>>>0,e.timestampMs.high>>>0).toNumber(!0):e.timestampMs),e.type!=null&&e.hasOwnProperty("type")&&(o.type=n.enums===String?$root.SdkSignalFrame.Type[e.type]:e.type),e.error!=null&&e.hasOwnProperty("error")&&(o.error=$root.SdkErrorFrame.toObject(e.error,n)),e.join!=null&&e.hasOwnProperty("join")&&(o.join=$root.SdkJoinFrame.toObject(e.join,n)),e.joinack!=null&&e.hasOwnProperty("joinack")&&(o.joinack=$root.SdkJoinAckFrame.toObject(e.joinack,n)),e.sub!=null&&e.hasOwnProperty("sub")&&(o.sub=$root.SdkSubscribeFrame.toObject(e.sub,n)),e.suback!=null&&e.hasOwnProperty("suback")&&(o.suback=$root.SdkSubscribeAckFrame.toObject(e.suback,n)),e.index!=null&&e.hasOwnProperty("index")&&(o.index=$root.SdkIndexFrame.toObject(e.index,n)),e.pause!=null&&e.hasOwnProperty("pause")&&(o.pause=$root.SdkPauseResumeFrame.toObject(e.pause,n)),e.leave!=null&&e.hasOwnProperty("leave")&&(o.leave=$root.SdkLeaveFrame.toObject(e.leave,n)),e.leaveAck!=null&&e.hasOwnProperty("leaveAck")&&(o.leaveAck=$root.SdkLeaveAckFrame.toObject(e.leaveAck,n)),e.bitrates!=null&&e.hasOwnProperty("bitrates")&&(o.bitrates=$root.SdkBitrateFrame.toObject(e.bitrates,n)),e.audioControl!=null&&e.hasOwnProperty("audioControl")&&(o.audioControl=$root.SdkAudioControlFrame.toObject(e.audioControl,n)),e.audioMetadata!=null&&e.hasOwnProperty("audioMetadata")&&(o.audioMetadata=$root.SdkAudioMetadataFrame.toObject(e.audioMetadata,n)),e.audioStreamIdInfo!=null&&e.hasOwnProperty("audioStreamIdInfo")&&(o.audioStreamIdInfo=$root.SdkAudioStreamIdInfoFrame.toObject(e.audioStreamIdInfo,n)),e.pingPong!=null&&e.hasOwnProperty("pingPong")&&(o.pingPong=$root.SdkPingPongFrame.toObject(e.pingPong,n)),e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&(o.audioStatus=$root.SdkAudioStatusFrame.toObject(e.audioStatus,n)),e.clientMetric!=null&&e.hasOwnProperty("clientMetric")&&(o.clientMetric=$root.SdkClientMetricFrame.toObject(e.clientMetric,n)),e.dataMessage!=null&&e.hasOwnProperty("dataMessage")&&(o.dataMessage=$root.SdkDataMessageFrame.toObject(e.dataMessage,n)),e.remoteVideoUpdate!=null&&e.hasOwnProperty("remoteVideoUpdate")&&(o.remoteVideoUpdate=$root.SdkRemoteVideoUpdateFrame.toObject(e.remoteVideoUpdate,n)),e.primaryMeetingJoin!=null&&e.hasOwnProperty("primaryMeetingJoin")&&(o.primaryMeetingJoin=$root.SdkPrimaryMeetingJoinFrame.toObject(e.primaryMeetingJoin,n)),e.primaryMeetingJoinAck!=null&&e.hasOwnProperty("primaryMeetingJoinAck")&&(o.primaryMeetingJoinAck=$root.SdkPrimaryMeetingJoinAckFrame.toObject(e.primaryMeetingJoinAck,n)),e.primaryMeetingLeave!=null&&e.hasOwnProperty("primaryMeetingLeave")&&(o.primaryMeetingLeave=$root.SdkPrimaryMeetingLeaveFrame.toObject(e.primaryMeetingLeave,n)),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.Type=function(){var t={},e=Object.create(t);return e[t[1]="JOIN"]=1,e[t[2]="JOIN_ACK"]=2,e[t[3]="SUBSCRIBE"]=3,e[t[4]="SUBSCRIBE_ACK"]=4,e[t[5]="INDEX"]=5,e[t[7]="PAUSE"]=7,e[t[8]="RESUME"]=8,e[t[9]="LEAVE"]=9,e[t[10]="LEAVE_ACK"]=10,e[t[13]="BITRATES"]=13,e[t[16]="AUDIO_CONTROL"]=16,e[t[17]="AUDIO_METADATA"]=17,e[t[18]="AUDIO_STREAM_ID_INFO"]=18,e[t[19]="PING_PONG"]=19,e[t[20]="AUDIO_STATUS"]=20,e[t[21]="CLIENT_METRIC"]=21,e[t[22]="DATA_MESSAGE"]=22,e[t[24]="REMOTE_VIDEO_UPDATE"]=24,e[t[25]="PRIMARY_MEETING_JOIN"]=25,e[t[26]="PRIMARY_MEETING_JOIN_ACK"]=26,e[t[27]="PRIMARY_MEETING_LEAVE"]=27,e}(),r}();$root.SdkErrorFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.status=0,r.prototype.description="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.status!=null&&Object.hasOwnProperty.call(e,"status")&&n.uint32(8).uint32(e.status),e.description!=null&&Object.hasOwnProperty.call(e,"description")&&n.uint32(18).string(e.description),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkErrorFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.status=e.uint32();break;case 2:a.description=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.status!=null&&e.hasOwnProperty("status")&&!$util.isInteger(e.status)?"status: integer expected":e.description!=null&&e.hasOwnProperty("description")&&!$util.isString(e.description)?"description: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkErrorFrame)return e;var n=new $root.SdkErrorFrame;return e.status!=null&&(n.status=e.status>>>0),e.description!=null&&(n.description=String(e.description)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.status=0,o.description=""),e.status!=null&&e.hasOwnProperty("status")&&(o.status=e.status),e.description!=null&&e.hasOwnProperty("description")&&(o.description=e.description),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkJoinFlags=function(){var r={},t=Object.create(r);return t[r[2]="HAS_STREAM_UPDATE"]=2,t[r[16]="COMPLETE_VIDEO_SOURCES_LIST"]=16,t[r[32]="EXCLUDE_SELF_CONTENT_IN_INDEX"]=32,t}();$root.SdkClientDetails=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.appName="",r.prototype.appVersion="",r.prototype.deviceModel="",r.prototype.deviceMake="",r.prototype.platformName="",r.prototype.platformVersion="",r.prototype.clientSource="",r.prototype.chimeSdkVersion="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.appName!=null&&Object.hasOwnProperty.call(e,"appName")&&n.uint32(10).string(e.appName),e.appVersion!=null&&Object.hasOwnProperty.call(e,"appVersion")&&n.uint32(18).string(e.appVersion),e.deviceModel!=null&&Object.hasOwnProperty.call(e,"deviceModel")&&n.uint32(26).string(e.deviceModel),e.deviceMake!=null&&Object.hasOwnProperty.call(e,"deviceMake")&&n.uint32(34).string(e.deviceMake),e.platformName!=null&&Object.hasOwnProperty.call(e,"platformName")&&n.uint32(42).string(e.platformName),e.platformVersion!=null&&Object.hasOwnProperty.call(e,"platformVersion")&&n.uint32(50).string(e.platformVersion),e.clientSource!=null&&Object.hasOwnProperty.call(e,"clientSource")&&n.uint32(58).string(e.clientSource),e.chimeSdkVersion!=null&&Object.hasOwnProperty.call(e,"chimeSdkVersion")&&n.uint32(66).string(e.chimeSdkVersion),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkClientDetails;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.appName=e.string();break;case 2:a.appVersion=e.string();break;case 3:a.deviceModel=e.string();break;case 4:a.deviceMake=e.string();break;case 5:a.platformName=e.string();break;case 6:a.platformVersion=e.string();break;case 7:a.clientSource=e.string();break;case 8:a.chimeSdkVersion=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.appName!=null&&e.hasOwnProperty("appName")&&!$util.isString(e.appName)?"appName: string expected":e.appVersion!=null&&e.hasOwnProperty("appVersion")&&!$util.isString(e.appVersion)?"appVersion: string expected":e.deviceModel!=null&&e.hasOwnProperty("deviceModel")&&!$util.isString(e.deviceModel)?"deviceModel: string expected":e.deviceMake!=null&&e.hasOwnProperty("deviceMake")&&!$util.isString(e.deviceMake)?"deviceMake: string expected":e.platformName!=null&&e.hasOwnProperty("platformName")&&!$util.isString(e.platformName)?"platformName: string expected":e.platformVersion!=null&&e.hasOwnProperty("platformVersion")&&!$util.isString(e.platformVersion)?"platformVersion: string expected":e.clientSource!=null&&e.hasOwnProperty("clientSource")&&!$util.isString(e.clientSource)?"clientSource: string expected":e.chimeSdkVersion!=null&&e.hasOwnProperty("chimeSdkVersion")&&!$util.isString(e.chimeSdkVersion)?"chimeSdkVersion: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkClientDetails)return e;var n=new $root.SdkClientDetails;return e.appName!=null&&(n.appName=String(e.appName)),e.appVersion!=null&&(n.appVersion=String(e.appVersion)),e.deviceModel!=null&&(n.deviceModel=String(e.deviceModel)),e.deviceMake!=null&&(n.deviceMake=String(e.deviceMake)),e.platformName!=null&&(n.platformName=String(e.platformName)),e.platformVersion!=null&&(n.platformVersion=String(e.platformVersion)),e.clientSource!=null&&(n.clientSource=String(e.clientSource)),e.chimeSdkVersion!=null&&(n.chimeSdkVersion=String(e.chimeSdkVersion)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.appName="",o.appVersion="",o.deviceModel="",o.deviceMake="",o.platformName="",o.platformVersion="",o.clientSource="",o.chimeSdkVersion=""),e.appName!=null&&e.hasOwnProperty("appName")&&(o.appName=e.appName),e.appVersion!=null&&e.hasOwnProperty("appVersion")&&(o.appVersion=e.appVersion),e.deviceModel!=null&&e.hasOwnProperty("deviceModel")&&(o.deviceModel=e.deviceModel),e.deviceMake!=null&&e.hasOwnProperty("deviceMake")&&(o.deviceMake=e.deviceMake),e.platformName!=null&&e.hasOwnProperty("platformName")&&(o.platformName=e.platformName),e.platformVersion!=null&&e.hasOwnProperty("platformVersion")&&(o.platformVersion=e.platformVersion),e.clientSource!=null&&e.hasOwnProperty("clientSource")&&(o.clientSource=e.clientSource),e.chimeSdkVersion!=null&&e.hasOwnProperty("chimeSdkVersion")&&(o.chimeSdkVersion=e.chimeSdkVersion),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkServerSideNetworkAdaption=function(){var r={},t=Object.create(r);return t[r[1]="DEFAULT"]=1,t[r[2]="NONE"]=2,t[r[3]="BANDWIDTH_PROBING"]=3,t}();$root.SdkJoinFrame=function(){function r(t){if(this.supportedServerSideNetworkAdaptions=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.protocolVersion=2,r.prototype.maxNumOfVideos=0,r.prototype.flags=0,r.prototype.clientDetails=null,r.prototype.audioSessionId=$util.Long?$util.Long.fromBits(0,0,!0):0,r.prototype.wantsCompressedSdp=!1,r.prototype.wantsServerSideNetworkProbingOnReceiveSideEstimator=!1,r.prototype.serverSideNetworkAdaption=1,r.prototype.supportedServerSideNetworkAdaptions=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.protocolVersion!=null&&Object.hasOwnProperty.call(e,"protocolVersion")&&n.uint32(8).uint32(e.protocolVersion),e.maxNumOfVideos!=null&&Object.hasOwnProperty.call(e,"maxNumOfVideos")&&n.uint32(16).uint32(e.maxNumOfVideos),e.flags!=null&&Object.hasOwnProperty.call(e,"flags")&&n.uint32(24).uint32(e.flags),e.clientDetails!=null&&Object.hasOwnProperty.call(e,"clientDetails")&&$root.SdkClientDetails.encode(e.clientDetails,n.uint32(34).fork()).ldelim(),e.audioSessionId!=null&&Object.hasOwnProperty.call(e,"audioSessionId")&&n.uint32(48).uint64(e.audioSessionId),e.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&n.uint32(56).bool(e.wantsCompressedSdp),e.wantsServerSideNetworkProbingOnReceiveSideEstimator!=null&&Object.hasOwnProperty.call(e,"wantsServerSideNetworkProbingOnReceiveSideEstimator")&&n.uint32(64).bool(e.wantsServerSideNetworkProbingOnReceiveSideEstimator),e.serverSideNetworkAdaption!=null&&Object.hasOwnProperty.call(e,"serverSideNetworkAdaption")&&n.uint32(80).int32(e.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions!=null&&e.supportedServerSideNetworkAdaptions.length)for(var o=0;o<e.supportedServerSideNetworkAdaptions.length;++o)n.uint32(88).int32(e.supportedServerSideNetworkAdaptions[o]);return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkJoinFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.protocolVersion=e.uint32();break;case 2:a.maxNumOfVideos=e.uint32();break;case 3:a.flags=e.uint32();break;case 4:a.clientDetails=$root.SdkClientDetails.decode(e,e.uint32());break;case 6:a.audioSessionId=e.uint64();break;case 7:a.wantsCompressedSdp=e.bool();break;case 8:a.wantsServerSideNetworkProbingOnReceiveSideEstimator=e.bool();break;case 10:a.serverSideNetworkAdaption=e.int32();break;case 11:if(a.supportedServerSideNetworkAdaptions&&a.supportedServerSideNetworkAdaptions.length||(a.supportedServerSideNetworkAdaptions=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)a.supportedServerSideNetworkAdaptions.push(e.int32());else a.supportedServerSideNetworkAdaptions.push(e.int32());break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.protocolVersion!=null&&e.hasOwnProperty("protocolVersion")&&!$util.isInteger(e.protocolVersion))return"protocolVersion: integer expected";if(e.maxNumOfVideos!=null&&e.hasOwnProperty("maxNumOfVideos")&&!$util.isInteger(e.maxNumOfVideos))return"maxNumOfVideos: integer expected";if(e.flags!=null&&e.hasOwnProperty("flags")&&!$util.isInteger(e.flags))return"flags: integer expected";if(e.clientDetails!=null&&e.hasOwnProperty("clientDetails")){var n=$root.SdkClientDetails.verify(e.clientDetails);if(n)return"clientDetails."+n}if(e.audioSessionId!=null&&e.hasOwnProperty("audioSessionId")&&!$util.isInteger(e.audioSessionId)&&!(e.audioSessionId&&$util.isInteger(e.audioSessionId.low)&&$util.isInteger(e.audioSessionId.high)))return"audioSessionId: integer|Long expected";if(e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&typeof e.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(e.wantsServerSideNetworkProbingOnReceiveSideEstimator!=null&&e.hasOwnProperty("wantsServerSideNetworkProbingOnReceiveSideEstimator")&&typeof e.wantsServerSideNetworkProbingOnReceiveSideEstimator!="boolean")return"wantsServerSideNetworkProbingOnReceiveSideEstimator: boolean expected";if(e.serverSideNetworkAdaption!=null&&e.hasOwnProperty("serverSideNetworkAdaption"))switch(e.serverSideNetworkAdaption){default:return"serverSideNetworkAdaption: enum value expected";case 1:case 2:case 3:break}if(e.supportedServerSideNetworkAdaptions!=null&&e.hasOwnProperty("supportedServerSideNetworkAdaptions")){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))return"supportedServerSideNetworkAdaptions: array expected";for(var o=0;o<e.supportedServerSideNetworkAdaptions.length;++o)switch(e.supportedServerSideNetworkAdaptions[o]){default:return"supportedServerSideNetworkAdaptions: enum value[] expected";case 1:case 2:case 3:break}}return null},r.fromObject=function(e){if(e instanceof $root.SdkJoinFrame)return e;var n=new $root.SdkJoinFrame;if(e.protocolVersion!=null&&(n.protocolVersion=e.protocolVersion>>>0),e.maxNumOfVideos!=null&&(n.maxNumOfVideos=e.maxNumOfVideos>>>0),e.flags!=null&&(n.flags=e.flags>>>0),e.clientDetails!=null){if(typeof e.clientDetails!="object")throw TypeError(".SdkJoinFrame.clientDetails: object expected");n.clientDetails=$root.SdkClientDetails.fromObject(e.clientDetails)}switch(e.audioSessionId!=null&&($util.Long?(n.audioSessionId=$util.Long.fromValue(e.audioSessionId)).unsigned=!0:typeof e.audioSessionId=="string"?n.audioSessionId=parseInt(e.audioSessionId,10):typeof e.audioSessionId=="number"?n.audioSessionId=e.audioSessionId:typeof e.audioSessionId=="object"&&(n.audioSessionId=new $util.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0))),e.wantsCompressedSdp!=null&&(n.wantsCompressedSdp=Boolean(e.wantsCompressedSdp)),e.wantsServerSideNetworkProbingOnReceiveSideEstimator!=null&&(n.wantsServerSideNetworkProbingOnReceiveSideEstimator=Boolean(e.wantsServerSideNetworkProbingOnReceiveSideEstimator)),e.serverSideNetworkAdaption){case"DEFAULT":case 1:n.serverSideNetworkAdaption=1;break;case"NONE":case 2:n.serverSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:n.serverSideNetworkAdaption=3;break}if(e.supportedServerSideNetworkAdaptions){if(!Array.isArray(e.supportedServerSideNetworkAdaptions))throw TypeError(".SdkJoinFrame.supportedServerSideNetworkAdaptions: array expected");n.supportedServerSideNetworkAdaptions=[];for(var o=0;o<e.supportedServerSideNetworkAdaptions.length;++o)switch(e.supportedServerSideNetworkAdaptions[o]){default:case"DEFAULT":case 1:n.supportedServerSideNetworkAdaptions[o]=1;break;case"NONE":case 2:n.supportedServerSideNetworkAdaptions[o]=2;break;case"BANDWIDTH_PROBING":case 3:n.supportedServerSideNetworkAdaptions[o]=3;break}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.supportedServerSideNetworkAdaptions=[]),n.defaults){if(o.protocolVersion=2,o.maxNumOfVideos=0,o.flags=0,o.clientDetails=null,$util.Long){var a=new $util.Long(0,0,!0);o.audioSessionId=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.audioSessionId=n.longs===String?"0":0;o.wantsCompressedSdp=!1,o.wantsServerSideNetworkProbingOnReceiveSideEstimator=!1,o.serverSideNetworkAdaption=n.enums===String?"DEFAULT":1}if(e.protocolVersion!=null&&e.hasOwnProperty("protocolVersion")&&(o.protocolVersion=e.protocolVersion),e.maxNumOfVideos!=null&&e.hasOwnProperty("maxNumOfVideos")&&(o.maxNumOfVideos=e.maxNumOfVideos),e.flags!=null&&e.hasOwnProperty("flags")&&(o.flags=e.flags),e.clientDetails!=null&&e.hasOwnProperty("clientDetails")&&(o.clientDetails=$root.SdkClientDetails.toObject(e.clientDetails,n)),e.audioSessionId!=null&&e.hasOwnProperty("audioSessionId")&&(typeof e.audioSessionId=="number"?o.audioSessionId=n.longs===String?String(e.audioSessionId):e.audioSessionId:o.audioSessionId=n.longs===String?$util.Long.prototype.toString.call(e.audioSessionId):n.longs===Number?new $util.LongBits(e.audioSessionId.low>>>0,e.audioSessionId.high>>>0).toNumber(!0):e.audioSessionId),e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&(o.wantsCompressedSdp=e.wantsCompressedSdp),e.wantsServerSideNetworkProbingOnReceiveSideEstimator!=null&&e.hasOwnProperty("wantsServerSideNetworkProbingOnReceiveSideEstimator")&&(o.wantsServerSideNetworkProbingOnReceiveSideEstimator=e.wantsServerSideNetworkProbingOnReceiveSideEstimator),e.serverSideNetworkAdaption!=null&&e.hasOwnProperty("serverSideNetworkAdaption")&&(o.serverSideNetworkAdaption=n.enums===String?$root.SdkServerSideNetworkAdaption[e.serverSideNetworkAdaption]:e.serverSideNetworkAdaption),e.supportedServerSideNetworkAdaptions&&e.supportedServerSideNetworkAdaptions.length){o.supportedServerSideNetworkAdaptions=[];for(var s=0;s<e.supportedServerSideNetworkAdaptions.length;++s)o.supportedServerSideNetworkAdaptions[s]=n.enums===String?$root.SdkServerSideNetworkAdaption[e.supportedServerSideNetworkAdaptions[s]]:e.supportedServerSideNetworkAdaptions[s]}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkJoinAckFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.turnCredentials=null,r.prototype.videoSubscriptionLimit=0,r.prototype.wantsCompressedSdp=!1,r.prototype.defaultServerSideNetworkAdaption=1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.turnCredentials!=null&&Object.hasOwnProperty.call(e,"turnCredentials")&&$root.SdkTurnCredentials.encode(e.turnCredentials,n.uint32(10).fork()).ldelim(),e.videoSubscriptionLimit!=null&&Object.hasOwnProperty.call(e,"videoSubscriptionLimit")&&n.uint32(16).uint32(e.videoSubscriptionLimit),e.wantsCompressedSdp!=null&&Object.hasOwnProperty.call(e,"wantsCompressedSdp")&&n.uint32(24).bool(e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption!=null&&Object.hasOwnProperty.call(e,"defaultServerSideNetworkAdaption")&&n.uint32(32).int32(e.defaultServerSideNetworkAdaption),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkJoinAckFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.turnCredentials=$root.SdkTurnCredentials.decode(e,e.uint32());break;case 2:a.videoSubscriptionLimit=e.uint32();break;case 3:a.wantsCompressedSdp=e.bool();break;case 4:a.defaultServerSideNetworkAdaption=e.int32();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.turnCredentials!=null&&e.hasOwnProperty("turnCredentials")){var n=$root.SdkTurnCredentials.verify(e.turnCredentials);if(n)return"turnCredentials."+n}if(e.videoSubscriptionLimit!=null&&e.hasOwnProperty("videoSubscriptionLimit")&&!$util.isInteger(e.videoSubscriptionLimit))return"videoSubscriptionLimit: integer expected";if(e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&typeof e.wantsCompressedSdp!="boolean")return"wantsCompressedSdp: boolean expected";if(e.defaultServerSideNetworkAdaption!=null&&e.hasOwnProperty("defaultServerSideNetworkAdaption"))switch(e.defaultServerSideNetworkAdaption){default:return"defaultServerSideNetworkAdaption: enum value expected";case 1:case 2:case 3:break}return null},r.fromObject=function(e){if(e instanceof $root.SdkJoinAckFrame)return e;var n=new $root.SdkJoinAckFrame;if(e.turnCredentials!=null){if(typeof e.turnCredentials!="object")throw TypeError(".SdkJoinAckFrame.turnCredentials: object expected");n.turnCredentials=$root.SdkTurnCredentials.fromObject(e.turnCredentials)}switch(e.videoSubscriptionLimit!=null&&(n.videoSubscriptionLimit=e.videoSubscriptionLimit>>>0),e.wantsCompressedSdp!=null&&(n.wantsCompressedSdp=Boolean(e.wantsCompressedSdp)),e.defaultServerSideNetworkAdaption){case"DEFAULT":case 1:n.defaultServerSideNetworkAdaption=1;break;case"NONE":case 2:n.defaultServerSideNetworkAdaption=2;break;case"BANDWIDTH_PROBING":case 3:n.defaultServerSideNetworkAdaption=3;break}return n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.turnCredentials=null,o.videoSubscriptionLimit=0,o.wantsCompressedSdp=!1,o.defaultServerSideNetworkAdaption=n.enums===String?"DEFAULT":1),e.turnCredentials!=null&&e.hasOwnProperty("turnCredentials")&&(o.turnCredentials=$root.SdkTurnCredentials.toObject(e.turnCredentials,n)),e.videoSubscriptionLimit!=null&&e.hasOwnProperty("videoSubscriptionLimit")&&(o.videoSubscriptionLimit=e.videoSubscriptionLimit),e.wantsCompressedSdp!=null&&e.hasOwnProperty("wantsCompressedSdp")&&(o.wantsCompressedSdp=e.wantsCompressedSdp),e.defaultServerSideNetworkAdaption!=null&&e.hasOwnProperty("defaultServerSideNetworkAdaption")&&(o.defaultServerSideNetworkAdaption=n.enums===String?$root.SdkServerSideNetworkAdaption[e.defaultServerSideNetworkAdaption]:e.defaultServerSideNetworkAdaption),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkLeaveFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkLeaveFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":null},r.fromObject=function(e){return e instanceof $root.SdkLeaveFrame?e:new $root.SdkLeaveFrame},r.toObject=function(){return{}},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkLeaveAckFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkLeaveAckFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":null},r.fromObject=function(e){return e instanceof $root.SdkLeaveAckFrame?e:new $root.SdkLeaveAckFrame},r.toObject=function(){return{}},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkStreamServiceType=function(){var r={},t=Object.create(r);return t[r[1]="RX"]=1,t[r[2]="TX"]=2,t[r[3]="DUPLEX"]=3,t}();$root.SdkStreamMediaType=function(){var r={},t=Object.create(r);return t[r[1]="AUDIO"]=1,t[r[2]="VIDEO"]=2,t}();$root.SdkSubscribeFrame=function(){function r(t){if(this.sendStreams=[],this.receiveStreamIds=[],this.videoSubscriptionConfiguration=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.duplex=1,r.prototype.sendStreams=$util.emptyArray,r.prototype.receiveStreamIds=$util.emptyArray,r.prototype.sdpOffer="",r.prototype.audioHost="",r.prototype.audioCheckin=!1,r.prototype.audioMuted=!1,r.prototype.compressedSdpOffer=$util.newBuffer([]),r.prototype.videoSubscriptionConfiguration=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.duplex!=null&&Object.hasOwnProperty.call(e,"duplex")&&n.uint32(8).int32(e.duplex),e.sendStreams!=null&&e.sendStreams.length)for(var o=0;o<e.sendStreams.length;++o)$root.SdkStreamDescriptor.encode(e.sendStreams[o],n.uint32(18).fork()).ldelim();if(e.receiveStreamIds!=null&&e.receiveStreamIds.length)for(var o=0;o<e.receiveStreamIds.length;++o)n.uint32(24).uint32(e.receiveStreamIds[o]);if(e.sdpOffer!=null&&Object.hasOwnProperty.call(e,"sdpOffer")&&n.uint32(34).string(e.sdpOffer),e.audioHost!=null&&Object.hasOwnProperty.call(e,"audioHost")&&n.uint32(42).string(e.audioHost),e.audioCheckin!=null&&Object.hasOwnProperty.call(e,"audioCheckin")&&n.uint32(48).bool(e.audioCheckin),e.audioMuted!=null&&Object.hasOwnProperty.call(e,"audioMuted")&&n.uint32(56).bool(e.audioMuted),e.compressedSdpOffer!=null&&Object.hasOwnProperty.call(e,"compressedSdpOffer")&&n.uint32(66).bytes(e.compressedSdpOffer),e.videoSubscriptionConfiguration!=null&&e.videoSubscriptionConfiguration.length)for(var o=0;o<e.videoSubscriptionConfiguration.length;++o)$root.SdkVideoSubscriptionConfiguration.encode(e.videoSubscriptionConfiguration[o],n.uint32(74).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkSubscribeFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.duplex=e.int32();break;case 2:a.sendStreams&&a.sendStreams.length||(a.sendStreams=[]),a.sendStreams.push($root.SdkStreamDescriptor.decode(e,e.uint32()));break;case 3:if(a.receiveStreamIds&&a.receiveStreamIds.length||(a.receiveStreamIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)a.receiveStreamIds.push(e.uint32());else a.receiveStreamIds.push(e.uint32());break;case 4:a.sdpOffer=e.string();break;case 5:a.audioHost=e.string();break;case 6:a.audioCheckin=e.bool();break;case 7:a.audioMuted=e.bool();break;case 8:a.compressedSdpOffer=e.bytes();break;case 9:a.videoSubscriptionConfiguration&&a.videoSubscriptionConfiguration.length||(a.videoSubscriptionConfiguration=[]),a.videoSubscriptionConfiguration.push($root.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.duplex!=null&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(e.sendStreams!=null&&e.hasOwnProperty("sendStreams")){if(!Array.isArray(e.sendStreams))return"sendStreams: array expected";for(var n=0;n<e.sendStreams.length;++n){var o=$root.SdkStreamDescriptor.verify(e.sendStreams[n]);if(o)return"sendStreams."+o}}if(e.receiveStreamIds!=null&&e.hasOwnProperty("receiveStreamIds")){if(!Array.isArray(e.receiveStreamIds))return"receiveStreamIds: array expected";for(var n=0;n<e.receiveStreamIds.length;++n)if(!$util.isInteger(e.receiveStreamIds[n]))return"receiveStreamIds: integer[] expected"}if(e.sdpOffer!=null&&e.hasOwnProperty("sdpOffer")&&!$util.isString(e.sdpOffer))return"sdpOffer: string expected";if(e.audioHost!=null&&e.hasOwnProperty("audioHost")&&!$util.isString(e.audioHost))return"audioHost: string expected";if(e.audioCheckin!=null&&e.hasOwnProperty("audioCheckin")&&typeof e.audioCheckin!="boolean")return"audioCheckin: boolean expected";if(e.audioMuted!=null&&e.hasOwnProperty("audioMuted")&&typeof e.audioMuted!="boolean")return"audioMuted: boolean expected";if(e.compressedSdpOffer!=null&&e.hasOwnProperty("compressedSdpOffer")&&!(e.compressedSdpOffer&&typeof e.compressedSdpOffer.length=="number"||$util.isString(e.compressedSdpOffer)))return"compressedSdpOffer: buffer expected";if(e.videoSubscriptionConfiguration!=null&&e.hasOwnProperty("videoSubscriptionConfiguration")){if(!Array.isArray(e.videoSubscriptionConfiguration))return"videoSubscriptionConfiguration: array expected";for(var n=0;n<e.videoSubscriptionConfiguration.length;++n){var o=$root.SdkVideoSubscriptionConfiguration.verify(e.videoSubscriptionConfiguration[n]);if(o)return"videoSubscriptionConfiguration."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkSubscribeFrame)return e;var n=new $root.SdkSubscribeFrame;switch(e.duplex){case"RX":case 1:n.duplex=1;break;case"TX":case 2:n.duplex=2;break;case"DUPLEX":case 3:n.duplex=3;break}if(e.sendStreams){if(!Array.isArray(e.sendStreams))throw TypeError(".SdkSubscribeFrame.sendStreams: array expected");n.sendStreams=[];for(var o=0;o<e.sendStreams.length;++o){if(typeof e.sendStreams[o]!="object")throw TypeError(".SdkSubscribeFrame.sendStreams: object expected");n.sendStreams[o]=$root.SdkStreamDescriptor.fromObject(e.sendStreams[o])}}if(e.receiveStreamIds){if(!Array.isArray(e.receiveStreamIds))throw TypeError(".SdkSubscribeFrame.receiveStreamIds: array expected");n.receiveStreamIds=[];for(var o=0;o<e.receiveStreamIds.length;++o)n.receiveStreamIds[o]=e.receiveStreamIds[o]>>>0}if(e.sdpOffer!=null&&(n.sdpOffer=String(e.sdpOffer)),e.audioHost!=null&&(n.audioHost=String(e.audioHost)),e.audioCheckin!=null&&(n.audioCheckin=Boolean(e.audioCheckin)),e.audioMuted!=null&&(n.audioMuted=Boolean(e.audioMuted)),e.compressedSdpOffer!=null&&(typeof e.compressedSdpOffer=="string"?$util.base64.decode(e.compressedSdpOffer,n.compressedSdpOffer=$util.newBuffer($util.base64.length(e.compressedSdpOffer)),0):e.compressedSdpOffer.length&&(n.compressedSdpOffer=e.compressedSdpOffer)),e.videoSubscriptionConfiguration){if(!Array.isArray(e.videoSubscriptionConfiguration))throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: array expected");n.videoSubscriptionConfiguration=[];for(var o=0;o<e.videoSubscriptionConfiguration.length;++o){if(typeof e.videoSubscriptionConfiguration[o]!="object")throw TypeError(".SdkSubscribeFrame.videoSubscriptionConfiguration: object expected");n.videoSubscriptionConfiguration[o]=$root.SdkVideoSubscriptionConfiguration.fromObject(e.videoSubscriptionConfiguration[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.sendStreams=[],o.receiveStreamIds=[],o.videoSubscriptionConfiguration=[]),n.defaults&&(o.duplex=n.enums===String?"RX":1,o.sdpOffer="",o.audioHost="",o.audioCheckin=!1,o.audioMuted=!1,n.bytes===String?o.compressedSdpOffer="":(o.compressedSdpOffer=[],n.bytes!==Array&&(o.compressedSdpOffer=$util.newBuffer(o.compressedSdpOffer)))),e.duplex!=null&&e.hasOwnProperty("duplex")&&(o.duplex=n.enums===String?$root.SdkStreamServiceType[e.duplex]:e.duplex),e.sendStreams&&e.sendStreams.length){o.sendStreams=[];for(var a=0;a<e.sendStreams.length;++a)o.sendStreams[a]=$root.SdkStreamDescriptor.toObject(e.sendStreams[a],n)}if(e.receiveStreamIds&&e.receiveStreamIds.length){o.receiveStreamIds=[];for(var a=0;a<e.receiveStreamIds.length;++a)o.receiveStreamIds[a]=e.receiveStreamIds[a]}if(e.sdpOffer!=null&&e.hasOwnProperty("sdpOffer")&&(o.sdpOffer=e.sdpOffer),e.audioHost!=null&&e.hasOwnProperty("audioHost")&&(o.audioHost=e.audioHost),e.audioCheckin!=null&&e.hasOwnProperty("audioCheckin")&&(o.audioCheckin=e.audioCheckin),e.audioMuted!=null&&e.hasOwnProperty("audioMuted")&&(o.audioMuted=e.audioMuted),e.compressedSdpOffer!=null&&e.hasOwnProperty("compressedSdpOffer")&&(o.compressedSdpOffer=n.bytes===String?$util.base64.encode(e.compressedSdpOffer,0,e.compressedSdpOffer.length):n.bytes===Array?Array.prototype.slice.call(e.compressedSdpOffer):e.compressedSdpOffer),e.videoSubscriptionConfiguration&&e.videoSubscriptionConfiguration.length){o.videoSubscriptionConfiguration=[];for(var a=0;a<e.videoSubscriptionConfiguration.length;++a)o.videoSubscriptionConfiguration[a]=$root.SdkVideoSubscriptionConfiguration.toObject(e.videoSubscriptionConfiguration[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkSubscribeAckFrame=function(){function r(t){if(this.allocations=[],this.tracks=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.duplex=1,r.prototype.allocations=$util.emptyArray,r.prototype.sdpAnswer="",r.prototype.tracks=$util.emptyArray,r.prototype.compressedSdpAnswer=$util.newBuffer([]),r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.duplex!=null&&Object.hasOwnProperty.call(e,"duplex")&&n.uint32(8).int32(e.duplex),e.allocations!=null&&e.allocations.length)for(var o=0;o<e.allocations.length;++o)$root.SdkStreamAllocation.encode(e.allocations[o],n.uint32(18).fork()).ldelim();if(e.sdpAnswer!=null&&Object.hasOwnProperty.call(e,"sdpAnswer")&&n.uint32(26).string(e.sdpAnswer),e.tracks!=null&&e.tracks.length)for(var o=0;o<e.tracks.length;++o)$root.SdkTrackMapping.encode(e.tracks[o],n.uint32(34).fork()).ldelim();return e.compressedSdpAnswer!=null&&Object.hasOwnProperty.call(e,"compressedSdpAnswer")&&n.uint32(42).bytes(e.compressedSdpAnswer),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkSubscribeAckFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.duplex=e.int32();break;case 2:a.allocations&&a.allocations.length||(a.allocations=[]),a.allocations.push($root.SdkStreamAllocation.decode(e,e.uint32()));break;case 3:a.sdpAnswer=e.string();break;case 4:a.tracks&&a.tracks.length||(a.tracks=[]),a.tracks.push($root.SdkTrackMapping.decode(e,e.uint32()));break;case 5:a.compressedSdpAnswer=e.bytes();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.duplex!=null&&e.hasOwnProperty("duplex"))switch(e.duplex){default:return"duplex: enum value expected";case 1:case 2:case 3:break}if(e.allocations!=null&&e.hasOwnProperty("allocations")){if(!Array.isArray(e.allocations))return"allocations: array expected";for(var n=0;n<e.allocations.length;++n){var o=$root.SdkStreamAllocation.verify(e.allocations[n]);if(o)return"allocations."+o}}if(e.sdpAnswer!=null&&e.hasOwnProperty("sdpAnswer")&&!$util.isString(e.sdpAnswer))return"sdpAnswer: string expected";if(e.tracks!=null&&e.hasOwnProperty("tracks")){if(!Array.isArray(e.tracks))return"tracks: array expected";for(var n=0;n<e.tracks.length;++n){var o=$root.SdkTrackMapping.verify(e.tracks[n]);if(o)return"tracks."+o}}return e.compressedSdpAnswer!=null&&e.hasOwnProperty("compressedSdpAnswer")&&!(e.compressedSdpAnswer&&typeof e.compressedSdpAnswer.length=="number"||$util.isString(e.compressedSdpAnswer))?"compressedSdpAnswer: buffer expected":null},r.fromObject=function(e){if(e instanceof $root.SdkSubscribeAckFrame)return e;var n=new $root.SdkSubscribeAckFrame;switch(e.duplex){case"RX":case 1:n.duplex=1;break;case"TX":case 2:n.duplex=2;break;case"DUPLEX":case 3:n.duplex=3;break}if(e.allocations){if(!Array.isArray(e.allocations))throw TypeError(".SdkSubscribeAckFrame.allocations: array expected");n.allocations=[];for(var o=0;o<e.allocations.length;++o){if(typeof e.allocations[o]!="object")throw TypeError(".SdkSubscribeAckFrame.allocations: object expected");n.allocations[o]=$root.SdkStreamAllocation.fromObject(e.allocations[o])}}if(e.sdpAnswer!=null&&(n.sdpAnswer=String(e.sdpAnswer)),e.tracks){if(!Array.isArray(e.tracks))throw TypeError(".SdkSubscribeAckFrame.tracks: array expected");n.tracks=[];for(var o=0;o<e.tracks.length;++o){if(typeof e.tracks[o]!="object")throw TypeError(".SdkSubscribeAckFrame.tracks: object expected");n.tracks[o]=$root.SdkTrackMapping.fromObject(e.tracks[o])}}return e.compressedSdpAnswer!=null&&(typeof e.compressedSdpAnswer=="string"?$util.base64.decode(e.compressedSdpAnswer,n.compressedSdpAnswer=$util.newBuffer($util.base64.length(e.compressedSdpAnswer)),0):e.compressedSdpAnswer.length&&(n.compressedSdpAnswer=e.compressedSdpAnswer)),n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.allocations=[],o.tracks=[]),n.defaults&&(o.duplex=n.enums===String?"RX":1,o.sdpAnswer="",n.bytes===String?o.compressedSdpAnswer="":(o.compressedSdpAnswer=[],n.bytes!==Array&&(o.compressedSdpAnswer=$util.newBuffer(o.compressedSdpAnswer)))),e.duplex!=null&&e.hasOwnProperty("duplex")&&(o.duplex=n.enums===String?$root.SdkStreamServiceType[e.duplex]:e.duplex),e.allocations&&e.allocations.length){o.allocations=[];for(var a=0;a<e.allocations.length;++a)o.allocations[a]=$root.SdkStreamAllocation.toObject(e.allocations[a],n)}if(e.sdpAnswer!=null&&e.hasOwnProperty("sdpAnswer")&&(o.sdpAnswer=e.sdpAnswer),e.tracks&&e.tracks.length){o.tracks=[];for(var a=0;a<e.tracks.length;++a)o.tracks[a]=$root.SdkTrackMapping.toObject(e.tracks[a],n)}return e.compressedSdpAnswer!=null&&e.hasOwnProperty("compressedSdpAnswer")&&(o.compressedSdpAnswer=n.bytes===String?$util.base64.encode(e.compressedSdpAnswer,0,e.compressedSdpAnswer.length):n.bytes===Array?Array.prototype.slice.call(e.compressedSdpAnswer):e.compressedSdpAnswer),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkIndexFrame=function(){function r(t){if(this.sources=[],this.pausedAtSourceIds=[],this.supportedReceiveCodecIntersection=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.atCapacity=!1,r.prototype.sources=$util.emptyArray,r.prototype.pausedAtSourceIds=$util.emptyArray,r.prototype.numParticipants=0,r.prototype.supportedReceiveCodecIntersection=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.atCapacity!=null&&Object.hasOwnProperty.call(e,"atCapacity")&&n.uint32(8).bool(e.atCapacity),e.sources!=null&&e.sources.length)for(var o=0;o<e.sources.length;++o)$root.SdkStreamDescriptor.encode(e.sources[o],n.uint32(18).fork()).ldelim();if(e.pausedAtSourceIds!=null&&e.pausedAtSourceIds.length)for(var o=0;o<e.pausedAtSourceIds.length;++o)n.uint32(24).uint32(e.pausedAtSourceIds[o]);if(e.numParticipants!=null&&Object.hasOwnProperty.call(e,"numParticipants")&&n.uint32(32).uint32(e.numParticipants),e.supportedReceiveCodecIntersection!=null&&e.supportedReceiveCodecIntersection.length)for(var o=0;o<e.supportedReceiveCodecIntersection.length;++o)n.uint32(40).int32(e.supportedReceiveCodecIntersection[o]);return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkIndexFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.atCapacity=e.bool();break;case 2:a.sources&&a.sources.length||(a.sources=[]),a.sources.push($root.SdkStreamDescriptor.decode(e,e.uint32()));break;case 3:if(a.pausedAtSourceIds&&a.pausedAtSourceIds.length||(a.pausedAtSourceIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)a.pausedAtSourceIds.push(e.uint32());else a.pausedAtSourceIds.push(e.uint32());break;case 4:a.numParticipants=e.uint32();break;case 5:if(a.supportedReceiveCodecIntersection&&a.supportedReceiveCodecIntersection.length||(a.supportedReceiveCodecIntersection=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)a.supportedReceiveCodecIntersection.push(e.int32());else a.supportedReceiveCodecIntersection.push(e.int32());break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.atCapacity!=null&&e.hasOwnProperty("atCapacity")&&typeof e.atCapacity!="boolean")return"atCapacity: boolean expected";if(e.sources!=null&&e.hasOwnProperty("sources")){if(!Array.isArray(e.sources))return"sources: array expected";for(var n=0;n<e.sources.length;++n){var o=$root.SdkStreamDescriptor.verify(e.sources[n]);if(o)return"sources."+o}}if(e.pausedAtSourceIds!=null&&e.hasOwnProperty("pausedAtSourceIds")){if(!Array.isArray(e.pausedAtSourceIds))return"pausedAtSourceIds: array expected";for(var n=0;n<e.pausedAtSourceIds.length;++n)if(!$util.isInteger(e.pausedAtSourceIds[n]))return"pausedAtSourceIds: integer[] expected"}if(e.numParticipants!=null&&e.hasOwnProperty("numParticipants")&&!$util.isInteger(e.numParticipants))return"numParticipants: integer expected";if(e.supportedReceiveCodecIntersection!=null&&e.hasOwnProperty("supportedReceiveCodecIntersection")){if(!Array.isArray(e.supportedReceiveCodecIntersection))return"supportedReceiveCodecIntersection: array expected";for(var n=0;n<e.supportedReceiveCodecIntersection.length;++n)switch(e.supportedReceiveCodecIntersection[n]){default:return"supportedReceiveCodecIntersection: enum value[] expected";case 1:case 3:break}}return null},r.fromObject=function(e){if(e instanceof $root.SdkIndexFrame)return e;var n=new $root.SdkIndexFrame;if(e.atCapacity!=null&&(n.atCapacity=Boolean(e.atCapacity)),e.sources){if(!Array.isArray(e.sources))throw TypeError(".SdkIndexFrame.sources: array expected");n.sources=[];for(var o=0;o<e.sources.length;++o){if(typeof e.sources[o]!="object")throw TypeError(".SdkIndexFrame.sources: object expected");n.sources[o]=$root.SdkStreamDescriptor.fromObject(e.sources[o])}}if(e.pausedAtSourceIds){if(!Array.isArray(e.pausedAtSourceIds))throw TypeError(".SdkIndexFrame.pausedAtSourceIds: array expected");n.pausedAtSourceIds=[];for(var o=0;o<e.pausedAtSourceIds.length;++o)n.pausedAtSourceIds[o]=e.pausedAtSourceIds[o]>>>0}if(e.numParticipants!=null&&(n.numParticipants=e.numParticipants>>>0),e.supportedReceiveCodecIntersection){if(!Array.isArray(e.supportedReceiveCodecIntersection))throw TypeError(".SdkIndexFrame.supportedReceiveCodecIntersection: array expected");n.supportedReceiveCodecIntersection=[];for(var o=0;o<e.supportedReceiveCodecIntersection.length;++o)switch(e.supportedReceiveCodecIntersection[o]){default:case"VP8":case 1:n.supportedReceiveCodecIntersection[o]=1;break;case"H264_CONSTRAINED_BASELINE_PROFILE":case 3:n.supportedReceiveCodecIntersection[o]=3;break}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.sources=[],o.pausedAtSourceIds=[],o.supportedReceiveCodecIntersection=[]),n.defaults&&(o.atCapacity=!1,o.numParticipants=0),e.atCapacity!=null&&e.hasOwnProperty("atCapacity")&&(o.atCapacity=e.atCapacity),e.sources&&e.sources.length){o.sources=[];for(var a=0;a<e.sources.length;++a)o.sources[a]=$root.SdkStreamDescriptor.toObject(e.sources[a],n)}if(e.pausedAtSourceIds&&e.pausedAtSourceIds.length){o.pausedAtSourceIds=[];for(var a=0;a<e.pausedAtSourceIds.length;++a)o.pausedAtSourceIds[a]=e.pausedAtSourceIds[a]}if(e.numParticipants!=null&&e.hasOwnProperty("numParticipants")&&(o.numParticipants=e.numParticipants),e.supportedReceiveCodecIntersection&&e.supportedReceiveCodecIntersection.length){o.supportedReceiveCodecIntersection=[];for(var a=0;a<e.supportedReceiveCodecIntersection.length;++a)o.supportedReceiveCodecIntersection[a]=n.enums===String?$root.SdkVideoCodecCapability[e.supportedReceiveCodecIntersection[a]]:e.supportedReceiveCodecIntersection[a]}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkPauseResumeFrame=function(){function r(t){if(this.streamIds=[],this.groupIds=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.streamIds=$util.emptyArray,r.prototype.groupIds=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.streamIds!=null&&e.streamIds.length)for(var o=0;o<e.streamIds.length;++o)n.uint32(8).uint32(e.streamIds[o]);if(e.groupIds!=null&&e.groupIds.length)for(var o=0;o<e.groupIds.length;++o)n.uint32(16).uint32(e.groupIds[o]);return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkPauseResumeFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:if(a.streamIds&&a.streamIds.length||(a.streamIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)a.streamIds.push(e.uint32());else a.streamIds.push(e.uint32());break;case 2:if(a.groupIds&&a.groupIds.length||(a.groupIds=[]),(s&7)===2)for(var d=e.uint32()+e.pos;e.pos<d;)a.groupIds.push(e.uint32());else a.groupIds.push(e.uint32());break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamIds!=null&&e.hasOwnProperty("streamIds")){if(!Array.isArray(e.streamIds))return"streamIds: array expected";for(var n=0;n<e.streamIds.length;++n)if(!$util.isInteger(e.streamIds[n]))return"streamIds: integer[] expected"}if(e.groupIds!=null&&e.hasOwnProperty("groupIds")){if(!Array.isArray(e.groupIds))return"groupIds: array expected";for(var n=0;n<e.groupIds.length;++n)if(!$util.isInteger(e.groupIds[n]))return"groupIds: integer[] expected"}return null},r.fromObject=function(e){if(e instanceof $root.SdkPauseResumeFrame)return e;var n=new $root.SdkPauseResumeFrame;if(e.streamIds){if(!Array.isArray(e.streamIds))throw TypeError(".SdkPauseResumeFrame.streamIds: array expected");n.streamIds=[];for(var o=0;o<e.streamIds.length;++o)n.streamIds[o]=e.streamIds[o]>>>0}if(e.groupIds){if(!Array.isArray(e.groupIds))throw TypeError(".SdkPauseResumeFrame.groupIds: array expected");n.groupIds=[];for(var o=0;o<e.groupIds.length;++o)n.groupIds[o]=e.groupIds[o]>>>0}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.streamIds=[],o.groupIds=[]),e.streamIds&&e.streamIds.length){o.streamIds=[];for(var a=0;a<e.streamIds.length;++a)o.streamIds[a]=e.streamIds[a]}if(e.groupIds&&e.groupIds.length){o.groupIds=[];for(var a=0;a<e.groupIds.length;++a)o.groupIds[a]=e.groupIds[a]}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkBitrateFrame=function(){function r(t){if(this.bitrates=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.bitrates=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.bitrates!=null&&e.bitrates.length)for(var o=0;o<e.bitrates.length;++o)$root.SdkBitrate.encode(e.bitrates[o],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkBitrateFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.bitrates&&a.bitrates.length||(a.bitrates=[]),a.bitrates.push($root.SdkBitrate.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.bitrates!=null&&e.hasOwnProperty("bitrates")){if(!Array.isArray(e.bitrates))return"bitrates: array expected";for(var n=0;n<e.bitrates.length;++n){var o=$root.SdkBitrate.verify(e.bitrates[n]);if(o)return"bitrates."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkBitrateFrame)return e;var n=new $root.SdkBitrateFrame;if(e.bitrates){if(!Array.isArray(e.bitrates))throw TypeError(".SdkBitrateFrame.bitrates: array expected");n.bitrates=[];for(var o=0;o<e.bitrates.length;++o){if(typeof e.bitrates[o]!="object")throw TypeError(".SdkBitrateFrame.bitrates: object expected");n.bitrates[o]=$root.SdkBitrate.fromObject(e.bitrates[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.bitrates=[]),e.bitrates&&e.bitrates.length){o.bitrates=[];for(var a=0;a<e.bitrates.length;++a)o.bitrates[a]=$root.SdkBitrate.toObject(e.bitrates[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkStreamDescriptor=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.streamId=0,r.prototype.framerate=0,r.prototype.maxBitrateKbps=0,r.prototype.trackLabel="",r.prototype.groupId=0,r.prototype.avgBitrateBps=0,r.prototype.attendeeId="",r.prototype.mediaType=1,r.prototype.externalUserId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&n.uint32(8).uint32(e.streamId),e.framerate!=null&&Object.hasOwnProperty.call(e,"framerate")&&n.uint32(16).uint32(e.framerate),e.maxBitrateKbps!=null&&Object.hasOwnProperty.call(e,"maxBitrateKbps")&&n.uint32(24).uint32(e.maxBitrateKbps),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&n.uint32(34).string(e.trackLabel),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&n.uint32(48).uint32(e.groupId),e.avgBitrateBps!=null&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&n.uint32(56).uint32(e.avgBitrateBps),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&n.uint32(66).string(e.attendeeId),e.mediaType!=null&&Object.hasOwnProperty.call(e,"mediaType")&&n.uint32(72).int32(e.mediaType),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&n.uint32(82).string(e.externalUserId),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkStreamDescriptor;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.streamId=e.uint32();break;case 2:a.framerate=e.uint32();break;case 3:a.maxBitrateKbps=e.uint32();break;case 4:a.trackLabel=e.string();break;case 6:a.groupId=e.uint32();break;case 7:a.avgBitrateBps=e.uint32();break;case 8:a.attendeeId=e.string();break;case 9:a.mediaType=e.int32();break;case 10:a.externalUserId=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId))return"streamId: integer expected";if(e.framerate!=null&&e.hasOwnProperty("framerate")&&!$util.isInteger(e.framerate))return"framerate: integer expected";if(e.maxBitrateKbps!=null&&e.hasOwnProperty("maxBitrateKbps")&&!$util.isInteger(e.maxBitrateKbps))return"maxBitrateKbps: integer expected";if(e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!$util.isString(e.trackLabel))return"trackLabel: string expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId))return"groupId: integer expected";if(e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&!$util.isInteger(e.avgBitrateBps))return"avgBitrateBps: integer expected";if(e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId))return"attendeeId: string expected";if(e.mediaType!=null&&e.hasOwnProperty("mediaType"))switch(e.mediaType){default:return"mediaType: enum value expected";case 1:case 2:break}return e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!$util.isString(e.externalUserId)?"externalUserId: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkStreamDescriptor)return e;var n=new $root.SdkStreamDescriptor;switch(e.streamId!=null&&(n.streamId=e.streamId>>>0),e.framerate!=null&&(n.framerate=e.framerate>>>0),e.maxBitrateKbps!=null&&(n.maxBitrateKbps=e.maxBitrateKbps>>>0),e.trackLabel!=null&&(n.trackLabel=String(e.trackLabel)),e.groupId!=null&&(n.groupId=e.groupId>>>0),e.avgBitrateBps!=null&&(n.avgBitrateBps=e.avgBitrateBps>>>0),e.attendeeId!=null&&(n.attendeeId=String(e.attendeeId)),e.mediaType){case"AUDIO":case 1:n.mediaType=1;break;case"VIDEO":case 2:n.mediaType=2;break}return e.externalUserId!=null&&(n.externalUserId=String(e.externalUserId)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.streamId=0,o.framerate=0,o.maxBitrateKbps=0,o.trackLabel="",o.groupId=0,o.avgBitrateBps=0,o.attendeeId="",o.mediaType=n.enums===String?"AUDIO":1,o.externalUserId=""),e.streamId!=null&&e.hasOwnProperty("streamId")&&(o.streamId=e.streamId),e.framerate!=null&&e.hasOwnProperty("framerate")&&(o.framerate=e.framerate),e.maxBitrateKbps!=null&&e.hasOwnProperty("maxBitrateKbps")&&(o.maxBitrateKbps=e.maxBitrateKbps),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(o.trackLabel=e.trackLabel),e.groupId!=null&&e.hasOwnProperty("groupId")&&(o.groupId=e.groupId),e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&(o.avgBitrateBps=e.avgBitrateBps),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(o.attendeeId=e.attendeeId),e.mediaType!=null&&e.hasOwnProperty("mediaType")&&(o.mediaType=n.enums===String?$root.SdkStreamMediaType[e.mediaType]:e.mediaType),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(o.externalUserId=e.externalUserId),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkStreamAllocation=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.trackLabel="",r.prototype.streamId=0,r.prototype.groupId=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&n.uint32(10).string(e.trackLabel),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&n.uint32(16).uint32(e.streamId),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&n.uint32(24).uint32(e.groupId),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkStreamAllocation;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.trackLabel=e.string();break;case 2:a.streamId=e.uint32();break;case 3:a.groupId=e.uint32();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!$util.isString(e.trackLabel)?"trackLabel: string expected":e.streamId!=null&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId)?"streamId: integer expected":e.groupId!=null&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId)?"groupId: integer expected":null},r.fromObject=function(e){if(e instanceof $root.SdkStreamAllocation)return e;var n=new $root.SdkStreamAllocation;return e.trackLabel!=null&&(n.trackLabel=String(e.trackLabel)),e.streamId!=null&&(n.streamId=e.streamId>>>0),e.groupId!=null&&(n.groupId=e.groupId>>>0),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.trackLabel="",o.streamId=0,o.groupId=0),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(o.trackLabel=e.trackLabel),e.streamId!=null&&e.hasOwnProperty("streamId")&&(o.streamId=e.streamId),e.groupId!=null&&e.hasOwnProperty("groupId")&&(o.groupId=e.groupId),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTrackMapping=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.streamId=0,r.prototype.ssrc=0,r.prototype.trackLabel="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&n.uint32(8).uint32(e.streamId),e.ssrc!=null&&Object.hasOwnProperty.call(e,"ssrc")&&n.uint32(16).uint32(e.ssrc),e.trackLabel!=null&&Object.hasOwnProperty.call(e,"trackLabel")&&n.uint32(26).string(e.trackLabel),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTrackMapping;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.streamId=e.uint32();break;case 2:a.ssrc=e.uint32();break;case 3:a.trackLabel=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.streamId!=null&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId)?"streamId: integer expected":e.ssrc!=null&&e.hasOwnProperty("ssrc")&&!$util.isInteger(e.ssrc)?"ssrc: integer expected":e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&!$util.isString(e.trackLabel)?"trackLabel: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkTrackMapping)return e;var n=new $root.SdkTrackMapping;return e.streamId!=null&&(n.streamId=e.streamId>>>0),e.ssrc!=null&&(n.ssrc=e.ssrc>>>0),e.trackLabel!=null&&(n.trackLabel=String(e.trackLabel)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.streamId=0,o.ssrc=0,o.trackLabel=""),e.streamId!=null&&e.hasOwnProperty("streamId")&&(o.streamId=e.streamId),e.ssrc!=null&&e.hasOwnProperty("ssrc")&&(o.ssrc=e.ssrc),e.trackLabel!=null&&e.hasOwnProperty("trackLabel")&&(o.trackLabel=e.trackLabel),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkBitrate=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.sourceStreamId=0,r.prototype.avgBitrateBps=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.sourceStreamId!=null&&Object.hasOwnProperty.call(e,"sourceStreamId")&&n.uint32(8).uint32(e.sourceStreamId),e.avgBitrateBps!=null&&Object.hasOwnProperty.call(e,"avgBitrateBps")&&n.uint32(16).uint32(e.avgBitrateBps),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkBitrate;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.sourceStreamId=e.uint32();break;case 2:a.avgBitrateBps=e.uint32();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.sourceStreamId!=null&&e.hasOwnProperty("sourceStreamId")&&!$util.isInteger(e.sourceStreamId)?"sourceStreamId: integer expected":e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&!$util.isInteger(e.avgBitrateBps)?"avgBitrateBps: integer expected":null},r.fromObject=function(e){if(e instanceof $root.SdkBitrate)return e;var n=new $root.SdkBitrate;return e.sourceStreamId!=null&&(n.sourceStreamId=e.sourceStreamId>>>0),e.avgBitrateBps!=null&&(n.avgBitrateBps=e.avgBitrateBps>>>0),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.sourceStreamId=0,o.avgBitrateBps=0),e.sourceStreamId!=null&&e.hasOwnProperty("sourceStreamId")&&(o.sourceStreamId=e.sourceStreamId),e.avgBitrateBps!=null&&e.hasOwnProperty("avgBitrateBps")&&(o.avgBitrateBps=e.avgBitrateBps),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkAudioControlFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.muted=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&n.uint32(8).bool(e.muted),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkAudioControlFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.muted=e.bool();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":null},r.fromObject=function(e){if(e instanceof $root.SdkAudioControlFrame)return e;var n=new $root.SdkAudioControlFrame;return e.muted!=null&&(n.muted=Boolean(e.muted)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.muted=!1),e.muted!=null&&e.hasOwnProperty("muted")&&(o.muted=e.muted),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkAudioMetadataFrame=function(){function r(t){if(this.attendeeStates=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.attendeeStates=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.attendeeStates!=null&&e.attendeeStates.length)for(var o=0;o<e.attendeeStates.length;++o)$root.SdkAudioAttendeeState.encode(e.attendeeStates[o],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkAudioMetadataFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.attendeeStates&&a.attendeeStates.length||(a.attendeeStates=[]),a.attendeeStates.push($root.SdkAudioAttendeeState.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.attendeeStates!=null&&e.hasOwnProperty("attendeeStates")){if(!Array.isArray(e.attendeeStates))return"attendeeStates: array expected";for(var n=0;n<e.attendeeStates.length;++n){var o=$root.SdkAudioAttendeeState.verify(e.attendeeStates[n]);if(o)return"attendeeStates."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkAudioMetadataFrame)return e;var n=new $root.SdkAudioMetadataFrame;if(e.attendeeStates){if(!Array.isArray(e.attendeeStates))throw TypeError(".SdkAudioMetadataFrame.attendeeStates: array expected");n.attendeeStates=[];for(var o=0;o<e.attendeeStates.length;++o){if(typeof e.attendeeStates[o]!="object")throw TypeError(".SdkAudioMetadataFrame.attendeeStates: object expected");n.attendeeStates[o]=$root.SdkAudioAttendeeState.fromObject(e.attendeeStates[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.attendeeStates=[]),e.attendeeStates&&e.attendeeStates.length){o.attendeeStates=[];for(var a=0;a<e.attendeeStates.length;++a)o.attendeeStates[a]=$root.SdkAudioAttendeeState.toObject(e.attendeeStates[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkAudioAttendeeState=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.audioStreamId=0,r.prototype.volume=0,r.prototype.muted=!1,r.prototype.signalStrength=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.audioStreamId!=null&&Object.hasOwnProperty.call(e,"audioStreamId")&&n.uint32(8).uint32(e.audioStreamId),e.volume!=null&&Object.hasOwnProperty.call(e,"volume")&&n.uint32(16).uint32(e.volume),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&n.uint32(24).bool(e.muted),e.signalStrength!=null&&Object.hasOwnProperty.call(e,"signalStrength")&&n.uint32(32).uint32(e.signalStrength),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkAudioAttendeeState;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.audioStreamId=e.uint32();break;case 2:a.volume=e.uint32();break;case 3:a.muted=e.bool();break;case 4:a.signalStrength=e.uint32();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&!$util.isInteger(e.audioStreamId)?"audioStreamId: integer expected":e.volume!=null&&e.hasOwnProperty("volume")&&!$util.isInteger(e.volume)?"volume: integer expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":e.signalStrength!=null&&e.hasOwnProperty("signalStrength")&&!$util.isInteger(e.signalStrength)?"signalStrength: integer expected":null},r.fromObject=function(e){if(e instanceof $root.SdkAudioAttendeeState)return e;var n=new $root.SdkAudioAttendeeState;return e.audioStreamId!=null&&(n.audioStreamId=e.audioStreamId>>>0),e.volume!=null&&(n.volume=e.volume>>>0),e.muted!=null&&(n.muted=Boolean(e.muted)),e.signalStrength!=null&&(n.signalStrength=e.signalStrength>>>0),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.audioStreamId=0,o.volume=0,o.muted=!1,o.signalStrength=0),e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&(o.audioStreamId=e.audioStreamId),e.volume!=null&&e.hasOwnProperty("volume")&&(o.volume=e.volume),e.muted!=null&&e.hasOwnProperty("muted")&&(o.muted=e.muted),e.signalStrength!=null&&e.hasOwnProperty("signalStrength")&&(o.signalStrength=e.signalStrength),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkAudioStreamIdInfoFrame=function(){function r(t){if(this.streams=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.streams=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.streams!=null&&e.streams.length)for(var o=0;o<e.streams.length;++o)$root.SdkAudioStreamIdInfo.encode(e.streams[o],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkAudioStreamIdInfoFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.streams&&a.streams.length||(a.streams=[]),a.streams.push($root.SdkAudioStreamIdInfo.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streams!=null&&e.hasOwnProperty("streams")){if(!Array.isArray(e.streams))return"streams: array expected";for(var n=0;n<e.streams.length;++n){var o=$root.SdkAudioStreamIdInfo.verify(e.streams[n]);if(o)return"streams."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkAudioStreamIdInfoFrame)return e;var n=new $root.SdkAudioStreamIdInfoFrame;if(e.streams){if(!Array.isArray(e.streams))throw TypeError(".SdkAudioStreamIdInfoFrame.streams: array expected");n.streams=[];for(var o=0;o<e.streams.length;++o){if(typeof e.streams[o]!="object")throw TypeError(".SdkAudioStreamIdInfoFrame.streams: object expected");n.streams[o]=$root.SdkAudioStreamIdInfo.fromObject(e.streams[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.streams=[]),e.streams&&e.streams.length){o.streams=[];for(var a=0;a<e.streams.length;++a)o.streams[a]=$root.SdkAudioStreamIdInfo.toObject(e.streams[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkAudioStreamIdInfo=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.audioStreamId=0,r.prototype.attendeeId="",r.prototype.muted=!1,r.prototype.externalUserId="",r.prototype.dropped=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.audioStreamId!=null&&Object.hasOwnProperty.call(e,"audioStreamId")&&n.uint32(8).uint32(e.audioStreamId),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&n.uint32(18).string(e.attendeeId),e.muted!=null&&Object.hasOwnProperty.call(e,"muted")&&n.uint32(24).bool(e.muted),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&n.uint32(34).string(e.externalUserId),e.dropped!=null&&Object.hasOwnProperty.call(e,"dropped")&&n.uint32(40).bool(e.dropped),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkAudioStreamIdInfo;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.audioStreamId=e.uint32();break;case 2:a.attendeeId=e.string();break;case 3:a.muted=e.bool();break;case 4:a.externalUserId=e.string();break;case 5:a.dropped=e.bool();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&!$util.isInteger(e.audioStreamId)?"audioStreamId: integer expected":e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId)?"attendeeId: string expected":e.muted!=null&&e.hasOwnProperty("muted")&&typeof e.muted!="boolean"?"muted: boolean expected":e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!$util.isString(e.externalUserId)?"externalUserId: string expected":e.dropped!=null&&e.hasOwnProperty("dropped")&&typeof e.dropped!="boolean"?"dropped: boolean expected":null},r.fromObject=function(e){if(e instanceof $root.SdkAudioStreamIdInfo)return e;var n=new $root.SdkAudioStreamIdInfo;return e.audioStreamId!=null&&(n.audioStreamId=e.audioStreamId>>>0),e.attendeeId!=null&&(n.attendeeId=String(e.attendeeId)),e.muted!=null&&(n.muted=Boolean(e.muted)),e.externalUserId!=null&&(n.externalUserId=String(e.externalUserId)),e.dropped!=null&&(n.dropped=Boolean(e.dropped)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.audioStreamId=0,o.attendeeId="",o.muted=!1,o.externalUserId="",o.dropped=!1),e.audioStreamId!=null&&e.hasOwnProperty("audioStreamId")&&(o.audioStreamId=e.audioStreamId),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(o.attendeeId=e.attendeeId),e.muted!=null&&e.hasOwnProperty("muted")&&(o.muted=e.muted),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(o.externalUserId=e.externalUserId),e.dropped!=null&&e.hasOwnProperty("dropped")&&(o.dropped=e.dropped),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkPingPongType=function(){var r={},t=Object.create(r);return t[r[1]="PING"]=1,t[r[2]="PONG"]=2,t}();$root.SdkPingPongFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.type=1,r.prototype.pingId=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),n.uint32(8).int32(e.type),n.uint32(16).uint32(e.pingId),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkPingPongFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.type=e.int32();break;case 2:a.pingId=e.uint32();break;default:e.skipType(s&7);break}}if(!a.hasOwnProperty("type"))throw $util.ProtocolError("missing required 'type'",{instance:a});if(!a.hasOwnProperty("pingId"))throw $util.ProtocolError("missing required 'pingId'",{instance:a});return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";switch(e.type){default:return"type: enum value expected";case 1:case 2:break}return $util.isInteger(e.pingId)?null:"pingId: integer expected"},r.fromObject=function(e){if(e instanceof $root.SdkPingPongFrame)return e;var n=new $root.SdkPingPongFrame;switch(e.type){case"PING":case 1:n.type=1;break;case"PONG":case 2:n.type=2;break}return e.pingId!=null&&(n.pingId=e.pingId>>>0),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.type=n.enums===String?"PING":1,o.pingId=0),e.type!=null&&e.hasOwnProperty("type")&&(o.type=n.enums===String?$root.SdkPingPongType[e.type]:e.type),e.pingId!=null&&e.hasOwnProperty("pingId")&&(o.pingId=e.pingId),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkAudioStatusFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.audioStatus=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.audioStatus!=null&&Object.hasOwnProperty.call(e,"audioStatus")&&n.uint32(8).uint32(e.audioStatus),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkAudioStatusFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.audioStatus=e.uint32();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&!$util.isInteger(e.audioStatus)?"audioStatus: integer expected":null},r.fromObject=function(e){if(e instanceof $root.SdkAudioStatusFrame)return e;var n=new $root.SdkAudioStatusFrame;return e.audioStatus!=null&&(n.audioStatus=e.audioStatus>>>0),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.audioStatus=0),e.audioStatus!=null&&e.hasOwnProperty("audioStatus")&&(o.audioStatus=e.audioStatus),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkMetric=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.type=1,r.prototype.value=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&n.uint32(8).int32(e.type),e.value!=null&&Object.hasOwnProperty.call(e,"value")&&n.uint32(17).double(e.value),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkMetric;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.type=e.int32();break;case 2:a.value=e.double();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 64:case 66:case 69:case 72:case 86:case 87:break}return e.value!=null&&e.hasOwnProperty("value")&&typeof e.value!="number"?"value: number expected":null},r.fromObject=function(e){if(e instanceof $root.SdkMetric)return e;var n=new $root.SdkMetric;switch(e.type){case"VIDEO_ACTUAL_ENCODER_BITRATE":case 1:n.type=1;break;case"VIDEO_AVAILABLE_SEND_BANDWIDTH":case 2:n.type=2;break;case"VIDEO_RETRANSMIT_BITRATE":case 3:n.type=3;break;case"VIDEO_AVAILABLE_RECEIVE_BANDWIDTH":case 4:n.type=4;break;case"VIDEO_TARGET_ENCODER_BITRATE":case 5:n.type=5;break;case"VIDEO_BUCKET_DELAY_MS":case 6:n.type=6;break;case"STUN_RTT_MS":case 7:n.type=7;break;case"SOCKET_DISCARDED_PPS":case 8:n.type=8;break;case"RTC_MIC_JITTER_MS":case 9:n.type=9;break;case"RTC_MIC_PPS":case 10:n.type=10;break;case"RTC_MIC_FRACTION_PACKET_LOST_PERCENT":case 11:n.type=11;break;case"RTC_MIC_BITRATE":case 12:n.type=12;break;case"RTC_MIC_RTT_MS":case 13:n.type=13;break;case"RTC_SPK_PPS":case 14:n.type=14;break;case"RTC_SPK_FRACTION_PACKET_LOST_PERCENT":case 15:n.type=15;break;case"RTC_SPK_JITTER_MS":case 16:n.type=16;break;case"RTC_SPK_FRACTION_DECODER_LOSS_PERCENT":case 17:n.type=17;break;case"RTC_SPK_BITRATE":case 18:n.type=18;break;case"RTC_SPK_CURRENT_DELAY_MS":case 19:n.type=19;break;case"RTC_SPK_JITTER_BUFFER_MS":case 20:n.type=20;break;case"VIDEO_SENT_RTT_MS":case 21:n.type=21;break;case"VIDEO_ENCODE_USAGE_PERCENT":case 22:n.type=22;break;case"VIDEO_NACKS_RECEIVED":case 23:n.type=23;break;case"VIDEO_PLIS_RECEIVED":case 24:n.type=24;break;case"VIDEO_AVERAGE_ENCODE_MS":case 25:n.type=25;break;case"VIDEO_INPUT_FPS":case 26:n.type=26;break;case"VIDEO_ENCODE_FPS":case 27:n.type=27;break;case"VIDEO_SENT_FPS":case 28:n.type=28;break;case"VIDEO_FIRS_RECEIVED":case 29:n.type=29;break;case"VIDEO_SENT_PPS":case 30:n.type=30;break;case"VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT":case 31:n.type=31;break;case"VIDEO_SENT_BITRATE":case 32:n.type=32;break;case"VIDEO_DROPPED_FPS":case 33:n.type=33;break;case"VIDEO_TARGET_DELAY_MS":case 34:n.type=34;break;case"VIDEO_DECODE_MS":case 35:n.type=35;break;case"VIDEO_OUTPUT_FPS":case 36:n.type=36;break;case"VIDEO_RECEIVED_PPS":case 37:n.type=37;break;case"VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT":case 38:n.type=38;break;case"VIDEO_RENDER_DELAY_MS":case 39:n.type=39;break;case"VIDEO_RECEIVED_FPS":case 40:n.type=40;break;case"VIDEO_DECODE_FPS":case 41:n.type=41;break;case"VIDEO_NACKS_SENT":case 42:n.type=42;break;case"VIDEO_FIRS_SENT":case 43:n.type=43;break;case"VIDEO_RECEIVED_BITRATE":case 44:n.type=44;break;case"VIDEO_CURRENT_DELAY_MS":case 45:n.type=45;break;case"VIDEO_JITTER_BUFFER_MS":case 46:n.type=46;break;case"VIDEO_DISCARDED_PPS":case 47:n.type=47;break;case"VIDEO_PLIS_SENT":case 48:n.type=48;break;case"VIDEO_RECEIVED_JITTER_MS":case 49:n.type=49;break;case"VIDEO_ENCODE_HEIGHT":case 64:n.type=64;break;case"VIDEO_SENT_QP_SUM":case 66:n.type=66;break;case"VIDEO_DECODE_HEIGHT":case 69:n.type=69;break;case"VIDEO_RECEIVED_QP_SUM":case 72:n.type=72;break;case"VIDEO_ENCODE_WIDTH":case 86:n.type=86;break;case"VIDEO_DECODE_WIDTH":case 87:n.type=87;break}return e.value!=null&&(n.value=Number(e.value)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.type=n.enums===String?"VIDEO_ACTUAL_ENCODER_BITRATE":1,o.value=0),e.type!=null&&e.hasOwnProperty("type")&&(o.type=n.enums===String?$root.SdkMetric.Type[e.type]:e.type),e.value!=null&&e.hasOwnProperty("value")&&(o.value=n.json&&!isFinite(e.value)?String(e.value):e.value),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.Type=function(){var t={},e=Object.create(t);return e[t[1]="VIDEO_ACTUAL_ENCODER_BITRATE"]=1,e[t[2]="VIDEO_AVAILABLE_SEND_BANDWIDTH"]=2,e[t[3]="VIDEO_RETRANSMIT_BITRATE"]=3,e[t[4]="VIDEO_AVAILABLE_RECEIVE_BANDWIDTH"]=4,e[t[5]="VIDEO_TARGET_ENCODER_BITRATE"]=5,e[t[6]="VIDEO_BUCKET_DELAY_MS"]=6,e[t[7]="STUN_RTT_MS"]=7,e[t[8]="SOCKET_DISCARDED_PPS"]=8,e[t[9]="RTC_MIC_JITTER_MS"]=9,e[t[10]="RTC_MIC_PPS"]=10,e[t[11]="RTC_MIC_FRACTION_PACKET_LOST_PERCENT"]=11,e[t[12]="RTC_MIC_BITRATE"]=12,e[t[13]="RTC_MIC_RTT_MS"]=13,e[t[14]="RTC_SPK_PPS"]=14,e[t[15]="RTC_SPK_FRACTION_PACKET_LOST_PERCENT"]=15,e[t[16]="RTC_SPK_JITTER_MS"]=16,e[t[17]="RTC_SPK_FRACTION_DECODER_LOSS_PERCENT"]=17,e[t[18]="RTC_SPK_BITRATE"]=18,e[t[19]="RTC_SPK_CURRENT_DELAY_MS"]=19,e[t[20]="RTC_SPK_JITTER_BUFFER_MS"]=20,e[t[21]="VIDEO_SENT_RTT_MS"]=21,e[t[22]="VIDEO_ENCODE_USAGE_PERCENT"]=22,e[t[23]="VIDEO_NACKS_RECEIVED"]=23,e[t[24]="VIDEO_PLIS_RECEIVED"]=24,e[t[25]="VIDEO_AVERAGE_ENCODE_MS"]=25,e[t[26]="VIDEO_INPUT_FPS"]=26,e[t[27]="VIDEO_ENCODE_FPS"]=27,e[t[28]="VIDEO_SENT_FPS"]=28,e[t[29]="VIDEO_FIRS_RECEIVED"]=29,e[t[30]="VIDEO_SENT_PPS"]=30,e[t[31]="VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT"]=31,e[t[32]="VIDEO_SENT_BITRATE"]=32,e[t[33]="VIDEO_DROPPED_FPS"]=33,e[t[34]="VIDEO_TARGET_DELAY_MS"]=34,e[t[35]="VIDEO_DECODE_MS"]=35,e[t[36]="VIDEO_OUTPUT_FPS"]=36,e[t[37]="VIDEO_RECEIVED_PPS"]=37,e[t[38]="VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT"]=38,e[t[39]="VIDEO_RENDER_DELAY_MS"]=39,e[t[40]="VIDEO_RECEIVED_FPS"]=40,e[t[41]="VIDEO_DECODE_FPS"]=41,e[t[42]="VIDEO_NACKS_SENT"]=42,e[t[43]="VIDEO_FIRS_SENT"]=43,e[t[44]="VIDEO_RECEIVED_BITRATE"]=44,e[t[45]="VIDEO_CURRENT_DELAY_MS"]=45,e[t[46]="VIDEO_JITTER_BUFFER_MS"]=46,e[t[47]="VIDEO_DISCARDED_PPS"]=47,e[t[48]="VIDEO_PLIS_SENT"]=48,e[t[49]="VIDEO_RECEIVED_JITTER_MS"]=49,e[t[64]="VIDEO_ENCODE_HEIGHT"]=64,e[t[66]="VIDEO_SENT_QP_SUM"]=66,e[t[69]="VIDEO_DECODE_HEIGHT"]=69,e[t[72]="VIDEO_RECEIVED_QP_SUM"]=72,e[t[86]="VIDEO_ENCODE_WIDTH"]=86,e[t[87]="VIDEO_DECODE_WIDTH"]=87,e}(),r}();$root.SdkStreamMetricFrame=function(){function r(t){if(this.metrics=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.streamId=0,r.prototype.groupId=0,r.prototype.metrics=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&n.uint32(24).uint32(e.streamId),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&n.uint32(32).uint32(e.groupId),e.metrics!=null&&e.metrics.length)for(var o=0;o<e.metrics.length;++o)$root.SdkMetric.encode(e.metrics[o],n.uint32(42).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkStreamMetricFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 3:a.streamId=e.uint32();break;case 4:a.groupId=e.uint32();break;case 5:a.metrics&&a.metrics.length||(a.metrics=[]),a.metrics.push($root.SdkMetric.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.streamId!=null&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId))return"streamId: integer expected";if(e.groupId!=null&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId))return"groupId: integer expected";if(e.metrics!=null&&e.hasOwnProperty("metrics")){if(!Array.isArray(e.metrics))return"metrics: array expected";for(var n=0;n<e.metrics.length;++n){var o=$root.SdkMetric.verify(e.metrics[n]);if(o)return"metrics."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkStreamMetricFrame)return e;var n=new $root.SdkStreamMetricFrame;if(e.streamId!=null&&(n.streamId=e.streamId>>>0),e.groupId!=null&&(n.groupId=e.groupId>>>0),e.metrics){if(!Array.isArray(e.metrics))throw TypeError(".SdkStreamMetricFrame.metrics: array expected");n.metrics=[];for(var o=0;o<e.metrics.length;++o){if(typeof e.metrics[o]!="object")throw TypeError(".SdkStreamMetricFrame.metrics: object expected");n.metrics[o]=$root.SdkMetric.fromObject(e.metrics[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.metrics=[]),n.defaults&&(o.streamId=0,o.groupId=0),e.streamId!=null&&e.hasOwnProperty("streamId")&&(o.streamId=e.streamId),e.groupId!=null&&e.hasOwnProperty("groupId")&&(o.groupId=e.groupId),e.metrics&&e.metrics.length){o.metrics=[];for(var a=0;a<e.metrics.length;++a)o.metrics[a]=$root.SdkMetric.toObject(e.metrics[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkClientMetricFrame=function(){function r(t){if(this.globalMetrics=[],this.streamMetricFrames=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.globalMetrics=$util.emptyArray,r.prototype.streamMetricFrames=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.globalMetrics!=null&&e.globalMetrics.length)for(var o=0;o<e.globalMetrics.length;++o)$root.SdkMetric.encode(e.globalMetrics[o],n.uint32(10).fork()).ldelim();if(e.streamMetricFrames!=null&&e.streamMetricFrames.length)for(var o=0;o<e.streamMetricFrames.length;++o)$root.SdkStreamMetricFrame.encode(e.streamMetricFrames[o],n.uint32(18).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkClientMetricFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.globalMetrics&&a.globalMetrics.length||(a.globalMetrics=[]),a.globalMetrics.push($root.SdkMetric.decode(e,e.uint32()));break;case 2:a.streamMetricFrames&&a.streamMetricFrames.length||(a.streamMetricFrames=[]),a.streamMetricFrames.push($root.SdkStreamMetricFrame.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.globalMetrics!=null&&e.hasOwnProperty("globalMetrics")){if(!Array.isArray(e.globalMetrics))return"globalMetrics: array expected";for(var n=0;n<e.globalMetrics.length;++n){var o=$root.SdkMetric.verify(e.globalMetrics[n]);if(o)return"globalMetrics."+o}}if(e.streamMetricFrames!=null&&e.hasOwnProperty("streamMetricFrames")){if(!Array.isArray(e.streamMetricFrames))return"streamMetricFrames: array expected";for(var n=0;n<e.streamMetricFrames.length;++n){var o=$root.SdkStreamMetricFrame.verify(e.streamMetricFrames[n]);if(o)return"streamMetricFrames."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkClientMetricFrame)return e;var n=new $root.SdkClientMetricFrame;if(e.globalMetrics){if(!Array.isArray(e.globalMetrics))throw TypeError(".SdkClientMetricFrame.globalMetrics: array expected");n.globalMetrics=[];for(var o=0;o<e.globalMetrics.length;++o){if(typeof e.globalMetrics[o]!="object")throw TypeError(".SdkClientMetricFrame.globalMetrics: object expected");n.globalMetrics[o]=$root.SdkMetric.fromObject(e.globalMetrics[o])}}if(e.streamMetricFrames){if(!Array.isArray(e.streamMetricFrames))throw TypeError(".SdkClientMetricFrame.streamMetricFrames: array expected");n.streamMetricFrames=[];for(var o=0;o<e.streamMetricFrames.length;++o){if(typeof e.streamMetricFrames[o]!="object")throw TypeError(".SdkClientMetricFrame.streamMetricFrames: object expected");n.streamMetricFrames[o]=$root.SdkStreamMetricFrame.fromObject(e.streamMetricFrames[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.globalMetrics=[],o.streamMetricFrames=[]),e.globalMetrics&&e.globalMetrics.length){o.globalMetrics=[];for(var a=0;a<e.globalMetrics.length;++a)o.globalMetrics[a]=$root.SdkMetric.toObject(e.globalMetrics[a],n)}if(e.streamMetricFrames&&e.streamMetricFrames.length){o.streamMetricFrames=[];for(var a=0;a<e.streamMetricFrames.length;++a)o.streamMetricFrames[a]=$root.SdkStreamMetricFrame.toObject(e.streamMetricFrames[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkDataMessageFrame=function(){function r(t){if(this.messages=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.messages=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.messages!=null&&e.messages.length)for(var o=0;o<e.messages.length;++o)$root.SdkDataMessagePayload.encode(e.messages[o],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkDataMessageFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.messages&&a.messages.length||(a.messages=[]),a.messages.push($root.SdkDataMessagePayload.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.messages!=null&&e.hasOwnProperty("messages")){if(!Array.isArray(e.messages))return"messages: array expected";for(var n=0;n<e.messages.length;++n){var o=$root.SdkDataMessagePayload.verify(e.messages[n]);if(o)return"messages."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkDataMessageFrame)return e;var n=new $root.SdkDataMessageFrame;if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".SdkDataMessageFrame.messages: array expected");n.messages=[];for(var o=0;o<e.messages.length;++o){if(typeof e.messages[o]!="object")throw TypeError(".SdkDataMessageFrame.messages: object expected");n.messages[o]=$root.SdkDataMessagePayload.fromObject(e.messages[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.messages=[]),e.messages&&e.messages.length){o.messages=[];for(var a=0;a<e.messages.length;++a)o.messages[a]=$root.SdkDataMessagePayload.toObject(e.messages[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkDataMessagePayload=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.topic="",r.prototype.data=$util.newBuffer([]),r.prototype.lifetimeMs=0,r.prototype.senderAttendeeId="",r.prototype.ingestTimeNs=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.senderExternalUserId="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.topic!=null&&Object.hasOwnProperty.call(e,"topic")&&n.uint32(10).string(e.topic),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&n.uint32(18).bytes(e.data),e.lifetimeMs!=null&&Object.hasOwnProperty.call(e,"lifetimeMs")&&n.uint32(24).uint32(e.lifetimeMs),e.senderAttendeeId!=null&&Object.hasOwnProperty.call(e,"senderAttendeeId")&&n.uint32(34).string(e.senderAttendeeId),e.ingestTimeNs!=null&&Object.hasOwnProperty.call(e,"ingestTimeNs")&&n.uint32(40).int64(e.ingestTimeNs),e.senderExternalUserId!=null&&Object.hasOwnProperty.call(e,"senderExternalUserId")&&n.uint32(50).string(e.senderExternalUserId),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkDataMessagePayload;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.topic=e.string();break;case 2:a.data=e.bytes();break;case 3:a.lifetimeMs=e.uint32();break;case 4:a.senderAttendeeId=e.string();break;case 5:a.ingestTimeNs=e.int64();break;case 6:a.senderExternalUserId=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.topic!=null&&e.hasOwnProperty("topic")&&!$util.isString(e.topic)?"topic: string expected":e.data!=null&&e.hasOwnProperty("data")&&!(e.data&&typeof e.data.length=="number"||$util.isString(e.data))?"data: buffer expected":e.lifetimeMs!=null&&e.hasOwnProperty("lifetimeMs")&&!$util.isInteger(e.lifetimeMs)?"lifetimeMs: integer expected":e.senderAttendeeId!=null&&e.hasOwnProperty("senderAttendeeId")&&!$util.isString(e.senderAttendeeId)?"senderAttendeeId: string expected":e.ingestTimeNs!=null&&e.hasOwnProperty("ingestTimeNs")&&!$util.isInteger(e.ingestTimeNs)&&!(e.ingestTimeNs&&$util.isInteger(e.ingestTimeNs.low)&&$util.isInteger(e.ingestTimeNs.high))?"ingestTimeNs: integer|Long expected":e.senderExternalUserId!=null&&e.hasOwnProperty("senderExternalUserId")&&!$util.isString(e.senderExternalUserId)?"senderExternalUserId: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkDataMessagePayload)return e;var n=new $root.SdkDataMessagePayload;return e.topic!=null&&(n.topic=String(e.topic)),e.data!=null&&(typeof e.data=="string"?$util.base64.decode(e.data,n.data=$util.newBuffer($util.base64.length(e.data)),0):e.data.length&&(n.data=e.data)),e.lifetimeMs!=null&&(n.lifetimeMs=e.lifetimeMs>>>0),e.senderAttendeeId!=null&&(n.senderAttendeeId=String(e.senderAttendeeId)),e.ingestTimeNs!=null&&($util.Long?(n.ingestTimeNs=$util.Long.fromValue(e.ingestTimeNs)).unsigned=!1:typeof e.ingestTimeNs=="string"?n.ingestTimeNs=parseInt(e.ingestTimeNs,10):typeof e.ingestTimeNs=="number"?n.ingestTimeNs=e.ingestTimeNs:typeof e.ingestTimeNs=="object"&&(n.ingestTimeNs=new $util.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber())),e.senderExternalUserId!=null&&(n.senderExternalUserId=String(e.senderExternalUserId)),n},r.toObject=function(e,n){n||(n={});var o={};if(n.defaults){if(o.topic="",n.bytes===String?o.data="":(o.data=[],n.bytes!==Array&&(o.data=$util.newBuffer(o.data))),o.lifetimeMs=0,o.senderAttendeeId="",$util.Long){var a=new $util.Long(0,0,!1);o.ingestTimeNs=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.ingestTimeNs=n.longs===String?"0":0;o.senderExternalUserId=""}return e.topic!=null&&e.hasOwnProperty("topic")&&(o.topic=e.topic),e.data!=null&&e.hasOwnProperty("data")&&(o.data=n.bytes===String?$util.base64.encode(e.data,0,e.data.length):n.bytes===Array?Array.prototype.slice.call(e.data):e.data),e.lifetimeMs!=null&&e.hasOwnProperty("lifetimeMs")&&(o.lifetimeMs=e.lifetimeMs),e.senderAttendeeId!=null&&e.hasOwnProperty("senderAttendeeId")&&(o.senderAttendeeId=e.senderAttendeeId),e.ingestTimeNs!=null&&e.hasOwnProperty("ingestTimeNs")&&(typeof e.ingestTimeNs=="number"?o.ingestTimeNs=n.longs===String?String(e.ingestTimeNs):e.ingestTimeNs:o.ingestTimeNs=n.longs===String?$util.Long.prototype.toString.call(e.ingestTimeNs):n.longs===Number?new $util.LongBits(e.ingestTimeNs.low>>>0,e.ingestTimeNs.high>>>0).toNumber():e.ingestTimeNs),e.senderExternalUserId!=null&&e.hasOwnProperty("senderExternalUserId")&&(o.senderExternalUserId=e.senderExternalUserId),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTurnCredentials=function(){function r(t){if(this.uris=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.username="",r.prototype.password="",r.prototype.ttl=0,r.prototype.uris=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.username!=null&&Object.hasOwnProperty.call(e,"username")&&n.uint32(10).string(e.username),e.password!=null&&Object.hasOwnProperty.call(e,"password")&&n.uint32(18).string(e.password),e.ttl!=null&&Object.hasOwnProperty.call(e,"ttl")&&n.uint32(24).uint32(e.ttl),e.uris!=null&&e.uris.length)for(var o=0;o<e.uris.length;++o)n.uint32(34).string(e.uris[o]);return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTurnCredentials;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.username=e.string();break;case 2:a.password=e.string();break;case 3:a.ttl=e.uint32();break;case 4:a.uris&&a.uris.length||(a.uris=[]),a.uris.push(e.string());break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.username!=null&&e.hasOwnProperty("username")&&!$util.isString(e.username))return"username: string expected";if(e.password!=null&&e.hasOwnProperty("password")&&!$util.isString(e.password))return"password: string expected";if(e.ttl!=null&&e.hasOwnProperty("ttl")&&!$util.isInteger(e.ttl))return"ttl: integer expected";if(e.uris!=null&&e.hasOwnProperty("uris")){if(!Array.isArray(e.uris))return"uris: array expected";for(var n=0;n<e.uris.length;++n)if(!$util.isString(e.uris[n]))return"uris: string[] expected"}return null},r.fromObject=function(e){if(e instanceof $root.SdkTurnCredentials)return e;var n=new $root.SdkTurnCredentials;if(e.username!=null&&(n.username=String(e.username)),e.password!=null&&(n.password=String(e.password)),e.ttl!=null&&(n.ttl=e.ttl>>>0),e.uris){if(!Array.isArray(e.uris))throw TypeError(".SdkTurnCredentials.uris: array expected");n.uris=[];for(var o=0;o<e.uris.length;++o)n.uris[o]=String(e.uris[o])}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.uris=[]),n.defaults&&(o.username="",o.password="",o.ttl=0),e.username!=null&&e.hasOwnProperty("username")&&(o.username=e.username),e.password!=null&&e.hasOwnProperty("password")&&(o.password=e.password),e.ttl!=null&&e.hasOwnProperty("ttl")&&(o.ttl=e.ttl),e.uris&&e.uris.length){o.uris=[];for(var a=0;a<e.uris.length;++a)o.uris[a]=e.uris[a]}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTranscriptItem=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.content="",r.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.speakerAttendeeId="",r.prototype.speakerExternalUserId="",r.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.type=1,r.prototype.vocabularyFilterMatch=!1,r.prototype.confidence=0,r.prototype.stable=!1,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.content!=null&&Object.hasOwnProperty.call(e,"content")&&n.uint32(10).string(e.content),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&n.uint32(16).int64(e.endTime),e.speakerAttendeeId!=null&&Object.hasOwnProperty.call(e,"speakerAttendeeId")&&n.uint32(26).string(e.speakerAttendeeId),e.speakerExternalUserId!=null&&Object.hasOwnProperty.call(e,"speakerExternalUserId")&&n.uint32(34).string(e.speakerExternalUserId),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&n.uint32(40).int64(e.startTime),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&n.uint32(48).int32(e.type),e.vocabularyFilterMatch!=null&&Object.hasOwnProperty.call(e,"vocabularyFilterMatch")&&n.uint32(56).bool(e.vocabularyFilterMatch),e.confidence!=null&&Object.hasOwnProperty.call(e,"confidence")&&n.uint32(65).double(e.confidence),e.stable!=null&&Object.hasOwnProperty.call(e,"stable")&&n.uint32(72).bool(e.stable),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscriptItem;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.content=e.string();break;case 2:a.endTime=e.int64();break;case 3:a.speakerAttendeeId=e.string();break;case 4:a.speakerExternalUserId=e.string();break;case 5:a.startTime=e.int64();break;case 6:a.type=e.int32();break;case 7:a.vocabularyFilterMatch=e.bool();break;case 8:a.confidence=e.double();break;case 9:a.stable=e.bool();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.content!=null&&e.hasOwnProperty("content")&&!$util.isString(e.content))return"content: string expected";if(e.endTime!=null&&e.hasOwnProperty("endTime")&&!$util.isInteger(e.endTime)&&!(e.endTime&&$util.isInteger(e.endTime.low)&&$util.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(e.speakerAttendeeId!=null&&e.hasOwnProperty("speakerAttendeeId")&&!$util.isString(e.speakerAttendeeId))return"speakerAttendeeId: string expected";if(e.speakerExternalUserId!=null&&e.hasOwnProperty("speakerExternalUserId")&&!$util.isString(e.speakerExternalUserId))return"speakerExternalUserId: string expected";if(e.startTime!=null&&e.hasOwnProperty("startTime")&&!$util.isInteger(e.startTime)&&!(e.startTime&&$util.isInteger(e.startTime.low)&&$util.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:break}return e.vocabularyFilterMatch!=null&&e.hasOwnProperty("vocabularyFilterMatch")&&typeof e.vocabularyFilterMatch!="boolean"?"vocabularyFilterMatch: boolean expected":e.confidence!=null&&e.hasOwnProperty("confidence")&&typeof e.confidence!="number"?"confidence: number expected":e.stable!=null&&e.hasOwnProperty("stable")&&typeof e.stable!="boolean"?"stable: boolean expected":null},r.fromObject=function(e){if(e instanceof $root.SdkTranscriptItem)return e;var n=new $root.SdkTranscriptItem;switch(e.content!=null&&(n.content=String(e.content)),e.endTime!=null&&($util.Long?(n.endTime=$util.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?n.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?n.endTime=e.endTime:typeof e.endTime=="object"&&(n.endTime=new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.speakerAttendeeId!=null&&(n.speakerAttendeeId=String(e.speakerAttendeeId)),e.speakerExternalUserId!=null&&(n.speakerExternalUserId=String(e.speakerExternalUserId)),e.startTime!=null&&($util.Long?(n.startTime=$util.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?n.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?n.startTime=e.startTime:typeof e.startTime=="object"&&(n.startTime=new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.type){case"PRONUNCIATION":case 1:n.type=1;break;case"PUNCTUATION":case 2:n.type=2;break}return e.vocabularyFilterMatch!=null&&(n.vocabularyFilterMatch=Boolean(e.vocabularyFilterMatch)),e.confidence!=null&&(n.confidence=Number(e.confidence)),e.stable!=null&&(n.stable=Boolean(e.stable)),n},r.toObject=function(e,n){n||(n={});var o={};if(n.defaults){if(o.content="",$util.Long){var a=new $util.Long(0,0,!1);o.endTime=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.endTime=n.longs===String?"0":0;if(o.speakerAttendeeId="",o.speakerExternalUserId="",$util.Long){var a=new $util.Long(0,0,!1);o.startTime=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.startTime=n.longs===String?"0":0;o.type=n.enums===String?"PRONUNCIATION":1,o.vocabularyFilterMatch=!1,o.confidence=0,o.stable=!1}return e.content!=null&&e.hasOwnProperty("content")&&(o.content=e.content),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?o.endTime=n.longs===String?String(e.endTime):e.endTime:o.endTime=n.longs===String?$util.Long.prototype.toString.call(e.endTime):n.longs===Number?new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.speakerAttendeeId!=null&&e.hasOwnProperty("speakerAttendeeId")&&(o.speakerAttendeeId=e.speakerAttendeeId),e.speakerExternalUserId!=null&&e.hasOwnProperty("speakerExternalUserId")&&(o.speakerExternalUserId=e.speakerExternalUserId),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?o.startTime=n.longs===String?String(e.startTime):e.startTime:o.startTime=n.longs===String?$util.Long.prototype.toString.call(e.startTime):n.longs===Number?new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.type!=null&&e.hasOwnProperty("type")&&(o.type=n.enums===String?$root.SdkTranscriptItem.Type[e.type]:e.type),e.vocabularyFilterMatch!=null&&e.hasOwnProperty("vocabularyFilterMatch")&&(o.vocabularyFilterMatch=e.vocabularyFilterMatch),e.confidence!=null&&e.hasOwnProperty("confidence")&&(o.confidence=n.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),e.stable!=null&&e.hasOwnProperty("stable")&&(o.stable=e.stable),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.Type=function(){var t={},e=Object.create(t);return e[t[1]="PRONUNCIATION"]=1,e[t[2]="PUNCTUATION"]=2,e}(),r}();$root.SdkTranscriptEntity=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.category="",r.prototype.confidence=0,r.prototype.content="",r.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.type="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.category!=null&&Object.hasOwnProperty.call(e,"category")&&n.uint32(10).string(e.category),e.confidence!=null&&Object.hasOwnProperty.call(e,"confidence")&&n.uint32(17).double(e.confidence),e.content!=null&&Object.hasOwnProperty.call(e,"content")&&n.uint32(26).string(e.content),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&n.uint32(32).int64(e.endTime),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&n.uint32(40).int64(e.startTime),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&n.uint32(50).string(e.type),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscriptEntity;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.category=e.string();break;case 2:a.confidence=e.double();break;case 3:a.content=e.string();break;case 4:a.endTime=e.int64();break;case 5:a.startTime=e.int64();break;case 6:a.type=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.category!=null&&e.hasOwnProperty("category")&&!$util.isString(e.category)?"category: string expected":e.confidence!=null&&e.hasOwnProperty("confidence")&&typeof e.confidence!="number"?"confidence: number expected":e.content!=null&&e.hasOwnProperty("content")&&!$util.isString(e.content)?"content: string expected":e.endTime!=null&&e.hasOwnProperty("endTime")&&!$util.isInteger(e.endTime)&&!(e.endTime&&$util.isInteger(e.endTime.low)&&$util.isInteger(e.endTime.high))?"endTime: integer|Long expected":e.startTime!=null&&e.hasOwnProperty("startTime")&&!$util.isInteger(e.startTime)&&!(e.startTime&&$util.isInteger(e.startTime.low)&&$util.isInteger(e.startTime.high))?"startTime: integer|Long expected":e.type!=null&&e.hasOwnProperty("type")&&!$util.isString(e.type)?"type: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkTranscriptEntity)return e;var n=new $root.SdkTranscriptEntity;return e.category!=null&&(n.category=String(e.category)),e.confidence!=null&&(n.confidence=Number(e.confidence)),e.content!=null&&(n.content=String(e.content)),e.endTime!=null&&($util.Long?(n.endTime=$util.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?n.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?n.endTime=e.endTime:typeof e.endTime=="object"&&(n.endTime=new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.startTime!=null&&($util.Long?(n.startTime=$util.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?n.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?n.startTime=e.startTime:typeof e.startTime=="object"&&(n.startTime=new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.type!=null&&(n.type=String(e.type)),n},r.toObject=function(e,n){n||(n={});var o={};if(n.defaults){if(o.category="",o.confidence=0,o.content="",$util.Long){var a=new $util.Long(0,0,!1);o.endTime=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.endTime=n.longs===String?"0":0;if($util.Long){var a=new $util.Long(0,0,!1);o.startTime=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.startTime=n.longs===String?"0":0;o.type=""}return e.category!=null&&e.hasOwnProperty("category")&&(o.category=e.category),e.confidence!=null&&e.hasOwnProperty("confidence")&&(o.confidence=n.json&&!isFinite(e.confidence)?String(e.confidence):e.confidence),e.content!=null&&e.hasOwnProperty("content")&&(o.content=e.content),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?o.endTime=n.longs===String?String(e.endTime):e.endTime:o.endTime=n.longs===String?$util.Long.prototype.toString.call(e.endTime):n.longs===Number?new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?o.startTime=n.longs===String?String(e.startTime):e.startTime:o.startTime=n.longs===String?$util.Long.prototype.toString.call(e.startTime):n.longs===Number?new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.type!=null&&e.hasOwnProperty("type")&&(o.type=e.type),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTranscriptAlternative=function(){function r(t){if(this.items=[],this.entities=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.items=$util.emptyArray,r.prototype.transcript="",r.prototype.entities=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.items!=null&&e.items.length)for(var o=0;o<e.items.length;++o)$root.SdkTranscriptItem.encode(e.items[o],n.uint32(10).fork()).ldelim();if(e.transcript!=null&&Object.hasOwnProperty.call(e,"transcript")&&n.uint32(18).string(e.transcript),e.entities!=null&&e.entities.length)for(var o=0;o<e.entities.length;++o)$root.SdkTranscriptEntity.encode(e.entities[o],n.uint32(26).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscriptAlternative;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.items&&a.items.length||(a.items=[]),a.items.push($root.SdkTranscriptItem.decode(e,e.uint32()));break;case 2:a.transcript=e.string();break;case 3:a.entities&&a.entities.length||(a.entities=[]),a.entities.push($root.SdkTranscriptEntity.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.items!=null&&e.hasOwnProperty("items")){if(!Array.isArray(e.items))return"items: array expected";for(var n=0;n<e.items.length;++n){var o=$root.SdkTranscriptItem.verify(e.items[n]);if(o)return"items."+o}}if(e.transcript!=null&&e.hasOwnProperty("transcript")&&!$util.isString(e.transcript))return"transcript: string expected";if(e.entities!=null&&e.hasOwnProperty("entities")){if(!Array.isArray(e.entities))return"entities: array expected";for(var n=0;n<e.entities.length;++n){var o=$root.SdkTranscriptEntity.verify(e.entities[n]);if(o)return"entities."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkTranscriptAlternative)return e;var n=new $root.SdkTranscriptAlternative;if(e.items){if(!Array.isArray(e.items))throw TypeError(".SdkTranscriptAlternative.items: array expected");n.items=[];for(var o=0;o<e.items.length;++o){if(typeof e.items[o]!="object")throw TypeError(".SdkTranscriptAlternative.items: object expected");n.items[o]=$root.SdkTranscriptItem.fromObject(e.items[o])}}if(e.transcript!=null&&(n.transcript=String(e.transcript)),e.entities){if(!Array.isArray(e.entities))throw TypeError(".SdkTranscriptAlternative.entities: array expected");n.entities=[];for(var o=0;o<e.entities.length;++o){if(typeof e.entities[o]!="object")throw TypeError(".SdkTranscriptAlternative.entities: object expected");n.entities[o]=$root.SdkTranscriptEntity.fromObject(e.entities[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.items=[],o.entities=[]),n.defaults&&(o.transcript=""),e.items&&e.items.length){o.items=[];for(var a=0;a<e.items.length;++a)o.items[a]=$root.SdkTranscriptItem.toObject(e.items[a],n)}if(e.transcript!=null&&e.hasOwnProperty("transcript")&&(o.transcript=e.transcript),e.entities&&e.entities.length){o.entities=[];for(var a=0;a<e.entities.length;++a)o.entities[a]=$root.SdkTranscriptEntity.toObject(e.entities[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTranscriptLanguageWithScore=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.languageCode="",r.prototype.score=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.languageCode!=null&&Object.hasOwnProperty.call(e,"languageCode")&&n.uint32(10).string(e.languageCode),e.score!=null&&Object.hasOwnProperty.call(e,"score")&&n.uint32(17).double(e.score),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscriptLanguageWithScore;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.languageCode=e.string();break;case 2:a.score=e.double();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.languageCode!=null&&e.hasOwnProperty("languageCode")&&!$util.isString(e.languageCode)?"languageCode: string expected":e.score!=null&&e.hasOwnProperty("score")&&typeof e.score!="number"?"score: number expected":null},r.fromObject=function(e){if(e instanceof $root.SdkTranscriptLanguageWithScore)return e;var n=new $root.SdkTranscriptLanguageWithScore;return e.languageCode!=null&&(n.languageCode=String(e.languageCode)),e.score!=null&&(n.score=Number(e.score)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.languageCode="",o.score=0),e.languageCode!=null&&e.hasOwnProperty("languageCode")&&(o.languageCode=e.languageCode),e.score!=null&&e.hasOwnProperty("score")&&(o.score=n.json&&!isFinite(e.score)?String(e.score):e.score),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTranscriptResult=function(){function r(t){if(this.alternatives=[],this.languageIdentification=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.alternatives=$util.emptyArray,r.prototype.channelId="",r.prototype.endTime=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.isPartial=!1,r.prototype.resultId="",r.prototype.startTime=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.languageCode="",r.prototype.languageIdentification=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.alternatives!=null&&e.alternatives.length)for(var o=0;o<e.alternatives.length;++o)$root.SdkTranscriptAlternative.encode(e.alternatives[o],n.uint32(10).fork()).ldelim();if(e.channelId!=null&&Object.hasOwnProperty.call(e,"channelId")&&n.uint32(18).string(e.channelId),e.endTime!=null&&Object.hasOwnProperty.call(e,"endTime")&&n.uint32(24).int64(e.endTime),e.isPartial!=null&&Object.hasOwnProperty.call(e,"isPartial")&&n.uint32(32).bool(e.isPartial),e.resultId!=null&&Object.hasOwnProperty.call(e,"resultId")&&n.uint32(42).string(e.resultId),e.startTime!=null&&Object.hasOwnProperty.call(e,"startTime")&&n.uint32(48).int64(e.startTime),e.languageCode!=null&&Object.hasOwnProperty.call(e,"languageCode")&&n.uint32(58).string(e.languageCode),e.languageIdentification!=null&&e.languageIdentification.length)for(var o=0;o<e.languageIdentification.length;++o)$root.SdkTranscriptLanguageWithScore.encode(e.languageIdentification[o],n.uint32(66).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscriptResult;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.alternatives&&a.alternatives.length||(a.alternatives=[]),a.alternatives.push($root.SdkTranscriptAlternative.decode(e,e.uint32()));break;case 2:a.channelId=e.string();break;case 3:a.endTime=e.int64();break;case 4:a.isPartial=e.bool();break;case 5:a.resultId=e.string();break;case 6:a.startTime=e.int64();break;case 7:a.languageCode=e.string();break;case 8:a.languageIdentification&&a.languageIdentification.length||(a.languageIdentification=[]),a.languageIdentification.push($root.SdkTranscriptLanguageWithScore.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.alternatives!=null&&e.hasOwnProperty("alternatives")){if(!Array.isArray(e.alternatives))return"alternatives: array expected";for(var n=0;n<e.alternatives.length;++n){var o=$root.SdkTranscriptAlternative.verify(e.alternatives[n]);if(o)return"alternatives."+o}}if(e.channelId!=null&&e.hasOwnProperty("channelId")&&!$util.isString(e.channelId))return"channelId: string expected";if(e.endTime!=null&&e.hasOwnProperty("endTime")&&!$util.isInteger(e.endTime)&&!(e.endTime&&$util.isInteger(e.endTime.low)&&$util.isInteger(e.endTime.high)))return"endTime: integer|Long expected";if(e.isPartial!=null&&e.hasOwnProperty("isPartial")&&typeof e.isPartial!="boolean")return"isPartial: boolean expected";if(e.resultId!=null&&e.hasOwnProperty("resultId")&&!$util.isString(e.resultId))return"resultId: string expected";if(e.startTime!=null&&e.hasOwnProperty("startTime")&&!$util.isInteger(e.startTime)&&!(e.startTime&&$util.isInteger(e.startTime.low)&&$util.isInteger(e.startTime.high)))return"startTime: integer|Long expected";if(e.languageCode!=null&&e.hasOwnProperty("languageCode")&&!$util.isString(e.languageCode))return"languageCode: string expected";if(e.languageIdentification!=null&&e.hasOwnProperty("languageIdentification")){if(!Array.isArray(e.languageIdentification))return"languageIdentification: array expected";for(var n=0;n<e.languageIdentification.length;++n){var o=$root.SdkTranscriptLanguageWithScore.verify(e.languageIdentification[n]);if(o)return"languageIdentification."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkTranscriptResult)return e;var n=new $root.SdkTranscriptResult;if(e.alternatives){if(!Array.isArray(e.alternatives))throw TypeError(".SdkTranscriptResult.alternatives: array expected");n.alternatives=[];for(var o=0;o<e.alternatives.length;++o){if(typeof e.alternatives[o]!="object")throw TypeError(".SdkTranscriptResult.alternatives: object expected");n.alternatives[o]=$root.SdkTranscriptAlternative.fromObject(e.alternatives[o])}}if(e.channelId!=null&&(n.channelId=String(e.channelId)),e.endTime!=null&&($util.Long?(n.endTime=$util.Long.fromValue(e.endTime)).unsigned=!1:typeof e.endTime=="string"?n.endTime=parseInt(e.endTime,10):typeof e.endTime=="number"?n.endTime=e.endTime:typeof e.endTime=="object"&&(n.endTime=new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber())),e.isPartial!=null&&(n.isPartial=Boolean(e.isPartial)),e.resultId!=null&&(n.resultId=String(e.resultId)),e.startTime!=null&&($util.Long?(n.startTime=$util.Long.fromValue(e.startTime)).unsigned=!1:typeof e.startTime=="string"?n.startTime=parseInt(e.startTime,10):typeof e.startTime=="number"?n.startTime=e.startTime:typeof e.startTime=="object"&&(n.startTime=new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber())),e.languageCode!=null&&(n.languageCode=String(e.languageCode)),e.languageIdentification){if(!Array.isArray(e.languageIdentification))throw TypeError(".SdkTranscriptResult.languageIdentification: array expected");n.languageIdentification=[];for(var o=0;o<e.languageIdentification.length;++o){if(typeof e.languageIdentification[o]!="object")throw TypeError(".SdkTranscriptResult.languageIdentification: object expected");n.languageIdentification[o]=$root.SdkTranscriptLanguageWithScore.fromObject(e.languageIdentification[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.alternatives=[],o.languageIdentification=[]),n.defaults){if(o.channelId="",$util.Long){var a=new $util.Long(0,0,!1);o.endTime=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.endTime=n.longs===String?"0":0;if(o.isPartial=!1,o.resultId="",$util.Long){var a=new $util.Long(0,0,!1);o.startTime=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.startTime=n.longs===String?"0":0;o.languageCode=""}if(e.alternatives&&e.alternatives.length){o.alternatives=[];for(var s=0;s<e.alternatives.length;++s)o.alternatives[s]=$root.SdkTranscriptAlternative.toObject(e.alternatives[s],n)}if(e.channelId!=null&&e.hasOwnProperty("channelId")&&(o.channelId=e.channelId),e.endTime!=null&&e.hasOwnProperty("endTime")&&(typeof e.endTime=="number"?o.endTime=n.longs===String?String(e.endTime):e.endTime:o.endTime=n.longs===String?$util.Long.prototype.toString.call(e.endTime):n.longs===Number?new $util.LongBits(e.endTime.low>>>0,e.endTime.high>>>0).toNumber():e.endTime),e.isPartial!=null&&e.hasOwnProperty("isPartial")&&(o.isPartial=e.isPartial),e.resultId!=null&&e.hasOwnProperty("resultId")&&(o.resultId=e.resultId),e.startTime!=null&&e.hasOwnProperty("startTime")&&(typeof e.startTime=="number"?o.startTime=n.longs===String?String(e.startTime):e.startTime:o.startTime=n.longs===String?$util.Long.prototype.toString.call(e.startTime):n.longs===Number?new $util.LongBits(e.startTime.low>>>0,e.startTime.high>>>0).toNumber():e.startTime),e.languageCode!=null&&e.hasOwnProperty("languageCode")&&(o.languageCode=e.languageCode),e.languageIdentification&&e.languageIdentification.length){o.languageIdentification=[];for(var s=0;s<e.languageIdentification.length;++s)o.languageIdentification[s]=$root.SdkTranscriptLanguageWithScore.toObject(e.languageIdentification[s],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTranscript=function(){function r(t){if(this.results=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.results=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.results!=null&&e.results.length)for(var o=0;o<e.results.length;++o)$root.SdkTranscriptResult.encode(e.results[o],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscript;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.results&&a.results.length||(a.results=[]),a.results.push($root.SdkTranscriptResult.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.results!=null&&e.hasOwnProperty("results")){if(!Array.isArray(e.results))return"results: array expected";for(var n=0;n<e.results.length;++n){var o=$root.SdkTranscriptResult.verify(e.results[n]);if(o)return"results."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkTranscript)return e;var n=new $root.SdkTranscript;if(e.results){if(!Array.isArray(e.results))throw TypeError(".SdkTranscript.results: array expected");n.results=[];for(var o=0;o<e.results.length;++o){if(typeof e.results[o]!="object")throw TypeError(".SdkTranscript.results: object expected");n.results[o]=$root.SdkTranscriptResult.fromObject(e.results[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.results=[]),e.results&&e.results.length){o.results=[];for(var a=0;a<e.results.length;++a)o.results[a]=$root.SdkTranscriptResult.toObject(e.results[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTranscriptionStatus=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.type=1,r.prototype.eventTime=$util.Long?$util.Long.fromBits(0,0,!1):0,r.prototype.transcriptionRegion="",r.prototype.transcriptionConfiguration="",r.prototype.message="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.type!=null&&Object.hasOwnProperty.call(e,"type")&&n.uint32(8).int32(e.type),e.eventTime!=null&&Object.hasOwnProperty.call(e,"eventTime")&&n.uint32(16).int64(e.eventTime),e.transcriptionRegion!=null&&Object.hasOwnProperty.call(e,"transcriptionRegion")&&n.uint32(26).string(e.transcriptionRegion),e.transcriptionConfiguration!=null&&Object.hasOwnProperty.call(e,"transcriptionConfiguration")&&n.uint32(34).string(e.transcriptionConfiguration),e.message!=null&&Object.hasOwnProperty.call(e,"message")&&n.uint32(42).string(e.message),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscriptionStatus;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.type=e.int32();break;case 2:a.eventTime=e.int64();break;case 3:a.transcriptionRegion=e.string();break;case 4:a.transcriptionConfiguration=e.string();break;case 5:a.message=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.type!=null&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 1:case 2:case 3:case 4:case 5:break}return e.eventTime!=null&&e.hasOwnProperty("eventTime")&&!$util.isInteger(e.eventTime)&&!(e.eventTime&&$util.isInteger(e.eventTime.low)&&$util.isInteger(e.eventTime.high))?"eventTime: integer|Long expected":e.transcriptionRegion!=null&&e.hasOwnProperty("transcriptionRegion")&&!$util.isString(e.transcriptionRegion)?"transcriptionRegion: string expected":e.transcriptionConfiguration!=null&&e.hasOwnProperty("transcriptionConfiguration")&&!$util.isString(e.transcriptionConfiguration)?"transcriptionConfiguration: string expected":e.message!=null&&e.hasOwnProperty("message")&&!$util.isString(e.message)?"message: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkTranscriptionStatus)return e;var n=new $root.SdkTranscriptionStatus;switch(e.type){case"STARTED":case 1:n.type=1;break;case"INTERRUPTED":case 2:n.type=2;break;case"RESUMED":case 3:n.type=3;break;case"STOPPED":case 4:n.type=4;break;case"FAILED":case 5:n.type=5;break}return e.eventTime!=null&&($util.Long?(n.eventTime=$util.Long.fromValue(e.eventTime)).unsigned=!1:typeof e.eventTime=="string"?n.eventTime=parseInt(e.eventTime,10):typeof e.eventTime=="number"?n.eventTime=e.eventTime:typeof e.eventTime=="object"&&(n.eventTime=new $util.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber())),e.transcriptionRegion!=null&&(n.transcriptionRegion=String(e.transcriptionRegion)),e.transcriptionConfiguration!=null&&(n.transcriptionConfiguration=String(e.transcriptionConfiguration)),e.message!=null&&(n.message=String(e.message)),n},r.toObject=function(e,n){n||(n={});var o={};if(n.defaults){if(o.type=n.enums===String?"STARTED":1,$util.Long){var a=new $util.Long(0,0,!1);o.eventTime=n.longs===String?a.toString():n.longs===Number?a.toNumber():a}else o.eventTime=n.longs===String?"0":0;o.transcriptionRegion="",o.transcriptionConfiguration="",o.message=""}return e.type!=null&&e.hasOwnProperty("type")&&(o.type=n.enums===String?$root.SdkTranscriptionStatus.Type[e.type]:e.type),e.eventTime!=null&&e.hasOwnProperty("eventTime")&&(typeof e.eventTime=="number"?o.eventTime=n.longs===String?String(e.eventTime):e.eventTime:o.eventTime=n.longs===String?$util.Long.prototype.toString.call(e.eventTime):n.longs===Number?new $util.LongBits(e.eventTime.low>>>0,e.eventTime.high>>>0).toNumber():e.eventTime),e.transcriptionRegion!=null&&e.hasOwnProperty("transcriptionRegion")&&(o.transcriptionRegion=e.transcriptionRegion),e.transcriptionConfiguration!=null&&e.hasOwnProperty("transcriptionConfiguration")&&(o.transcriptionConfiguration=e.transcriptionConfiguration),e.message!=null&&e.hasOwnProperty("message")&&(o.message=e.message),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r.Type=function(){var t={},e=Object.create(t);return e[t[1]="STARTED"]=1,e[t[2]="INTERRUPTED"]=2,e[t[3]="RESUMED"]=3,e[t[4]="STOPPED"]=4,e[t[5]="FAILED"]=5,e}(),r}();$root.SdkTranscriptEvent=function(){function r(e){if(e)for(var n=Object.keys(e),o=0;o<n.length;++o)e[n[o]]!=null&&(this[n[o]]=e[n[o]])}r.prototype.status=null,r.prototype.transcript=null;var t;return Object.defineProperty(r.prototype,"Event",{get:$util.oneOfGetter(t=["status","transcript"]),set:$util.oneOfSetter(t)}),r.create=function(n){return new r(n)},r.encode=function(n,o){return o||(o=$Writer.create()),n.status!=null&&Object.hasOwnProperty.call(n,"status")&&$root.SdkTranscriptionStatus.encode(n.status,o.uint32(10).fork()).ldelim(),n.transcript!=null&&Object.hasOwnProperty.call(n,"transcript")&&$root.SdkTranscript.encode(n.transcript,o.uint32(18).fork()).ldelim(),o},r.encodeDelimited=function(n,o){return this.encode(n,o).ldelim()},r.decode=function(n,o){n instanceof $Reader||(n=$Reader.create(n));for(var a=o===void 0?n.len:n.pos+o,s=new $root.SdkTranscriptEvent;n.pos<a;){var d=n.uint32();switch(d>>>3){case 1:s.status=$root.SdkTranscriptionStatus.decode(n,n.uint32());break;case 2:s.transcript=$root.SdkTranscript.decode(n,n.uint32());break;default:n.skipType(d&7);break}}return s},r.decodeDelimited=function(n){return n instanceof $Reader||(n=new $Reader(n)),this.decode(n,n.uint32())},r.verify=function(n){if(typeof n!="object"||n===null)return"object expected";var o={};if(n.status!=null&&n.hasOwnProperty("status")){o.Event=1;{var a=$root.SdkTranscriptionStatus.verify(n.status);if(a)return"status."+a}}if(n.transcript!=null&&n.hasOwnProperty("transcript")){if(o.Event===1)return"Event: multiple values";o.Event=1;{var a=$root.SdkTranscript.verify(n.transcript);if(a)return"transcript."+a}}return null},r.fromObject=function(n){if(n instanceof $root.SdkTranscriptEvent)return n;var o=new $root.SdkTranscriptEvent;if(n.status!=null){if(typeof n.status!="object")throw TypeError(".SdkTranscriptEvent.status: object expected");o.status=$root.SdkTranscriptionStatus.fromObject(n.status)}if(n.transcript!=null){if(typeof n.transcript!="object")throw TypeError(".SdkTranscriptEvent.transcript: object expected");o.transcript=$root.SdkTranscript.fromObject(n.transcript)}return o},r.toObject=function(n,o){o||(o={});var a={};return n.status!=null&&n.hasOwnProperty("status")&&(a.status=$root.SdkTranscriptionStatus.toObject(n.status,o),o.oneofs&&(a.Event="status")),n.transcript!=null&&n.hasOwnProperty("transcript")&&(a.transcript=$root.SdkTranscript.toObject(n.transcript,o),o.oneofs&&(a.Event="transcript")),a},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkTranscriptFrame=function(){function r(t){if(this.events=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.events=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.events!=null&&e.events.length)for(var o=0;o<e.events.length;++o)$root.SdkTranscriptEvent.encode(e.events[o],n.uint32(10).fork()).ldelim();return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkTranscriptFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.events&&a.events.length||(a.events=[]),a.events.push($root.SdkTranscriptEvent.decode(e,e.uint32()));break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.events!=null&&e.hasOwnProperty("events")){if(!Array.isArray(e.events))return"events: array expected";for(var n=0;n<e.events.length;++n){var o=$root.SdkTranscriptEvent.verify(e.events[n]);if(o)return"events."+o}}return null},r.fromObject=function(e){if(e instanceof $root.SdkTranscriptFrame)return e;var n=new $root.SdkTranscriptFrame;if(e.events){if(!Array.isArray(e.events))throw TypeError(".SdkTranscriptFrame.events: array expected");n.events=[];for(var o=0;o<e.events.length;++o){if(typeof e.events[o]!="object")throw TypeError(".SdkTranscriptFrame.events: object expected");n.events[o]=$root.SdkTranscriptEvent.fromObject(e.events[o])}}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.events=[]),e.events&&e.events.length){o.events=[];for(var a=0;a<e.events.length;++a)o.events[a]=$root.SdkTranscriptEvent.toObject(e.events[a],n)}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkRemoteVideoUpdateFrame=function(){function r(t){if(this.addedOrUpdatedVideoSubscriptions=[],this.removedVideoSubscriptionMids=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.addedOrUpdatedVideoSubscriptions=$util.emptyArray,r.prototype.removedVideoSubscriptionMids=$util.emptyArray,r.create=function(e){return new r(e)},r.encode=function(e,n){if(n||(n=$Writer.create()),e.addedOrUpdatedVideoSubscriptions!=null&&e.addedOrUpdatedVideoSubscriptions.length)for(var o=0;o<e.addedOrUpdatedVideoSubscriptions.length;++o)$root.SdkVideoSubscriptionConfiguration.encode(e.addedOrUpdatedVideoSubscriptions[o],n.uint32(10).fork()).ldelim();if(e.removedVideoSubscriptionMids!=null&&e.removedVideoSubscriptionMids.length)for(var o=0;o<e.removedVideoSubscriptionMids.length;++o)n.uint32(18).string(e.removedVideoSubscriptionMids[o]);return n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkRemoteVideoUpdateFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.addedOrUpdatedVideoSubscriptions&&a.addedOrUpdatedVideoSubscriptions.length||(a.addedOrUpdatedVideoSubscriptions=[]),a.addedOrUpdatedVideoSubscriptions.push($root.SdkVideoSubscriptionConfiguration.decode(e,e.uint32()));break;case 2:a.removedVideoSubscriptionMids&&a.removedVideoSubscriptionMids.length||(a.removedVideoSubscriptionMids=[]),a.removedVideoSubscriptionMids.push(e.string());break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.addedOrUpdatedVideoSubscriptions!=null&&e.hasOwnProperty("addedOrUpdatedVideoSubscriptions")){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))return"addedOrUpdatedVideoSubscriptions: array expected";for(var n=0;n<e.addedOrUpdatedVideoSubscriptions.length;++n){var o=$root.SdkVideoSubscriptionConfiguration.verify(e.addedOrUpdatedVideoSubscriptions[n]);if(o)return"addedOrUpdatedVideoSubscriptions."+o}}if(e.removedVideoSubscriptionMids!=null&&e.hasOwnProperty("removedVideoSubscriptionMids")){if(!Array.isArray(e.removedVideoSubscriptionMids))return"removedVideoSubscriptionMids: array expected";for(var n=0;n<e.removedVideoSubscriptionMids.length;++n)if(!$util.isString(e.removedVideoSubscriptionMids[n]))return"removedVideoSubscriptionMids: string[] expected"}return null},r.fromObject=function(e){if(e instanceof $root.SdkRemoteVideoUpdateFrame)return e;var n=new $root.SdkRemoteVideoUpdateFrame;if(e.addedOrUpdatedVideoSubscriptions){if(!Array.isArray(e.addedOrUpdatedVideoSubscriptions))throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: array expected");n.addedOrUpdatedVideoSubscriptions=[];for(var o=0;o<e.addedOrUpdatedVideoSubscriptions.length;++o){if(typeof e.addedOrUpdatedVideoSubscriptions[o]!="object")throw TypeError(".SdkRemoteVideoUpdateFrame.addedOrUpdatedVideoSubscriptions: object expected");n.addedOrUpdatedVideoSubscriptions[o]=$root.SdkVideoSubscriptionConfiguration.fromObject(e.addedOrUpdatedVideoSubscriptions[o])}}if(e.removedVideoSubscriptionMids){if(!Array.isArray(e.removedVideoSubscriptionMids))throw TypeError(".SdkRemoteVideoUpdateFrame.removedVideoSubscriptionMids: array expected");n.removedVideoSubscriptionMids=[];for(var o=0;o<e.removedVideoSubscriptionMids.length;++o)n.removedVideoSubscriptionMids[o]=String(e.removedVideoSubscriptionMids[o])}return n},r.toObject=function(e,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.addedOrUpdatedVideoSubscriptions=[],o.removedVideoSubscriptionMids=[]),e.addedOrUpdatedVideoSubscriptions&&e.addedOrUpdatedVideoSubscriptions.length){o.addedOrUpdatedVideoSubscriptions=[];for(var a=0;a<e.addedOrUpdatedVideoSubscriptions.length;++a)o.addedOrUpdatedVideoSubscriptions[a]=$root.SdkVideoSubscriptionConfiguration.toObject(e.addedOrUpdatedVideoSubscriptions[a],n)}if(e.removedVideoSubscriptionMids&&e.removedVideoSubscriptionMids.length){o.removedVideoSubscriptionMids=[];for(var a=0;a<e.removedVideoSubscriptionMids.length;++a)o.removedVideoSubscriptionMids[a]=e.removedVideoSubscriptionMids[a]}return o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkVideoSubscriptionConfiguration=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.mid="",r.prototype.attendeeId="",r.prototype.streamId=0,r.prototype.priority=0,r.prototype.targetBitrateKbps=0,r.prototype.groupId=0,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),n.uint32(10).string(e.mid),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&n.uint32(18).string(e.attendeeId),e.streamId!=null&&Object.hasOwnProperty.call(e,"streamId")&&n.uint32(24).uint32(e.streamId),e.priority!=null&&Object.hasOwnProperty.call(e,"priority")&&n.uint32(32).uint32(e.priority),e.targetBitrateKbps!=null&&Object.hasOwnProperty.call(e,"targetBitrateKbps")&&n.uint32(40).uint32(e.targetBitrateKbps),e.groupId!=null&&Object.hasOwnProperty.call(e,"groupId")&&n.uint32(48).uint32(e.groupId),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkVideoSubscriptionConfiguration;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.mid=e.string();break;case 2:a.attendeeId=e.string();break;case 3:a.streamId=e.uint32();break;case 4:a.priority=e.uint32();break;case 5:a.targetBitrateKbps=e.uint32();break;case 6:a.groupId=e.uint32();break;default:e.skipType(s&7);break}}if(!a.hasOwnProperty("mid"))throw $util.ProtocolError("missing required 'mid'",{instance:a});return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":$util.isString(e.mid)?e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId)?"attendeeId: string expected":e.streamId!=null&&e.hasOwnProperty("streamId")&&!$util.isInteger(e.streamId)?"streamId: integer expected":e.priority!=null&&e.hasOwnProperty("priority")&&!$util.isInteger(e.priority)?"priority: integer expected":e.targetBitrateKbps!=null&&e.hasOwnProperty("targetBitrateKbps")&&!$util.isInteger(e.targetBitrateKbps)?"targetBitrateKbps: integer expected":e.groupId!=null&&e.hasOwnProperty("groupId")&&!$util.isInteger(e.groupId)?"groupId: integer expected":null:"mid: string expected"},r.fromObject=function(e){if(e instanceof $root.SdkVideoSubscriptionConfiguration)return e;var n=new $root.SdkVideoSubscriptionConfiguration;return e.mid!=null&&(n.mid=String(e.mid)),e.attendeeId!=null&&(n.attendeeId=String(e.attendeeId)),e.streamId!=null&&(n.streamId=e.streamId>>>0),e.priority!=null&&(n.priority=e.priority>>>0),e.targetBitrateKbps!=null&&(n.targetBitrateKbps=e.targetBitrateKbps>>>0),e.groupId!=null&&(n.groupId=e.groupId>>>0),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.mid="",o.attendeeId="",o.streamId=0,o.priority=0,o.targetBitrateKbps=0,o.groupId=0),e.mid!=null&&e.hasOwnProperty("mid")&&(o.mid=e.mid),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(o.attendeeId=e.attendeeId),e.streamId!=null&&e.hasOwnProperty("streamId")&&(o.streamId=e.streamId),e.priority!=null&&e.hasOwnProperty("priority")&&(o.priority=e.priority),e.targetBitrateKbps!=null&&e.hasOwnProperty("targetBitrateKbps")&&(o.targetBitrateKbps=e.targetBitrateKbps),e.groupId!=null&&e.hasOwnProperty("groupId")&&(o.groupId=e.groupId),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkPrimaryMeetingJoinFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.credentials=null,r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.credentials!=null&&Object.hasOwnProperty.call(e,"credentials")&&$root.SdkMeetingSessionCredentials.encode(e.credentials,n.uint32(10).fork()).ldelim(),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkPrimaryMeetingJoinFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.credentials=$root.SdkMeetingSessionCredentials.decode(e,e.uint32());break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){if(typeof e!="object"||e===null)return"object expected";if(e.credentials!=null&&e.hasOwnProperty("credentials")){var n=$root.SdkMeetingSessionCredentials.verify(e.credentials);if(n)return"credentials."+n}return null},r.fromObject=function(e){if(e instanceof $root.SdkPrimaryMeetingJoinFrame)return e;var n=new $root.SdkPrimaryMeetingJoinFrame;if(e.credentials!=null){if(typeof e.credentials!="object")throw TypeError(".SdkPrimaryMeetingJoinFrame.credentials: object expected");n.credentials=$root.SdkMeetingSessionCredentials.fromObject(e.credentials)}return n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.credentials=null),e.credentials!=null&&e.hasOwnProperty("credentials")&&(o.credentials=$root.SdkMeetingSessionCredentials.toObject(e.credentials,n)),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkPrimaryMeetingJoinAckFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkPrimaryMeetingJoinAckFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":null},r.fromObject=function(e){return e instanceof $root.SdkPrimaryMeetingJoinAckFrame?e:new $root.SdkPrimaryMeetingJoinAckFrame},r.toObject=function(){return{}},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkPrimaryMeetingLeaveFrame=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkPrimaryMeetingLeaveFrame;e.pos<o;){var s=e.uint32();switch(s>>>3){default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":null},r.fromObject=function(e){return e instanceof $root.SdkPrimaryMeetingLeaveFrame?e:new $root.SdkPrimaryMeetingLeaveFrame},r.toObject=function(){return{}},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkMeetingSessionCredentials=function(){function r(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)t[e[n]]!=null&&(this[e[n]]=t[e[n]])}return r.prototype.attendeeId="",r.prototype.externalUserId="",r.prototype.joinToken="",r.create=function(e){return new r(e)},r.encode=function(e,n){return n||(n=$Writer.create()),e.attendeeId!=null&&Object.hasOwnProperty.call(e,"attendeeId")&&n.uint32(10).string(e.attendeeId),e.externalUserId!=null&&Object.hasOwnProperty.call(e,"externalUserId")&&n.uint32(18).string(e.externalUserId),e.joinToken!=null&&Object.hasOwnProperty.call(e,"joinToken")&&n.uint32(26).string(e.joinToken),n},r.encodeDelimited=function(e,n){return this.encode(e,n).ldelim()},r.decode=function(e,n){e instanceof $Reader||(e=$Reader.create(e));for(var o=n===void 0?e.len:e.pos+n,a=new $root.SdkMeetingSessionCredentials;e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:a.attendeeId=e.string();break;case 2:a.externalUserId=e.string();break;case 3:a.joinToken=e.string();break;default:e.skipType(s&7);break}}return a},r.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},r.verify=function(e){return typeof e!="object"||e===null?"object expected":e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&!$util.isString(e.attendeeId)?"attendeeId: string expected":e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&!$util.isString(e.externalUserId)?"externalUserId: string expected":e.joinToken!=null&&e.hasOwnProperty("joinToken")&&!$util.isString(e.joinToken)?"joinToken: string expected":null},r.fromObject=function(e){if(e instanceof $root.SdkMeetingSessionCredentials)return e;var n=new $root.SdkMeetingSessionCredentials;return e.attendeeId!=null&&(n.attendeeId=String(e.attendeeId)),e.externalUserId!=null&&(n.externalUserId=String(e.externalUserId)),e.joinToken!=null&&(n.joinToken=String(e.joinToken)),n},r.toObject=function(e,n){n||(n={});var o={};return n.defaults&&(o.attendeeId="",o.externalUserId="",o.joinToken=""),e.attendeeId!=null&&e.hasOwnProperty("attendeeId")&&(o.attendeeId=e.attendeeId),e.externalUserId!=null&&e.hasOwnProperty("externalUserId")&&(o.externalUserId=e.externalUserId),e.joinToken!=null&&e.hasOwnProperty("joinToken")&&(o.joinToken=e.joinToken),o},r.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},r}();$root.SdkVideoCodecCapability=function(){var r={},t=Object.create(r);return t[r[1]="VP8"]=1,t[r[3]="H264_CONSTRAINED_BASELINE_PROFILE"]=3,t}();var SignalingProtocol=$root;$util.Long=void 0;$protobuf.configure();var ClientMetricReportDirection={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ClientMetricReportDirection=void 0;var t;(function(e){e[e.UPSTREAM=0]="UPSTREAM",e[e.DOWNSTREAM=1]="DOWNSTREAM"})(t=r.ClientMetricReportDirection||(r.ClientMetricReportDirection={})),r.default=t})(ClientMetricReportDirection);var ClientMetricReportMediaType={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ClientMetricReportMediaType=void 0;var t;(function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"})(t=r.ClientMetricReportMediaType||(r.ClientMetricReportMediaType={})),r.default=t})(ClientMetricReportMediaType);var GlobalMetricReport$1={};Object.defineProperty(GlobalMetricReport$1,"__esModule",{value:!0});class GlobalMetricReport{constructor(){this.previousMetrics={},this.currentMetrics={}}}GlobalMetricReport$1.default=GlobalMetricReport;Object.defineProperty(ClientMetricReport$1,"__esModule",{value:!0});const SignalingProtocol_js_1$e=SignalingProtocol,ClientMetricReportDirection_1$3=ClientMetricReportDirection,ClientMetricReportMediaType_1$3=ClientMetricReportMediaType,GlobalMetricReport_1=GlobalMetricReport$1;class ClientMetricReport{constructor(t,e,n){this.logger=t,this.videoStreamIndex=e,this.selfAttendeeId=n,this.globalMetricReport=new GlobalMetricReport_1.default,this.streamMetricReports={},this.rtcStatsReport={},this.currentTimestampMs=0,this.previousTimestampMs=0,this.currentSsrcs={},this.identityValue=(o,a)=>{const s=a?this.streamMetricReports[a]:this.globalMetricReport;return Number(s.currentMetrics[o])},this.decoderLossPercent=(o,a)=>{const s=this.streamMetricReports[a],d=s.currentMetrics.concealedSamples-(s.previousMetrics.concealedSamples||0),u=s.currentMetrics.totalSamplesReceived-(s.previousMetrics.totalSamplesReceived||0);return u<=0||u-d<=0?0:d/u*100},this.packetLossPercent=(o,a)=>{const s=this.streamMetricReports[a],d=s.currentMetrics[o]-(s.previousMetrics[o]||0),u=s.currentMetrics.packetsLost-(s.previousMetrics.packetsLost||0),c=d+u;return c<=0||u<=0?0:u*100/c},this.jitterBufferMs=(o,a)=>{const s=this.streamMetricReports[a],d=s.currentMetrics.jitterBufferDelay-(s.previousMetrics.jitterBufferDelay||0),u=s.currentMetrics.jitterBufferEmittedCount-(s.previousMetrics.jitterBufferEmittedCount||0);return d<=0||u<=0?0:d/u*1e3},this.countPerSecond=(o,a)=>{const s=a?this.streamMetricReports[a]:this.globalMetricReport;let d=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(d<=0)return 0;this.previousTimestampMs<=0&&(d=1);const u=s.currentMetrics[o]-(s.previousMetrics[o]||0);return u<=0?0:Math.trunc(u/d)},this.bitsPerSecond=(o,a)=>{const s=a?this.streamMetricReports[a]:this.globalMetricReport;let d=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(d<=0)return 0;this.previousTimestampMs<=0&&(d=1);const u=(s.currentMetrics[o]-(s.previousMetrics[o]||0))*8;return u<=0?0:Math.trunc(u/d)},this.secondsToMilliseconds=(o,a)=>{const s=a?this.streamMetricReports[a]:this.globalMetricReport;return Number(s.currentMetrics[o]*1e3)},this.globalMetricMap={retransmittedBytesSent:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_RETRANSMIT_BITRATE},totalEncodedBytesTarget:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_TARGET_ENCODER_BITRATE},totalPacketSendDelay:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_BUCKET_DELAY_MS},packetsDiscardedOnSend:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.SOCKET_DISCARDED_PPS},availableIncomingBitrate:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_AVAILABLE_RECEIVE_BANDWIDTH},availableOutgoingBitrate:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_AVAILABLE_SEND_BANDWIDTH},currentRoundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$e.SdkMetric.Type.STUN_RTT_MS}},this.audioUpstreamMetricMap={jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_MIC_JITTER_MS},packetsSent:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_MIC_PPS},bytesSent:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_MIC_BITRATE},roundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_MIC_RTT_MS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_MIC_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"}},this.audioDownstreamMetricMap={concealedSamples:{transform:this.countPerSecond},totalSamplesReceived:{transform:this.countPerSecond},decoderLoss:{transform:this.decoderLossPercent,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_SPK_FRACTION_DECODER_LOSS_PERCENT},packetsReceived:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_SPK_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_SPK_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_SPK_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_SPK_JITTER_BUFFER_MS},bytesReceived:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.RTC_SPK_BITRATE}},this.videoUpstreamMetricMap={roundTripTime:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_SENT_RTT_MS},nackCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_NACKS_RECEIVED},pliCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_PLIS_RECEIVED},firCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_FIRS_RECEIVED},framesPerSecond:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_INPUT_FPS},framesEncoded:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_ENCODE_FPS},packetsSent:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_SENT_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"},bytesSent:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_SENT_BITRATE},qpSum:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_SENT_QP_SUM},frameHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_ENCODE_HEIGHT},frameWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_ENCODE_WIDTH},jitter:{transform:this.secondsToMilliseconds}},this.videoDownstreamMetricMap={totalDecodeTime:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_DECODE_MS},packetsReceived:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_RECEIVED_PPS},packetsLost:{transform:this.packetLossPercent,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},framesReceived:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_RECEIVED_FPS},framesDecoded:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_DECODE_FPS},nackCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_NACKS_SENT},firCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_FIRS_SENT},pliCount:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_PLIS_SENT},bytesReceived:{transform:this.bitsPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_RECEIVED_BITRATE},jitter:{transform:this.secondsToMilliseconds,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_RECEIVED_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_JITTER_BUFFER_MS},qpSum:{transform:this.countPerSecond,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_RECEIVED_QP_SUM},frameHeight:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_DECODE_HEIGHT},frameWidth:{transform:this.identityValue,type:SignalingProtocol_js_1$e.SdkMetric.Type.VIDEO_DECODE_WIDTH}},this.observableVideoMetricSpec={videoUpstreamBitrate:{source:"bytesSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamPacketsSent:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFramesEncodedPerSecond:{source:"framesEncoded",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFrameHeight:{source:"frameHeight",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamFrameWidth:{source:"frameWidth",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamRoundTripTimeMs:{source:"roundTripTime",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoDownstreamBitrate:{source:"bytesReceived",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamPacketsReceived:{source:"packetsReceived",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFramesDecodedPerSecond:{source:"framesDecoded",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFrameHeight:{source:"frameHeight",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamFrameWidth:{source:"frameWidth",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},videoDownstreamDelayMs:{source:"jitterBufferMs",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM}},this.observableMetricSpec={audioPacketsReceived:{source:"packetsReceived",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioPacketsReceivedFractionLoss:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioDecoderLoss:{source:"decoderLoss",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioPacketsSent:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioPacketLossPercent:{source:"packetsLost",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioUpstreamRoundTripTimeMs:{source:"roundTripTime",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoUpstreamBitrate:{source:"bytesSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},videoPacketSentPerSecond:{source:"packetsSent",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioSpeakerDelayMs:{source:"jitterBufferMs",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},audioUpstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},audioDownstreamJitterMs:{source:"jitter",media:ClientMetricReportMediaType_1$3.default.AUDIO,dir:ClientMetricReportDirection_1$3.default.DOWNSTREAM},nackCountReceivedPerSecond:{source:"nackCount",media:ClientMetricReportMediaType_1$3.default.VIDEO,dir:ClientMetricReportDirection_1$3.default.UPSTREAM},availableOutgoingBitrate:{source:"availableOutgoingBitrate"},availableIncomingBitrate:{source:"availableIncomingBitrate"},currentRoundTripTimeMs:{source:"currentRoundTripTime"}}}getMetricMap(t,e){switch(t){case ClientMetricReportMediaType_1$3.default.AUDIO:switch(e){case ClientMetricReportDirection_1$3.default.UPSTREAM:return this.audioUpstreamMetricMap;case ClientMetricReportDirection_1$3.default.DOWNSTREAM:return this.audioDownstreamMetricMap}case ClientMetricReportMediaType_1$3.default.VIDEO:switch(e){case ClientMetricReportDirection_1$3.default.UPSTREAM:return this.videoUpstreamMetricMap;case ClientMetricReportDirection_1$3.default.DOWNSTREAM:return this.videoDownstreamMetricMap}default:return this.globalMetricMap}}getObservableMetricValue(t){const e=this.observableMetricSpec[t],o=this.getMetricMap(e.media,e.dir)[e.source],{transform:a,source:s}=o;if(e.hasOwnProperty("media"))for(const d in this.streamMetricReports){const u=this.streamMetricReports[d];if(u.direction===e.dir&&u.mediaType===e.media)return a(s||e.source,Number(d))}else return a(s||e.source);return 0}getObservableVideoMetricValue(t,e){const n=this.observableVideoMetricSpec[t],a=this.getMetricMap(n.media,n.dir)[n.source],{transform:s,source:d}=a;return s(d||n.source,e)}getObservableMetrics(){const t={};for(const e in this.observableMetricSpec)t[e]=this.getObservableMetricValue(e);return t}getObservableVideoMetrics(){const t={};if(!this.videoStreamIndex||!this.selfAttendeeId)return this.logger.error("Need to define VideoStreamIndex and selfAttendeeId if using getObservableVideoMetrics API"),t;for(const e in this.streamMetricReports)if(this.streamMetricReports[e].mediaType===ClientMetricReportMediaType_1$3.default.VIDEO){const n={};for(const s in this.observableVideoMetricSpec)if(this.observableVideoMetricSpec[s].dir===this.streamMetricReports[e].direction){const d=this.getObservableVideoMetricValue(s,Number(e));isNaN(d)||(n[s]=d)}const o=this.streamMetricReports[e].streamId,a=o?this.videoStreamIndex.attendeeIdForStreamId(o):this.selfAttendeeId;t[a]=t[a]?t[a]:{},t[a][e]=n}return t}getRTCStatsReport(){return this.rtcStatsReport}clone(){const t=new ClientMetricReport(this.logger,this.videoStreamIndex,this.selfAttendeeId);return t.globalMetricReport=this.globalMetricReport,t.streamMetricReports=this.streamMetricReports,t.rtcStatsReport=this.rtcStatsReport,t.currentTimestampMs=this.currentTimestampMs,t.previousTimestampMs=this.previousTimestampMs,t}print(){const t={globalMetricReport:this.globalMetricReport,streamMetricReports:this.streamMetricReports,currentTimestampMs:this.currentTimestampMs,previousTimestampMs:this.previousTimestampMs};this.logger.debug(()=>`Client Metric Report: ${JSON.stringify(t)}`)}removeDestroyedSsrcs(){for(const t in this.streamMetricReports)this.currentSsrcs[t]||delete this.streamMetricReports[t]}}ClientMetricReport$1.default=ClientMetricReport;var ClientVideoStreamReceivingReport$1={};Object.defineProperty(ClientVideoStreamReceivingReport$1,"__esModule",{value:!0});class ClientVideoStreamReceivingReport{}ClientVideoStreamReceivingReport$1.default=ClientVideoStreamReceivingReport;var ConnectionHealthData$1={};Object.defineProperty(ConnectionHealthData$1,"__esModule",{value:!0});class ConnectionHealthData{constructor(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}static isTimestampRecent(t,e){return Date.now()<t+e}setConnectionStartTime(){this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}reset(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}isConnectionStartRecent(t){return ConnectionHealthData.isTimestampRecent(this.connectionStartTimestampMs,t)}isLastPacketLossRecent(t){return ConnectionHealthData.isTimestampRecent(this.lastPacketLossInboundTimestampMs,t)}isGoodSignalRecent(t){return ConnectionHealthData.isTimestampRecent(this.lastGoodSignalTimestampMs,t)}isWeakSignalRecent(t){return ConnectionHealthData.isTimestampRecent(this.lastWeakSignalTimestampMs,t)}isNoSignalRecent(t){return ConnectionHealthData.isTimestampRecent(this.lastNoSignalTimestampMs,t)}clone(){const t=new ConnectionHealthData;return t.connectionStartTimestampMs=this.connectionStartTimestampMs,t.consecutiveStatsWithNoPackets=this.consecutiveStatsWithNoPackets,t.lastPacketLossInboundTimestampMs=this.lastPacketLossInboundTimestampMs,t.lastGoodSignalTimestampMs=this.lastGoodSignalTimestampMs,t.lastWeakSignalTimestampMs=this.lastWeakSignalTimestampMs,t.lastNoSignalTimestampMs=this.lastNoSignalTimestampMs,t.consecutiveMissedPongs=this.consecutiveMissedPongs,t.packetsReceivedInLastMinute=this.packetsReceivedInLastMinute.slice(0),t.fractionPacketsLostInboundInLastMinute=this.fractionPacketsLostInboundInLastMinute.slice(0),t.audioSpeakerDelayMs=this.audioSpeakerDelayMs,t}setConsecutiveMissedPongs(t){this.consecutiveMissedPongs=t}setConsecutiveStatsWithNoPackets(t){this.consecutiveStatsWithNoPackets=t}setLastPacketLossInboundTimestampMs(t){this.lastPacketLossInboundTimestampMs=t}setLastNoSignalTimestampMs(t){this.lastNoSignalTimestampMs=t}setLastWeakSignalTimestampMs(t){this.lastWeakSignalTimestampMs=t}setLastGoodSignalTimestampMs(t){this.lastGoodSignalTimestampMs=t}setAudioSpeakerDelayMs(t){this.audioSpeakerDelayMs=t}}ConnectionHealthData$1.default=ConnectionHealthData;var ConnectionHealthPolicyConfiguration$1={};Object.defineProperty(ConnectionHealthPolicyConfiguration$1,"__esModule",{value:!0});class ConnectionHealthPolicyConfiguration{constructor(){this.minHealth=0,this.maxHealth=1,this.initialHealth=1,this.connectionUnhealthyThreshold=25,this.noSignalThresholdTimeMs=1e4,this.connectionWaitTimeMs=1e4,this.zeroBarsNoSignalTimeMs=5e3,this.oneBarWeakSignalTimeMs=5e3,this.twoBarsTimeMs=5e3,this.threeBarsTimeMs=1e4,this.fourBarsTimeMs=2e4,this.fiveBarsTimeMs=6e4,this.cooldownTimeMs=6e4,this.pastSamplesToConsider=15,this.goodSignalTimeMs=15e3,this.fractionalLoss=.5,this.packetsExpected=50,this.maximumTimesToWarn=2,this.missedPongsLowerThreshold=1,this.missedPongsUpperThreshold=4,this.maximumAudioDelayMs=6e4,this.maximumAudioDelayDataPoints=10}}ConnectionHealthPolicyConfiguration$1.default=ConnectionHealthPolicyConfiguration;var ContentShareConstants$1={};Object.defineProperty(ContentShareConstants$1,"__esModule",{value:!0});var ContentShareConstants;(function(r){r.Modality="#content"})(ContentShareConstants||(ContentShareConstants={}));ContentShareConstants$1.default=ContentShareConstants;var ContentShareMediaStreamBroker$1={},DefaultDeviceController$1={},DefaultMediaDeviceFactory$1={},MediaDeviceProxyHandler$1={},IntervalScheduler$1={};Object.defineProperty(IntervalScheduler$1,"__esModule",{value:!0});class IntervalScheduler{constructor(t){this.intervalMs=t}start(t){this.stop(),this.timer=setInterval(t,this.intervalMs)}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.timer=void 0)}running(){return this.timer!==void 0}}IntervalScheduler$1.default=IntervalScheduler;var __awaiter$P=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(MediaDeviceProxyHandler$1,"__esModule",{value:!0});const AsyncScheduler_1$6=AsyncScheduler$1,IntervalScheduler_1$5=IntervalScheduler$1;class MediaDeviceProxyHandler{constructor(){this.scheduler=null,this.devices=null,this.deviceChangeListeners=new Set,this.get=(t,e,n)=>{if(!Reflect.has(t,e))return;if(!("ondevicechange"in navigator.mediaDevices)){if(e==="addEventListener")return this.patchAddEventListener(t,e,n);if(e==="removeEventListener")return this.patchRemoveEventListener(t,e,n)}const o=Reflect.get(t,e,n);return typeof o=="function"?o.bind(t):o},this.patchAddEventListener=(t,e,n)=>{const o=Reflect.get(t,e,n);return(a,s,d)=>{if(a==="devicechange")this.deviceChangeListeners.add(s),this.scheduler||(this.scheduler=new IntervalScheduler_1$5.default(MediaDeviceProxyHandler.INTERVAL_MS),this.scheduler.start(this.pollDeviceLists));else return Reflect.apply(o,t,[a,s,d])}},this.patchRemoveEventListener=(t,e,n)=>{const o=Reflect.get(t,e,n);return(a,s,d)=>{if(a==="devicechange")this.deviceChangeListeners.delete(s),this.deviceChangeListeners.size===0&&this.scheduler&&(this.scheduler.stop(),this.scheduler=null);else return Reflect.apply(o,t,[a,s,d])}},this.pollDeviceLists=()=>__awaiter$P(this,void 0,void 0,function*(){const t=yield this.sortedDeviceList();this.devices&&(t.length!==this.devices.length||t.some((n,o)=>n.deviceId!==this.devices[o].deviceId))&&this.handleDeviceChangeEvent(),this.devices=t})}sortedDeviceList(){return __awaiter$P(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).sort((e,n)=>e.deviceId<n.deviceId?1:e.deviceId>n.deviceId?-1:0)})}handleDeviceChangeEvent(){for(const t of this.deviceChangeListeners)AsyncScheduler_1$6.default.nextTick(()=>{if(this.deviceChangeListeners.has(t)){const e=new Event("devicechange");typeof t=="function"?t(e):t.handleEvent(e)}})}}MediaDeviceProxyHandler$1.default=MediaDeviceProxyHandler;MediaDeviceProxyHandler.INTERVAL_MS=1e3;Object.defineProperty(DefaultMediaDeviceFactory$1,"__esModule",{value:!0});const MediaDeviceProxyHandler_1=MediaDeviceProxyHandler$1;class DefaultMediaDeviceFactory{constructor(){this.isMediaDevicesSupported=typeof navigator<"u"&&!!navigator.mediaDevices}create(){if(this.isMediaDevicesSupported)return new Proxy(navigator.mediaDevices,new MediaDeviceProxyHandler_1.default);throw new Error("navigator.mediaDevices is not supported")}}DefaultMediaDeviceFactory$1.default=DefaultMediaDeviceFactory;var PromiseQueue$1={};Object.defineProperty(PromiseQueue$1,"__esModule",{value:!0});class PromiseQueue{constructor(){this.queue=Promise.resolve()}add(t){return new Promise((e,n)=>{this.queue=this.queue.then(t).then(e).catch(n)})}}PromiseQueue$1.default=PromiseQueue;var Types={};Object.defineProperty(Types,"__esModule",{value:!0});Types.None=Types.Some=Types.Maybe=void 0;class Maybe{static of(t){return t==null?None.of():Some.of(t)}}Types.Maybe=Maybe;class Some{constructor(t){this.value=t,this.isSome=!0,this.isNone=!1}map(t){return Maybe.of(t(this.value))}flatMap(t){return t(this.value)}get(){return this.value}getOrElse(t){return this.value}defaulting(t){return Maybe.of(this.getOrElse(t))}static of(t){if(t==null)throw new Error("value is ${value}");return new Some(t)}}Types.Some=Some;class None{constructor(){this.isSome=!1,this.isNone=!0}get(){throw new Error("value is null")}getOrElse(t){return t}map(t){return new None}flatMap(t){return new None}defaulting(t){return Maybe.of(this.getOrElse(t))}static of(){return new None}}Types.None=None;var DefaultVideoTile$1={},DefaultModality$1={};Object.defineProperty(DefaultModality$1,"__esModule",{value:!0});const ContentShareConstants_1$3=ContentShareConstants$1;class DefaultModality{constructor(t){this._id=t}id(){return this._id}base(){return this._id?this._id.split(DefaultModality.MODALITY_SEPARATOR)[0]:""}modality(){if(!this._id)return"";const t=this._id.split(DefaultModality.MODALITY_SEPARATOR);return t.length===2?t[1]:""}hasModality(t){return t!==""&&this.modality()===t}withModality(t){const e=new DefaultModality(this.base()+DefaultModality.MODALITY_SEPARATOR+t);return t===""||this.base()===""||new DefaultModality(e._id).modality()!==t?new DefaultModality(this.base()):e}}DefaultModality$1.default=DefaultModality;DefaultModality.MODALITY_SEPARATOR=ContentShareConstants_1$3.default.Modality[0];DefaultModality.MODALITY_CONTENT=ContentShareConstants_1$3.default.Modality.substr(1);var VideoTileState$1={};Object.defineProperty(VideoTileState$1,"__esModule",{value:!0});class VideoTileState{constructor(){this.tileId=null,this.localTile=!1,this.localTileStarted=!1,this.isContent=!1,this.active=!1,this.paused=!1,this.poorConnection=!1,this.boundAttendeeId=null,this.boundExternalUserId=null,this.boundVideoStream=null,this.boundVideoElement=null,this.nameplate=null,this.videoStreamContentWidth=null,this.videoStreamContentHeight=null,this.videoElementCSSWidthPixels=null,this.videoElementCSSHeightPixels=null,this.devicePixelRatio=0,this.videoElementPhysicalWidthPixels=null,this.videoElementPhysicalHeightPixels=null,this.streamId=null}clone(){const t=new VideoTileState;return t.tileId=this.tileId,t.localTile=this.localTile,t.isContent=this.isContent,t.active=this.active,t.paused=this.paused,t.poorConnection=this.poorConnection,t.boundAttendeeId=this.boundAttendeeId,t.boundExternalUserId=this.boundExternalUserId,t.boundVideoStream=this.boundVideoStream,t.boundVideoElement=this.boundVideoElement,t.nameplate=this.nameplate,t.videoStreamContentWidth=this.videoStreamContentWidth,t.videoStreamContentHeight=this.videoStreamContentHeight,t.videoElementCSSWidthPixels=this.videoElementCSSWidthPixels,t.videoElementCSSHeightPixels=this.videoElementCSSHeightPixels,t.devicePixelRatio=this.devicePixelRatio,t.videoElementPhysicalWidthPixels=this.videoElementPhysicalWidthPixels,t.videoElementPhysicalHeightPixels=this.videoElementPhysicalHeightPixels,t.streamId=this.streamId,t}}VideoTileState$1.default=VideoTileState;Object.defineProperty(DefaultVideoTile$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$8=DefaultBrowserBehavior$1,DefaultModality_1$4=DefaultModality$1,VideoTileState_1=VideoTileState$1;class DefaultVideoTile{constructor(t,e,n,o){this.tileController=n,this.devicePixelRatioMonitor=o,this.tileState=new VideoTileState_1.default,this.tileState.tileId=t,this.tileState.localTile=e,this.devicePixelRatioMonitor.registerObserver(this)}static connectVideoStreamToVideoElement(t,e,n){const o=n&&t.getVideoTracks()[0].getSettings().facingMode!=="environment"?"rotateY(180deg)":"";DefaultVideoTile.setVideoElementFlag(e,"disablePictureInPicture",n),DefaultVideoTile.setVideoElementFlag(e,"disableRemotePlayback",n),e.style.transform!==o&&(e.style.transform=o),e.hasAttribute("controls")&&e.removeAttribute("controls"),e.hasAttribute("autoplay")||e.setAttribute("autoplay","true"),e.hasAttribute("playsinline")||e.setAttribute("playsinline","true"),e.hasAttribute("muted")||(e.setAttribute("muted","true"),e.muted=!0),e.srcObject!==t&&(e.srcObject=t,new DefaultBrowserBehavior_1$8.default().requiresVideoPlayWorkaround()&&e.paused&&e.play())}static disconnectVideoStreamFromVideoElement(t,e,n=!1){if(!!t)if(e)n||(t.srcObject=null,t.style.transform="");else{if(!t.srcObject)return;t.pause(),t.style.transform="",DefaultVideoTile.setVideoElementFlag(t,"disablePictureInPicture",!1),DefaultVideoTile.setVideoElementFlag(t,"disableRemotePlayback",!1),t.srcObject=null}}destroy(){this.devicePixelRatioMonitor.removeObserver(this),this.tileState.boundVideoElement&&this.tileState.boundVideoElement.srcObject===this.tileState.boundVideoStream&&DefaultVideoTile.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,!1),this.tileState=new VideoTileState_1.default}devicePixelRatioChanged(t){this.tileState.devicePixelRatio=t,this.sendTileStateUpdate()}id(){return this.tileState.tileId}state(){return this.tileState.clone()}stateRef(){return this.tileState}bindVideoStream(t,e,n,o,a,s,d){let u=!1;this.tileState.boundAttendeeId!==t&&(this.tileState.boundAttendeeId=t,new DefaultModality_1$4.default(t).hasModality(DefaultModality_1$4.default.MODALITY_CONTENT)&&(this.tileState.isContent=!0),u=!0),this.tileState.boundExternalUserId!==d&&(this.tileState.boundExternalUserId=d,u=!0),this.tileState.localTile!==e&&(this.tileState.localTile=e,u=!0),this.tileState.boundVideoStream!==n&&(this.tileState.boundVideoStream=n,u=!0),this.tileState.videoStreamContentWidth!==o&&(this.tileState.videoStreamContentWidth=o,u=!0),this.tileState.videoStreamContentHeight!==a&&(this.tileState.videoStreamContentHeight=a,u=!0),this.tileState.streamId!==s&&(this.tileState.streamId=s,u=!0),u&&this.sendTileStateUpdate()}bindVideoElement(t){let e=!1;this.tileState.boundVideoElement!==t&&(this.tileState.boundVideoElement=t,e=!0),this.tileState.boundVideoElement!==null?(this.tileState.videoElementCSSWidthPixels!==t.clientWidth&&(this.tileState.videoElementCSSWidthPixels=t.clientWidth,e=!0),this.tileState.videoElementCSSHeightPixels!==t.clientHeight&&(this.tileState.videoElementCSSHeightPixels=t.clientHeight,e=!0)):(this.tileState.videoElementCSSWidthPixels=null,this.tileState.videoElementCSSHeightPixels=null),e&&this.sendTileStateUpdate()}pause(){this.tileState.paused||(this.tileState.paused=!0,this.sendTileStateUpdate())}unpause(){this.tileState.paused&&(this.tileState.paused=!1,this.sendTileStateUpdate())}markPoorConnection(){return this.tileState.poorConnection?!1:(this.tileState.poorConnection=!0,this.sendTileStateUpdate(),!0)}unmarkPoorConnection(){return this.tileState.poorConnection?(this.tileState.poorConnection=!1,this.sendTileStateUpdate(),!0):!1}capture(){if(!this.tileState.active)return null;const t=document.createElement("canvas"),e=this.tileState.boundVideoElement;t.width=e.videoWidth||e.width,t.height=e.videoHeight||e.height;const n=t.getContext("2d");return n.drawImage(e,0,0,t.width,t.height),n.getImageData(0,0,t.width,t.height)}setStreamId(t){this.tileState.streamId=t,this.tileController.sendTileStateUpdate(this.state())}sendTileStateUpdate(){this.updateActiveState(),this.updateVideoStreamOnVideoElement(),this.updateVideoElementPhysicalPixels(),this.tileController.sendTileStateUpdate(this.state())}updateActiveState(){this.tileState.active=!!(!this.tileState.paused&&!this.tileState.poorConnection&&this.tileState.boundAttendeeId&&this.tileState.boundVideoElement&&this.tileState.boundVideoStream)}updateVideoElementPhysicalPixels(){typeof this.tileState.videoElementCSSWidthPixels=="number"&&typeof this.tileState.videoElementCSSHeightPixels=="number"?(this.tileState.videoElementPhysicalWidthPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSWidthPixels,this.tileState.videoElementPhysicalHeightPixels=this.tileState.devicePixelRatio*this.tileState.videoElementCSSHeightPixels):(this.tileState.videoElementPhysicalWidthPixels=null,this.tileState.videoElementPhysicalHeightPixels=null)}updateVideoStreamOnVideoElement(){this.tileState.active?DefaultVideoTile.connectVideoStreamToVideoElement(this.tileState.boundVideoStream,this.tileState.boundVideoElement,this.tileState.localTile):DefaultVideoTile.disconnectVideoStreamFromVideoElement(this.tileState.boundVideoElement,this.tileState.paused,this.tileController.keepLastFrameWhenPaused)}static setVideoElementFlag(t,e,n){e in t&&(t[e]=n)}}DefaultVideoTile$1.default=DefaultVideoTile;var AudioTransformDevice={};Object.defineProperty(AudioTransformDevice,"__esModule",{value:!0});AudioTransformDevice.isAudioTransformDevice=void 0;function isAudioTransformDevice(r){return!!r&&typeof r=="object"&&"mute"in r&&"stop"in r&&"intrinsicDevice"in r}AudioTransformDevice.isAudioTransformDevice=isAudioTransformDevice;var DeviceSelection$1={};Object.defineProperty(DeviceSelection$1,"__esModule",{value:!0});class DeviceSelection{constructor(){this.groupId=""}matchesConstraints(t){return JSON.stringify(this.constraints)===JSON.stringify(t)}}DeviceSelection$1.default=DeviceSelection;var GetUserMediaError$1={};Object.defineProperty(GetUserMediaError$1,"__esModule",{value:!0});class GetUserMediaError extends Error{constructor(t,e){super(e||"Error fetching device."),this.cause=t,this.name="GetUserMediaError"}}GetUserMediaError$1.default=GetUserMediaError;var NotFoundError$1={};Object.defineProperty(NotFoundError$1,"__esModule",{value:!0});const GetUserMediaError_1$5=GetUserMediaError$1;class NotFoundError extends GetUserMediaError_1$5.default{constructor(t){super(t),this.name="NotFoundError"}}NotFoundError$1.default=NotFoundError;var NotReadableError$1={};Object.defineProperty(NotReadableError$1,"__esModule",{value:!0});const GetUserMediaError_1$4=GetUserMediaError$1;class NotReadableError extends GetUserMediaError_1$4.default{constructor(t){super(t),this.name="NotReadableError"}}NotReadableError$1.default=NotReadableError;var OverconstrainedError$1={};Object.defineProperty(OverconstrainedError$1,"__esModule",{value:!0});const GetUserMediaError_1$3=GetUserMediaError$1;class OverconstrainedError extends GetUserMediaError_1$3.default{constructor(t,e){super(t),this.constraint=e,this.name="OverconstrainedError"}}OverconstrainedError$1.default=OverconstrainedError;var PermissionDeniedError$1={};Object.defineProperty(PermissionDeniedError$1,"__esModule",{value:!0});const GetUserMediaError_1$2=GetUserMediaError$1;class PermissionDeniedError extends GetUserMediaError_1$2.default{constructor(t,e){super(t,e),this.name="PermissionDeniedError"}}PermissionDeniedError$1.default=PermissionDeniedError;var _TypeError={};Object.defineProperty(_TypeError,"__esModule",{value:!0});const GetUserMediaError_1$1=GetUserMediaError$1;class TypeError$1 extends GetUserMediaError_1$1.default{constructor(t){super(t),this.name="TypeError"}}_TypeError.default=TypeError$1;var VideoQualitySettings$1={};Object.defineProperty(VideoQualitySettings$1,"__esModule",{value:!0});class VideoQualitySettings{constructor(t,e,n){this.videoWidth=t,this.videoHeight=e,this.videoFrameRate=n}}VideoQualitySettings$1.default=VideoQualitySettings;var VideoTransformDevice={};Object.defineProperty(VideoTransformDevice,"__esModule",{value:!0});VideoTransformDevice.isVideoTransformDevice=void 0;function isVideoTransformDevice(r){return!!r&&typeof r=="object"&&"transformStream"in r&&"stop"in r&&"intrinsicDevice"in r}VideoTransformDevice.isVideoTransformDevice=isVideoTransformDevice;var __awaiter$O=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultDeviceController$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$7=DefaultBrowserBehavior$1,DefaultMediaDeviceFactory_1=DefaultMediaDeviceFactory$1,AsyncScheduler_1$5=AsyncScheduler$1,PromiseQueue_1=PromiseQueue$1,Types_1$8=Types,DefaultVideoTile_1$2=DefaultVideoTile$1,AudioTransformDevice_1=AudioTransformDevice,DeviceSelection_1=DeviceSelection$1,GetUserMediaError_1=GetUserMediaError$1,NotFoundError_1=NotFoundError$1,NotReadableError_1=NotReadableError$1,OverconstrainedError_1=OverconstrainedError$1,PermissionDeniedError_1$1=PermissionDeniedError$1,TypeError_1=_TypeError,VideoQualitySettings_1=VideoQualitySettings$1,VideoTransformDevice_1$1=VideoTransformDevice;class DefaultDeviceController{constructor(t,e,n=new DefaultBrowserBehavior_1$7.default,o){this.logger=t,this.browserBehavior=n,this.eventController=o,this.deviceInfoCache=null,this.activeDevices={audio:null,video:null},this.chosenVideoTransformDevice=null,this.audioOutputDeviceId=void 0,this.deviceChangeObservers=new Set,this.mediaStreamBrokerObservers=new Set,this.deviceLabelTrigger=()=>navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),this.audioInputDestinationNode=null,this.audioInputSourceNode=null,this.videoInputQualitySettings=null,this.useWebAudio=!1,this.useMediaConstraintsFallback=!0,this.audioInputTaskQueue=new PromiseQueue_1.default,this.videoInputTaskQueue=new PromiseQueue_1.default,this.muted=!1,this.mediaStreamMuteObserver=(u,c)=>{for(const l of this.deviceChangeObservers)AsyncScheduler_1$5.default.nextTick(()=>{this.deviceChangeObservers.has(l)&&l.audioInputMuteStateChanged&&l.audioInputMuteStateChanged(u,c)})},this.alreadyHandlingDeviceChange=!1;const{enableWebAudio:a=!1,useMediaConstraintsFallback:s=!0}=e||{};this.useWebAudio=a,this.useMediaConstraintsFallback=s,this.videoInputQualitySettings=new VideoQualitySettings_1.default(DefaultDeviceController.defaultVideoWidth,DefaultDeviceController.defaultVideoHeight,DefaultDeviceController.defaultVideoFrameRate);const d=this.browserBehavior.requiresResolutionAlignment(this.videoInputQualitySettings.videoWidth,this.videoInputQualitySettings.videoHeight);this.videoInputQualitySettings.videoWidth=d[0],this.videoInputQualitySettings.videoHeight=d[1],this.logger.info(`DefaultDeviceController video dimension ${this.videoInputQualitySettings.videoWidth} x ${this.videoInputQualitySettings.videoHeight}`);try{this.mediaDeviceWrapper=new DefaultMediaDeviceFactory_1.default().create();const u=navigator.mediaDevices.getSupportedConstraints();this.logger.info(`Supported Constraints in this browser ${JSON.stringify(u)}`)}catch(u){t.error(u.message)}}isWatchingForDeviceChanges(){return!!this.onDeviceChangeCallback}ensureWatchingDeviceChanges(){var t;this.isWatchingForDeviceChanges()||(this.logger.info("Starting devicechange listener."),this.onDeviceChangeCallback=()=>{this.logger.info("Device change event callback is triggered"),this.handleDeviceChange()},(t=this.mediaDeviceWrapper)===null||t===void 0||t.addEventListener("devicechange",this.onDeviceChangeCallback))}stopWatchingDeviceChanges(){var t;!this.isWatchingForDeviceChanges()||(this.logger.info("Stopping devicechange listener."),(t=this.mediaDeviceWrapper)===null||t===void 0||t.removeEventListener("devicechange",this.onDeviceChangeCallback),this.onDeviceChangeCallback=void 0)}shouldObserveDeviceChanges(){return this.deviceChangeObservers.size?!0:this.activeDevices.audio&&this.activeDevices.audio.constraints!==null||this.activeDevices.video&&this.activeDevices.video.constraints!==null||!!this.audioOutputDeviceId}watchForDeviceChangesIfNecessary(){this.shouldObserveDeviceChanges()?this.ensureWatchingDeviceChanges():this.stopWatchingDeviceChanges()}destroy(){return __awaiter$O(this,void 0,void 0,function*(){this.stopWatchingDeviceChanges(),yield this.stopAudioInput(),yield this.stopVideoInput()})}listAudioInputDevices(t=!1){return __awaiter$O(this,void 0,void 0,function*(){const e=yield this.listDevicesOfKind("audioinput",t);return this.trace("listAudioInputDevices",t,e),e})}listVideoInputDevices(t=!1){return __awaiter$O(this,void 0,void 0,function*(){const e=yield this.listDevicesOfKind("videoinput",t);return this.trace("listVideoInputDevices",t,e),e})}listAudioOutputDevices(t=!1){return __awaiter$O(this,void 0,void 0,function*(){const e=yield this.listDevicesOfKind("audiooutput",t);return this.trace("listAudioOutputDevices",t,e),e})}pushAudioMeetingStateForPermissions(t){var e;(e=this.eventController)===null||e===void 0||e.publishEvent(t===void 0?"audioInputUnselected":"audioInputSelected")}pushVideoMeetingStateForPermissions(t){var e;(e=this.eventController)===null||e===void 0||e.publishEvent(t===void 0?"videoInputUnselected":"videoInputSelected")}startAudioInput(t){return __awaiter$O(this,void 0,void 0,function*(){return yield this.audioInputTaskQueue.add(()=>this.startAudioInputTask(t))})}startAudioInputTask(t){var e;return __awaiter$O(this,void 0,void 0,function*(){if(t===void 0){this.logger.error("Audio input device cannot be undefined");return}try{return AudioTransformDevice_1.isAudioTransformDevice(t)?(this.logger.info(`Choosing transform input device ${t}`),yield this.chooseAudioTransformInputDevice(t)):(this.logger.info(`Choosing intrinsic audio input device ${t}`),this.removeTransform(),yield this.chooseInputIntrinsicDevice("audio",t)),this.trace("startAudioInputDevice",t,"success"),this.useWebAudio?(this.attachAudioInputStreamToAudioContext(this.activeDevices.audio.stream),this.pushAudioMeetingStateForPermissions(this.getMediaStreamDestinationNode().stream),yield(e=this.transform)===null||e===void 0?void 0:e.device.mute(this.muted),this.getMediaStreamDestinationNode().stream):(this.publishAudioInputDidChangeEvent(this.activeDevices.audio.stream),this.activeDevices.audio.stream)}catch(n){throw n}})}stopAudioInput(){return __awaiter$O(this,void 0,void 0,function*(){return this.audioInputTaskQueue.add(()=>this.stopAudioInputTask())})}stopAudioInputTask(){return __awaiter$O(this,void 0,void 0,function*(){try{if(this.useWebAudio){this.releaseAudioTransformStream();return}this.stopTracksAndRemoveCallbacks("audio")}finally{this.watchForDeviceChangesIfNecessary(),this.publishAudioInputDidChangeEvent(void 0)}})}chooseAudioTransformInputDevice(t){var e;return __awaiter$O(this,void 0,void 0,function*(){if(((e=this.transform)===null||e===void 0?void 0:e.device)===t)return;if(!this.useWebAudio)throw new Error("Cannot apply transform device without enabling Web Audio.");const n=DefaultDeviceController.getAudioContext();if(!(n instanceof OfflineAudioContext))switch(n.state){case"running":break;case"closed":throw new Error("Cannot choose a transform device with a closed audio context.");case"suspended":yield n.resume()}let o;try{o=yield t.createAudioNode(n)}catch(s){throw this.logger.error(`Unable to create transform device node: ${s}.`),s}const a=yield t.intrinsicDevice();yield this.chooseInputIntrinsicDevice("audio",a),this.logger.debug(`Got inner stream: ${a}.`),this.setTransform(t,o)})}chooseVideoTransformInputDevice(t){var e;return __awaiter$O(this,void 0,void 0,function*(){if(t===this.chosenVideoTransformDevice){this.logger.info("Reselecting same VideoTransformDevice");return}const n=this.chosenVideoTransformDevice;n&&this.logger.info("Switched from previous VideoTransformDevice");const o=!!n,a=yield t.intrinsicDevice();if(!this.isMediaStreamReusableByDeviceId((e=this.activeDevices.video)===null||e===void 0?void 0:e.stream,a)){this.logger.info("video transform device needs new intrinsic device"),o&&n.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=t,this.activeDevices.video=null,yield this.chooseInputIntrinsicDevice("video",a),this.logger.info("apply processors to transform"),yield this.chosenVideoTransformDevice.transformStream(this.activeDevices.video.stream);return}this.chosenVideoTransformDevice=t,this.logger.info("video transform device uses previous stream"),this.logger.info("apply processors to transform"),yield t.transformStream(this.activeDevices.video.stream)})}startVideoInput(t){return __awaiter$O(this,void 0,void 0,function*(){return yield this.videoInputTaskQueue.add(()=>this.startVideoInputTask(t))})}startVideoInputTask(t){return __awaiter$O(this,void 0,void 0,function*(){if(!t){this.logger.error("Invalid video input device");return}try{return VideoTransformDevice_1$1.isVideoTransformDevice(t)?(this.logger.info(`Choosing video transform device ${t}`),yield this.chooseVideoTransformInputDevice(t),this.publishVideoInputDidChangeEvent(this.chosenVideoTransformDevice.outputMediaStream),this.chosenVideoTransformDevice.outputMediaStream):(this.chosenVideoInputIsTransformDevice()&&(this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null),yield this.chooseInputIntrinsicDevice("video",t),this.trace("startVideoInputDevice",t),this.publishVideoInputDidChangeEvent(this.activeDevices.video.stream),this.activeDevices.video.stream)}catch(e){throw e}})}stopVideoInput(){return __awaiter$O(this,void 0,void 0,function*(){return this.videoInputTaskQueue.add(()=>this.stopVideoInputTask())})}stopVideoInputTask(){return __awaiter$O(this,void 0,void 0,function*(){try{if(this.chosenVideoInputIsTransformDevice()){this.releaseVideoTransformStream();return}this.stopTracksAndRemoveCallbacks("video")}finally{this.watchForDeviceChangesIfNecessary(),this.publishVideoInputDidChangeEvent(void 0)}})}chooseAudioOutput(t){return __awaiter$O(this,void 0,void 0,function*(){this.audioOutputDeviceId=t,this.watchForDeviceChangesIfNecessary();const e=this.deviceInfoFromDeviceId("audiooutput",this.audioOutputDeviceId);this.publishAudioOutputDidChangeEvent(e),this.trace("chooseAudioOutput",t,null)})}addDeviceChangeObserver(t){this.logger.info("adding device change observer"),this.deviceChangeObservers.add(t),this.watchForDeviceChangesIfNecessary(),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(t){this.logger.info("removing device change observer"),this.deviceChangeObservers.delete(t),this.watchForDeviceChangesIfNecessary(),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){var t,e;if(!this.activeDevices.audio)return null;const n=(e=(t=this.transform)===null||t===void 0?void 0:t.nodes)===null||e===void 0?void 0:e.end;if(n){const o=n.context.createAnalyser();return o.removeOriginalInputs=()=>{try{n.disconnect(o)}catch{}},n.connect(o),o}return this.createAnalyserNodeForRawAudioInput()}createAnalyserNodeForRawAudioInput(){return this.activeDevices.audio?this.createAnalyserNodeForStream(this.activeDevices.audio.stream):null}createAnalyserNodeForStream(t){const e=DefaultDeviceController.getAudioContext(),n=e.createAnalyser(),o=e.createMediaStreamSource(t);return o.connect(n),this.trace("createAnalyserNodeForAudioInput"),n.removeOriginalInputs=()=>{try{o.disconnect(n)}catch{}},n}startVideoPreviewForVideoInput(t){if(!this.activeDevices.video){this.logger.warn("cannot bind video preview since video input device has not been chosen"),this.trace("startVideoPreviewForVideoInput",t.id);return}DefaultVideoTile_1$2.default.connectVideoStreamToVideoElement(this.chosenVideoTransformDevice?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream,t,!0),this.trace("startVideoPreviewForVideoInput",t.id)}stopVideoPreviewForVideoInput(t){DefaultVideoTile_1$2.default.disconnectVideoStreamFromVideoElement(t,!1),this.trace("stopVideoPreviewForVideoInput",t.id)}setDeviceLabelTrigger(t){if(this.deviceInfoCache){for(const e of this.deviceInfoCache)if(!e.label){this.deviceInfoCache=null;break}}this.deviceLabelTrigger=t,this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(t){let e=null;return this.useWebAudio?(e=DefaultDeviceController.getAudioContext().createMediaStreamSource(t),e.connect(this.getMediaStreamOutputNode())):this.logger.warn("WebAudio is not enabled, mixIntoAudioInput will not work"),this.trace("mixIntoAudioInput",t.id),e}chooseVideoInputQuality(t,e,n){const o=this.browserBehavior.requiresResolutionAlignment(t,e);this.videoInputQualitySettings=new VideoQualitySettings_1.default(o[0],o[1],n)}getVideoInputQualitySettings(){return this.videoInputQualitySettings}acquireAudioInputStream(){return __awaiter$O(this,void 0,void 0,function*(){return this.activeDevices.audio||(this.logger.info("No audio device chosen, creating empty audio device"),yield this.startAudioInput(null)),this.useWebAudio?this.getMediaStreamDestinationNode().stream:this.activeDevices.audio.stream})}acquireVideoInputStream(){return __awaiter$O(this,void 0,void 0,function*(){if(!this.activeDevices.video)throw new Error("No video device chosen");return this.chosenVideoInputIsTransformDevice()?this.chosenVideoTransformDevice.outputMediaStream:this.activeDevices.video.stream})}acquireDisplayInputStream(t){return __awaiter$O(this,void 0,void 0,function*(){throw new Error("unsupported")})}releaseAudioTransformStream(){this.logger.info("Stopping audio track for Web Audio graph"),this.stopTracksAndRemoveCallbacks("audio"),this.logger.info("Removing audio transform, if there is one."),this.removeTransform(),this.audioInputSourceNode&&(this.audioInputSourceNode.disconnect(),this.audioInputSourceNode=void 0),this.audioInputDestinationNode&&(this.audioInputDestinationNode.disconnect(),this.audioInputDestinationNode=void 0)}releaseVideoTransformStream(){this.logger.info("Stopping video track for transform"),this.stopTracksAndRemoveCallbacks("video"),this.logger.info("Disconnecting video transform"),this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null}stopTracksAndRemoveCallbacks(t){const e=this.activeDevices[t];if(!e)return;const n=e.endedCallback,o=e.trackMuteCallback,a=e.trackUnmuteCallback;for(const s of e.stream.getTracks())s.stop(),n&&s.removeEventListener("ended",n),o&&s.removeEventListener("mute",o),a&&s.removeEventListener("unmute",a),delete e.endedCallback,delete e.trackMuteCallback,delete e.trackUnmuteCallback,delete this.activeDevices[t]}chosenVideoInputIsTransformDevice(){return!!this.chosenVideoTransformDevice}muteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!1)}unmuteLocalAudioInputStream(){this.toggleLocalAudioInputStream(!0)}toggleLocalAudioInputStream(t){var e;let n=this.activeDevices.audio;if(this.useWebAudio&&(n=this.getMediaStreamDestinationNode()),!!n){for(const o of n.stream.getTracks())o.enabled!==t&&(o.enabled=t);this.muted!==!t&&(this.muted=!t,(e=this.transform)===null||e===void 0||e.device.mute(this.muted))}}static getIntrinsicDeviceId(t){if(!t)return;if(typeof t=="string")return t;if(t.id)return t.id;const n=t.deviceId;if(!n)return;if(typeof n=="string"||Array.isArray(n))return n;const o=n;if(typeof o.exact=="string"||Array.isArray(o.exact))return o.exact}static createEmptyAudioDevice(){return DefaultDeviceController.synthesizeAudioDevice(0)}static synthesizeAudioDevice(t){const e=DefaultDeviceController.getAudioContext(),n=e.createMediaStreamDestination();if(t){const o=e.createGain();o.gain.value=.1,o.connect(n);const a=e.createOscillator();a.frequency.value=t,a.connect(o),a.start()}else{const o=e.createBufferSource();try{o.buffer=e.createBuffer(1,e.sampleRate*5,e.sampleRate)}catch(a){if(a&&a.name==="NotSupportedError")o.buffer=e.createBuffer(1,DefaultDeviceController.defaultSampleRate*5,DefaultDeviceController.defaultSampleRate);else throw a}o.buffer.getChannelData(0)[0]=3e-4,o.loop=!0,o.connect(n),o.start()}return n.stream}listDevicesOfKind(t,e){return __awaiter$O(this,void 0,void 0,function*(){return(e||this.deviceInfoCache===null||!this.isWatchingForDeviceChanges())&&(yield this.updateDeviceInfoCacheFromBrowser()),this.listCachedDevicesOfKind(t)})}updateDeviceInfoCacheFromBrowser(){return __awaiter$O(this,void 0,void 0,function*(){if(typeof MediaDeviceInfo>"u"){this.deviceInfoCache=[];return}let e=yield navigator.mediaDevices.enumerateDevices(),n=!0;for(const o of e)if(!o.label){n=!1;break}if(!n)try{this.logger.info("attempting to trigger media device labels since they are hidden");const o=yield this.deviceLabelTrigger();e=yield navigator.mediaDevices.enumerateDevices();for(const a of o.getTracks())a.stop()}catch{this.logger.info("unable to get media device labels")}this.logger.debug(`Update device info cache with devices: ${JSON.stringify(e)}`),this.deviceInfoCache=e})}listCachedDevicesOfKind(t){const e=[];if(this.deviceInfoCache)for(const n of this.deviceInfoCache)n.kind===t&&e.push(n);return e}handleDeviceChange(){return __awaiter$O(this,void 0,void 0,function*(){if(this.deviceInfoCache===null)return;if(this.alreadyHandlingDeviceChange){AsyncScheduler_1$5.default.nextTick(()=>{this.handleDeviceChange()});return}this.alreadyHandlingDeviceChange=!0;const t=this.listCachedDevicesOfKind("audioinput"),e=this.listCachedDevicesOfKind("videoinput"),n=this.listCachedDevicesOfKind("audiooutput");yield this.updateDeviceInfoCacheFromBrowser();const o=this.listCachedDevicesOfKind("audioinput"),a=this.listCachedDevicesOfKind("videoinput"),s=this.listCachedDevicesOfKind("audiooutput");this.forEachObserver(d=>{this.areDeviceListsEqual(t,o)||Types_1$8.Maybe.of(d.audioInputsChanged).map(u=>u.bind(d)(o)),this.areDeviceListsEqual(e,a)||Types_1$8.Maybe.of(d.videoInputsChanged).map(u=>u.bind(d)(a)),this.areDeviceListsEqual(n,s)||Types_1$8.Maybe.of(d.audioOutputsChanged).map(u=>u.bind(d)(s))}),this.alreadyHandlingDeviceChange=!1})}handleDeviceStreamEnded(t,e){return __awaiter$O(this,void 0,void 0,function*(){try{t==="audio"?(this.logger.warn("Audio input device which was active is no longer available, resetting to null device"),yield this.startAudioInput(null)):(this.logger.warn("Video input device which was active is no longer available, stopping video"),yield this.stopVideoInput())}catch{this.logger.error("Failed to choose null device after stream ended.")}t==="audio"?this.forEachObserver(n=>{Types_1$8.Maybe.of(n.audioInputStreamEnded).map(o=>o.bind(n)(e))}):this.forEachObserver(n=>{Types_1$8.Maybe.of(n.videoInputStreamEnded).map(o=>o.bind(n)(e))})})}forEachObserver(t){for(const e of this.deviceChangeObservers)AsyncScheduler_1$5.default.nextTick(()=>{this.deviceChangeObservers.has(e)&&t(e)})}forEachMediaStreamBrokerObserver(t){for(const e of this.mediaStreamBrokerObservers)t(e)}areDeviceListsEqual(t,e){return JSON.stringify(t.map(n=>JSON.stringify(n)).sort())===JSON.stringify(e.map(n=>JSON.stringify(n)).sort())}intrinsicDeviceAsMediaStream(t){return t&&t.id?t:null}hasSameMediaStreamId(t,e,n){var o,a,s,d;let u;return t==="audio"?(u=n==null?void 0:n.audio.streamId,!!u&&u===((a=(o=e.constraints)===null||o===void 0?void 0:o.audio)===null||a===void 0?void 0:a.streamId)):(u=n==null?void 0:n.video.streamId,!!u&&u===((d=(s=e==null?void 0:e.constraints)===null||s===void 0?void 0:s.video)===null||d===void 0?void 0:d.streamId))}hasSameGroupId(t,e,n){if(t==="")return!0;const o=DefaultDeviceController.getIntrinsicDeviceId(n);return this.logger.debug(`Checking deviceIds ${o} of type ${typeof o} with groupId ${t}`),typeof o=="string"&&t===this.getGroupIdFromDeviceId(e,o)}getGroupIdFromDeviceId(t,e){if(this.deviceInfoCache!==null){const n=this.listCachedDevicesOfKind(`${t}input`).find(o=>o.deviceId===e);if(n&&n.groupId)return this.logger.debug(`GroupId of deviceId ${e} found in cache is ${n.groupId}`),n.groupId}return this.logger.debug(`GroupId of deviceId ${e} found in cache is empty`),""}handleGetUserMediaError(t,e){if(!t)throw new GetUserMediaError_1.default(t);switch(t.name){case"NotReadableError":case"TrackStartError":throw new NotReadableError_1.default(t);case"NotFoundError":case"DevicesNotFoundError":throw new NotFoundError_1.default(t);case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":throw e&&e<DefaultDeviceController.permissionDeniedOriginDetectionThresholdMs?new PermissionDeniedError_1$1.default(t,"Permission denied by browser"):new PermissionDeniedError_1$1.default(t,"Permission denied by user");case"OverconstrainedError":case"ConstraintNotSatisfiedError":throw new OverconstrainedError_1.default(t);case"TypeError":throw new TypeError_1.default(t);case"AbortError":default:throw new GetUserMediaError_1.default(t)}}matchesDeviceSelection(t,e,n,o){return n&&n.stream.active&&(this.hasSameMediaStreamId(t,n,o)||n.groupId!==null&&this.hasSameGroupId(n.groupId,t,e))?(this.logger.debug(`Compare current device constraint ${JSON.stringify(n.constraints)} to proposed constraints ${JSON.stringify(o)}`),n.matchesConstraints(o)):!1}chooseInputIntrinsicDevice(t,e){var n,o;return __awaiter$O(this,void 0,void 0,function*(){const a=this.getMediaStreamConstraints(t,e);if(this.matchesDeviceSelection(t,e,this.activeDevices[t],a)){this.logger.info(`reusing existing ${t} input device`);return}this.activeDevices[t]&&this.activeDevices[t].stream&&this.stopTracksAndRemoveCallbacks(t);const s=Date.now(),d=new DeviceSelection_1.default;try{this.logger.info(`requesting new ${t} device with constraint ${JSON.stringify(a)}`);const u=this.intrinsicDeviceAsMediaStream(e);t==="audio"&&e===null?(d.stream=DefaultDeviceController.createEmptyAudioDevice(),d.constraints=null):u?(this.logger.info(`using media stream ${u.id} for ${t} device`),d.stream=u,d.constraints=a):(d.stream=yield navigator.mediaDevices.getUserMedia(a),d.constraints=a),yield this.handleNewInputDevice(t,d)}catch(u){const c=this.getErrorMessage(u);t==="audio"?(n=this.eventController)===null||n===void 0||n.publishEvent("audioInputFailed",{audioInputErrorMessage:c}):(o=this.eventController)===null||o===void 0||o.publishEvent("videoInputFailed",{videoInputErrorMessage:c}),this.logger.error(`failed to get ${t} device for constraints ${JSON.stringify(a)}: ${c}`);let l=!0;if(u&&"constraint"in u&&(this.logger.error(`Over-constrained by constraint: ${u.constraint}`),this.useMediaConstraintsFallback)){const f=this.getMediaStreamConstraints(t,e,!0),h=JSON.stringify(f);if(h!==JSON.stringify(a)){this.logger.info(`retry requesting new ${t} device with minimal constraint ${h}`);try{d.stream=yield navigator.mediaDevices.getUserMedia(f),d.constraints=f,yield this.handleNewInputDevice(t,d),l=!1}catch(p){this.logger.error(`failed to get ${t} device for constraints ${h}: ${this.getErrorMessage(p)}`)}}}if(l){if(t==="audio"){this.logger.info(`choosing null ${t} device instead`);try{d.stream=DefaultDeviceController.createEmptyAudioDevice(),d.constraints=null,yield this.handleNewInputDevice(t,d)}catch(f){this.logger.error(`failed to choose null ${t} device. ${f.name}: ${f.message}`)}}this.handleGetUserMediaError(u,Date.now()-s)}}finally{this.watchForDeviceChangesIfNecessary()}})}getErrorMessage(t){return t?t.name&&t.message?`${t.name}: ${t.message}`:t.name?t.name:t.message?t.message:"UnknownError":"UnknownError"}handleNewInputDevice(t,e){var n;return __awaiter$O(this,void 0,void 0,function*(){this.logger.info(`got ${t} device for constraints ${JSON.stringify(e.constraints)}`);const o=(n=this.getMediaTrackSettings(e.stream))===null||n===void 0?void 0:n.deviceId;e.groupId=o?this.getGroupIdFromDeviceId(t,o):"",this.activeDevices[t]=e,this.logger.debug(`Set activeDevice to ${JSON.stringify(e)}`),this.watchForDeviceChangesIfNecessary();const a=e.stream.getTracks()[0];if(a&&(e.endedCallback=()=>{this.activeDevices[t]&&this.activeDevices[t].stream===e.stream&&(this.handleDeviceStreamEnded(t,o),delete e.endedCallback)},a.addEventListener("ended",e.endedCallback,{once:!0})),t==="audio"){const s=e.stream.getAudioTracks()[0];if(s){const d=s.getSettings().deviceId||e.stream;e.trackMuteCallback=()=>{this.mediaStreamMuteObserver(d,!0)},e.trackUnmuteCallback=()=>{this.mediaStreamMuteObserver(d,!1)},s.addEventListener("mute",e.trackMuteCallback,{once:!1}),s.addEventListener("unmute",e.trackUnmuteCallback,{once:!1}),this.logger.debug("Notifying mute state after selection"),s.muted?e.trackMuteCallback():e.trackUnmuteCallback()}}})}calculateMediaStreamConstraints(t,e,n,o){if(o&&this.listCachedDevicesOfKind(`${t}input`).length===1)return!0;const a={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?a.deviceId=e:a.deviceId={exact:e},n&&(a.groupId=n),o?a:t==="video"?(a.width={ideal:this.videoInputQualitySettings.videoWidth},a.height={ideal:this.videoInputQualitySettings.videoHeight},a.frameRate={ideal:this.videoInputQualitySettings.videoFrameRate},a):(this.supportSampleRateConstraint()&&(a.sampleRate={ideal:DefaultDeviceController.defaultSampleRate}),this.supportSampleSizeConstraint()&&(a.sampleSize={ideal:DefaultDeviceController.defaultSampleSize}),this.supportChannelCountConstraint()&&(a.channelCount={ideal:DefaultDeviceController.defaultChannelCount}),Object.assign({echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0},a))}getMediaStreamConstraintsFromTrackConstraints(t,e){return t==="audio"?{audio:e}:{video:e}}getMediaStreamConstraints(t,e,n=!1){let o={};if(!e)return null;const a=this.intrinsicDeviceAsMediaStream(e);if(a)return o.streamId=a.id,this.getMediaStreamConstraintsFromTrackConstraints(t,o);if(typeof e=="string"){let s="";return this.browserBehavior.requiresGroupIdMediaStreamConstraints()&&(this.deviceInfoCache!==null?s=this.getGroupIdFromDeviceId(t,e):this.logger.error("Device cache is not populated. Please make sure to call list devices first")),o=this.calculateMediaStreamConstraints(t,e,s,n),this.getMediaStreamConstraintsFromTrackConstraints(t,o)}return isMediaDeviceInfo(e)?(o=this.calculateMediaStreamConstraints(t,e.deviceId,e.groupId,n),this.getMediaStreamConstraintsFromTrackConstraints(t,o)):(o=e,this.getMediaStreamConstraintsFromTrackConstraints(t,o))}deviceInfoFromDeviceId(t,e){if(this.deviceInfoCache===null)return null;for(const n of this.deviceInfoCache)if(n.kind===t&&n.deviceId===e)return n;return null}hasAppliedTransform(){return!!this.transform}isMediaStreamReusableByDeviceId(t,e){if(!t||!t.active||!e)return!1;if(e.id)return t.id===e.id;const n=this.getMediaTrackSettings(t);if(!n.deviceId)return!1;const o=DefaultDeviceController.getIntrinsicDeviceId(e);return typeof o=="string"?n.deviceId===o:!1}getMediaTrackSettings(t){var e;return(e=t.getTracks()[0])===null||e===void 0?void 0:e.getSettings()}reconnectAudioInputs(){if(!this.audioInputSourceNode)return;this.audioInputSourceNode.disconnect();const t=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(t)}setTransform(t,e){var n,o;(o=(n=this.transform)===null||n===void 0?void 0:n.nodes)===null||o===void 0||o.end.disconnect(),this.transform={nodes:e,device:t};const a=e==null?void 0:e.end,s=this.getMediaStreamDestinationNode();this.logger.debug(`Connecting transform node ${a} to destination ${s}.`),a==null||a.connect(s),this.reconnectAudioInputs()}removeTransform(){var t;const e=this.transform;if(!!e)return(t=this.transform.nodes)===null||t===void 0||t.end.disconnect(),this.transform=void 0,this.reconnectAudioInputs(),e}attachAudioInputStreamToAudioContext(t){var e;(e=this.audioInputSourceNode)===null||e===void 0||e.disconnect(),this.audioInputSourceNode=DefaultDeviceController.getAudioContext().createMediaStreamSource(t);const n=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(n)}getMediaStreamDestinationNode(){return this.audioInputDestinationNode||(this.audioInputDestinationNode=DefaultDeviceController.getAudioContext().createMediaStreamDestination()),this.audioInputDestinationNode}getMediaStreamOutputNode(){var t,e;return((e=(t=this.transform)===null||t===void 0?void 0:t.nodes)===null||e===void 0?void 0:e.start)||this.getMediaStreamDestinationNode()}static getAudioContext(){if(!DefaultDeviceController.audioContext){const t={};navigator.mediaDevices.getSupportedConstraints().sampleRate&&(t.sampleRate=DefaultDeviceController.defaultSampleRate),DefaultDeviceController.audioContext=new(window.AudioContext||window.webkitAudioContext)(t)}return DefaultDeviceController.audioContext}static closeAudioContext(){if(DefaultDeviceController.audioContext)try{DefaultDeviceController.audioContext.close()}catch{}DefaultDeviceController.audioContext=null}addMediaStreamBrokerObserver(t){this.mediaStreamBrokerObservers.add(t)}removeMediaStreamBrokerObserver(t){this.mediaStreamBrokerObservers.delete(t)}publishVideoInputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.videoInputDidChange&&e.videoInputDidChange(t)}),this.pushVideoMeetingStateForPermissions(t)}publishAudioInputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.audioInputDidChange&&e.audioInputDidChange(t)}),this.pushAudioMeetingStateForPermissions(t)}publishAudioOutputDidChangeEvent(t){this.forEachMediaStreamBrokerObserver(e=>{e.audioOutputDidChange&&e.audioOutputDidChange(t)})}supportSampleRateConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleRate}supportSampleSizeConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleSize}supportChannelCountConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().channelCount}trace(t,e,n){let o=`API/DefaultDeviceController/${t}`;typeof e<"u"&&(o+=` ${JSON.stringify(e)}`),typeof n<"u"&&(o+=` -> ${JSON.stringify(n)}`),this.logger.info(o)}}DefaultDeviceController$1.default=DefaultDeviceController;DefaultDeviceController.permissionDeniedOriginDetectionThresholdMs=500;DefaultDeviceController.defaultVideoWidth=960;DefaultDeviceController.defaultVideoHeight=540;DefaultDeviceController.defaultVideoFrameRate=15;DefaultDeviceController.defaultSampleRate=48e3;DefaultDeviceController.defaultSampleSize=16;DefaultDeviceController.defaultChannelCount=1;DefaultDeviceController.audioContext=null;function isMediaDeviceInfo(r){return typeof r=="object"&&"deviceId"in r&&"groupId"in r&&"kind"in r&&"label"in r}var __awaiter$N=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(ContentShareMediaStreamBroker$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$6=DefaultBrowserBehavior$1,DefaultDeviceController_1$1=DefaultDeviceController$1;class ContentShareMediaStreamBroker{constructor(t){this.logger=t}get mediaStream(){return this._mediaStream}set mediaStream(t){this._mediaStream=t}acquireAudioInputStream(){return __awaiter$N(this,void 0,void 0,function*(){return this._mediaStream.getAudioTracks().length===0?(this.logger.info("No audio stream available. Synthesizing an audio stream."),DefaultDeviceController_1$1.default.synthesizeAudioDevice(0)):this._mediaStream})}acquireVideoInputStream(){return __awaiter$N(this,void 0,void 0,function*(){return this._mediaStream})}acquireDisplayInputStream(t){return __awaiter$N(this,void 0,void 0,function*(){return t&&t.video&&t.video.mandatory&&t.video.mandatory.chromeMediaSource&&t.video.mandatory.chromeMediaSourceId?navigator.mediaDevices.getUserMedia(t):navigator.mediaDevices.getDisplayMedia(t)})}acquireScreenCaptureDisplayInputStream(t,e){return __awaiter$N(this,void 0,void 0,function*(){return this.acquireDisplayInputStream(this.screenCaptureDisplayMediaConstraints(t,e))})}screenCaptureDisplayMediaConstraints(t,e){return{audio:!!(!t&&new DefaultBrowserBehavior_1$6.default().getDisplayMediaAudioCaptureSupport()),video:Object.assign(Object.assign({},!t&&{frameRate:{max:e||ContentShareMediaStreamBroker.defaultFrameRate}}),t&&{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e||ContentShareMediaStreamBroker.defaultFrameRate}})}}toggleMediaStream(t){let e=!1;if(this.mediaStream)for(let n=0;n<this.mediaStream.getTracks().length;n++)this.mediaStream.getTracks()[n].enabled!==t&&(this.mediaStream.getTracks()[n].enabled=t,e=!0);return e}cleanup(){if(this.mediaStream)for(let t=0;t<this.mediaStream.getTracks().length;t++)this.mediaStream.getTracks()[t].stop();this.mediaStream=null}muteLocalAudioInputStream(){throw new Error("unsupported")}unmuteLocalAudioInputStream(){throw new Error("unsupported")}addMediaStreamBrokerObserver(t){}removeMediaStreamBrokerObserver(t){}}ContentShareMediaStreamBroker$1.default=ContentShareMediaStreamBroker;ContentShareMediaStreamBroker.defaultFrameRate=15;var CreatePeerConnectionTask$1={},__awaiter$M=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(CreatePeerConnectionTask$1,"__esModule",{value:!0});const BaseTask_1$l=BaseTask$1;class CreatePeerConnectionTask extends BaseTask_1$l.default{constructor(t){super(t.logger),this.context=t,this.taskName="CreatePeerConnectionTask",this.removeTrackAddedEventListener=null,this.removeTrackRemovedEventListeners={},this.trackEvents=["ended","mute","unmute","isolationchange","overconstrained"],this.removeVideoTrackEventListeners={},this.trackAddedHandler=e=>{const n=e.track;if(this.context.logger.info(`received track event: kind=${n.kind} id=${n.id} label=${n.label}`),e.transceiver&&e.transceiver.currentDirection==="inactive")return;if(e.streams.length===0){this.context.logger.warn("Track event but no stream");return}const o=e.streams[0];n.kind==="audio"?this.context.audioMixController.bindAudioStream(o):n.kind==="video"&&!this.trackIsVideoInput(n)&&this.addRemoteVideoTrack(n,o)}}removeObserver(){this.removeTrackAddedEventListener&&this.removeTrackAddedEventListener();for(const t in this.removeTrackRemovedEventListeners)this.removeTrackRemovedEventListeners[t]()}addPeerConnectionEventLogger(){const t=this.context.peer;t.addEventListener("connectionstatechange",()=>{this.context.logger.info(`peer connection state changed: ${t.connectionState}`)}),t.addEventListener("negotiationneeded",()=>{this.context.logger.info("peer connection negotiation is needed")}),t.addEventListener("icegatheringstatechange",()=>{this.context.logger.info(`peer connection ice gathering state changed: ${t.iceGatheringState}`)}),t.addEventListener("icecandidate",e=>{this.context.logger.info(`peer connection ice candidate: ${e.candidate?e.candidate.candidate:"(null)"}`)}),t.addEventListener("iceconnectionstatechange",()=>{this.context.logger.info(`peer connection ice connection state changed: ${t.iceConnectionState}`)})}run(){return __awaiter$M(this,void 0,void 0,function*(){this.context.removableObservers.push(this);const e=this.context.turnCredentials&&this.context.turnCredentials.uris.length>0?{iceServers:[{urls:this.context.turnCredentials.uris,username:this.context.turnCredentials.username,credential:this.context.turnCredentials.password,credentialType:"password"}],iceTransportPolicy:"relay"}:{};e.bundlePolicy=this.context.browserBehavior.requiresBundlePolicy(),e.sdpSemantics="unified-plan",this.context.peer?this.context.logger.info("reusing peer connection"):(this.context.logger.info("creating new peer connection"),this.context.peer=new RTCPeerConnection(e),this.addPeerConnectionEventLogger()),this.removeTrackAddedEventListener=()=>{this.context.peer&&this.context.peer.removeEventListener("track",this.trackAddedHandler),this.removeTrackAddedEventListener=null},this.context.peer.addEventListener("track",this.trackAddedHandler)})}trackIsVideoInput(t){return this.context.transceiverController.useTransceivers()?(this.logger.debug(()=>"getting video track type"),this.context.transceiverController.trackIsVideoInput(t)):!1}addRemoteVideoTrack(t,e){var n;const o=e.id,a=this.context.videoStreamIndex.attendeeIdForTrack(o);let s,d;if(this.context.videoTileController.getVideoTileForAttendeeId?(d=this.context.videoTileController.getVideoTileForAttendeeId(a),s=!!(!((n=d==null?void 0:d.state())===null||n===void 0)&&n.boundVideoStream)):s=this.context.videoTileController.haveVideoTileForAttendeeId(a),s){this.context.logger.info(`Not adding remote track. Already have tile for attendeeId:  ${a}`);return}d||(d=this.context.videoTileController.addVideoTile(),this.logger.info(`Created video tile ${d.id()}`));let u=this.context.videoStreamIndex.streamIdForTrack(o);typeof u>"u"&&(this.logger.warn(`stream not found for tile=${d.id()} track=${o}`),u=null);for(let S=0;S<this.trackEvents.length;S++){const g=this.trackEvents[S],y=e.getVideoTracks();if(y&&y.length){const E=y[0],T=()=>{this.context.logger.info(`received the ${g} event for tile=${d.id()} id=${t.id} streamId=${u}`),g==="ended"&&this.removeRemoteVideoTrack(t,d.state())};E.addEventListener(g,T),this.removeVideoTrackEventListeners[t.id]||(this.removeVideoTrackEventListeners[t.id]=[]),this.removeVideoTrackEventListeners[t.id].push(()=>{E.removeEventListener(g,T)})}}let c,l;if(t.getSettings){const S=t.getSettings();c=S.width,l=S.height}else{const S=t.getCapabilities();c=S.width,l=S.height}const f=this.context.videoStreamIndex.externalUserIdForTrack(o);d.bindVideoStream(a,!1,e,c,l,u,f),this.logger.info(`video track added, use tile=${d.id()} track=${o} streamId=${u}`);const h="removetrack",p=e,m=()=>this.removeRemoteVideoTrack(t,d.state());this.removeTrackRemovedEventListeners[t.id]=()=>{p.removeEventListener(h,m),delete this.removeTrackRemovedEventListeners[t.id]},p.addEventListener(h,m)}removeRemoteVideoTrack(t,e){if(this.removeTrackRemovedEventListeners.hasOwnProperty(t.id)){this.removeTrackRemovedEventListeners[t.id]();for(const n of this.removeVideoTrackEventListeners[t.id])n();delete this.removeVideoTrackEventListeners[t.id]}this.logger.info(`video track ended, removing tile=${e.tileId} id=${t.id} stream=${e.streamId}`),e.streamId?this.context.videosPaused.remove(e.streamId):this.logger.warn(`no stream found for tile=${e.tileId}`),this.context.videoTileController.removeVideoTile(e.tileId)}}CreatePeerConnectionTask$1.default=CreatePeerConnectionTask;CreatePeerConnectionTask.REMOVE_HANDLER_INTERVAL_MS=1e4;var CreateSDPTask$1={},MeetingSessionStatusCode={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.MeetingSessionStatusCode=void 0;var t;(function(e){e[e.OK=0]="OK",e[e.Left=1]="Left",e[e.AudioJoinedFromAnotherDevice=2]="AudioJoinedFromAnotherDevice",e[e.AudioAuthenticationRejected=3]="AudioAuthenticationRejected",e[e.AudioCallAtCapacity=4]="AudioCallAtCapacity",e[e.MeetingEnded=5]="MeetingEnded",e[e.AudioInternalServerError=6]="AudioInternalServerError",e[e.AudioServiceUnavailable=7]="AudioServiceUnavailable",e[e.AudioDisconnected=8]="AudioDisconnected",e[e.VideoCallSwitchToViewOnly=9]="VideoCallSwitchToViewOnly",e[e.VideoCallAtSourceCapacity=10]="VideoCallAtSourceCapacity",e[e.SignalingBadRequest=11]="SignalingBadRequest",e[e.SignalingInternalServerError=12]="SignalingInternalServerError",e[e.SignalingRequestFailed=13]="SignalingRequestFailed",e[e.ICEGatheringTimeoutWorkaround=14]="ICEGatheringTimeoutWorkaround",e[e.ConnectionHealthReconnect=15]="ConnectionHealthReconnect",e[e.RealtimeApiFailed=16]="RealtimeApiFailed",e[e.TaskFailed=17]="TaskFailed",e[e.IncompatibleSDP=18]="IncompatibleSDP",e[e.TURNCredentialsForbidden=19]="TURNCredentialsForbidden",e[e.NoAttendeePresent=20]="NoAttendeePresent",e[e.AudioAttendeeRemoved=21]="AudioAttendeeRemoved",e[e.AudioVideoWasRemovedFromPrimaryMeeting=22]="AudioVideoWasRemovedFromPrimaryMeeting",e[e.AudioDisconnectAudio=23]="AudioDisconnectAudio"})(t=r.MeetingSessionStatusCode||(r.MeetingSessionStatusCode={})),r.default=t})(MeetingSessionStatusCode);var SDP$1={},SDPCandidateType={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SDPCandidateType=void 0;var t;(function(e){e.Host="host",e.ServerReflexive="srflx",e.PeerReflexive="prflx",e.Relay="relay"})(t=r.SDPCandidateType||(r.SDPCandidateType={})),r.default=t})(SDPCandidateType);var SDPMediaSection$1={};Object.defineProperty(SDPMediaSection$1,"__esModule",{value:!0});class SDPMediaSection{}SDPMediaSection$1.default=SDPMediaSection;var VideoCodecCapability$1={};Object.defineProperty(VideoCodecCapability$1,"__esModule",{value:!0});const SignalingProtocol_1$2=SignalingProtocol;class VideoCodecCapability{constructor(t,e){this.codecName=t,this.codecCapability=e}equals(t){return t!==void 0&&this.codecName===t.codecName&&this.codecCapability.mimeType===t.codecCapability.mimeType&&this.codecCapability.clockRate===t.codecCapability.clockRate&&this.codecCapability.sdpFmtpLine===t.codecCapability.sdpFmtpLine}static vp8(){return new VideoCodecCapability("VP8",{clockRate:9e4,mimeType:"video/VP8"})}static h264ConstrainedBaselineProfile(){return new VideoCodecCapability("H264",{clockRate:9e4,mimeType:"video/H264",sdpFmtpLine:"level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"})}static h264(){return this.h264ConstrainedBaselineProfile()}static fromSignaled(t){switch(t){case SignalingProtocol_1$2.SdkVideoCodecCapability.VP8:return this.vp8();case SignalingProtocol_1$2.SdkVideoCodecCapability.H264_CONSTRAINED_BASELINE_PROFILE:return this.h264ConstrainedBaselineProfile();default:return}}}VideoCodecCapability$1.default=VideoCodecCapability;Object.defineProperty(SDP$1,"__esModule",{value:!0});const SDPCandidateType_1=SDPCandidateType,SDPMediaSection_1=SDPMediaSection$1,VideoCodecCapability_1$1=VideoCodecCapability$1;class SDP{constructor(t){this.sdp=t}clone(){return new SDP(this.sdp)}static isRTPCandidate(t){const e=/candidate[:](\S+) (\d+)/g.exec(t);return!(e===null||e[2]!=="1")}static linesToSDP(t){return new SDP(t.join(SDP.CRLF))}static candidateTypeFromString(t){switch(t){case SDPCandidateType_1.default.Host:return SDPCandidateType_1.default.Host;case SDPCandidateType_1.default.ServerReflexive:return SDPCandidateType_1.default.ServerReflexive;case SDPCandidateType_1.default.PeerReflexive:return SDPCandidateType_1.default.PeerReflexive;case SDPCandidateType_1.default.Relay:return SDPCandidateType_1.default.Relay}return null}static candidateType(t){const e=/a[=]candidate[:].* typ ([a-z]+) /g.exec(t);return e===null?null:SDP.candidateTypeFromString(e[1])}static mediaType(t){const e=/m=(audio|video)/g.exec(t);if(e!==null)return e[1]}static mid(t){if(!!t.includes("a=mid:"))return t.replace(/^(a=mid:)/,"")}static direction(t){const e=/a=(sendrecv|sendonly|recvonly|inactive)/g.exec(t);if(e!==null)return e[1]}static splitLines(t){return t.trim().split(`
`).map(e=>e.trim())}static splitSections(t){return t.split(`
m=`).map((n,o)=>(o>0?"m="+n:n).trim()+SDP.CRLF)}static findActiveCameraSection(t){let e=0,n=!1;for(const o of t){if(/^m=video/.test(o)&&(o.indexOf("sendrecv")>-1||o.indexOf("sendonly")===-1&&o.indexOf("recvonly")===-1&&o.indexOf("inactive")===-1)){n=!0;break}e++}return n===!1&&(e=-1),e}static extractSSRCsFromFIDGroupLine(t){return/^a=ssrc-group:FID\s(.+)/.exec(t)[1]}static matchPrefix(t,e){return SDP.splitLines(t).filter(n=>n.indexOf(e)===0)}lines(){return this.sdp.split(SDP.CRLF)}hasVideo(){return/^m=video/gm.exec(this.sdp)!==null}hasCandidates(){return/a[=]candidate[:]/g.exec(this.sdp)!==null}hasCandidatesForAllMLines(){return!(this.sdp.indexOf("c=IN IP4 0.0.0.0")>-1)}withoutCandidateType(t){return SDP.linesToSDP(this.lines().filter(e=>SDP.candidateType(e)!==t))}withoutServerReflexiveCandidates(){return this.withoutCandidateType(SDPCandidateType_1.default.ServerReflexive)}withAudioMaxAverageBitrate(t){if(!t)return this.clone();t=Math.trunc(Math.min(Math.max(t,SDP.rfc7587LowestBitrate),SDP.rfc7587HighestBitrate));const e=this.lines(),n=SDP.findOpusFmtpAttributes(e),o=SDP.updateOpusFmtpAttributes(e,n,[`maxaveragebitrate=${t}`]);return SDP.linesToSDP(o)}withStereoAudio(){const t=this.lines(),e=SDP.findOpusFmtpAttributes(t),n=SDP.updateOpusFmtpAttributes(t,e,["stereo=1","sprop-stereo=1"]);return SDP.linesToSDP(n)}static findOpusFmtpAttributes(t){const e=/^a=rtpmap:\s*(\d+)\s+opus\/48000/;let n=!1;const o=[];for(const a of t)if(a.startsWith("m=audio")&&(o.push(null),n=!0),a.startsWith("m=video")&&(n=!1),n){const s=e.exec(a);s!==null&&(o[o.length-1]=`a=fmtp:${s[1]} `)}return o}static updateOpusFmtpAttributes(t,e,n){const o=[];let a=0,s=null;for(const d of t)if(d.startsWith("m=audio")&&(s=e[a],a++),d.startsWith("m=video")&&(s=null),s&&d.startsWith(s)){const u=d.slice(s.length).split(";"),c=[];for(const l of u)n.findIndex(h=>h.startsWith(l.split("=")[0]))<0&&c.push(l);for(const l of n)c.push(l);o.push(s+c.join(";"))}else o.push(d);return o}withUnifiedPlanFormat(){let t=this.sdp;return t.includes("mozilla")?this.clone():(t=t.replace("o=-","o=mozilla-chrome"),new SDP(t))}getUniqueRtpHeaderExtensionId(t){const e=[];for(const o of t)if(/^a=extmap:/.test(o.trim())){const s=+o.split("a=extmap:")[1].split(" ")[0];e.includes(s)||e.push(s)}e.sort((o,a)=>o-a);let n=0;for(const o of e){if(o-n>1)return n+1;n=o}return n===14?-1:n+1}withVideoLayersAllocationRtpHeaderExtension(t){const e="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",n=t?t.getRtpHeaderExtensionId(e):-1,o=n===-1?this.getUniqueRtpHeaderExtensionId(SDP.splitLines(this.sdp)):n,a=SDP.splitSections(this.sdp),s=[];for(let u of a){if(/^m=video/.test(u)&&SDP.getRtpHeaderExtensionIdInSection(u,e)===-1){const c=SDP.splitLines(u),l=[];if(o===-1||this.hasRtpHeaderExtensionId(o)){s.push(u);continue}for(const f of c)if(l.push(f),/^a=sendrecv/.test(f.trim())){const h="a=extmap:"+o+" "+e;l.push(h)}u=l.join(SDP.CRLF)+SDP.CRLF}else if(n!==-1&&/^m=video/.test(u)&&SDP.getRtpHeaderExtensionIdInSection(u,e)!==n){const c=SDP.splitLines(u),l=[];for(const f of c){if(/^a=extmap:/.test(f.trim())&&f.split("a=extmap:")[1].split(" ")[1]===e){if(!this.hasRtpHeaderExtensionId(n)){const p="a=extmap:"+n+" "+e;l.push(p)}continue}l.push(f)}u=l.join(SDP.CRLF)+SDP.CRLF}s.push(u)}const d=s.join("");return new SDP(d)}ssrcForVideoSendingSection(){const t=this.sdp,e=SDP.splitSections(t);if(e.length<2)return"";const n=SDP.findActiveCameraSection(e);if(n===-1)return"";const o=SDP.matchPrefix(e[n],"a=ssrc-group:FID ");if(o.length<1)return"";const a=SDP.extractSSRCsFromFIDGroupLine(o[0]),[s]=a.split(" ").map(d=>parseInt(d,10));return s.toString()}videoSendSectionHasDifferentSSRC(t){const e=this.ssrcForVideoSendingSection(),n=t.ssrcForVideoSendingSection();if(e===""||n==="")return!1;const o=parseInt(e,10),a=parseInt(n,10);return o!==a}removeH264SupportFromSendSection(){const t=this.sdp,e=SDP.splitSections(t),n=SDP.findActiveCameraSection(e);if(n===-1)return new SDP(this.sdp);const o=e[n],a=SDP.splitLines(o),s=[],d=new Map;a.forEach(f=>{if(/^a=rtpmap:/.test(f)){const h=/^a=rtpmap:([0-9]+)\s/.exec(f);h&&f.toLowerCase().includes("h264")&&s.push(parseInt(h[1],10))}if(/^a=fmtp:/.test(f)){const h=/^a=fmtp:([0-9]+) apt=([0-9]+)/.exec(f);if(h&&h.length===3){const p=parseInt(h[1],10),m=parseInt(h[2],10);d.has(m)?d.get(m).push(p):d.set(m,[p])}}});const u=new Set;for(const f of s){u.add(f);const h=d.get(f);if(h)for(const p of h)u.add(p)}if(s.length>0){const f=a[0].split(" ");a[0]=f.filter(h=>!u.has(parseInt(h))).join(" ")}const c=a.filter(f=>{if(!f.includes("rtpmap")&&!f.includes("rtcp-fb")&&!f.includes("fmtp"))return!0;for(const h of u)if(f.includes(h.toString()))return!1;return!0});e[n]=c.join(SDP.CRLF)+SDP.CRLF;const l=e.join("");return new SDP(l)}mediaSections(){const t=SDP.splitSections(this.sdp);if(t.length<2)return[];const e=[];for(let n=1;n<t.length;n++){const o=new SDPMediaSection_1.default,a=SDP.splitLines(t[n]);for(const s of a){const d=SDP.mediaType(s);if(d!==void 0){o.mediaType=d;continue}const u=SDP.direction(s);if(u!==void 0){o.direction=u;continue}const c=SDP.mid(s);if(c!==void 0){o.mid=c;continue}}e.push(o)}return e}static getRtpHeaderExtensionIdInSection(t,e){const n=SDP.splitLines(t);for(const o of n)if(/^a=extmap:/.test(o.trim())){const a=o.split("a=extmap:")[1].split(" "),s=+a[0];if(a[1]===e)return s}return-1}getRtpHeaderExtensionId(t){const e=SDP.splitSections(this.sdp);for(const n of e)if(/^m=video/.test(n)){const o=SDP.getRtpHeaderExtensionIdInSection(n,t);if(o!==-1)return o}return-1}hasRtpHeaderExtensionId(t){const e=SDP.splitLines(this.sdp);for(const n of e)if(/^a=extmap:/.test(n.trim())&&+n.split("a=extmap:")[1].split(" ")[0]===t)return!0;return!1}withVideoSendCodecPreferences(t){const e=this.sdp,n=SDP.splitSections(e),o=SDP.findActiveCameraSection(n);if(o===-1)return new SDP(this.sdp);n[o]=this.sectionWithCodecPreferences(n[o],t);const a=n.join("");return new SDP(a)}sectionWithCodecPreferences(t,e){const n=new Map,o=SDP.splitLines(t);o.forEach(u=>{if(!!/^a=rtpmap:/.test(u))for(const c of e){if(!u.includes(`${c.codecName}/${c.codecCapability.clockRate}`))continue;const l=/^a=rtpmap:([0-9]+)\s/.exec(u);let f=!1;if(c.codecCapability.sdpFmtpLine!==void 0){for(const h of o)if(h.startsWith(`a=fmtp:${l[1]} ${c.codecCapability.sdpFmtpLine}`)){f=!0;break}}else f=!0;if(f){n.set(c.codecName,l[1]);break}}});const a=new Set(n.values()),s=o[0].split(" ").filter(u=>!a.has(u)),d=Array.from(n.values()).sort((u,c)=>{const l=e.findIndex(h=>n.get(h.codecName)===u),f=e.findIndex(h=>n.get(h.codecName)===c);return l-f});return s.splice(3,0,...d.values()),o[0]=s.join(" "),o.join(SDP.CRLF)+SDP.CRLF}highestPriorityVideoSendCodec(){const t=this.sdp,e=SDP.splitSections(t),n=SDP.findActiveCameraSection(e);if(n===-1)return;const o=SDP.splitLines(e[n]),a=o[0].split(" ");if(a.length<4)return;const s=a[3];let d,u,c;for(const l of o){const f=/^a=rtpmap:([0-9]+)\s/.exec(l);if(f===null||f.length<2||f[1]!==s)continue;const p=l.split(" ")[1].split("/");if(!(p===void 0||p.length<2)){d=p[0],u=p[1];for(const m of o)if(m.startsWith(`a=fmtp:${s}`)){const S=m.split(" ");if(S===void 0||S.length<2)return;c=S[1];continue}break}}if(d!==void 0)return new VideoCodecCapability_1$1.default(d,{clockRate:parseInt(u),mimeType:`video/${d}`,sdpFmtpLine:c})}}SDP$1.default=SDP;SDP.CRLF=`\r
`;SDP.rfc7587LowestBitrate=6e3;SDP.rfc7587HighestBitrate=51e4;var __awaiter$L=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(CreateSDPTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$7=MeetingSessionStatusCode,SDP_1$4=SDP$1,BaseTask_1$k=BaseTask$1;class CreateSDPTask extends BaseTask_1$k.default{constructor(t){super(t.logger),this.context=t,this.taskName="CreateSDPTask"}cancel(){if(this.cancelPromise){const t=new Error(`canceling ${this.name()}`);this.cancelPromise(t),delete this.cancelPromise}}sessionUsesAudio(){var t,e;return!!(!((e=(t=this.context.meetingSessionConfiguration)===null||t===void 0?void 0:t.urls)===null||e===void 0)&&e.audioHostURL)}sessionUsesVideo(){let e;this.context.transceiverController.useTransceivers()?e=this.context.transceiverController.hasVideoInput():e=this.context.videoTileController.hasStartedLocalVideoTile();const n=!!this.context.videosToReceive&&!this.context.videosToReceive.empty(),o=e||n;return this.context.logger.info(`uses video: ${o} (enabled: ${!0}, sending: ${e}, receiving: ${n})`),o}run(){return __awaiter$L(this,void 0,void 0,function*(){const t={offerToReceiveAudio:this.sessionUsesAudio(),offerToReceiveVideo:this.sessionUsesVideo()};this.logger.info(`peer connection offerOptions: ${JSON.stringify(t)}`),yield new Promise((e,n)=>__awaiter$L(this,void 0,void 0,function*(){this.cancelPromise=o=>{n(o)};try{if(this.context.sdpOfferInit=yield this.context.peer.createOffer(t),this.context.logger.info("peer connection created offer"),this.context.previousSdpOffer&&new SDP_1$4.default(this.context.sdpOfferInit.sdp).videoSendSectionHasDifferentSSRC(this.context.previousSdpOffer)){const o=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$7.default.IncompatibleSDP}`);this.context.previousSdpOffer=null,n(o);return}e()}catch(o){n(o)}finally{delete this.cancelPromise}}))})}}CreateSDPTask$1.default=CreateSDPTask;var DataMessage$1={};Object.defineProperty(DataMessage$1,"__esModule",{value:!0});class DataMessage{constructor(t,e,n,o,a,s){this.timestampMs=t,this.topic=e,this.data=n,this.senderAttendeeId=o,this.senderExternalUserId=a,this.throttled=!!s}text(){return new TextDecoder().decode(this.data)}json(){return JSON.parse(new TextDecoder().decode(this.data))}}DataMessage$1.default=DataMessage;var DefaultActiveSpeakerDetector$1={},__awaiter$K=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultActiveSpeakerDetector$1,"__esModule",{value:!0});const IntervalScheduler_1$4=IntervalScheduler$1;class DefaultActiveSpeakerDetector{constructor(t,e,n,o=1e3,a=200){this.realtimeController=t,this.selfAttendeeId=e,this.hasBandwidthPriorityCallback=n,this.waitIntervalMs=o,this.updateIntervalMs=a,this.speakerScores={},this.speakerMuteState={},this.detectorCallbackToHandler=new Map,this.detectorCallbackToScoresTimer=new Map,this.detectorCallbackToActivityTimer=new Map,this.hasBandwidthPriority=!1,this.mostRecentUpdateTimestamp={}}needUpdate(t){return this.activeSpeakers?this.speakerScores[t]===0&&this.activeSpeakers.includes(t)||this.speakerScores[t]>0&&!this.activeSpeakers.includes(t):!0}updateActiveSpeakers(t,e,n){if(!this.needUpdate(n))return;const o=[],a=Object.keys(this.speakerScores);for(let l=0;l<a.length;l++){const f=a[l];o.push({attendeeId:f,activeScore:this.speakerScores[f]})}const s=o.sort((l,f)=>f.activeScore-l.activeScore).filter(function(l){return l.activeScore>0}).map(function(l){return l.attendeeId});this.activeSpeakers=s,e(s);const u=s.length>0&&s[0]===this.selfAttendeeId&&t.prioritizeVideoSendBandwidthForActiveSpeaker();this.hasBandwidthPriority!==u&&(this.hasBandwidthPriority=u,this.hasBandwidthPriorityCallback(u))}updateScore(t,e,n,o,a){const s=t.calculateScore(n,o,a);this.speakerScores[n]!==s&&(this.speakerScores[n]=s,this.mostRecentUpdateTimestamp[n]=Date.now(),this.updateActiveSpeakers(t,e,n))}subscribe(t,e,n,o){const a=(d,u)=>{if(!u){this.speakerScores[d]=0,this.mostRecentUpdateTimestamp[d]=Date.now(),this.updateActiveSpeakers(t,e,d);return}this.realtimeController.realtimeSubscribeToVolumeIndicator(d,(c,l,f,h)=>{this.mostRecentUpdateTimestamp[c]=Date.now(),f!==null&&(this.speakerMuteState[c]=f),this.updateScore(t,e,c,l,f)})};this.detectorCallbackToHandler.set(e,a);const s=new IntervalScheduler_1$4.default(this.updateIntervalMs);if(s.start(()=>{for(const d in this.speakerScores)Date.now()-this.mostRecentUpdateTimestamp[d]>this.waitIntervalMs&&this.updateScore(t,e,d,0,this.speakerMuteState[d])}),this.detectorCallbackToActivityTimer.set(e,s),n&&o){const d=new IntervalScheduler_1$4.default(o);d.start(()=>{n(this.speakerScores)}),this.detectorCallbackToScoresTimer.set(e,d)}this.realtimeController.realtimeSubscribeToAttendeeIdPresence(a)}unsubscribe(t){const e=this.detectorCallbackToHandler.get(t);this.detectorCallbackToHandler.delete(t),e&&this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(e);const n=this.detectorCallbackToActivityTimer.get(t);n&&(n.stop(),this.detectorCallbackToActivityTimer.delete(t));const o=this.detectorCallbackToScoresTimer.get(t);o&&(o.stop(),this.detectorCallbackToHandler.delete(t))}destroy(){return __awaiter$K(this,void 0,void 0,function*(){for(const t of this.detectorCallbackToHandler.values())this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t);for(const t of this.detectorCallbackToActivityTimer.values())t.stop();for(const t of this.detectorCallbackToScoresTimer.values())t.stop();this.detectorCallbackToHandler.clear(),this.detectorCallbackToActivityTimer.clear(),this.detectorCallbackToScoresTimer.clear()})}}DefaultActiveSpeakerDetector$1.default=DefaultActiveSpeakerDetector;var DefaultActiveSpeakerPolicy$1={};Object.defineProperty(DefaultActiveSpeakerPolicy$1,"__esModule",{value:!0});class DefaultActiveSpeakerPolicy{constructor(t=.9,e=.01,n=.2,o=.2){this.speakerWeight=t,this.cutoffThreshold=e,this.silenceThreshold=n,this.takeoverRate=o,this.volumes={}}calculateScore(t,e,n){(n||e===null)&&(e=0),this.volumes.hasOwnProperty(t)||(this.volumes[t]=0),e>this.silenceThreshold?e=1:e=0;const o=this.volumes[t]*this.speakerWeight+e*(1-this.speakerWeight);this.volumes[t]=o;for(const a in this.volumes)a!==t&&(this.volumes[a]=Math.max(this.volumes[a]-this.takeoverRate*e,0));return o<this.cutoffThreshold?0:o}prioritizeVideoSendBandwidthForActiveSpeaker(){return!0}}DefaultActiveSpeakerPolicy$1.default=DefaultActiveSpeakerPolicy;var DefaultAudioMixController$1={},__awaiter$J=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultAudioMixController$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$5=DefaultBrowserBehavior$1,AsyncScheduler_1$4=AsyncScheduler$1;class DefaultAudioMixController{constructor(t){this.logger=t,this.audioDevice=null,this.audioElement=null,this.audioStream=null,this.browserBehavior=new DefaultBrowserBehavior_1$5.default,this.observers=new Set}bindAudioElement(t){return __awaiter$J(this,void 0,void 0,function*(){if(!t)throw new Error(`Cannot bind audio element: ${t}`);return this.audioElement=t,this.audioElement.autoplay=!0,this.bindAudioMix()})}unbindAudioElement(){!this.audioElement||(this.audioElement.srcObject=null,this.audioElement=null,this.forEachObserver(t=>{this.audioStream&&t.meetingAudioStreamBecameInactive(this.audioStream)}))}bindAudioStream(t){return __awaiter$J(this,void 0,void 0,function*(){if(!!t){this.audioStream=t;try{yield this.bindAudioMix()}catch(e){this.logger&&this.logger.warn(`Failed to bind audio stream: ${e}`)}}})}bindAudioDevice(t){return __awaiter$J(this,void 0,void 0,function*(){if(t&&!this.browserBehavior.supportsSetSinkId())throw new Error("Cannot select audio output device. This browser does not support setSinkId.");return this.audioDevice=t,this.bindAudioMix()})}forEachObserver(t){for(const e of this.observers)AsyncScheduler_1$4.default.nextTick(()=>{t(e)})}bindAudioMix(){var t,e;return __awaiter$J(this,void 0,void 0,function*(){if(!this.audioElement)return;const n=this.audioElement.srcObject;this.audioStream&&(this.audioElement.srcObject=this.audioStream),n!==this.audioStream&&this.forEachObserver(c=>{n&&c.meetingAudioStreamBecameInactive(n),this.audioStream&&c.meetingAudioStreamBecameActive(this.audioStream)});const o=((t=this.audioDevice)===null||t===void 0?void 0:t.deviceId)!==this.audioElement.sinkId;if(o&&typeof this.audioElement.sinkId>"u")throw new Error("Cannot select audio output device. This browser does not support setSinkId.");const a=this.audioDevice?this.audioDevice.deviceId:"",s=this.audioElement.sinkId;if(a===s)return;const d=this.audioElement,u=this.audioStream;if(this.browserBehavior.hasChromiumWebRTC()&&(d.srcObject=null),o)try{yield d.setSinkId(a)}catch(c){throw(e=this.logger)===null||e===void 0||e.error(`Failed to set sinkId for audio element: ${c}`),c}this.browserBehavior.hasChromiumWebRTC()&&(d.srcObject=u)})}getCurrentMeetingAudioStream(){return __awaiter$J(this,void 0,void 0,function*(){return this.audioStream})}addAudioMixObserver(t){return __awaiter$J(this,void 0,void 0,function*(){this.observers.add(t)})}removeAudioMixObserver(t){return __awaiter$J(this,void 0,void 0,function*(){this.observers.delete(t)})}audioOutputDidChange(t){return __awaiter$J(this,void 0,void 0,function*(){return this.logger.info("Receive an audio output change event"),this.bindAudioDevice(t)})}}DefaultAudioMixController$1.default=DefaultAudioMixController;var DefaultAudioVideoController={},SignalingAndMetricsConnectionMonitor$1={};Object.defineProperty(SignalingAndMetricsConnectionMonitor$1,"__esModule",{value:!0});const Types_1$7=Types;class SignalingAndMetricsConnectionMonitor{constructor(t,e,n,o,a){this.audioVideoController=t,this.realtimeController=e,this.connectionHealthData=n,this.pingPong=o,this.statsCollector=a,this.isActive=!1,this.hasSeenValidPacketMetricsBefore=!1,this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(s=>{this.isActive&&this.receiveSignalStrengthChange(s)})}start(){this.isActive=!0,this.pingPong.addObserver(this),this.pingPong.start(),this.audioVideoController.addObserver(this)}stop(){this.isActive=!1,this.pingPong.removeObserver(this),this.pingPong.stop(),this.audioVideoController.removeObserver(this)}receiveSignalStrengthChange(t){t===0?this.connectionHealthData.setLastNoSignalTimestampMs(Date.now()):t<=.5?this.connectionHealthData.setLastWeakSignalTimestampMs(Date.now()):this.connectionHealthData.setLastGoodSignalTimestampMs(Date.now()),this.updateConnectionHealth()}didReceivePong(t,e,n){this.connectionHealthData.setConsecutiveMissedPongs(0),this.statsCollector.logLatency("ping_pong",e),this.statsCollector.logLatency("ping_pong_clock_skew",n),this.updateConnectionHealth()}didMissPongs(){this.connectionHealthData.setConsecutiveMissedPongs(this.connectionHealthData.consecutiveMissedPongs+1),this.updateConnectionHealth()}metricsDidReceive(t){let e=0,n=0;const o=t.getObservableMetrics(),a=o.audioPacketsReceived,s=o.audioPacketsReceivedFractionLoss,d=o.audioSpeakerDelayMs;if(typeof d=="number"&&!isNaN(d)&&this.connectionHealthData.setAudioSpeakerDelayMs(d),typeof a=="number"&&typeof s=="number"){if(e=a,n=s,e<0||n<0)return}else return;this.addToMinuteWindow(this.connectionHealthData.packetsReceivedInLastMinute,e),this.addToMinuteWindow(this.connectionHealthData.fractionPacketsLostInboundInLastMinute,n),e>0?(this.hasSeenValidPacketMetricsBefore=!0,this.connectionHealthData.setConsecutiveStatsWithNoPackets(0)):this.hasSeenValidPacketMetricsBefore&&this.connectionHealthData.setConsecutiveStatsWithNoPackets(this.connectionHealthData.consecutiveStatsWithNoPackets+1),(e===0||n>0)&&this.connectionHealthData.setLastPacketLossInboundTimestampMs(Date.now()),this.updateConnectionHealth()}addToMinuteWindow(t,e){t.unshift(e),t.length>60&&t.pop()}updateConnectionHealth(){this.audioVideoController.forEachObserver(t=>{Types_1$7.Maybe.of(t.connectionHealthDidChange).map(e=>e.bind(t)(this.connectionHealthData.clone()))})}}SignalingAndMetricsConnectionMonitor$1.default=SignalingAndMetricsConnectionMonitor;var MeetingSessionStatus$1={};Object.defineProperty(MeetingSessionStatus$1,"__esModule",{value:!0});const SignalingProtocol_js_1$d=SignalingProtocol,MeetingSessionStatusCode_1$6=MeetingSessionStatusCode;class MeetingSessionStatus{constructor(t){this._statusCode=t}statusCode(){return this._statusCode}isFailure(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity:case MeetingSessionStatusCode_1$6.default.AudioInternalServerError:case MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$6.default.AudioDisconnected:case MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity:case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$6.default.ICEGatheringTimeoutWorkaround:case MeetingSessionStatusCode_1$6.default.ConnectionHealthReconnect:case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$6.default.TaskFailed:case MeetingSessionStatusCode_1$6.default.NoAttendeePresent:return!0;default:return!1}}isTerminal(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.Left:case MeetingSessionStatusCode_1$6.default.AudioJoinedFromAnotherDevice:case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity:case MeetingSessionStatusCode_1$6.default.MeetingEnded:case MeetingSessionStatusCode_1$6.default.AudioDisconnected:case MeetingSessionStatusCode_1$6.default.TURNCredentialsForbidden:case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity:case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$6.default.AudioAttendeeRemoved:return!0;default:return!1}}isAudioConnectionFailure(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:case MeetingSessionStatusCode_1$6.default.AudioInternalServerError:case MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$6.default.ICEGatheringTimeoutWorkaround:case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:case MeetingSessionStatusCode_1$6.default.NoAttendeePresent:return!0;default:return!1}}toString(){switch(this._statusCode){case MeetingSessionStatusCode_1$6.default.OK:return"Everything is OK so far.";case MeetingSessionStatusCode_1$6.default.Left:return"The attendee left the meeting.";case MeetingSessionStatusCode_1$6.default.AudioJoinedFromAnotherDevice:return"The attendee joined from another device.";case MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected:return"The meeting rejected the attendee.";case MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity:return"The attendee couldn't join because the meeting was at capacity.";case MeetingSessionStatusCode_1$6.default.MeetingEnded:return"The meeting ended.";case MeetingSessionStatusCode_1$6.default.AudioInternalServerError:case MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable:case MeetingSessionStatusCode_1$6.default.AudioDisconnected:return"The audio connection failed.";case MeetingSessionStatusCode_1$6.default.VideoCallSwitchToViewOnly:return"The attendee couldn't start the local video because the maximum video capacity was reached.";case MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity:return"The connection failed due to an internal server error.";case MeetingSessionStatusCode_1$6.default.SignalingBadRequest:case MeetingSessionStatusCode_1$6.default.SignalingInternalServerError:case MeetingSessionStatusCode_1$6.default.SignalingRequestFailed:return"The signaling connection failed.";case MeetingSessionStatusCode_1$6.default.ICEGatheringTimeoutWorkaround:return"Gathering ICE candidates timed out. In Chrome, this might indicate that the browser is in a bad state after reconnecting to VPN.";case MeetingSessionStatusCode_1$6.default.ConnectionHealthReconnect:return"The meeting was reconnected.";case MeetingSessionStatusCode_1$6.default.RealtimeApiFailed:return"The real-time API failed. This status code might indicate that the callback you passed to the real-time API threw an exception.";case MeetingSessionStatusCode_1$6.default.TaskFailed:return"The connection failed. See the error message for more details.";case MeetingSessionStatusCode_1$6.default.IncompatibleSDP:return"The connection failed due to incompatible SDP.";case MeetingSessionStatusCode_1$6.default.TURNCredentialsForbidden:return"The meeting ended, or the attendee was removed.";case MeetingSessionStatusCode_1$6.default.NoAttendeePresent:return"The attendee was not present.";case MeetingSessionStatusCode_1$6.default.AudioAttendeeRemoved:return"The meeting ended because attendee removed.";case MeetingSessionStatusCode_1$6.default.AudioVideoWasRemovedFromPrimaryMeeting:return"The Primary meeting credentials provided are no longer valid. chime::DeleteAttendee may have been called on them.";case MeetingSessionStatusCode_1$6.default.AudioDisconnectAudio:return"The audio connection failed.";default:{const t=this._statusCode;throw new Error(`Unhandled case: ${t}`)}}}static fromSignalFrame(t){return t.error&&t.error.status?this.fromSignalingStatus(t.error.status):t.type===SignalingProtocol_js_1$d.SdkSignalFrame.Type.AUDIO_STATUS?t.audioStatus?this.fromAudioStatus(t.audioStatus.audioStatus):new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingRequestFailed):t.type===SignalingProtocol_js_1$d.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE?new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioVideoWasRemovedFromPrimaryMeeting):new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK)}static fromAudioStatus(t){switch(t){case 200:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK);case 301:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioJoinedFromAnotherDevice);case 302:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioDisconnectAudio);case 403:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected);case 409:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity);case 410:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.MeetingEnded);case 411:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioAttendeeRemoved);case 500:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioInternalServerError);case 503:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioServiceUnavailable);default:switch(Math.floor(t/100)){case 2:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK);default:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioDisconnected)}}}static fromSignalingStatus(t){switch(t){case 206:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.VideoCallSwitchToViewOnly);case 509:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.VideoCallAtSourceCapacity);case 403:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioAuthenticationRejected);case 409:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.AudioCallAtCapacity);default:switch(Math.floor(t/100)){case 2:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.OK);case 4:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingBadRequest);case 5:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingInternalServerError);default:return new MeetingSessionStatus(MeetingSessionStatusCode_1$6.default.SignalingRequestFailed)}}}}MeetingSessionStatus$1.default=MeetingSessionStatus;var MeetingSessionVideoAvailability$1={};Object.defineProperty(MeetingSessionVideoAvailability$1,"__esModule",{value:!0});class MeetingSessionVideoAvailability{constructor(){this.remoteVideoAvailable=!1,this.canStartLocalVideo=!1}equal(t){return this.remoteVideoAvailable===t.remoteVideoAvailable&&this.canStartLocalVideo===t.canStartLocalVideo}clone(){const t=new MeetingSessionVideoAvailability;return t.remoteVideoAvailable=this.remoteVideoAvailable,t.canStartLocalVideo=this.canStartLocalVideo,t}}MeetingSessionVideoAvailability$1.default=MeetingSessionVideoAvailability;var DefaultPingPong$1={};Object.defineProperty(DefaultPingPong$1,"__esModule",{value:!0});const AsyncScheduler_1$3=AsyncScheduler$1,IntervalScheduler_1$3=IntervalScheduler$1,SignalingClientEventType_1$a=SignalingClientEventType,SignalingProtocol_js_1$c=SignalingProtocol,Types_1$6=Types;class DefaultPingPong{constructor(t,e,n){this.signalingClient=t,this.intervalMs=e,this.logger=n,this.observerQueue=new Set,this.consecutivePongsUnaccountedFor=0,this.intervalScheduler=new IntervalScheduler_1$3.default(this.intervalMs),this.pingId=0}addObserver(t){this.logger.info("adding a ping-pong observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing a ping-pong observer"),this.observerQueue.delete(t)}forEachObserver(t){for(const e of this.observerQueue)AsyncScheduler_1$3.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}start(){this.stop(),this.signalingClient.registerObserver(this),this.signalingClient.ready()&&this.startPingInterval()}stop(){this.stopPingInterval(),this.signalingClient.removeObserver(this)}startPingInterval(){this.intervalScheduler.start(()=>{this.ping()}),this.ping()}stopPingInterval(){this.intervalScheduler.stop(),this.pingId=0,this.consecutivePongsUnaccountedFor=0}ping(){this.consecutivePongsUnaccountedFor>0&&(this.logger.warn(`missed pong ${this.consecutivePongsUnaccountedFor} time(s)`),this.forEachObserver(e=>{Types_1$6.Maybe.of(e.didMissPongs).map(n=>n.bind(e)(this.consecutivePongsUnaccountedFor))})),this.consecutivePongsUnaccountedFor+=1,this.pingId=this.pingId+1&4294967295;const t=SignalingProtocol_js_1$c.SdkPingPongFrame.create();t.pingId=this.pingId,t.type=SignalingProtocol_js_1$c.SdkPingPongType.PING,this.pingTimestampLocalMs=this.signalingClient.pingPong(t),this.logger.debug(()=>`sent ping ${this.pingId}`)}pong(t){const e=SignalingProtocol_js_1$c.SdkPingPongFrame.create();e.pingId=t,e.type=SignalingProtocol_js_1$c.SdkPingPongType.PONG,this.signalingClient.pingPong(e)}handleSignalingClientEvent(t){switch(t.type){case SignalingClientEventType_1$a.default.WebSocketOpen:this.startPingInterval();break;case SignalingClientEventType_1$a.default.WebSocketFailed:case SignalingClientEventType_1$a.default.WebSocketError:this.logger.warn(`stopped pinging (${SignalingClientEventType_1$a.default[t.type]})`),this.stopPingInterval();break;case SignalingClientEventType_1$a.default.WebSocketClosing:case SignalingClientEventType_1$a.default.WebSocketClosed:this.logger.info(`stopped pinging (${SignalingClientEventType_1$a.default[t.type]})`),this.stopPingInterval();break;case SignalingClientEventType_1$a.default.ReceivedSignalFrame:if(t.message.type!==SignalingProtocol_js_1$c.SdkSignalFrame.Type.PING_PONG)break;if(t.message.pingPong.type===SignalingProtocol_js_1$c.SdkPingPongType.PONG){const e=t.message.pingPong.pingId;if(e!==this.pingId){this.logger.warn(`unexpected ping id ${e} (expected ${this.pingId})`);break}this.consecutivePongsUnaccountedFor=0;let n;if(typeof t.message.timestampMs=="number")n=t.message.timestampMs;else break;this.logger.debug(()=>`received pong ${e} with timestamp ${n}`);const a=t.timestampMs-this.pingTimestampLocalMs,s=Math.round(n-a/2),d=this.pingTimestampLocalMs-s;this.logger.info(`local clock skew estimate=${d}ms from ping-pong time=${a}ms`),this.forEachObserver(u=>{Types_1$6.Maybe.of(u.didReceivePong).map(c=>c.bind(u)(e,d,a))})}else this.pong(t.message.pingPong.pingId);break}}}DefaultPingPong$1.default=DefaultPingPong;var DefaultRealtimeController$1={},DefaultTranscriptionController={},TranscriptEvent={},Transcript$1={};Object.defineProperty(Transcript$1,"__esModule",{value:!0});class Transcript{}Transcript$1.default=Transcript;var TranscriptionStatus$1={};Object.defineProperty(TranscriptionStatus$1,"__esModule",{value:!0});class TranscriptionStatus{}TranscriptionStatus$1.default=TranscriptionStatus;var TranscriptionStatusType$1={};Object.defineProperty(TranscriptionStatusType$1,"__esModule",{value:!0});var TranscriptionStatusType;(function(r){r.STARTED="started",r.INTERRUPTED="interrupted",r.RESUMED="resumed",r.STOPPED="stopped",r.FAILED="failed"})(TranscriptionStatusType||(TranscriptionStatusType={}));TranscriptionStatusType$1.default=TranscriptionStatusType;var TranscriptItemType$1={};Object.defineProperty(TranscriptItemType$1,"__esModule",{value:!0});var TranscriptItemType;(function(r){r.PRONUNCIATION="pronunciation",r.PUNCTUATION="punctuation"})(TranscriptItemType||(TranscriptItemType={}));TranscriptItemType$1.default=TranscriptItemType;Object.defineProperty(TranscriptEvent,"__esModule",{value:!0});TranscriptEvent.TranscriptEventConverter=void 0;const SignalingProtocol_1$1=SignalingProtocol,Transcript_1=Transcript$1,TranscriptionStatus_1=TranscriptionStatus$1,TranscriptionStatusType_1=TranscriptionStatusType$1,TranscriptItemType_1=TranscriptItemType$1,TranscriptionStatusTypes={[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.STARTED]:TranscriptionStatusType_1.default.STARTED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.INTERRUPTED]:TranscriptionStatusType_1.default.INTERRUPTED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.RESUMED]:TranscriptionStatusType_1.default.RESUMED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.STOPPED]:TranscriptionStatusType_1.default.STOPPED,[SignalingProtocol_1$1.SdkTranscriptionStatus.Type.FAILED]:TranscriptionStatusType_1.default.FAILED};class TranscriptEventConverter{static from(t){let e;try{e=SignalingProtocol_1$1.SdkTranscriptFrame.decode(t.data)}catch(o){throw new Error("Cannot decode transcript data message: "+o)}const n=[];for(const o of e.events)if(o.status){const a=TranscriptionStatusTypes[o.status.type];if(!a)continue;const s=new TranscriptionStatus_1.default;s.type=a,s.eventTimeMs=o.status.eventTime,s.transcriptionRegion=o.status.transcriptionRegion,s.transcriptionConfiguration=o.status.transcriptionConfiguration,o.status.message&&(s.message=o.status.message),n.push(s)}else if(o.transcript){const a=new Transcript_1.default;a.results=[];for(const s of o.transcript.results){const d={channelId:s.channelId,isPartial:s.isPartial,resultId:s.resultId,startTimeMs:s.startTime,endTimeMs:s.endTime,alternatives:[]};if(s.languageCode&&(d.languageCode=s.languageCode),s.languageIdentification&&s.languageIdentification.length>0){d.languageIdentification=[];for(const u of s.languageIdentification){const c={languageCode:u.languageCode,score:u.score};d.languageIdentification.push(c)}}for(const u of s.alternatives){const c={items:[],transcript:u.transcript};for(const l of u.items){const f={content:l.content,attendee:{attendeeId:l.speakerAttendeeId,externalUserId:l.speakerExternalUserId},startTimeMs:l.startTime,endTimeMs:l.endTime,type:null};switch(l.vocabularyFilterMatch&&(f.vocabularyFilterMatch=l.vocabularyFilterMatch),l.hasOwnProperty("stable")&&(f.stable=l.stable),l.hasOwnProperty("confidence")&&(f.confidence=l.confidence),l.type){case SignalingProtocol_1$1.SdkTranscriptItem.Type.PRONUNCIATION:f.type=TranscriptItemType_1.default.PRONUNCIATION;break;case SignalingProtocol_1$1.SdkTranscriptItem.Type.PUNCTUATION:f.type=TranscriptItemType_1.default.PUNCTUATION;break}c.items.push(f)}for(const l of u.entities){c.entities||(c.entities=[]);const f={category:l.category,confidence:l.confidence,content:l.content,startTimeMs:l.startTime,endTimeMs:l.endTime};l.type&&(f.type=l.type),c.entities.push(f)}d.alternatives.push(c)}a.results.push(d)}n.push(a)}return n}}TranscriptEvent.TranscriptEventConverter=TranscriptEventConverter;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TRANSCRIPTION_DATA_MESSAGE_TOPIC=void 0;const t=TranscriptEvent;r.TRANSCRIPTION_DATA_MESSAGE_TOPIC="aws:chime:transcription";class e{constructor(o){this.realtimeController=o,this.transcriptEventCallbacks=new Set}subscribeToTranscriptEvent(o){this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeSubscribeToReceiveDataMessage(r.TRANSCRIPTION_DATA_MESSAGE_TOPIC,a=>{for(const s of t.TranscriptEventConverter.from(a))for(const d of this.transcriptEventCallbacks)d(s)}),this.transcriptEventCallbacks.add(o)}unsubscribeFromTranscriptEvent(o){this.transcriptEventCallbacks.delete(o),this.transcriptEventCallbacks.size===0&&this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(r.TRANSCRIPTION_DATA_MESSAGE_TOPIC)}}r.default=e})(DefaultTranscriptionController);var RealtimeState$1={};Object.defineProperty(RealtimeState$1,"__esModule",{value:!0});class RealtimeState{constructor(){this.localAttendeeId=null,this.localExternalUserId=null,this.attendeeIdChangesCallbacks=[],this.canUnmute=!0,this.setCanUnmuteLocalAudioCallbacks=[],this.muted=!1,this.muteAndUnmuteLocalAudioCallbacks=[],this.volumeIndicatorState={},this.attendeeIdToExternalUserId={},this.volumeIndicatorCallbacks={},this.localSignalStrengthChangeCallbacks=[],this.fatalErrorCallbacks=[],this.sendDataMessageCallbacks=[],this.receiveDataMessageCallbacks=new Map}}RealtimeState$1.default=RealtimeState;var RealtimeVolumeIndicator$1={};Object.defineProperty(RealtimeVolumeIndicator$1,"__esModule",{value:!0});class RealtimeVolumeIndicator{constructor(){this.volume=null,this.muted=null,this.signalStrength=null}}RealtimeVolumeIndicator$1.default=RealtimeVolumeIndicator;Object.defineProperty(DefaultRealtimeController$1,"__esModule",{value:!0});const DefaultTranscriptionController_1=DefaultTranscriptionController,RealtimeState_1=RealtimeState$1,RealtimeVolumeIndicator_1=RealtimeVolumeIndicator$1;class DefaultRealtimeController{constructor(t,e){this.mediaStreamBroker=t,this.state=new RealtimeState_1.default,this._transcriptionController=e||new DefaultTranscriptionController_1.default(this)}realtimeSetLocalAttendeeId(t,e){this.state.localAttendeeId=t,this.state.localExternalUserId=e}realtimeSetAttendeeIdPresence(t,e,n,o,a){try{e&&(this.state.attendeeIdToExternalUserId[t]=n);for(const s of this.state.attendeeIdChangesCallbacks)s(t,e,n,o,a)}catch(s){this.onError(s)}}realtimeSubscribeToAttendeeIdPresence(t){try{this.state.attendeeIdChangesCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToAttendeeIdPresence(t){try{const e=this.state.attendeeIdChangesCallbacks.indexOf(t);e!==-1&&this.state.attendeeIdChangesCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSetCanUnmuteLocalAudio(t){try{if(this.state.canUnmute===t)return;this.state.canUnmute=t;for(const e of this.state.setCanUnmuteLocalAudioCallbacks)e(t)}catch(e){this.onError(e)}}realtimeSubscribeToSetCanUnmuteLocalAudio(t){try{this.state.setCanUnmuteLocalAudioCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToSetCanUnmuteLocalAudio(t){try{const e=this.state.setCanUnmuteLocalAudioCallbacks.indexOf(t);e!==-1&&this.state.setCanUnmuteLocalAudioCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeCanUnmuteLocalAudio(){return this.state.canUnmute}realtimeMuteLocalAudio(){if(!this.state.muted)try{this.setAudioInputEnabled(!1),this.state.muted=!0,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(const t of this.state.muteAndUnmuteLocalAudioCallbacks)t(!0)}catch(t){this.onError(t)}}realtimeUnmuteLocalAudio(){if(!this.state.muted)return!0;if(!this.state.canUnmute)return!1;try{this.setAudioInputEnabled(!0),this.state.muted=!1,this.realtimeUpdateVolumeIndicator(this.state.localAttendeeId,null,null,null,this.state.localExternalUserId);for(const t of this.state.muteAndUnmuteLocalAudioCallbacks)t(!1);return!0}catch(t){return this.onError(t),!1}}realtimeSubscribeToMuteAndUnmuteLocalAudio(t){try{this.state.muteAndUnmuteLocalAudioCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t){try{const e=this.state.muteAndUnmuteLocalAudioCallbacks.indexOf(t);e!==-1&&this.state.muteAndUnmuteLocalAudioCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeIsLocalAudioMuted(){return this.state.muted}realtimeSubscribeToVolumeIndicator(t,e){try{this.state.volumeIndicatorCallbacks.hasOwnProperty(t)||(this.state.volumeIndicatorCallbacks[t]=[]),this.state.volumeIndicatorCallbacks[t].push(e),this.sendVolumeIndicatorChange(t,!0,!0,!0,this.state.attendeeIdToExternalUserId[t])}catch(n){this.onError(n)}}realtimeUnsubscribeFromVolumeIndicator(t,e){if(!!this.state.volumeIndicatorCallbacks[t])if(e){const o=this.state.volumeIndicatorCallbacks[t].indexOf(e);o>=0&&this.state.volumeIndicatorCallbacks[t].splice(o,1)}else delete this.state.volumeIndicatorCallbacks[t]}realtimeUpdateVolumeIndicator(t,e,n,o,a){try{n=this.applyLocalMuteOverride(t,n);const s=this.getVolumeIndicatorState(t);let d=!1,u=!1,c=!1;n!==null&&s.muted!==n&&(s.muted=n,u=!0,s.muted&&s.volume!==0&&(s.volume=0,d=!0)),!s.muted&&e!==null&&(s.volume!==e&&(s.volume=e,d=!0),s.muted===null&&(s.muted=!1,u=!0)),o!==null&&s.signalStrength!==o&&(s.signalStrength=o,c=!0),this.sendVolumeIndicatorChange(t,d,u,c,a)}catch(s){this.onError(s)}}realtimeSubscribeToLocalSignalStrengthChange(t){try{if(this.state.localSignalStrengthChangeCallbacks.push(t),this.state.localAttendeeId===null)return;this.sendLocalSignalStrengthChange(this.state.localAttendeeId,!0)}catch(e){this.onError(e)}}realtimeUnsubscribeToLocalSignalStrengthChange(t){try{const e=this.state.localSignalStrengthChangeCallbacks.indexOf(t);e!==-1&&this.state.localSignalStrengthChangeCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSubscribeToSendDataMessage(t){try{this.state.sendDataMessageCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeFromSendDataMessage(t){try{const e=this.state.sendDataMessageCallbacks.indexOf(t);e!==-1&&this.state.sendDataMessageCallbacks.splice(e,1)}catch(e){this.onError(e)}}realtimeSendDataMessage(t,e,n){try{for(const o of this.state.sendDataMessageCallbacks)o(t,e,n)}catch(o){this.onError(o)}}realtimeSubscribeToReceiveDataMessage(t,e){try{this.state.receiveDataMessageCallbacks.has(t)?this.state.receiveDataMessageCallbacks.get(t).push(e):this.state.receiveDataMessageCallbacks.set(t,[e])}catch(n){this.onError(n)}}realtimeUnsubscribeFromReceiveDataMessage(t){try{this.state.receiveDataMessageCallbacks.delete(t)}catch(e){this.onError(e)}}realtimeReceiveDataMessage(t){try{if(this.state.receiveDataMessageCallbacks.has(t.topic))for(const e of this.state.receiveDataMessageCallbacks.get(t.topic))e(t)}catch(e){this.onError(e)}}realtimeSubscribeToFatalError(t){try{this.state.fatalErrorCallbacks.push(t)}catch(e){this.onError(e)}}realtimeUnsubscribeToFatalError(t){try{const e=this.state.fatalErrorCallbacks.indexOf(t);e!==-1&&this.state.fatalErrorCallbacks.splice(e,1)}catch(e){this.onError(e)}}get transcriptionController(){return this._transcriptionController}setAudioInputEnabled(t){t?this.mediaStreamBroker.unmuteLocalAudioInputStream():this.mediaStreamBroker.muteLocalAudioInputStream()}applyLocalMuteOverride(t,e){const n=this.state.localAttendeeId,o=this.state.muted;return t!==n||!("activeDevices"in this.mediaStreamBroker&&this.mediaStreamBroker.activeDevices.audio)?e:o}sendVolumeIndicatorChange(t,e,n,o,a){if(this.sendLocalSignalStrengthChange(t,o),!this.state.volumeIndicatorCallbacks.hasOwnProperty(t))return;const s=this.getVolumeIndicatorState(t),d=new RealtimeVolumeIndicator_1.default;if(e&&(d.volume=s.volume),n&&(d.muted=s.muted),o&&(d.signalStrength=s.signalStrength),!this.stateIsEmpty(d))for(const u of this.state.volumeIndicatorCallbacks[t])u(t,d.volume,d.muted,d.signalStrength,a)}sendLocalSignalStrengthChange(t,e){if(!e||t!==this.state.localAttendeeId)return;const o=this.getVolumeIndicatorState(t).signalStrength;if(o!==null)for(const a of this.state.localSignalStrengthChangeCallbacks)a(o)}getVolumeIndicatorState(t){return this.state.volumeIndicatorState.hasOwnProperty(t)||(this.state.volumeIndicatorState[t]=new RealtimeVolumeIndicator_1.default),this.state.volumeIndicatorState[t]}stateIsEmpty(t){return t.volume===null&&t.muted===null&&t.signalStrength===null}onError(t){try{for(const e of this.state.fatalErrorCallbacks)e(t)}catch(e){try{console.error(t),console.error(e)}catch{}}}}DefaultRealtimeController$1.default=DefaultRealtimeController;var DefaultSessionStateController$1={},SessionStateControllerAction={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SessionStateControllerAction=void 0;var t;(function(e){e[e.Connect=0]="Connect",e[e.FinishConnecting=1]="FinishConnecting",e[e.Update=2]="Update",e[e.FinishUpdating=3]="FinishUpdating",e[e.Reconnect=4]="Reconnect",e[e.Disconnect=5]="Disconnect",e[e.Fail=6]="Fail",e[e.FinishDisconnecting=7]="FinishDisconnecting"})(t=r.SessionStateControllerAction||(r.SessionStateControllerAction={})),r.default=t})(SessionStateControllerAction);var SessionStateControllerDeferPriority={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SessionStateControllerDeferPriority=void 0;var t;(function(e){e[e.DoNotDefer=0]="DoNotDefer",e[e.Low=1]="Low",e[e.Medium=2]="Medium",e[e.High=3]="High",e[e.VeryHigh=4]="VeryHigh"})(t=r.SessionStateControllerDeferPriority||(r.SessionStateControllerDeferPriority={})),r.default=t})(SessionStateControllerDeferPriority);var SessionStateControllerState={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SessionStateControllerState=void 0;var t;(function(e){e[e.NotConnected=0]="NotConnected",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.Updating=3]="Updating",e[e.Disconnecting=4]="Disconnecting"})(t=r.SessionStateControllerState||(r.SessionStateControllerState={})),r.default=t})(SessionStateControllerState);var SessionStateControllerTransitionResult={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SessionStateControllerTransitionResult=void 0;var t;(function(e){e[e.Transitioned=0]="Transitioned",e[e.NoTransitionAvailable=1]="NoTransitionAvailable",e[e.DeferredTransition=2]="DeferredTransition",e[e.TransitionFailed=3]="TransitionFailed"})(t=r.SessionStateControllerTransitionResult||(r.SessionStateControllerTransitionResult={})),r.default=t})(SessionStateControllerTransitionResult);Object.defineProperty(DefaultSessionStateController$1,"__esModule",{value:!0});const SessionStateControllerAction_1=SessionStateControllerAction,SessionStateControllerDeferPriority_1=SessionStateControllerDeferPriority,SessionStateControllerState_1=SessionStateControllerState,SessionStateControllerTransitionResult_1=SessionStateControllerTransitionResult;class DefaultSessionStateController{constructor(t){this.logger=t,this.currentState=SessionStateControllerState_1.SessionStateControllerState.NotConnected,this.deferredAction=null,this.deferredWork=null}perform(t,e){const n=this.currentState;if(n===SessionStateControllerState_1.SessionStateControllerState.NotConnected&&t===SessionStateControllerAction_1.SessionStateControllerAction.Connect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connecting,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Connecting&&t===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Connecting&&t===SessionStateControllerAction_1.SessionStateControllerAction.FinishConnecting)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connected,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Connected&&t===SessionStateControllerAction_1.SessionStateControllerAction.Disconnect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Connected&&t===SessionStateControllerAction_1.SessionStateControllerAction.Reconnect)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connecting,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Connected&&t===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Connected&&t===SessionStateControllerAction_1.SessionStateControllerAction.Update)this.transition(SessionStateControllerState_1.SessionStateControllerState.Updating,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Updating&&t===SessionStateControllerAction_1.SessionStateControllerAction.Fail)this.transition(SessionStateControllerState_1.SessionStateControllerState.Disconnecting,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Updating&&t===SessionStateControllerAction_1.SessionStateControllerAction.FinishUpdating)this.transition(SessionStateControllerState_1.SessionStateControllerState.Connected,t);else if(n===SessionStateControllerState_1.SessionStateControllerState.Disconnecting&&t===SessionStateControllerAction_1.SessionStateControllerAction.FinishDisconnecting)this.transition(SessionStateControllerState_1.SessionStateControllerState.NotConnected,t);else return this.canDefer(t)?(this.logger.info(`deferring transition from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with ${SessionStateControllerAction_1.SessionStateControllerAction[t]}`),this.deferAction(t,e),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.DeferredTransition):(this.logger.warn(`no transition found from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with ${SessionStateControllerAction_1.SessionStateControllerAction[t]}`),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.NoTransitionAvailable);try{e()}catch(o){return this.logger.error(`error during state ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} with action ${SessionStateControllerAction_1.SessionStateControllerAction[t]}: ${o}`),this.logger.info(`rolling back transition to ${SessionStateControllerState_1.SessionStateControllerState[n]}`),this.currentState=n,SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.TransitionFailed}return this.performDeferredAction(),SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.Transitioned}state(){return this.currentState}transition(t,e){this.logger.info(`transitioning from ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]} to ${SessionStateControllerState_1.SessionStateControllerState[t]} with ${SessionStateControllerAction_1.SessionStateControllerAction[e]}`),this.currentState=t}deferPriority(t){switch(t){case SessionStateControllerAction_1.SessionStateControllerAction.Disconnect:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.VeryHigh;case SessionStateControllerAction_1.SessionStateControllerAction.Fail:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.High;case SessionStateControllerAction_1.SessionStateControllerAction.Reconnect:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.Medium;case SessionStateControllerAction_1.SessionStateControllerAction.Update:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.Low;default:return SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.DoNotDefer}}deferAction(t,e){this.deferredAction!==null&&this.deferPriority(this.deferredAction)>this.deferPriority(t)||(this.deferredAction=t,this.deferredWork=e)}canDefer(t){return this.deferPriority(t)!==SessionStateControllerDeferPriority_1.SessionStateControllerDeferPriority.DoNotDefer&&(this.currentState===SessionStateControllerState_1.SessionStateControllerState.Connecting||this.currentState===SessionStateControllerState_1.SessionStateControllerState.Updating)}performDeferredAction(){if(!this.deferredAction)return;const t=this.deferredAction,e=this.deferredWork;this.deferredAction=null,this.deferredWork=null,this.logger.info(`performing deferred action ${SessionStateControllerAction_1.SessionStateControllerAction[t]}`),this.perform(t,e)!==SessionStateControllerTransitionResult_1.SessionStateControllerTransitionResult.Transitioned&&this.logger.info(`unable to perform deferred action ${SessionStateControllerAction_1.SessionStateControllerAction[t]} in state ${SessionStateControllerState_1.SessionStateControllerState[this.currentState]}`)}}DefaultSessionStateController$1.default=DefaultSessionStateController;var DefaultSignalingClient$1={},WebSocketReadyState={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WebSocketReadyState=void 0;var t;(function(e){e[e.None=0]="None",e[e.Connecting=1]="Connecting",e[e.Open=2]="Open",e[e.Closing=3]="Closing",e[e.Closed=4]="Closed"})(t=r.WebSocketReadyState||(r.WebSocketReadyState={})),r.default=t})(WebSocketReadyState);var ServerSideNetworkAdaption={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convertServerSideNetworkAdaptionEnumToSignaled=r.convertServerSideNetworkAdaptionEnumFromSignaled=r.ServerSideNetworkAdaption=void 0;const t=SignalingProtocol;var e;(function(a){a[a.Default=0]="Default",a[a.None=1]="None",a[a.BandwidthProbing=2]="BandwidthProbing"})(e=r.ServerSideNetworkAdaption||(r.ServerSideNetworkAdaption={})),r.default=e;function n(a){switch(a){case t.SdkServerSideNetworkAdaption.DEFAULT:return e.Default;case t.SdkServerSideNetworkAdaption.NONE:return e.None;case t.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING:return e.BandwidthProbing}}r.convertServerSideNetworkAdaptionEnumFromSignaled=n;function o(a){switch(a){case e.Default:return t.SdkServerSideNetworkAdaption.DEFAULT;case e.None:return t.SdkServerSideNetworkAdaption.NONE;case e.BandwidthProbing:return t.SdkServerSideNetworkAdaption.BANDWIDTH_PROBING}}r.convertServerSideNetworkAdaptionEnumToSignaled=o})(ServerSideNetworkAdaption);var SignalingClientEvent$1={};Object.defineProperty(SignalingClientEvent$1,"__esModule",{value:!0});const SignalingClientEventType_1$9=SignalingClientEventType;class SignalingClientEvent{constructor(t,e,n,o,a){this.client=t,this.type=e,this.message=n,this.closeCode=o,this.closeReason=a,this.timestampMs=Date.now()}isConnectionTerminated(){switch(this.type){case SignalingClientEventType_1$9.default.WebSocketFailed:case SignalingClientEventType_1$9.default.WebSocketError:case SignalingClientEventType_1$9.default.WebSocketClosing:case SignalingClientEventType_1$9.default.WebSocketClosed:return!0;default:return!1}}}SignalingClientEvent$1.default=SignalingClientEvent;Object.defineProperty(DefaultSignalingClient$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$4=DefaultBrowserBehavior$1,TimeoutScheduler_1$2=TimeoutScheduler$1,SignalingProtocol_js_1$b=SignalingProtocol,Versioning_1$6=Versioning$1,WebSocketReadyState_1$2=WebSocketReadyState,ServerSideNetworkAdaption_1$5=ServerSideNetworkAdaption,SignalingClientEvent_1=SignalingClientEvent$1,SignalingClientEventType_1$8=SignalingClientEventType;class DefaultSignalingClient{constructor(t,e){this.webSocket=t,this.logger=e,this.unloadHandler=null,this.closeEventHandler=n=>{this.deactivatePageUnloadHandler(),this.resetConnection(),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketClosed,null,n.code,n.reason)),this.serviceConnectionRequestQueue()},this.observerQueue=new Set,this.connectionRequestQueue=[],this.resetConnection(),this.logger.debug(()=>"signaling client init"),this.audioSessionId=this.generateNewAudioSessionId()}registerObserver(t){this.logger.debug(()=>"registering signaling client observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.debug(()=>"removing signaling client observer"),this.observerQueue.delete(t)}openConnection(t){this.logger.info("adding connection request to queue: "+t.url()),this.connectionRequestQueue.push(t),this.closeConnection()}pingPong(t){this.logger.debug(()=>"sending ping");const e=SignalingProtocol_js_1$b.SdkSignalFrame.create();return e.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.PING_PONG,e.pingPong=t,this.sendMessage(e),e.timestampMs}join(t){this.logger.info("sending join");const e=SignalingProtocol_js_1$b.SdkJoinFrame.create();e.protocolVersion=2,e.flags=SignalingProtocol_js_1$b.SdkJoinFlags.HAS_STREAM_UPDATE;const n=new DefaultBrowserBehavior_1$4.default,o={platformName:n.name(),platformVersion:n.version(),clientSource:Versioning_1$6.default.sdkName,chimeSdkVersion:Versioning_1$6.default.sdkVersion};if(t.applicationMetadata){const{appName:s,appVersion:d}=t.applicationMetadata;o.appName=s,o.appVersion=d}e.clientDetails=SignalingProtocol_js_1$b.SdkClientDetails.create(o),e.audioSessionId=this.audioSessionId,e.wantsCompressedSdp=DefaultSignalingClient.CLIENT_SUPPORTS_COMPRESSION,e.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$5.convertServerSideNetworkAdaptionEnumToSignaled(t.serverSideNetworkAdaption),t.serverSideNetworkAdaption===ServerSideNetworkAdaption_1$5.default.BandwidthProbing&&(e.wantsServerSideNetworkProbingOnReceiveSideEstimator=!0),e.supportedServerSideNetworkAdaptions=t.supportedServerSideNetworkAdaptions.map(ServerSideNetworkAdaption_1$5.convertServerSideNetworkAdaptionEnumToSignaled);const a=SignalingProtocol_js_1$b.SdkSignalFrame.create();a.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.JOIN,a.join=e,this.sendMessage(a)}subscribe(t){const e=SignalingProtocol_js_1$b.SdkSubscribeFrame.create();if(e.sendStreams=[],e.sdpOffer=t.sdpOffer,t.connectionTypeHasVideo&&(e.receiveStreamIds=t.receiveStreamIds),t.audioHost&&(e.audioCheckin=t.audioCheckin,e.audioHost=t.audioHost,e.audioMuted=t.audioMuted,!t.audioCheckin)){const o=SignalingProtocol_js_1$b.SdkStreamDescriptor.create();o.mediaType=SignalingProtocol_js_1$b.SdkStreamMediaType.AUDIO,o.trackLabel="AmazonChimeExpressAudio",o.attendeeId=t.attendeeId,o.streamId=1,o.groupId=1,o.framerate=15,o.maxBitrateKbps=600,o.avgBitrateBps=4e5,e.sendStreams.push(o)}if(e.compressedSdpOffer=t.compressedSdpOffer,e.duplex=SignalingProtocol_js_1$b.SdkStreamServiceType.RX,t.localVideoEnabled){e.duplex=SignalingProtocol_js_1$b.SdkStreamServiceType.DUPLEX;for(let o=0;o<t.videoStreamDescriptions.length;o++){const a=t.videoStreamDescriptions[o].clone();a.attendeeId=t.attendeeId,e.sendStreams.push(a.toStreamDescriptor())}}t.videoSubscriptionConfiguration.length>0&&(e.videoSubscriptionConfiguration=t.videoSubscriptionConfiguration.map(this.convertVideoSubscriptionConfiguration));const n=SignalingProtocol_js_1$b.SdkSignalFrame.create();n.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.SUBSCRIBE,n.sub=e,this.sendMessage(n)}remoteVideoUpdate(t,e){const n=SignalingProtocol_js_1$b.SdkRemoteVideoUpdateFrame.create();n.addedOrUpdatedVideoSubscriptions=t.map(this.convertVideoSubscriptionConfiguration),n.removedVideoSubscriptionMids=e;const o=SignalingProtocol_js_1$b.SdkSignalFrame.create();o.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.REMOTE_VIDEO_UPDATE,o.remoteVideoUpdate=n,this.sendMessage(o)}convertVideoSubscriptionConfiguration(t){const e=new SignalingProtocol_js_1$b.SdkVideoSubscriptionConfiguration;return e.mid=t.mid,e.attendeeId=t.attendeeId,e.streamId=t.streamId,e.groupId=t.groupId,e.priority=t.priority,e.targetBitrateKbps=t.targetBitrateKbps,e}leave(){const t=SignalingProtocol_js_1$b.SdkSignalFrame.create();t.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.LEAVE,t.leave=SignalingProtocol_js_1$b.SdkLeaveFrame.create(),this.sendMessage(t),this.logger.debug(()=>"sent leave")}sendClientMetrics(t){const e=SignalingProtocol_js_1$b.SdkSignalFrame.create();e.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.CLIENT_METRIC,e.clientMetric=t,this.sendMessage(e)}sendDataMessage(t){const e=SignalingProtocol_js_1$b.SdkSignalFrame.create();e.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.DATA_MESSAGE,e.dataMessage=t,this.sendMessage(e)}closeConnection(){var t,e;if(this.webSocket.readyState()!==WebSocketReadyState_1$2.default.None&&this.webSocket.readyState()!==WebSocketReadyState_1$2.default.Closed){this.isClosing=!0,this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketClosing,null));const n=new TimeoutScheduler_1$2.default(DefaultSignalingClient.CLOSE_EVENT_TIMEOUT_MS),o=a=>{var s,d;(d=(s=this.webSocket).removeEventListener)===null||d===void 0||d.call(s,"close",o),n.stop(),this.closeEventHandler(a)};(e=(t=this.webSocket).removeEventListener)===null||e===void 0||e.call(t,"close",this.closeEventHandler),this.webSocket.addEventListener("close",o),n.start(()=>{o(new CloseEvent("close",{wasClean:!1,code:1006,reason:"",bubbles:!1}))}),this.webSocket.close(),this.deactivatePageUnloadHandler()}else this.logger.info("no existing signaling client connection needs closing"),this.serviceConnectionRequestQueue()}ready(){return this.webSocket.readyState()===WebSocketReadyState_1$2.default.Open&&!this.isClosing&&this.wasOpened}mute(t){const e=SignalingProtocol_js_1$b.SdkSignalFrame.create();e.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.AUDIO_CONTROL;const n=SignalingProtocol_js_1$b.SdkAudioControlFrame.create();n.muted=t,e.audioControl=n,this.sendMessage(e)}pause(t){const e=SignalingProtocol_js_1$b.SdkSignalFrame.create();e.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.PAUSE,e.pause=SignalingProtocol_js_1$b.SdkPauseResumeFrame.create(),e.pause.streamIds=t,this.sendMessage(e)}resume(t){const e=SignalingProtocol_js_1$b.SdkSignalFrame.create();e.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.RESUME,e.pause=SignalingProtocol_js_1$b.SdkPauseResumeFrame.create(),e.pause.streamIds=t,this.sendMessage(e)}resetConnection(){this.webSocket.destroy(),this.wasOpened=!1}sendMessage(t){t.timestampMs=Date.now(),this.logger.debug(()=>`sending: ${JSON.stringify(t)}`);const e=this.prependWithFrameTypeRTC(SignalingProtocol_js_1$b.SdkSignalFrame.encode(t).finish());if(this.ready()){if(!this.webSocket.send(e)){this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketSendMessageFailure,null));return}this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketSentMessage,null))}else this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketSkippedMessage,null))}receiveMessage(t){let e;try{e=SignalingProtocol_js_1$b.SdkSignalFrame.decode(t)}catch{this.logger.info(`failed to decode: ${t}`),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.ProtocolDecodeFailure,null));return}this.logger.debug(()=>`received: ${JSON.stringify(e)}`),this.webSocket.readyState()===WebSocketReadyState_1$2.default.Open?this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.ReceivedSignalFrame,e)):this.logger.info(`skipping notification of message since WebSocket is not open: ${JSON.stringify(e)}`)}stripFrameTypeRTC(t){const e=t[0];return e!==DefaultSignalingClient.FRAME_TYPE_RTC&&e!==2&&this.logger.warn(`expected FrameTypeRTC for message but got ${e}`),t.slice(1)}prependWithFrameTypeRTC(t){const e=new Uint8Array(t.length+1);return e[0]=DefaultSignalingClient.FRAME_TYPE_RTC,e.set(t,1),e}serviceConnectionRequestQueue(){if(this.connectionRequestQueue.length===0){this.logger.info("no connection requests to service");return}const t=this.connectionRequestQueue.shift();this.logger.info(`opening connection to ${t.url()}`),this.isClosing=!1,this.webSocket.create(t.url(),t.protocols()),this.setUpEventListeners(),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketConnecting,null))}sendEvent(t){switch(t.type){case SignalingClientEventType_1$8.default.WebSocketMessage:case SignalingClientEventType_1$8.default.ReceivedSignalFrame:case SignalingClientEventType_1$8.default.WebSocketSentMessage:this.logger.debug(()=>`notifying event: ${SignalingClientEventType_1$8.default[t.type]}`);break;case SignalingClientEventType_1$8.default.WebSocketSkippedMessage:this.logger.debug(()=>`notifying event: ${SignalingClientEventType_1$8.default[t.type]}, websocket state=${WebSocketReadyState_1$2.default[this.webSocket.readyState()]}`);break;default:this.logger.info(`notifying event: ${SignalingClientEventType_1$8.default[t.type]}`);break}for(const e of this.observerQueue)e.handleSignalingClientEvent(t)}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.activatePageUnloadHandler(),this.wasOpened=!0,this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketOpen,null))}),this.webSocket.addEventListener("message",t=>{this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketMessage,null)),this.receiveMessage(this.stripFrameTypeRTC(new Uint8Array(t.data)))}),this.webSocket.addEventListener("close",this.closeEventHandler),this.webSocket.addEventListener("error",()=>{if(this.isClosing&&!this.wasOpened){this.logger.info("ignoring error closing signaling while connecting");return}this.wasOpened?(this.logger.error("received error while connected"),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketError,null))):(this.logger.error("failed to connect"),this.sendEvent(new SignalingClientEvent_1.default(this,SignalingClientEventType_1$8.default.WebSocketFailed,null)))})}activatePageUnloadHandler(){this.unloadHandler=()=>{this.leave()};const t=commonjsGlobal;t.window&&t.window.addEventListener&&window.addEventListener("unload",this.unloadHandler)}deactivatePageUnloadHandler(){const t=commonjsGlobal;t.window&&t.window.removeEventListener&&window.removeEventListener("unload",this.unloadHandler),this.unloadHandler=null}generateNewAudioSessionId(){const t=new Uint32Array(1);return window.crypto.getRandomValues(t)[0]}promoteToPrimaryMeeting(t){const e=SignalingProtocol_js_1$b.SdkMeetingSessionCredentials.create();e.attendeeId=t.attendeeId,e.externalUserId=t.externalUserId,e.joinToken=t.joinToken;const n=SignalingProtocol_js_1$b.SdkPrimaryMeetingJoinFrame.create();n.credentials=e;const o=SignalingProtocol_js_1$b.SdkSignalFrame.create();o.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN,o.primaryMeetingJoin=n,this.sendMessage(o)}demoteFromPrimaryMeeting(){const t=SignalingProtocol_js_1$b.SdkPrimaryMeetingLeaveFrame.create(),e=SignalingProtocol_js_1$b.SdkSignalFrame.create();e.type=SignalingProtocol_js_1$b.SdkSignalFrame.Type.PRIMARY_MEETING_LEAVE,e.primaryMeetingLeave=t,this.sendMessage(e)}}DefaultSignalingClient$1.default=DefaultSignalingClient;DefaultSignalingClient.FRAME_TYPE_RTC=5;DefaultSignalingClient.CLOSE_EVENT_TIMEOUT_MS=2e3;DefaultSignalingClient.CLIENT_SUPPORTS_COMPRESSION=!0;var SignalingClientVideoSubscriptionConfiguration$1={};Object.defineProperty(SignalingClientVideoSubscriptionConfiguration$1,"__esModule",{value:!0});class SignalingClientVideoSubscriptionConfiguration{}SignalingClientVideoSubscriptionConfiguration$1.default=SignalingClientVideoSubscriptionConfiguration;var StatsCollector$1={},StreamMetricReport$1={};Object.defineProperty(StreamMetricReport$1,"__esModule",{value:!0});class StreamMetricReport{constructor(){this.previousMetrics={},this.currentMetrics={}}}StreamMetricReport$1.default=StreamMetricReport;var MeetingSessionLifecycleEvent={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.MeetingSessionLifecycleEvent=void 0;var t;(function(e){e[e.Connecting=0]="Connecting",e[e.Started=1]="Started",e[e.Stopped=2]="Stopped"})(t=r.MeetingSessionLifecycleEvent||(r.MeetingSessionLifecycleEvent={})),r.default=t})(MeetingSessionLifecycleEvent);var MeetingSessionLifecycleEventCondition={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.MeetingSessionLifecycleEventCondition=void 0;var t;(function(e){e[e.ConnectingNew=0]="ConnectingNew",e[e.ReconnectingExisting=1]="ReconnectingExisting",e[e.StartedNew=2]="StartedNew",e[e.StartedExisting=3]="StartedExisting",e[e.StartedAfterReconnect=4]="StartedAfterReconnect",e[e.StoppedCleanly=5]="StoppedCleanly",e[e.StoppedWithFailure=6]="StoppedWithFailure"})(t=r.MeetingSessionLifecycleEventCondition||(r.MeetingSessionLifecycleEventCondition={})),r.default=t})(MeetingSessionLifecycleEventCondition);var __awaiter$I=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(StatsCollector$1,"__esModule",{value:!0});const ClientMetricReport_1=ClientMetricReport$1,ClientMetricReportDirection_1$2=ClientMetricReportDirection,ClientMetricReportMediaType_1$2=ClientMetricReportMediaType,StreamMetricReport_1=StreamMetricReport$1,MeetingSessionLifecycleEvent_1=MeetingSessionLifecycleEvent,MeetingSessionLifecycleEventCondition_1=MeetingSessionLifecycleEventCondition,IntervalScheduler_1$2=IntervalScheduler$1,SignalingProtocol_js_1$a=SignalingProtocol,Types_1$5=Types,AudioLogEvent_1$1=AudioLogEvent,VideoLogEvent_1=VideoLogEvent;class StatsCollector{constructor(t,e,n=StatsCollector.INTERVAL_MS){this.audioVideoController=t,this.logger=e,this.interval=n,this.intervalScheduler=null,this.metricsAddTime=(o,a,s)=>{},this.metricsLogEvent=(o,a)=>{}}toAttribute(t){return this.toSuffix(t).substring(1)}toSuffix(t){return t.toLowerCase()===t?`_${t}`:t.toUpperCase()===t?`_${t.toLowerCase()}`:t.replace(/([A-Z][a-z]+)/g,function(e){return`_${e}`}).replace(/([A-Z][A-Z]+)/g,function(e){return`_${e}`}).toLowerCase()}logLatency(t,e,n){const o=this.toSuffix(t);this.logEventTime("meeting"+o,e,n)}logStateTimeout(t,e){const n=this.toSuffix(t);this.logEvent("meeting_session_state_timeout",Object.assign(Object.assign({},e),{state:`state${n}`}))}logAudioEvent(t,e){const n="audio"+this.toSuffix(AudioLogEvent_1$1.default[t]);this.logEvent(n,e)}logVideoEvent(t,e){const n="video"+this.toSuffix(VideoLogEvent_1.default[t]);this.logEvent(n,e)}logEventTime(t,e,n={}){const o=Object.assign(Object.assign({},n),{call_id:this.audioVideoController.configuration.meetingId,client_type:StatsCollector.CLIENT_TYPE,metric_type:"latency"});this.logger.debug(()=>`[StatsCollector] ${t}: ${JSON.stringify(o)}`),this.metricsAddTime(t,e,o)}logMeetingSessionStatus(t){const e=`${t.statusCode()}`;this.logEvent(e);const n={status:e,status_code:`${t.statusCode()}`};this.logEvent("meeting_session_status",n),t.isTerminal()&&this.logEvent("meeting_session_stopped",n),t.isAudioConnectionFailure()&&this.logEvent("meeting_session_audio_failed",n),t.isFailure()&&this.logEvent("meeting_session_failed",n)}logLifecycleEvent(t,e){const n={lifecycle_event:`lifecycle${this.toSuffix(MeetingSessionLifecycleEvent_1.default[t])}`,lifecycle_event_code:`${t}`,lifecycle_event_condition:`condition${this.toSuffix(MeetingSessionLifecycleEventCondition_1.default[e])}`,lifecycle_event_condition_code:`${e}`};this.logEvent("meeting_session_lifecycle",n)}logEvent(t,e={}){const n=Object.assign(Object.assign({},e),{call_id:this.audioVideoController.configuration.meetingId,client_type:StatsCollector.CLIENT_TYPE});this.logger.debug(()=>`[StatsCollector] ${t}: ${JSON.stringify(n)}`),this.metricsLogEvent(t,n)}start(t,e){return this.intervalScheduler?!1:(this.logger.info("Starting StatsCollector"),this.signalingClient=t,this.videoStreamIndex=e,this.clientMetricReport=new ClientMetricReport_1.default(this.logger,this.videoStreamIndex,this.audioVideoController.configuration.credentials.attendeeId),this.intervalScheduler=new IntervalScheduler_1$2.default(this.interval),this.intervalScheduler.start(()=>__awaiter$I(this,void 0,void 0,function*(){yield this.getStatsWrapper()})),!0)}stop(){this.logger.info("Stopping StatsCollector"),this.intervalScheduler&&this.intervalScheduler.stop(),this.intervalScheduler=null}updateMetricValues(t,e){const n=e?this.clientMetricReport.streamMetricReports[Number(t.ssrc)]:this.clientMetricReport.globalMetricReport;let o;e?o=this.clientMetricReport.getMetricMap(n.mediaType,n.direction):o=this.clientMetricReport.getMetricMap();for(const a in t)a in o&&(n.previousMetrics[a]=n.currentMetrics[a],n.currentMetrics[a]=t[a])}processRawMetricReports(t){this.clientMetricReport.currentSsrcs={};const e=Date.now();for(const n of t){const o=this.isStreamRawMetricReport(n.type);if(o){const a=this.clientMetricReport.streamMetricReports[Number(n.ssrc)];if(a)a.streamId=this.videoStreamIndex.streamIdForSSRC(Number(n.ssrc));else{const s=new StreamMetricReport_1.default;s.mediaType=this.getMediaType(n),s.direction=this.getDirectionType(n),this.videoStreamIndex.allStreams().empty()||(s.streamId=this.videoStreamIndex.streamIdForSSRC(Number(n.ssrc))),this.clientMetricReport.streamMetricReports[Number(n.ssrc)]=s}this.clientMetricReport.currentSsrcs[Number(n.ssrc)]=1}this.updateMetricValues(n,o)}this.clientMetricReport.removeDestroyedSsrcs(),this.clientMetricReport.previousTimestampMs=this.clientMetricReport.currentTimestampMs,this.clientMetricReport.currentTimestampMs=e,this.clientMetricReport.print()}addMetricFrame(t,e,n,o){const a=n.type,s=n.transform,d=n.source,u=e.streamMetricFrames.length,c=e.streamMetricFrames[u-1];if(a){const l=SignalingProtocol_js_1$a.SdkMetric.create();l.type=a,l.value=s(d||t,o),o?c.metrics.push(l):e.globalMetrics.push(l)}}addGlobalMetricsToProtobuf(t){const e=this.clientMetricReport.getMetricMap();for(const n in this.clientMetricReport.globalMetricReport.currentMetrics)this.addMetricFrame(n,t,e[n])}addStreamMetricsToProtobuf(t){for(const e in this.clientMetricReport.streamMetricReports){const n=this.clientMetricReport.streamMetricReports[e],o=SignalingProtocol_js_1$a.SdkStreamMetricFrame.create();o.streamId=n.streamId,o.metrics=[],t.streamMetricFrames.push(o);const a=this.clientMetricReport.getMetricMap(n.mediaType,n.direction);for(const s in n.currentMetrics)this.addMetricFrame(s,t,a[s],Number(e))}}makeClientMetricProtobuf(){const t=SignalingProtocol_js_1$a.SdkClientMetricFrame.create();return t.globalMetrics=[],t.streamMetricFrames=[],this.addGlobalMetricsToProtobuf(t),this.addStreamMetricsToProtobuf(t),t}sendClientMetricProtobuf(t){this.signalingClient.sendClientMetrics(t)}isStreamRawMetricReport(t){return["inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp"].includes(t)}getMediaType(t){return t.kind==="audio"?ClientMetricReportMediaType_1$2.default.AUDIO:ClientMetricReportMediaType_1$2.default.VIDEO}getDirectionType(t){const{type:e}=t;return e==="inbound-rtp"||e==="remote-outbound-rtp"?ClientMetricReportDirection_1$2.default.DOWNSTREAM:ClientMetricReportDirection_1$2.default.UPSTREAM}isValidStandardRawMetric(t){return t.type==="inbound-rtp"||t.type==="outbound-rtp"||t.type==="remote-inbound-rtp"||t.type==="remote-outbound-rtp"||t.type==="candidate-pair"&&t.state==="succeeded"}isValidSsrc(t){let e=!0;return this.isStreamRawMetricReport(t.type)&&this.getDirectionType(t)===ClientMetricReportDirection_1$2.default.DOWNSTREAM&&this.getMediaType(t)===ClientMetricReportMediaType_1$2.default.VIDEO&&(e=this.videoStreamIndex.streamIdForSSRC(Number(t.ssrc))>0),e}isValidRawMetricReport(t){return this.isValidStandardRawMetric(t)&&this.isValidSsrc(t)}filterRawMetricReports(t){const e=[];for(const n of t)this.isValidRawMetricReport(n)&&e.push(n);return e}handleRawMetricReports(t){const e=this.filterRawMetricReports(t);this.logger.debug(()=>`Filtered raw metrics : ${JSON.stringify(e)}`),this.processRawMetricReports(e);const n=this.makeClientMetricProtobuf();this.sendClientMetricProtobuf(n),this.audioVideoController.forEachObserver(o=>{Types_1$5.Maybe.of(o.metricsDidReceive).map(a=>a.bind(o)(this.clientMetricReport.clone()))})}getStatsWrapper(){return __awaiter$I(this,void 0,void 0,function*(){if(!this.audioVideoController.rtcPeerConnection)return;const t=[];try{const e=yield this.audioVideoController.rtcPeerConnection.getStats();this.clientMetricReport.rtcStatsReport=e,e.forEach(n=>{t.push(n)}),this.handleRawMetricReports(t)}catch(e){this.logger.error(e.message)}})}}StatsCollector$1.default=StatsCollector;StatsCollector.INTERVAL_MS=1e3;StatsCollector.CLIENT_TYPE="amazon-chime-sdk-js";var FinishGatheringICECandidatesTask$1={},__awaiter$H=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(FinishGatheringICECandidatesTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$5=MeetingSessionStatusCode,SDP_1$3=SDP$1,BaseTask_1$j=BaseTask$1;class FinishGatheringICECandidatesTask extends BaseTask_1$j.default{constructor(t,e=FinishGatheringICECandidatesTask.CHROME_VPN_TIMEOUT_MS){super(t.logger),this.context=t,this.chromeVpnTimeoutMs=e,this.taskName="FinishGatheringICECandidatesTask"}removeEventListener(){this.context.peer&&(this.context.peer.removeEventListener("icecandidate",this.context.iceCandidateHandler),this.context.turnCredentials||this.context.peer.removeEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler))}cancel(){let t;this.context.browserBehavior.requiresIceCandidateGatheringTimeoutWorkaround()&&this.chromeVpnTimeoutMs<this.context.meetingSessionConfiguration.connectionTimeoutMs&&Date.now()-this.startTimestampMs>this.chromeVpnTimeoutMs&&(t=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$5.default.ICEGatheringTimeoutWorkaround}`)),this.cancelPromise&&(t=t||new Error(`canceling ${this.name()}`),this.cancelPromise(t),delete this.cancelPromise)}run(){return __awaiter$H(this,void 0,void 0,function*(){if(this.context.peer||this.logAndThrow("session does not have peer connection; bypass ice gathering"),this.context.browserBehavior.requiresCheckForSdpConnectionAttributes()){if(new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidatesForAllMLines()){this.context.logger.info(`ice gathering already complete; bypass gathering, current local description ${this.context.peer.localDescription.sdp}`);return}}else this.context.logger.info(`iOS device does not require checking for connection attributes in SDP, current local description ${this.context.peer.localDescription.sdp}`);if((this.context.browserBehavior.hasFirefoxWebRTC()||this.context.peer.iceGatheringState==="complete")&&new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidates()){this.context.logger.info("ice gathering state is complete and candidates are in SDP; bypass gathering");return}try{yield new Promise((t,e)=>{this.cancelPromise=n=>{this.removeEventListener(),e(n)},this.context.turnCredentials||(this.context.iceGatheringStateEventHandler=()=>{if(this.context.peer.iceGatheringState==="complete"){this.removeEventListener(),t(),delete this.cancelPromise;return}},this.context.peer.addEventListener("icegatheringstatechange",this.context.iceGatheringStateEventHandler)),this.context.iceCandidateHandler=n=>{if(this.context.logger.info(`ice candidate: ${n.candidate?n.candidate.candidate:"(null)"} state: ${this.context.peer.iceGatheringState}`),n.candidate&&(SDP_1$3.default.isRTPCandidate(n.candidate.candidate)&&this.context.iceCandidates.push(n.candidate),this.context.turnCredentials&&this.context.iceCandidates.length>=1)){this.context.logger.info("gathered at least one relay candidate"),this.removeEventListener(),t(),delete this.cancelPromise;return}this.context.peer.iceGatheringState==="complete"&&(this.context.logger.info("done gathering ice candidates"),this.removeEventListener(),!new SDP_1$3.default(this.context.peer.localDescription.sdp).hasCandidates()||this.context.iceCandidates.length===0?(e(new Error("no ice candidates were gathered")),delete this.cancelPromise):(t(),delete this.cancelPromise))},this.context.peer.addEventListener("icecandidate",this.context.iceCandidateHandler),this.startTimestampMs=Date.now()})}catch(t){throw t}finally{this.startTimestampMs&&(this.context.iceGatheringDurationMs=Math.round(Date.now()-this.startTimestampMs))}})}}FinishGatheringICECandidatesTask$1.default=FinishGatheringICECandidatesTask;FinishGatheringICECandidatesTask.CHROME_VPN_TIMEOUT_MS=5e3;var JoinAndReceiveIndexTask$1={},MeetingSessionTURNCredentials$1={};Object.defineProperty(MeetingSessionTURNCredentials$1,"__esModule",{value:!0});class MeetingSessionTURNCredentials{constructor(){this.username=null,this.password=null,this.ttl=null,this.uris=null}}MeetingSessionTURNCredentials$1.default=MeetingSessionTURNCredentials;var SignalingClientJoin$1={};Object.defineProperty(SignalingClientJoin$1,"__esModule",{value:!0});const ServerSideNetworkAdaption_1$4=ServerSideNetworkAdaption;class SignalingClientJoin{constructor(t){this.applicationMetadata=t,this.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$4.default.Default,this.supportedServerSideNetworkAdaptions=[]}}SignalingClientJoin$1.default=SignalingClientJoin;var __awaiter$G=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(JoinAndReceiveIndexTask$1,"__esModule",{value:!0});const MeetingSessionStatus_1$2=MeetingSessionStatus$1,MeetingSessionStatusCode_1$4=MeetingSessionStatusCode,MeetingSessionTURNCredentials_1$1=MeetingSessionTURNCredentials$1,ServerSideNetworkAdaption_1$3=ServerSideNetworkAdaption,SignalingClientEventType_1$7=SignalingClientEventType,SignalingClientJoin_1=SignalingClientJoin$1,SignalingProtocol_js_1$9=SignalingProtocol,BaseTask_1$i=BaseTask$1;class JoinAndReceiveIndexTask extends BaseTask_1$i.default{constructor(t){super(t.logger),this.context=t,this.taskName="JoinAndReceiveIndexTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$G(this,void 0,void 0,function*(){const t=yield new Promise((e,n)=>{const o=this.context;o.turnCredentials=null;class a{constructor(c){this.signalingClient=c}cancel(){this.signalingClient.removeObserver(this),n(new Error("JoinAndReceiveIndexTask got canceled while waiting for SdkIndexFrame"))}handleSignalingClientEvent(c){if(c.type===SignalingClientEventType_1$7.default.WebSocketClosed){let f=`The signaling connection was closed with code ${c.closeCode} and reason: ${c.closeReason}`;o.logger.warn(f);let h=MeetingSessionStatusCode_1$4.default.SignalingBadRequest;c.closeCode===4410?(f="The meeting already ended.",o.logger.warn(f),h=MeetingSessionStatusCode_1$4.default.MeetingEnded):c.closeCode>=4500&&c.closeCode<4600&&(h=MeetingSessionStatusCode_1$4.default.SignalingInternalServerError),o.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$2.default(h),new Error(f));return}if(c.type!==SignalingClientEventType_1$7.default.ReceivedSignalFrame)return;if(c.message.type===SignalingProtocol_js_1$9.SdkSignalFrame.Type.JOIN_ACK){const f=c.message.joinack;if(f&&f.videoSubscriptionLimit&&(o.videoSubscriptionLimit=f.videoSubscriptionLimit),o.serverSupportsCompression=f==null?void 0:f.wantsCompressedSdp,(f==null?void 0:f.defaultServerSideNetworkAdaption)!==void 0&&f.defaultServerSideNetworkAdaption!==ServerSideNetworkAdaption_1$3.default.Default&&o.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption!==void 0){const h=f.defaultServerSideNetworkAdaption;o.logger.info(`Overriding server side network adaption value to ${h}`),o.videoDownlinkBandwidthPolicy.setServerSideNetworkAdaption(ServerSideNetworkAdaption_1$3.convertServerSideNetworkAdaptionEnumFromSignaled(h))}f&&f.turnCredentials?(o.turnCredentials=new MeetingSessionTURNCredentials_1$1.default,o.turnCredentials.username=f.turnCredentials.username,o.turnCredentials.password=f.turnCredentials.password,o.turnCredentials.ttl=f.turnCredentials.ttl,o.turnCredentials.uris=f.turnCredentials.uris.map(h=>o.meetingSessionConfiguration.urls.urlRewriter(h)).filter(h=>!!h)):o.logger.error("missing TURN credentials in JoinAckFrame");return}if(c.message.type!==SignalingProtocol_js_1$9.SdkSignalFrame.Type.INDEX)return;this.signalingClient.removeObserver(this);const l=c.message.index;e(l)}}const s=new a(this.context.signalingClient);this.context.signalingClient.registerObserver(s),this.taskCanceler=s,this.context.previousSdpAnswerAsString="",this.context.previousSdpOffer=null,this.context.serverSupportsCompression=!1;const d=new SignalingClientJoin_1.default(this.context.meetingSessionConfiguration.applicationMetadata);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions!==void 0&&(d.serverSideNetworkAdaption=this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption(),d.supportedServerSideNetworkAdaptions=this.context.videoDownlinkBandwidthPolicy.supportedServerSideNetworkAdaptions()),this.context.signalingClient.join(d)});this.context.logger.info(`received first index ${JSON.stringify(t)}`),this.context.indexFrame=t})}}JoinAndReceiveIndexTask$1.default=JoinAndReceiveIndexTask;var LeaveAndReceiveLeaveAckTask$1={},__awaiter$F=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(LeaveAndReceiveLeaveAckTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$6=SignalingClientEventType,SignalingProtocol_js_1$8=SignalingProtocol,BaseTask_1$h=BaseTask$1;class LeaveAndReceiveLeaveAckTask extends BaseTask_1$h.default{constructor(t){super(t.logger),this.context=t,this.taskName="LeaveAndReceiveLeaveAckTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$F(this,void 0,void 0,function*(){this.context.signalingClient.ready()&&(this.context.signalingClient.leave(),this.context.logger.info("sent leave"),yield this.receiveLeaveAck())})}receiveLeaveAck(){return new Promise((t,e)=>{class n{constructor(s,d){this.signalingClient=s,this.logger=d}cancel(){this.signalingClient.removeObserver(this),e(new Error("LeaveAndReceiveLeaveAckTask got canceled while waiting for IndexFrame"))}handleSignalingClientEvent(s){if(s.isConnectionTerminated()){this.signalingClient.removeObserver(this),this.logger.info("LeaveAndReceiveLeaveAckTask connection terminated"),t();return}s.type===SignalingClientEventType_1$6.default.ReceivedSignalFrame&&s.message.type===SignalingProtocol_js_1$8.SdkSignalFrame.Type.LEAVE_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("got leave ack"),t())}}const o=new n(this.context.signalingClient,this.context.logger);this.taskCanceler=o,this.context.signalingClient.registerObserver(o)})}}LeaveAndReceiveLeaveAckTask$1.default=LeaveAndReceiveLeaveAckTask;var ListenForVolumeIndicatorsTask$1={},__awaiter$E=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(ListenForVolumeIndicatorsTask$1,"__esModule",{value:!0});const SignalingClientEventType_1$5=SignalingClientEventType,SignalingProtocol_js_1$7=SignalingProtocol,BaseTask_1$g=BaseTask$1;class ListenForVolumeIndicatorsTask extends BaseTask_1$g.default{constructor(t){super(t.logger),this.context=t,this.taskName="ListenForVolumeIndicatorsTask",this.realtimeMuteAndUnmuteHandler=e=>{this.context.signalingClient.mute(e)}}run(){return __awaiter$E(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(this.realtimeMuteAndUnmuteHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(t){if(t.type===SignalingClientEventType_1$5.default.ReceivedSignalFrame){if(t.message.type===SignalingProtocol_js_1$7.SdkSignalFrame.Type.AUDIO_STREAM_ID_INFO){const e=t.message.audioStreamIdInfo;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioStreamIdInfo(e)}else if(t.message.type===SignalingProtocol_js_1$7.SdkSignalFrame.Type.AUDIO_METADATA){const e=t.message.audioMetadata;this.context.volumeIndicatorAdapter.sendRealtimeUpdatesForAudioMetadata(e)}}}}ListenForVolumeIndicatorsTask$1.default=ListenForVolumeIndicatorsTask;var MonitorTask$1={},ReconnectionHealthPolicy$1={};Object.defineProperty(ReconnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1$1=BaseConnectionHealthPolicy$1;class ReconnectionHealthPolicy extends BaseConnectionHealthPolicy_1$1.default{constructor(t,e,n){super(e,n),this.logger=t,this.audioDelayPointsOverMaximum=0,ReconnectionHealthPolicy.CONNECTION_UNHEALTHY_THRESHOLD=e.connectionUnhealthyThreshold,ReconnectionHealthPolicy.CONNECTION_WAIT_TIME_MS=e.connectionWaitTimeMs,ReconnectionHealthPolicy.MISSED_PONGS_THRESHOLD=e.missedPongsUpperThreshold,ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_MS=e.maximumAudioDelayMs,ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_DATA_POINTS=e.maximumAudioDelayDataPoints}health(){if(this.currentData.isConnectionStartRecent(ReconnectionHealthPolicy.CONNECTION_WAIT_TIME_MS))return 1;const e=this.currentData.consecutiveStatsWithNoPackets>=ReconnectionHealthPolicy.CONNECTION_UNHEALTHY_THRESHOLD,n=this.currentData.consecutiveMissedPongs>=ReconnectionHealthPolicy.MISSED_PONGS_THRESHOLD;this.currentData.audioSpeakerDelayMs>ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_MS?this.audioDelayPointsOverMaximum+=1:this.audioDelayPointsOverMaximum=0;const o=this.audioDelayPointsOverMaximum>ReconnectionHealthPolicy.MAXIMUM_AUDIO_DELAY_DATA_POINTS;return o&&(this.audioDelayPointsOverMaximum=0),e||n||o?(this.logger.warn(`reconnection recommended due to: no packets received: ${e}, missed pongs: ${n}, bad audio delay: ${o}`),0):1}}ReconnectionHealthPolicy$1.default=ReconnectionHealthPolicy;var UnusableAudioWarningConnectionHealthPolicy$1={};Object.defineProperty(UnusableAudioWarningConnectionHealthPolicy$1,"__esModule",{value:!0});const BaseConnectionHealthPolicy_1=BaseConnectionHealthPolicy$1;class UnusableAudioWarningConnectionHealthPolicy extends BaseConnectionHealthPolicy_1.default{constructor(t,e){super(t,e),this.coolDownTimeMs=t.cooldownTimeMs,this.pastSamplesToConsider=t.pastSamplesToConsider,this.fractionalLoss=t.fractionalLoss,this.packetsExpected=t.packetsExpected,this.maximumTimesToWarn=t.maximumTimesToWarn,this.lastWarnTimestampMs=0,this.warnCount=0}calculateFractionalLoss(){if(this.currentData.packetsReceivedInLastMinute.length<this.pastSamplesToConsider)return 0;const t=this.pastSamplesToConsider,e=t*this.packetsExpected;let n=0;for(let o=0;o<t;o++)n+=this.currentData.packetsReceivedInLastMinute[o];return Math.min(Math.max(1-n/e,0),1)}health(){return Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs?this.currentHealth:this.calculateFractionalLoss()>=this.fractionalLoss?this.currentHealth!==0&&(this.lastWarnTimestampMs=Date.now(),this.warnCount++,this.warnCount>this.maximumTimesToWarn)?1:0:1}}UnusableAudioWarningConnectionHealthPolicy$1.default=UnusableAudioWarningConnectionHealthPolicy;var __awaiter$D=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(MonitorTask$1,"__esModule",{value:!0});const ClientMetricReportDirection_1$1=ClientMetricReportDirection,ClientMetricReportMediaType_1$1=ClientMetricReportMediaType,ClientVideoStreamReceivingReport_1=ClientVideoStreamReceivingReport$1,ReconnectionHealthPolicy_1=ReconnectionHealthPolicy$1,UnusableAudioWarningConnectionHealthPolicy_1=UnusableAudioWarningConnectionHealthPolicy$1,MeetingSessionStatus_1$1=MeetingSessionStatus$1,MeetingSessionStatusCode_1$3=MeetingSessionStatusCode,SignalingClientEventType_1$4=SignalingClientEventType,SignalingProtocol_1=SignalingProtocol,AudioLogEvent_1=AudioLogEvent,Types_1$4=Types,BaseTask_1$f=BaseTask$1;class MonitorTask extends BaseTask_1$f.default{constructor(t,e,n){super(t.logger),this.context=t,this.initialConnectionHealthData=n,this.taskName="MonitorTask",this.prevSignalStrength=1,this.currentVideoDownlinkBandwidthEstimationKbps=1e4,this.currentAvailableStreamAvgBitrates=null,this.hasSignalingError=!1,this.presenceHandlerCalled=!1,this.isResubscribeCheckPaused=!1,this.pendingMetricsReport=void 0,this.checkAndSendWeakSignalEvent=o=>{const a=o<1,s=this.prevSignalStrength<1,d=a?s?null:AudioLogEvent_1.default.RedmicStartLoss:s?AudioLogEvent_1.default.RedmicEndLoss:null;d&&this.context.statsCollector.logAudioEvent(d),this.prevSignalStrength=o},this.realtimeFatalErrorCallback=o=>{this.logger.error(`realtime error: ${o}: ${o.stack}`),this.context.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$1.default(MeetingSessionStatusCode_1$3.default.RealtimeApiFailed),o)},this.realtimeAttendeeIdPresenceHandler=(o,a)=>{var s;const d=this.context.meetingSessionConfiguration.credentials.attendeeId;this.logger.info(`attendeePresenceReceived: ${d}`),d===o&&a&&!this.presenceHandlerCalled&&(this.presenceHandlerCalled=!0,this.context.attendeePresenceDurationMs=Date.now()-this.context.startAudioVideoTimestamp,(s=this.context.eventController)===null||s===void 0||s.publishEvent("attendeePresenceReceived",{attendeePresenceDurationMs:this.context.attendeePresenceDurationMs}))},this.generateAudioVideoEventAttributes=()=>{const{signalingOpenDurationMs:o,poorConnectionCount:a,startTimeMs:s,iceGatheringDurationMs:d,attendeePresenceDurationMs:u,meetingStartDurationMs:c}=this.context;return{maxVideoTileCount:this.context.maxVideoTileCount,meetingDurationMs:s===null?0:Math.round(Date.now()-s),signalingOpenDurationMs:o,iceGatheringDurationMs:d,attendeePresenceDurationMs:u,poorConnectionCount:a,meetingStartDurationMs:c}},this.reconnectionHealthPolicy=new ReconnectionHealthPolicy_1.default(t.logger,Object.assign({},e),this.initialConnectionHealthData.clone()),this.unusableAudioWarningHealthPolicy=new UnusableAudioWarningConnectionHealthPolicy_1.default(Object.assign({},e),this.initialConnectionHealthData.clone())}removeObserver(){this.context.audioVideoController.removeObserver(this),this.context.realtimeController.realtimeUnsubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.signalingClient.removeObserver(this)}run(){return __awaiter$D(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.audioVideoController.addObserver(this),this.context.realtimeController.realtimeSubscribeToFatalError(this.realtimeFatalErrorCallback),this.context.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(this.checkAndSendWeakSignalEvent),this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(this.realtimeAttendeeIdPresenceHandler),this.context.connectionMonitor.start(),this.context.statsCollector.start(this.context.signalingClient,this.context.videoStreamIndex),this.context.signalingClient.registerObserver(this)})}pauseResubscribeCheck(){this.isResubscribeCheckPaused=!0}resumeResubscribeCheck(){!this.isResubscribeCheckPaused||(this.isResubscribeCheckPaused=!1,this.pendingMetricsReport&&(this.context.logger.info("Resuming resubscribe check with pending metrics report"),this.checkResubscribe(this.pendingMetricsReport)&&this.context.audioVideoController.update({needsRenegotiation:!1})))}videoTileDidUpdate(t){this.context.maxVideoTileCount=Math.max(this.context.maxVideoTileCount,this.context.videoTileController.getAllVideoTiles().length)}checkResubscribe(t){if(this.isResubscribeCheckPaused){this.context.logger.info("Resubscribe check is paused, setting incoming client metric report as pending"),this.pendingMetricsReport=t;return}else this.pendingMetricsReport=void 0;const e=t.getObservableMetrics();if(!e)return!1;const n=e.availableOutgoingBitrate,o=e.nackCountReceivedPerSecond;let a=!1;this.context.videoDownlinkBandwidthPolicy.updateMetrics(t);const s=this.context.videoDownlinkBandwidthPolicy.wantsResubscribe();if(a=a||s,s){const d=this.context.videoDownlinkBandwidthPolicy.chooseSubscriptions();this.context.videosToReceive=d.truncate(this.context.videoSubscriptionLimit),d.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.logger.info(`trigger resubscribe for down=${s}; videosToReceive=[${this.context.videosToReceive.array()}]`)}if(this.context.videoTileController.hasStartedLocalVideoTile()){this.context.videoUplinkBandwidthPolicy.updateConnectionMetric({uplinkKbps:n/1e3,nackCountPerSecond:o});const d=this.context.videoUplinkBandwidthPolicy.wantsResubscribe();a=a||d,d&&(this.logger.info(`trigger resubscribe for up=${d}; videosToReceive=[${this.context.videosToReceive.array()}]`),this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters(),this.context.videoUplinkBandwidthPolicy.chooseMediaTrackConstraints())}return a}metricsDidReceive(t){const e=t;if(!e||(this.checkResubscribe(t)&&this.context.audioVideoController.update({needsRenegotiation:!1}),!this.currentAvailableStreamAvgBitrates))return;const n=e.streamMetricReports;if(!n)return;const o=t.getObservableMetrics();this.currentVideoDownlinkBandwidthEstimationKbps=o.availableIncomingBitrate;const a=new Map,s=new Map;for(const u in n)n[u].mediaType===ClientMetricReportMediaType_1$1.default.VIDEO&&n[u].direction===ClientMetricReportDirection_1$1.default.DOWNSTREAM&&a.set(n[u].streamId,n[u]);let d=!1;for(const u of this.currentAvailableStreamAvgBitrates.bitrates)if(a.has(u.sourceStreamId)){const c=a.get(u.sourceStreamId),l=this.context.videoStreamIndex.attendeeIdForStreamId(u.sourceStreamId);if(!l)continue;const f=new ClientVideoStreamReceivingReport_1.default,h=c.previousMetrics.bytesReceived,p=c.currentMetrics.bytesReceived;if(!h||!p)continue;const m=(p-h)*8/1e3;f.expectedAverageBitrateKbps=u.avgBitrateBps/1e3,f.receivedAverageBitrateKbps=m,f.attendeeId=l,m<u.avgBitrateBps/1e3*MonitorTask.DEFAULT_DOWNLINK_CALLRATE_UNDERSHOOT_FACTOR&&(d=!0),s.set(l,f)}d&&this.logger.info(`One or more video streams are not receiving expected amounts of data ${JSON.stringify(Array.from(s.values()))}`)}connectionHealthDidChange(t){var e;t.consecutiveMissedPongs===0&&this.context.reconnectController&&this.context.reconnectController.setLastActiveTimestampMs(Date.now()),this.reconnectionHealthPolicy.update(t);const n=this.reconnectionHealthPolicy.healthIfChanged();n!==null&&(this.logger.info(`reconnection health is now: ${n}`),n===0&&this.context.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1$1.default(MeetingSessionStatusCode_1$3.default.ConnectionHealthReconnect),null)),this.unusableAudioWarningHealthPolicy.update(t);const o=this.unusableAudioWarningHealthPolicy.healthIfChanged();if(o!==null)if(this.logger.info(`unusable audio warning is now: ${o}`),o===0){this.context.poorConnectionCount+=1;const a=this.generateAudioVideoEventAttributes();(e=this.context.eventController)===null||e===void 0||e.publishEvent("receivingAudioDropped",a),this.context.videoTileController.haveVideoTilesWithStreams()?this.context.audioVideoController.forEachObserver(s=>{Types_1$4.Maybe.of(s.connectionDidSuggestStopVideo).map(d=>d.bind(s)())}):this.context.audioVideoController.forEachObserver(s=>{Types_1$4.Maybe.of(s.connectionDidBecomePoor).map(d=>d.bind(s)())})}else this.context.audioVideoController.forEachObserver(a=>{Types_1$4.Maybe.of(a.connectionDidBecomeGood).map(s=>s.bind(a)())})}handleBitrateFrame(t){let e=0;this.currentAvailableStreamAvgBitrates=t,this.logger.debug(()=>`simulcast: bitrates from server ${JSON.stringify(t)}`);for(const n of t.bitrates)this.context.videosToReceive.contain(n.sourceStreamId)&&(e+=n.avgBitrateBps);e/=1e3,this.currentVideoDownlinkBandwidthEstimationKbps*MonitorTask.DEFAULT_DOWNLINK_CALLRATE_OVERSHOOT_FACTOR<e&&this.logger.info(`Downlink bandwidth pressure is high: estimated bandwidth ${this.currentVideoDownlinkBandwidthEstimationKbps}Kbps, required bandwidth ${e}Kbps`)}handleSignalingClientEvent(t){var e;if(t.type===SignalingClientEventType_1$4.default.WebSocketClosed&&(t.closeCode===4410||t.closeCode>=4500&&t.closeCode<4600)||t.type===SignalingClientEventType_1$4.default.WebSocketError||t.type===SignalingClientEventType_1$4.default.WebSocketFailed){if(!this.hasSignalingError){const n=this.generateAudioVideoEventAttributes();(e=this.context.eventController)===null||e===void 0||e.publishEvent("signalingDropped",n),this.hasSignalingError=!0}}else t.type===SignalingClientEventType_1$4.default.WebSocketOpen&&(this.hasSignalingError=!1);if(t.type===SignalingClientEventType_1$4.default.ReceivedSignalFrame){if(t.message.bitrates){const o=t.message.bitrates;this.context.videoStreamIndex.integrateBitratesFrame(o),this.context.videoDownlinkBandwidthPolicy.updateIndex(this.context.videoStreamIndex),this.handleBitrateFrame(t.message.bitrates)}const n=MeetingSessionStatus_1$1.default.fromSignalFrame(t.message);t.message.type!==SignalingProtocol_1.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&n.statusCode()!==MeetingSessionStatusCode_1$3.default.OK&&this.context.audioVideoController.handleMeetingSessionStatus(n,null)}}}MonitorTask$1.default=MonitorTask;MonitorTask.DEFAULT_DOWNLINK_CALLRATE_OVERSHOOT_FACTOR=2;MonitorTask.DEFAULT_DOWNLINK_CALLRATE_UNDERSHOOT_FACTOR=.2;var OpenSignalingConnectionTask$1={},SignalingClientConnectionRequest$1={};Object.defineProperty(SignalingClientConnectionRequest$1,"__esModule",{value:!0});class SignalingClientConnectionRequest{constructor(t,e){this.signalingURL=t,this.joinToken=e}url(){return this.signalingURL+"?X-Chime-Control-Protocol-Version=3&X-Amzn-Chime-Send-Close-On-Error=1"}protocols(){return["_aws_wt_session",this.joinToken]}}SignalingClientConnectionRequest$1.default=SignalingClientConnectionRequest;var __awaiter$C=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(OpenSignalingConnectionTask$1,"__esModule",{value:!0});const SignalingClientConnectionRequest_1=SignalingClientConnectionRequest$1,SignalingClientEventType_1$3=SignalingClientEventType,BaseTask_1$e=BaseTask$1;class OpenSignalingConnectionTask extends BaseTask_1$e.default{constructor(t){super(t.logger),this.context=t,this.taskName="OpenSignalingConnectionTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$C(this,void 0,void 0,function*(){const t=this.context.meetingSessionConfiguration;this.context.signalingClient.openConnection(new SignalingClientConnectionRequest_1.default(t.urls.signalingURL,t.credentials.joinToken));const e=Date.now();try{yield new Promise((n,o)=>{class a{constructor(u){this.signalingClient=u}cancel(){this.signalingClient.removeObserver(this),o(new Error("OpenSignalingConnectionTask got canceled while waiting to open signaling connection"))}handleSignalingClientEvent(u){switch(u.type){case SignalingClientEventType_1$3.default.WebSocketOpen:this.signalingClient.removeObserver(this),n();break;case SignalingClientEventType_1$3.default.WebSocketFailed:this.signalingClient.removeObserver(this),o(new Error("WebSocket connection failed"));break}}}const s=new a(this.context.signalingClient);this.context.signalingClient.registerObserver(s),this.taskCanceler=s})}catch(n){throw n}finally{this.context.signalingOpenDurationMs=Math.round(Date.now()-e),this.logger.info(`Opening signaling connection took ${this.context.signalingOpenDurationMs} ms`)}})}}OpenSignalingConnectionTask$1.default=OpenSignalingConnectionTask;var ParallelGroupTask$1={},__awaiter$B=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(ParallelGroupTask$1,"__esModule",{value:!0});const BaseTask_1$d=BaseTask$1;class ParallelGroupTask extends BaseTask_1$d.default{constructor(t,e,n){super(t),this.taskName=e,this.tasksToRunParallel=n;for(const o of n)o.setParent(this)}cancel(){for(const t of this.tasksToRunParallel)this.logger.info(`canceling parallel group task ${this.name()} subtask ${t.name()}`),t.cancel()}run(){return __awaiter$B(this,void 0,void 0,function*(){const t=[];for(const n of this.tasksToRunParallel)this.logger.info(`parallel group task ${this.name()} running subtask ${n.name()}`),t.push(n.run());const e=[];for(let n=0;n<t.length;n++){try{yield t[n]}catch(o){e.push(`task ${this.tasksToRunParallel[n].name()} failed: ${o.message}`)}this.logger.info(`parallel group task ${this.name()} completed subtask ${this.tasksToRunParallel[n].name()}`)}if(e.length>0){const n=e.join(", ");this.logAndThrow(`parallel group task ${this.name()} failed for tasks: ${n}`)}this.logger.info(`parallel group task ${this.name()} completed`)})}}ParallelGroupTask$1.default=ParallelGroupTask;var PromoteToPrimaryMeetingTask={},hasRequiredPromoteToPrimaryMeetingTask;function requirePromoteToPrimaryMeetingTask(){if(hasRequiredPromoteToPrimaryMeetingTask)return PromoteToPrimaryMeetingTask;hasRequiredPromoteToPrimaryMeetingTask=1;var r=commonjsGlobal&&commonjsGlobal.__awaiter||function(s,d,u,c){function l(f){return f instanceof u?f:new u(function(h){h(f)})}return new(u||(u=Promise))(function(f,h){function p(g){try{S(c.next(g))}catch(y){h(y)}}function m(g){try{S(c.throw(g))}catch(y){h(y)}}function S(g){g.done?f(g.value):l(g.value).then(p,m)}S((c=c.apply(s,d||[])).next())})};Object.defineProperty(PromoteToPrimaryMeetingTask,"__esModule",{value:!0});const t=requireBuild(),e=SignalingClientEventType,n=SignalingProtocol,o=BaseTask$1;class a extends o.default{constructor(d,u,c){super(d.logger),this.context=d,this.credentials=u,this.completionCallback=c,this.taskName="PromoteToPrimaryMeetingTask",this.taskCanceler=null}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return r(this,void 0,void 0,function*(){this.context.signalingClient.ready()?(this.context.signalingClient.promoteToPrimaryMeeting(this.credentials),this.context.logger.info("Sent request to join primary meeting"),yield this.receivePrimaryMeetingJoinAck()):this.completionCallback(new t.MeetingSessionStatus(t.MeetingSessionStatusCode.SignalingRequestFailed))})}receivePrimaryMeetingJoinAck(){return new Promise((d,u)=>{class c{constructor(h,p,m){this.signalingClient=h,this.completionCallback=p,this.logger=m}cancel(){this.signalingClient.removeObserver(this),this.completionCallback(new t.MeetingSessionStatus(t.MeetingSessionStatusCode.SignalingRequestFailed)),d()}handleSignalingClientEvent(h){h.isConnectionTerminated()&&(this.signalingClient.removeObserver(this),this.logger.info("PromoteToPrimaryMeetingTask connection terminated"),this.completionCallback(new t.MeetingSessionStatus(t.MeetingSessionStatusCode.SignalingRequestFailed)),d()),h.type===e.default.ReceivedSignalFrame&&h.message.type===n.SdkSignalFrame.Type.PRIMARY_MEETING_JOIN_ACK&&(this.signalingClient.removeObserver(this),this.logger.info("Got a primary meeting join ACK"),this.completionCallback(t.MeetingSessionStatus.fromSignalFrame(h.message)),d())}}const l=new c(this.context.signalingClient,this.completionCallback,this.context.logger);this.taskCanceler=l,this.context.signalingClient.registerObserver(l)})}}return PromoteToPrimaryMeetingTask.default=a,PromoteToPrimaryMeetingTask}var ReceiveAudioInputTask$1={},__awaiter$A=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(ReceiveAudioInputTask$1,"__esModule",{value:!0});const BaseTask_1$c=BaseTask$1;class ReceiveAudioInputTask extends BaseTask_1$c.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveAudioInputTask"}run(){var t,e;return __awaiter$A(this,void 0,void 0,function*(){if(!(!((e=(t=this.context.meetingSessionConfiguration)===null||t===void 0?void 0:t.urls)===null||e===void 0)&&e.audioHostURL)){this.context.logger.info("No audio connection: not acquiring audio input");return}if(this.context.activeAudioInput){this.context.logger.info("an active audio input exists");return}let n;try{n=yield this.context.mediaStreamBroker.acquireAudioInputStream()}catch{this.context.logger.warn("could not acquire audio input from current device")}n?this.context.activeAudioInput=n:this.context.logger.warn("an audio input is not available")})}}ReceiveAudioInputTask$1.default=ReceiveAudioInputTask;var ReceiveTURNCredentialsTask$1={},__awaiter$z=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(ReceiveTURNCredentialsTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1$2=MeetingSessionStatusCode,MeetingSessionTURNCredentials_1=MeetingSessionTURNCredentials$1,DefaultModality_1$3=DefaultModality$1,Versioning_1$5=Versioning$1,BaseTask_1$b=BaseTask$1;class ReceiveTURNCredentialsTask extends BaseTask_1$b.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveTURNCredentialsTask",this.url=t.meetingSessionConfiguration.urls.turnControlURL,this.meetingId=t.meetingSessionConfiguration.meetingId,this.joinToken=t.meetingSessionConfiguration.credentials.joinToken}cancel(){if(this.cancelPromise){const t=new Error(`canceling ${this.name()}`);this.cancelPromise(t),delete this.cancelPromise}}run(){return __awaiter$z(this,void 0,void 0,function*(){if(this.context.turnCredentials){this.context.logger.info("TURN credentials available, skipping credentials fetch");return}if(this.context.logger.error("missing TURN credentials - falling back to fetch"),!this.url){this.context.logger.info("TURN control url not supplied, skipping credentials fetch");return}const t={method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json","X-Chime-Auth-Token":"_aws_wt_session="+new DefaultModality_1$3.default(this.joinToken).base()},redirect:"follow",referrer:"no-referrer",body:JSON.stringify({meetingId:this.meetingId})};this.context.logger.info(`requesting TURN credentials from ${this.url}`);const e=yield new Promise((n,o)=>__awaiter$z(this,void 0,void 0,function*(){this.cancelPromise=a=>{o(a)};try{const a=yield fetch(Versioning_1$5.default.urlWithVersion(this.url),t);if(this.context.logger.info("received TURN credentials"),a.status&&a.status===403){o(new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$2.default.TURNCredentialsForbidden}`));return}if(a.status&&a.status===404){o(new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1$2.default.MeetingEnded}`));return}n(yield a.json())}catch(a){o(a)}finally{delete this.cancelPromise}}));this.context.turnCredentials=new MeetingSessionTURNCredentials_1.default,this.context.turnCredentials.password=e.password,this.context.turnCredentials.ttl=e.ttl,this.context.turnCredentials.uris=e.uris.map(n=>this.context.meetingSessionConfiguration.urls.urlRewriter(n)).filter(n=>!!n),this.context.turnCredentials.username=e.username})}}ReceiveTURNCredentialsTask$1.default=ReceiveTURNCredentialsTask;var ReceiveVideoInputTask$1={},__awaiter$y=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(ReceiveVideoInputTask$1,"__esModule",{value:!0});const DefaultModality_1$2=DefaultModality$1,SignalingProtocol_js_1$6=SignalingProtocol,BaseTask_1$a=BaseTask$1;class ReceiveVideoInputTask extends BaseTask_1$a.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveVideoInputTask"}run(){return __awaiter$y(this,void 0,void 0,function*(){const t=this.context.videoDuplexMode===SignalingProtocol_js_1$6.SdkStreamServiceType.RX||this.context.videoDuplexMode===SignalingProtocol_js_1$6.SdkStreamServiceType.DUPLEX;if(this.context.videoTileController.hasStartedLocalVideoTile()?this.context.videoDuplexMode=t?SignalingProtocol_js_1$6.SdkStreamServiceType.DUPLEX:SignalingProtocol_js_1$6.SdkStreamServiceType.TX:this.context.videoDuplexMode=t?SignalingProtocol_js_1$6.SdkStreamServiceType.RX:0,this.context.videoCaptureAndEncodeParameter=this.context.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters(),!this.context.videoTileController.hasStartedLocalVideoTile()){this.context.logger.info("has not started local video tile"),this.context.activeVideoInput&&(this.context.activeVideoInput=void 0,this.context.videoStreamIndex.integrateUplinkPolicyDecision([]));return}const e=this.context.videoTileController.getLocalVideoTile();let n;try{n=yield this.context.mediaStreamBroker.acquireVideoInputStream()}catch{this.context.logger.warn("could not acquire video input from current device"),this.context.videoTileController.stopLocalVideoTile()}if(this.context.enableSimulcast){const o=this.context.videoUplinkBandwidthPolicy.chooseEncodingParameters();this.context.videoStreamIndex.integrateUplinkPolicyDecision(Array.from(o.values()))}if(this.context.activeVideoInput=n,n){const o=n.getVideoTracks();if(!o||o.length===0)return;const a=this.context.meetingSessionConfiguration.credentials.attendeeId,s=new DefaultModality_1$2.default(a).hasModality(DefaultModality_1$2.default.MODALITY_CONTENT),d=o[0].getSettings();if(this.context.enableSimulcast&&!s){const c=this.context.videoUplinkBandwidthPolicy.chooseMediaTrackConstraints();this.context.logger.info(`simulcast: choose constraint ${JSON.stringify(c)}`);try{yield o[0].applyConstraints(c)}catch{this.context.logger.info("simulcast: pass video without more constraint")}}const u=this.context.audioVideoController.configuration.credentials.externalUserId;e.bindVideoStream(a,!0,n,d.width,d.height,null,u);for(let c=0;c<o.length;c++){const l=o[c];this.logger.info(`using video device label=${l.label} id=${l.id}`),this.context.videoDeviceInformation.current_camera_name=l.label,this.context.videoDeviceInformation.current_camera_id=l.id}}})}}ReceiveVideoInputTask$1.default=ReceiveVideoInputTask;var ReceiveVideoStreamIndexTask$1={},__awaiter$x=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(ReceiveVideoStreamIndexTask$1,"__esModule",{value:!0});const MeetingSessionVideoAvailability_1=MeetingSessionVideoAvailability$1,DefaultModality_1$1=DefaultModality$1,VideoCodecCapability_1=VideoCodecCapability$1,SignalingClientEventType_1$2=SignalingClientEventType,SignalingProtocol_js_1$5=SignalingProtocol,Types_1$3=Types,BaseTask_1$9=BaseTask$1;class ReceiveVideoStreamIndexTask extends BaseTask_1$9.default{constructor(t){super(t.logger),this.context=t,this.taskName="ReceiveVideoStreamIndexTask",this.isIngestionPaused=!1,this.pendingIndex=null}removeObserver(){this.context.signalingClient.removeObserver(this)}run(){return __awaiter$x(this,void 0,void 0,function*(){this.handleIndexFrame(this.context.indexFrame),this.context.signalingClient.registerObserver(this),this.context.removableObservers.push(this)})}handleSignalingClientEvent(t){if(t.type!==SignalingClientEventType_1$2.default.ReceivedSignalFrame||t.message.type!==SignalingProtocol_js_1$5.SdkSignalFrame.Type.INDEX)return;const e=t.message.index;this.context.logger.info(`received new index ${JSON.stringify(e)}`),this.handleIndexFrame(e)}pauseIngestion(){this.isIngestionPaused=!0}resumeIngestion(){!this.isIngestionPaused||(this.isIngestionPaused=!1,this.pendingIndex&&(this.context.logger.info("Resuming index ingestion with pending index"),this.handleIndexFrame(this.pendingIndex)))}handleIndexFrame(t){if(!t)return;if(this.isIngestionPaused){this.context.logger.info("Index ingestion is paused, setting most recent index as pending"),this.pendingIndex=t;return}else this.pendingIndex=null;const e=this.context.audioVideoController.configuration.credentials.attendeeId;t.sources=t.sources.filter(u=>{const c=new DefaultModality_1$1.default(u.attendeeId);return!(c.base()===e&&c.hasModality(DefaultModality_1$1.default.MODALITY_CONTENT))});const{videoStreamIndex:n,videoDownlinkBandwidthPolicy:o,videoUplinkBandwidthPolicy:a}=this.context,s=n.allVideoSendingSourcesExcludingSelf(e);n.integrateIndexFrame(t),o.updateIndex(n),a.updateIndex(n),this.resubscribe(o,a),this.updateVideoAvailability(t),this.handleIndexVideosPausedAtSource(),t.supportedReceiveCodecIntersection.length>0&&this.handleSupportedVideoReceiveCodecIntersection(t);const d=n.allVideoSendingSourcesExcludingSelf(e);this.areVideoSourcesEqual(s,d)||this.context.audioVideoController.forEachObserver(u=>{Types_1$3.Maybe.of(u.remoteVideoSourcesDidChange).map(c=>c.bind(u)(d))})}areVideoSourcesEqual(t,e){if(t.length!==e.length)return!1;const n=(s,d)=>s.attendee.attendeeId.localeCompare(d.attendee.attendeeId),o=[...t].sort(n),a=[...e].sort(n);for(let s=0;s<o.length;s++)if(o[s].attendee.attendeeId!==a[s].attendee.attendeeId)return!1;return!0}resubscribe(t,e){const n=t.wantsResubscribe(),o=(this.context.videoDuplexMode===SignalingProtocol_js_1$5.SdkStreamServiceType.TX||this.context.videoDuplexMode===SignalingProtocol_js_1$5.SdkStreamServiceType.DUPLEX)&&e.wantsResubscribe(),a=n||o;if(this.logger.info(`should resubscribe: ${a} (downlink: ${n} uplink: ${o})`),!a)return;const s=t.chooseSubscriptions();this.context.videosToReceive=s.truncate(this.context.videoSubscriptionLimit),s.size()>this.context.videosToReceive.size()&&this.logger.warn(`Video receive limit exceeded. Limiting the videos to ${this.context.videosToReceive.size()}. Please consider using AllHighestVideoBandwidthPolicy or VideoPriorityBasedPolicy along with chooseRemoteVideoSources api to select the video sources to be displayed.`),this.context.videoCaptureAndEncodeParameter=e.chooseCaptureAndEncodeParameters(),this.logger.info(`trigger resubscribe for up=${o} down=${n}; videosToReceive=[${this.context.videosToReceive.array()}] captureParams=${JSON.stringify(this.context.videoCaptureAndEncodeParameter)}`),this.context.audioVideoController.update({needsRenegotiation:!1})}updateVideoAvailability(t){if(!this.context.videosToReceive){this.logger.error("videosToReceive must be set in the meeting context.");return}const e=new MeetingSessionVideoAvailability_1.default;e.remoteVideoAvailable=!this.context.videosToReceive.empty(),e.canStartLocalVideo=!t.atCapacity,(!this.context.lastKnownVideoAvailability||!this.context.lastKnownVideoAvailability.equal(e))&&(this.context.lastKnownVideoAvailability=e.clone(),this.context.audioVideoController.forEachObserver(n=>{Types_1$3.Maybe.of(n.videoAvailabilityDidChange).map(o=>o.bind(n)(e.clone()))}))}handleSupportedVideoReceiveCodecIntersection(t){if(this.context.videoSendCodecPreferences===void 0)return;const e=[];let n=!1;for(const o of this.context.videoSendCodecPreferences){for(const a of t.supportedReceiveCodecIntersection)if(o.equals(VideoCodecCapability_1.default.fromSignaled(a))){e.push(o);break}o.equals(this.context.currentVideoSendCodec)&&(n=!0)}e.length>0?this.context.meetingSupportedVideoSendCodecPreferences=e:(this.logger.warn("Interesection of meeting receive codec support and send codec preferences has no overlap, falling back to just values provided in `setVideoCodecSendPreferences`"),this.context.meetingSupportedVideoSendCodecPreferences=void 0),n&&this.context.audioVideoController.update({needsRenegotiation:!0})}handleIndexVideosPausedAtSource(){const t=this.context.videoStreamIndex.streamsPausedAtSource();for(const e of this.context.videoTileController.getAllVideoTiles()){const n=e.state();t.contain(n.streamId)?e.markPoorConnection()&&this.logger.info(`marks the tile ${n.tileId} as having a poor connection`):e.unmarkPoorConnection()&&this.logger.info(`unmarks the tile ${n.tileId} as having a poor connection`)}}}ReceiveVideoStreamIndexTask$1.default=ReceiveVideoStreamIndexTask;var SendAndReceiveDataMessagesTask$1={},__awaiter$w=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SendAndReceiveDataMessagesTask$1,"__esModule",{value:!0});const DataMessage_1=DataMessage$1,SignalingClientEventType_1$1=SignalingClientEventType,SignalingProtocol_js_1$4=SignalingProtocol,BaseTask_1$8=BaseTask$1;class SendAndReceiveDataMessagesTask extends BaseTask_1$8.default{constructor(t){super(t.logger),this.context=t,this.taskName="SendAndReceiveDataMessagesTask",this.sendDataMessageHandler=(e,n,o)=>{if(this.context.signalingClient.ready()){let a;n instanceof Uint8Array?a=n:typeof n=="string"?a=new TextEncoder().encode(n):a=new TextEncoder().encode(JSON.stringify(n)),this.validateDataMessage(e,a,o);const s=SignalingProtocol_js_1$4.SdkDataMessagePayload.create();s.topic=e,s.lifetimeMs=o,s.data=a;const d=SignalingProtocol_js_1$4.SdkDataMessageFrame.create();d.messages=[s],this.context.signalingClient.sendDataMessage(d)}else this.context.logger.error("Signaling client is not ready")}}run(){return __awaiter$w(this,void 0,void 0,function*(){this.context.removableObservers.push(this),this.context.signalingClient.registerObserver(this),this.context.realtimeController.realtimeSubscribeToSendDataMessage(this.sendDataMessageHandler)})}removeObserver(){this.context.realtimeController.realtimeUnsubscribeFromSendDataMessage(this.sendDataMessageHandler),this.context.signalingClient.removeObserver(this)}handleSignalingClientEvent(t){if(t.type===SignalingClientEventType_1$1.default.ReceivedSignalFrame&&t.message.type===SignalingProtocol_js_1$4.SdkSignalFrame.Type.DATA_MESSAGE)for(const e of t.message.dataMessage.messages){const n=new DataMessage_1.default(e.ingestTimeNs/1e6,e.topic,e.data,e.senderAttendeeId,e.senderExternalUserId,e.ingestTimeNs===0);this.context.realtimeController.realtimeReceiveDataMessage(n)}}validateDataMessage(t,e,n){if(!SendAndReceiveDataMessagesTask.TOPIC_REGEX.test(t))throw new Error("Invalid topic");if(e.length>SendAndReceiveDataMessagesTask.DATA_SIZE)throw new Error("Data size has to be less than 2048 bytes");if(n&&n<0)throw new Error("The life time of the message has to be non negative")}}SendAndReceiveDataMessagesTask$1.default=SendAndReceiveDataMessagesTask;SendAndReceiveDataMessagesTask.TOPIC_REGEX=new RegExp(/^[a-zA-Z0-9_-]{1,36}$/);SendAndReceiveDataMessagesTask.DATA_SIZE=2048;var SerialGroupTask$1={},__awaiter$v=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SerialGroupTask$1,"__esModule",{value:!0});const BaseTask_1$7=BaseTask$1,TaskStatus_1=TaskStatus$1;class SerialGroupTask extends BaseTask_1$7.default{constructor(t,e,n){super(t),this.taskName=e,this.tasksToRunSerially=n,this.currentTask=null;for(const o of n)o.setParent(this)}cancel(){this.currentTask&&(this.logger.info(`canceling serial group task ${this.name()} subtask ${this.currentTask.name()}`),this.currentTask.cancel())}run(){return __awaiter$v(this,void 0,void 0,function*(){for(const t of this.tasksToRunSerially){this.getStatus()===TaskStatus_1.default.CANCELED&&this.logAndThrow(`serial group task ${this.name()} was canceled`);try{this.logger.info(`serial group task ${this.name()} running subtask ${t.name()}`),this.currentTask=t,yield t.run(),this.logger.info(`serial group task ${this.name()} completed subtask ${t.name()}`)}catch(e){this.logAndThrow(`serial group task ${this.name()} was canceled due to subtask ${this.currentTask.name()} error: ${e.message}`)}finally{this.currentTask=null}}this.logger.info(`serial group task ${this.name()} completed`)})}}SerialGroupTask$1.default=SerialGroupTask;var SetLocalDescriptionTask$1={},__awaiter$u=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SetLocalDescriptionTask$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$3=DefaultBrowserBehavior$1,SDP_1$2=SDP$1,BaseTask_1$6=BaseTask$1;class SetLocalDescriptionTask extends BaseTask_1$6.default{constructor(t){super(t.logger),this.context=t,this.taskName="SetLocalDescriptionTask"}cancel(){if(this.cancelPromise){const t=new Error(`canceling ${this.name()}`);this.cancelPromise(t),delete this.cancelPromise}}run(){return __awaiter$u(this,void 0,void 0,function*(){const t=this.context.peer;let n=this.context.sdpOfferInit.sdp;this.context.browserBehavior.supportsVideoLayersAllocationRtpHeaderExtension()&&(n=new SDP_1$2.default(n).withVideoLayersAllocationRtpHeaderExtension(this.context.previousSdpOffer).sdp),new DefaultBrowserBehavior_1$3.default().requiresDisablingH264Encoding()&&(n=new SDP_1$2.default(n).removeH264SupportFromSendSection().sdp),this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(n=new SDP_1$2.default(n).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp),this.context.audioProfile&&(n=new SDP_1$2.default(n).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(n=new SDP_1$2.default(n).withStereoAudio().sdp)),this.logger.debug(()=>`local description is >>>${n}<<<`);const o={type:"offer",sdp:n,toJSON:null};yield new Promise((a,s)=>__awaiter$u(this,void 0,void 0,function*(){this.cancelPromise=d=>{s(d)};try{yield t.setLocalDescription(o),a()}catch(d){s(d)}finally{delete this.cancelPromise}})),this.context.logger.info("set local description")})}}SetLocalDescriptionTask$1.default=SetLocalDescriptionTask;var SetRemoteDescriptionTask$1={},__awaiter$t=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SetRemoteDescriptionTask$1,"__esModule",{value:!0});const SDP_1$1=SDP$1,BaseTask_1$5=BaseTask$1;class SetRemoteDescriptionTask extends BaseTask_1$5.default{constructor(t){super(t.logger),this.context=t,this.taskName="SetRemoteDescriptionTask"}cancel(){this.cancelICEPromise&&this.cancelICEPromise()}run(){return __awaiter$t(this,void 0,void 0,function*(){this.context.peer||this.logAndThrow("session does not have peer connection; bypass set remote description");let e=this.context.sdpAnswer;e=new SDP_1$1.default(e).withoutServerReflexiveCandidates().sdp,this.context.audioProfile&&(e=new SDP_1$1.default(e).withAudioMaxAverageBitrate(this.context.audioProfile.audioBitrateBps).sdp,this.context.audioProfile.isStereo()&&(e=new SDP_1$1.default(e).withStereoAudio().sdp)),this.context.videoSendCodecPreferences!==void 0&&this.context.videoSendCodecPreferences.length>0&&(e=new SDP_1$1.default(e).withVideoSendCodecPreferences(this.context.meetingSupportedVideoSendCodecPreferences!==void 0?this.context.meetingSupportedVideoSendCodecPreferences:this.context.videoSendCodecPreferences).sdp,this.context.currentVideoSendCodec=new SDP_1$1.default(e).highestPriorityVideoSendCodec()),this.logger.info(`processed remote description is >>>${e}<<<`);const n={type:"answer",sdp:e,toJSON:null};try{yield this.createICEConnectionCompletedPromise(n)}catch(o){throw o}})}createICEConnectionCompletedPromise(t){return new Promise((e,n)=>__awaiter$t(this,void 0,void 0,function*(){const o=()=>{(this.context.peer.iceConnectionState==="connected"||this.context.peer.iceConnectionState==="completed")&&(this.context.peer.removeEventListener("iceconnectionstatechange",o),e())};this.cancelICEPromise=()=>{this.context.peer&&this.context.peer.removeEventListener("iceconnectionstatechange",o),n(new Error(`${this.name()} got canceled while waiting for the ICE connection state`))},this.context.peer.addEventListener("iceconnectionstatechange",o);try{yield this.context.peer.setRemoteDescription(t),this.logger.info("set remote description, waiting for ICE connection"),o()}catch(a){n(a)}}))}}SetRemoteDescriptionTask$1.default=SetRemoteDescriptionTask;var SubscribeAndReceiveSubscribeAckTask$1={},ZLIBTextCompressor$1={},pako$1={},deflate$4={},deflate$3={},trees={};const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(r){let t=r.length;for(;--t>=0;)r[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(r,t,e,n,o){this.static_tree=r,this.extra_bits=t,this.extra_base=e,this.elems=n,this.max_length=o,this.has_stree=r&&r.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(r,t){this.dyn_tree=r,this.max_code=0,this.stat_desc=t}const d_code=r=>r<256?_dist_code[r]:_dist_code[256+(r>>>7)],put_short=(r,t)=>{r.pending_buf[r.pending++]=t&255,r.pending_buf[r.pending++]=t>>>8&255},send_bits=(r,t,e)=>{r.bi_valid>Buf_size-e?(r.bi_buf|=t<<r.bi_valid&65535,put_short(r,r.bi_buf),r.bi_buf=t>>Buf_size-r.bi_valid,r.bi_valid+=e-Buf_size):(r.bi_buf|=t<<r.bi_valid&65535,r.bi_valid+=e)},send_code=(r,t,e)=>{send_bits(r,e[t*2],e[t*2+1])},bi_reverse=(r,t)=>{let e=0;do e|=r&1,r>>>=1,e<<=1;while(--t>0);return e>>>1},bi_flush=r=>{r.bi_valid===16?(put_short(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},gen_bitlen=(r,t)=>{const e=t.dyn_tree,n=t.max_code,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,u=t.stat_desc.max_length;let c,l,f,h,p,m,S=0;for(h=0;h<=MAX_BITS$1;h++)r.bl_count[h]=0;for(e[r.heap[r.heap_max]*2+1]=0,c=r.heap_max+1;c<HEAP_SIZE$1;c++)l=r.heap[c],h=e[e[l*2+1]*2+1]+1,h>u&&(h=u,S++),e[l*2+1]=h,!(l>n)&&(r.bl_count[h]++,p=0,l>=d&&(p=s[l-d]),m=e[l*2],r.opt_len+=m*(h+p),a&&(r.static_len+=m*(o[l*2+1]+p)));if(S!==0){do{for(h=u-1;r.bl_count[h]===0;)h--;r.bl_count[h]--,r.bl_count[h+1]+=2,r.bl_count[u]--,S-=2}while(S>0);for(h=u;h!==0;h--)for(l=r.bl_count[h];l!==0;)f=r.heap[--c],!(f>n)&&(e[f*2+1]!==h&&(r.opt_len+=(h-e[f*2+1])*e[f*2],e[f*2+1]=h),l--)}},gen_codes=(r,t,e)=>{const n=new Array(MAX_BITS$1+1);let o=0,a,s;for(a=1;a<=MAX_BITS$1;a++)n[a]=o=o+e[a-1]<<1;for(s=0;s<=t;s++){let d=r[s*2+1];d!==0&&(r[s*2]=bi_reverse(n[d]++,d))}},tr_static_init=()=>{let r,t,e,n,o;const a=new Array(MAX_BITS$1+1);for(e=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=e,r=0;r<1<<extra_lbits[n];r++)_length_code[e++]=n;for(_length_code[e-1]=n,o=0,n=0;n<16;n++)for(base_dist[n]=o,r=0;r<1<<extra_dbits[n];r++)_dist_code[o++]=n;for(o>>=7;n<D_CODES$1;n++)for(base_dist[n]=o<<7,r=0;r<1<<extra_dbits[n]-7;r++)_dist_code[256+o++]=n;for(t=0;t<=MAX_BITS$1;t++)a[t]=0;for(r=0;r<=143;)static_ltree[r*2+1]=8,r++,a[8]++;for(;r<=255;)static_ltree[r*2+1]=9,r++,a[9]++;for(;r<=279;)static_ltree[r*2+1]=7,r++,a[7]++;for(;r<=287;)static_ltree[r*2+1]=8,r++,a[8]++;for(gen_codes(static_ltree,L_CODES$1+1,a),r=0;r<D_CODES$1;r++)static_dtree[r*2+1]=5,static_dtree[r*2]=bi_reverse(r,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=r=>{let t;for(t=0;t<L_CODES$1;t++)r.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)r.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)r.bl_tree[t*2]=0;r.dyn_ltree[END_BLOCK*2]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0},bi_windup=r=>{r.bi_valid>8?put_short(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},copy_block=(r,t,e,n)=>{bi_windup(r),n&&(put_short(r,e),put_short(r,~e)),r.pending_buf.set(r.window.subarray(t,t+e),r.pending),r.pending+=e},smaller=(r,t,e,n)=>{const o=t*2,a=e*2;return r[o]<r[a]||r[o]===r[a]&&n[t]<=n[e]},pqdownheap=(r,t,e)=>{const n=r.heap[e];let o=e<<1;for(;o<=r.heap_len&&(o<r.heap_len&&smaller(t,r.heap[o+1],r.heap[o],r.depth)&&o++,!smaller(t,n,r.heap[o],r.depth));)r.heap[e]=r.heap[o],e=o,o<<=1;r.heap[e]=n},compress_block=(r,t,e)=>{let n,o,a=0,s,d;if(r.last_lit!==0)do n=r.pending_buf[r.d_buf+a*2]<<8|r.pending_buf[r.d_buf+a*2+1],o=r.pending_buf[r.l_buf+a],a++,n===0?send_code(r,o,t):(s=_length_code[o],send_code(r,s+LITERALS$1+1,t),d=extra_lbits[s],d!==0&&(o-=base_length[s],send_bits(r,o,d)),n--,s=d_code(n),send_code(r,s,e),d=extra_dbits[s],d!==0&&(n-=base_dist[s],send_bits(r,n,d)));while(a<r.last_lit);send_code(r,END_BLOCK,t)},build_tree=(r,t)=>{const e=t.dyn_tree,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.elems;let s,d,u=-1,c;for(r.heap_len=0,r.heap_max=HEAP_SIZE$1,s=0;s<a;s++)e[s*2]!==0?(r.heap[++r.heap_len]=u=s,r.depth[s]=0):e[s*2+1]=0;for(;r.heap_len<2;)c=r.heap[++r.heap_len]=u<2?++u:0,e[c*2]=1,r.depth[c]=0,r.opt_len--,o&&(r.static_len-=n[c*2+1]);for(t.max_code=u,s=r.heap_len>>1;s>=1;s--)pqdownheap(r,e,s);c=a;do s=r.heap[1],r.heap[1]=r.heap[r.heap_len--],pqdownheap(r,e,1),d=r.heap[1],r.heap[--r.heap_max]=s,r.heap[--r.heap_max]=d,e[c*2]=e[s*2]+e[d*2],r.depth[c]=(r.depth[s]>=r.depth[d]?r.depth[s]:r.depth[d])+1,e[s*2+1]=e[d*2+1]=c,r.heap[1]=c++,pqdownheap(r,e,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],gen_bitlen(r,t),gen_codes(e,u,r.bl_count)},scan_tree=(r,t,e)=>{let n,o=-1,a,s=t[0*2+1],d=0,u=7,c=4;for(s===0&&(u=138,c=3),t[(e+1)*2+1]=65535,n=0;n<=e;n++)a=s,s=t[(n+1)*2+1],!(++d<u&&a===s)&&(d<c?r.bl_tree[a*2]+=d:a!==0?(a!==o&&r.bl_tree[a*2]++,r.bl_tree[REP_3_6*2]++):d<=10?r.bl_tree[REPZ_3_10*2]++:r.bl_tree[REPZ_11_138*2]++,d=0,o=a,s===0?(u=138,c=3):a===s?(u=6,c=3):(u=7,c=4))},send_tree=(r,t,e)=>{let n,o=-1,a,s=t[0*2+1],d=0,u=7,c=4;for(s===0&&(u=138,c=3),n=0;n<=e;n++)if(a=s,s=t[(n+1)*2+1],!(++d<u&&a===s)){if(d<c)do send_code(r,a,r.bl_tree);while(--d!==0);else a!==0?(a!==o&&(send_code(r,a,r.bl_tree),d--),send_code(r,REP_3_6,r.bl_tree),send_bits(r,d-3,2)):d<=10?(send_code(r,REPZ_3_10,r.bl_tree),send_bits(r,d-3,3)):(send_code(r,REPZ_11_138,r.bl_tree),send_bits(r,d-11,7));d=0,o=a,s===0?(u=138,c=3):a===s?(u=6,c=3):(u=7,c=4)}},build_bl_tree=r=>{let t;for(scan_tree(r,r.dyn_ltree,r.l_desc.max_code),scan_tree(r,r.dyn_dtree,r.d_desc.max_code),build_tree(r,r.bl_desc),t=BL_CODES$1-1;t>=3&&r.bl_tree[bl_order[t]*2+1]===0;t--);return r.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(r,t,e,n)=>{let o;for(send_bits(r,t-257,5),send_bits(r,e-1,5),send_bits(r,n-4,4),o=0;o<n;o++)send_bits(r,r.bl_tree[bl_order[o]*2+1],3);send_tree(r,r.dyn_ltree,t-1),send_tree(r,r.dyn_dtree,e-1)},detect_data_type=r=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&r.dyn_ltree[e*2]!==0)return Z_BINARY;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return Z_TEXT;for(e=32;e<LITERALS$1;e++)if(r.dyn_ltree[e*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=r=>{static_init_done||(tr_static_init(),static_init_done=!0),r.l_desc=new TreeDesc(r.dyn_ltree,static_l_desc),r.d_desc=new TreeDesc(r.dyn_dtree,static_d_desc),r.bl_desc=new TreeDesc(r.bl_tree,static_bl_desc),r.bi_buf=0,r.bi_valid=0,init_block(r)},_tr_stored_block$1=(r,t,e,n)=>{send_bits(r,(STORED_BLOCK<<1)+(n?1:0),3),copy_block(r,t,e,!0)},_tr_align$1=r=>{send_bits(r,STATIC_TREES<<1,3),send_code(r,END_BLOCK,static_ltree),bi_flush(r)},_tr_flush_block$1=(r,t,e,n)=>{let o,a,s=0;r.level>0?(r.strm.data_type===Z_UNKNOWN$1&&(r.strm.data_type=detect_data_type(r)),build_tree(r,r.l_desc),build_tree(r,r.d_desc),s=build_bl_tree(r),o=r.opt_len+3+7>>>3,a=r.static_len+3+7>>>3,a<=o&&(o=a)):o=a=e+5,e+4<=o&&t!==-1?_tr_stored_block$1(r,t,e,n):r.strategy===Z_FIXED$1||a===o?(send_bits(r,(STATIC_TREES<<1)+(n?1:0),3),compress_block(r,static_ltree,static_dtree)):(send_bits(r,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(r,r.l_desc.max_code+1,r.d_desc.max_code+1,s+1),compress_block(r,r.dyn_ltree,r.dyn_dtree)),init_block(r),n&&bi_windup(r)},_tr_tally$1=(r,t,e)=>(r.pending_buf[r.d_buf+r.last_lit*2]=t>>>8&255,r.pending_buf[r.d_buf+r.last_lit*2+1]=t&255,r.pending_buf[r.l_buf+r.last_lit]=e&255,r.last_lit++,t===0?r.dyn_ltree[e*2]++:(r.matches++,t--,r.dyn_ltree[(_length_code[e]+LITERALS$1+1)*2]++,r.dyn_dtree[d_code(t)*2]++),r.last_lit===r.lit_bufsize-1);trees._tr_init=_tr_init$1;trees._tr_stored_block=_tr_stored_block$1;trees._tr_flush_block=_tr_flush_block$1;trees._tr_tally=_tr_tally$1;trees._tr_align=_tr_align$1;const adler32$2=(r,t,e,n)=>{let o=r&65535|0,a=r>>>16&65535|0,s=0;for(;e!==0;){s=e>2e3?2e3:e,e-=s;do o=o+t[n++]|0,a=a+o|0;while(--s);o%=65521,a%=65521}return o|a<<16|0};var adler32_1=adler32$2;const makeTable=()=>{let r,t=[];for(var e=0;e<256;e++){r=e;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;t[e]=r}return t},crcTable=new Uint32Array(makeTable()),crc32$2=(r,t,e,n)=>{const o=crcTable,a=n+e;r^=-1;for(let s=n;s<a;s++)r=r>>>8^o[(r^t[s])&255];return r^-1};var crc32_1=crc32$2,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,adler32$1=adler32_1,crc32$1=crc32_1,msg$2=messages,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(r,t)=>(r.msg=msg$2[t],t),rank=r=>(r<<1)-(r>4?9:0),zero=r=>{let t=r.length;for(;--t>=0;)r[t]=0};let HASH_ZLIB=(r,t,e)=>(t<<r.hash_shift^e)&r.hash_mask,HASH=HASH_ZLIB;const flush_pending=r=>{const t=r.state;let e=t.pending;e>r.avail_out&&(e=r.avail_out),e!==0&&(r.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),r.next_out),r.next_out+=e,t.pending_out+=e,r.total_out+=e,r.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},flush_block_only=(r,t)=>{_tr_flush_block(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,t),r.block_start=r.strstart,flush_pending(r.strm)},put_byte=(r,t)=>{r.pending_buf[r.pending++]=t},putShortMSB=(r,t)=>{r.pending_buf[r.pending++]=t>>>8&255,r.pending_buf[r.pending++]=t&255},read_buf=(r,t,e,n)=>{let o=r.avail_in;return o>n&&(o=n),o===0?0:(r.avail_in-=o,t.set(r.input.subarray(r.next_in,r.next_in+o),e),r.state.wrap===1?r.adler=adler32$1(r.adler,t,o,e):r.state.wrap===2&&(r.adler=crc32$1(r.adler,t,o,e)),r.next_in+=o,r.total_in+=o,o)},longest_match=(r,t)=>{let e=r.max_chain_length,n=r.strstart,o,a,s=r.prev_length,d=r.nice_match;const u=r.strstart>r.w_size-MIN_LOOKAHEAD?r.strstart-(r.w_size-MIN_LOOKAHEAD):0,c=r.window,l=r.w_mask,f=r.prev,h=r.strstart+MAX_MATCH;let p=c[n+s-1],m=c[n+s];r.prev_length>=r.good_match&&(e>>=2),d>r.lookahead&&(d=r.lookahead);do if(o=t,!(c[o+s]!==m||c[o+s-1]!==p||c[o]!==c[n]||c[++o]!==c[n+1])){n+=2,o++;do;while(c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&c[++n]===c[++o]&&n<h);if(a=MAX_MATCH-(h-n),n=h-MAX_MATCH,a>s){if(r.match_start=t,s=a,a>=d)break;p=c[n+s-1],m=c[n+s]}}while((t=f[t&l])>u&&--e!==0);return s<=r.lookahead?s:r.lookahead},fill_window=r=>{const t=r.w_size;let e,n,o,a,s;do{if(a=r.window_size-r.lookahead-r.strstart,r.strstart>=t+(t-MIN_LOOKAHEAD)){r.window.set(r.window.subarray(t,t+t),0),r.match_start-=t,r.strstart-=t,r.block_start-=t,n=r.hash_size,e=n;do o=r.head[--e],r.head[e]=o>=t?o-t:0;while(--n);n=t,e=n;do o=r.prev[--e],r.prev[e]=o>=t?o-t:0;while(--n);a+=t}if(r.strm.avail_in===0)break;if(n=read_buf(r.strm,r.window,r.strstart+r.lookahead,a),r.lookahead+=n,r.lookahead+r.insert>=MIN_MATCH)for(s=r.strstart-r.insert,r.ins_h=r.window[s],r.ins_h=HASH(r,r.ins_h,r.window[s+1]);r.insert&&(r.ins_h=HASH(r,r.ins_h,r.window[s+MIN_MATCH-1]),r.prev[s&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=s,s++,r.insert--,!(r.lookahead+r.insert<MIN_MATCH)););}while(r.lookahead<MIN_LOOKAHEAD&&r.strm.avail_in!==0)},deflate_stored=(r,t)=>{let e=65535;for(e>r.pending_buf_size-5&&(e=r.pending_buf_size-5);;){if(r.lookahead<=1){if(fill_window(r),r.lookahead===0&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}r.strstart+=r.lookahead,r.lookahead=0;const n=r.block_start+e;if((r.strstart===0||r.strstart>=n)&&(r.lookahead=r.strstart-n,r.strstart=n,flush_block_only(r,!1),r.strm.avail_out===0)||r.strstart-r.block_start>=r.w_size-MIN_LOOKAHEAD&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=0,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):(r.strstart>r.block_start&&(flush_block_only(r,!1),r.strm.avail_out===0),BS_NEED_MORE)},deflate_fast=(r,t)=>{let e,n;for(;;){if(r.lookahead<MIN_LOOKAHEAD){if(fill_window(r),r.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(e=0,r.lookahead>=MIN_MATCH&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),e!==0&&r.strstart-e<=r.w_size-MIN_LOOKAHEAD&&(r.match_length=longest_match(r,e)),r.match_length>=MIN_MATCH)if(n=_tr_tally(r,r.strstart-r.match_start,r.match_length-MIN_MATCH),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=MIN_MATCH){r.match_length--;do r.strstart++,r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+1]);else n=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=r.strstart<MIN_MATCH-1?r.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.last_lit&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(r,t)=>{let e,n,o;for(;;){if(r.lookahead<MIN_LOOKAHEAD){if(fill_window(r),r.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(e=0,r.lookahead>=MIN_MATCH&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=MIN_MATCH-1,e!==0&&r.prev_length<r.max_lazy_match&&r.strstart-e<=r.w_size-MIN_LOOKAHEAD&&(r.match_length=longest_match(r,e),r.match_length<=5&&(r.strategy===Z_FILTERED||r.match_length===MIN_MATCH&&r.strstart-r.match_start>4096)&&(r.match_length=MIN_MATCH-1)),r.prev_length>=MIN_MATCH&&r.match_length<=r.prev_length){o=r.strstart+r.lookahead-MIN_MATCH,n=_tr_tally(r,r.strstart-1-r.prev_match,r.prev_length-MIN_MATCH),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=o&&(r.ins_h=HASH(r,r.ins_h,r.window[r.strstart+MIN_MATCH-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=MIN_MATCH-1,r.strstart++,n&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}else if(r.match_available){if(n=_tr_tally(r,0,r.window[r.strstart-1]),n&&flush_block_only(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return BS_NEED_MORE}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=_tr_tally(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<MIN_MATCH-1?r.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.last_lit&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(r,t)=>{let e,n,o,a;const s=r.window;for(;;){if(r.lookahead<=MAX_MATCH){if(fill_window(r),r.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=MIN_MATCH&&r.strstart>0&&(o=r.strstart-1,n=s[o],n===s[++o]&&n===s[++o]&&n===s[++o])){a=r.strstart+MAX_MATCH;do;while(n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&o<a);r.match_length=MAX_MATCH-(a-o),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=MIN_MATCH?(e=_tr_tally(r,1,r.match_length-MIN_MATCH),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(e=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),e&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=0,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.last_lit&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(r,t)=>{let e;for(;;){if(r.lookahead===0&&(fill_window(r),r.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(r.match_length=0,e=_tr_tally(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,e&&(flush_block_only(r,!1),r.strm.avail_out===0))return BS_NEED_MORE}return r.insert=0,t===Z_FINISH$3?(flush_block_only(r,!0),r.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):r.last_lit&&(flush_block_only(r,!1),r.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(r,t,e,n,o){this.good_length=r,this.max_lazy=t,this.nice_length=e,this.max_chain=n,this.func=o}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=r=>{r.window_size=2*r.w_size,zero(r.head),r.max_lazy_match=configuration_table[r.level].max_lazy,r.good_match=configuration_table[r.level].good_length,r.nice_match=configuration_table[r.level].nice_length,r.max_chain_length=configuration_table[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,r.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateResetKeep=r=>{if(!r||!r.state)return err(r,Z_STREAM_ERROR$2);r.total_in=r.total_out=0,r.data_type=Z_UNKNOWN;const t=r.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,r.adler=t.wrap===2?0:1,t.last_flush=Z_NO_FLUSH$2,_tr_init(t),Z_OK$3},deflateReset=r=>{const t=deflateResetKeep(r);return t===Z_OK$3&&lm_init(r.state),t},deflateSetHeader=(r,t)=>!r||!r.state||r.state.wrap!==2?Z_STREAM_ERROR$2:(r.state.gzhead=t,Z_OK$3),deflateInit2=(r,t,e,n,o,a)=>{if(!r)return Z_STREAM_ERROR$2;let s=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),o<1||o>MAX_MEM_LEVEL||e!==Z_DEFLATED$2||n<8||n>15||t<0||t>9||a<0||a>Z_FIXED)return err(r,Z_STREAM_ERROR$2);n===8&&(n=9);const d=new DeflateState;return r.state=d,d.strm=r,d.wrap=s,d.gzhead=null,d.w_bits=n,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=o+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+MIN_MATCH-1)/MIN_MATCH),d.window=new Uint8Array(d.w_size*2),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<o+6,d.pending_buf_size=d.lit_bufsize*4,d.pending_buf=new Uint8Array(d.pending_buf_size),d.d_buf=1*d.lit_bufsize,d.l_buf=(1+2)*d.lit_bufsize,d.level=t,d.strategy=a,d.method=e,deflateReset(r)},deflateInit=(r,t)=>deflateInit2(r,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(r,t)=>{let e,n;if(!r||!r.state||t>Z_BLOCK$1||t<0)return r?err(r,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const o=r.state;if(!r.output||!r.input&&r.avail_in!==0||o.status===FINISH_STATE&&t!==Z_FINISH$3)return err(r,r.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);o.strm=r;const a=o.last_flush;if(o.last_flush=t,o.status===INIT_STATE)if(o.wrap===2)r.adler=0,put_byte(o,31),put_byte(o,139),put_byte(o,8),o.gzhead?(put_byte(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),put_byte(o,o.gzhead.time&255),put_byte(o,o.gzhead.time>>8&255),put_byte(o,o.gzhead.time>>16&255),put_byte(o,o.gzhead.time>>24&255),put_byte(o,o.level===9?2:o.strategy>=Z_HUFFMAN_ONLY||o.level<2?4:0),put_byte(o,o.gzhead.os&255),o.gzhead.extra&&o.gzhead.extra.length&&(put_byte(o,o.gzhead.extra.length&255),put_byte(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(r.adler=crc32$1(r.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=EXTRA_STATE):(put_byte(o,0),put_byte(o,0),put_byte(o,0),put_byte(o,0),put_byte(o,0),put_byte(o,o.level===9?2:o.strategy>=Z_HUFFMAN_ONLY||o.level<2?4:0),put_byte(o,OS_CODE),o.status=BUSY_STATE);else{let s=Z_DEFLATED$2+(o.w_bits-8<<4)<<8,d=-1;o.strategy>=Z_HUFFMAN_ONLY||o.level<2?d=0:o.level<6?d=1:o.level===6?d=2:d=3,s|=d<<6,o.strstart!==0&&(s|=PRESET_DICT),s+=31-s%31,o.status=BUSY_STATE,putShortMSB(o,s),o.strstart!==0&&(putShortMSB(o,r.adler>>>16),putShortMSB(o,r.adler&65535)),r.adler=1}if(o.status===EXTRA_STATE)if(o.gzhead.extra){for(e=o.pending;o.gzindex<(o.gzhead.extra.length&65535)&&!(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>e&&(r.adler=crc32$1(r.adler,o.pending_buf,o.pending-e,e)),flush_pending(r),e=o.pending,o.pending===o.pending_buf_size));)put_byte(o,o.gzhead.extra[o.gzindex]&255),o.gzindex++;o.gzhead.hcrc&&o.pending>e&&(r.adler=crc32$1(r.adler,o.pending_buf,o.pending-e,e)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=NAME_STATE)}else o.status=NAME_STATE;if(o.status===NAME_STATE)if(o.gzhead.name){e=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>e&&(r.adler=crc32$1(r.adler,o.pending_buf,o.pending-e,e)),flush_pending(r),e=o.pending,o.pending===o.pending_buf_size)){n=1;break}o.gzindex<o.gzhead.name.length?n=o.gzhead.name.charCodeAt(o.gzindex++)&255:n=0,put_byte(o,n)}while(n!==0);o.gzhead.hcrc&&o.pending>e&&(r.adler=crc32$1(r.adler,o.pending_buf,o.pending-e,e)),n===0&&(o.gzindex=0,o.status=COMMENT_STATE)}else o.status=COMMENT_STATE;if(o.status===COMMENT_STATE)if(o.gzhead.comment){e=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>e&&(r.adler=crc32$1(r.adler,o.pending_buf,o.pending-e,e)),flush_pending(r),e=o.pending,o.pending===o.pending_buf_size)){n=1;break}o.gzindex<o.gzhead.comment.length?n=o.gzhead.comment.charCodeAt(o.gzindex++)&255:n=0,put_byte(o,n)}while(n!==0);o.gzhead.hcrc&&o.pending>e&&(r.adler=crc32$1(r.adler,o.pending_buf,o.pending-e,e)),n===0&&(o.status=HCRC_STATE)}else o.status=HCRC_STATE;if(o.status===HCRC_STATE&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&flush_pending(r),o.pending+2<=o.pending_buf_size&&(put_byte(o,r.adler&255),put_byte(o,r.adler>>8&255),r.adler=0,o.status=BUSY_STATE)):o.status=BUSY_STATE),o.pending!==0){if(flush_pending(r),r.avail_out===0)return o.last_flush=-1,Z_OK$3}else if(r.avail_in===0&&rank(t)<=rank(a)&&t!==Z_FINISH$3)return err(r,Z_BUF_ERROR$1);if(o.status===FINISH_STATE&&r.avail_in!==0)return err(r,Z_BUF_ERROR$1);if(r.avail_in!==0||o.lookahead!==0||t!==Z_NO_FLUSH$2&&o.status!==FINISH_STATE){let s=o.strategy===Z_HUFFMAN_ONLY?deflate_huff(o,t):o.strategy===Z_RLE?deflate_rle(o,t):configuration_table[o.level].func(o,t);if((s===BS_FINISH_STARTED||s===BS_FINISH_DONE)&&(o.status=FINISH_STATE),s===BS_NEED_MORE||s===BS_FINISH_STARTED)return r.avail_out===0&&(o.last_flush=-1),Z_OK$3;if(s===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(o):t!==Z_BLOCK$1&&(_tr_stored_block(o,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(o.head),o.lookahead===0&&(o.strstart=0,o.block_start=0,o.insert=0))),flush_pending(r),r.avail_out===0))return o.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:o.wrap<=0?Z_STREAM_END$3:(o.wrap===2?(put_byte(o,r.adler&255),put_byte(o,r.adler>>8&255),put_byte(o,r.adler>>16&255),put_byte(o,r.adler>>24&255),put_byte(o,r.total_in&255),put_byte(o,r.total_in>>8&255),put_byte(o,r.total_in>>16&255),put_byte(o,r.total_in>>24&255)):(putShortMSB(o,r.adler>>>16),putShortMSB(o,r.adler&65535)),flush_pending(r),o.wrap>0&&(o.wrap=-o.wrap),o.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=r=>{if(!r||!r.state)return Z_STREAM_ERROR$2;const t=r.state.status;return t!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(r,Z_STREAM_ERROR$2):(r.state=null,t===BUSY_STATE?err(r,Z_DATA_ERROR$2):Z_OK$3)},deflateSetDictionary=(r,t)=>{let e=t.length;if(!r||!r.state)return Z_STREAM_ERROR$2;const n=r.state,o=n.wrap;if(o===2||o===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(o===1&&(r.adler=adler32$1(r.adler,t,e,0)),n.wrap=0,e>=n.w_size){o===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let u=new Uint8Array(n.w_size);u.set(t.subarray(e-n.w_size,e),0),t=u,e=n.w_size}const a=r.avail_in,s=r.next_in,d=r.input;for(r.avail_in=e,r.next_in=0,r.input=t,fill_window(n);n.lookahead>=MIN_MATCH;){let u=n.strstart,c=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[u+MIN_MATCH-1]),n.prev[u&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=u,u++;while(--c);n.strstart=u,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,r.next_in=s,r.input=d,r.avail_in=a,n.wrap=o,Z_OK$3};deflate$3.deflateInit=deflateInit;deflate$3.deflateInit2=deflateInit2;deflate$3.deflateReset=deflateReset;deflate$3.deflateResetKeep=deflateResetKeep;deflate$3.deflateSetHeader=deflateSetHeader;deflate$3.deflate=deflate$2;deflate$3.deflateEnd=deflateEnd;deflate$3.deflateSetDictionary=deflateSetDictionary;deflate$3.deflateInfo="pako deflate (from Nodeca project)";var common={};const _has=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);common.assign=function(r){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(!!e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)_has(e,n)&&(r[n]=e[n])}}return r};common.flattenChunks=r=>{let t=0;for(let n=0,o=r.length;n<o;n++)t+=r[n].length;const e=new Uint8Array(t);for(let n=0,o=0,a=r.length;n<a;n++){let s=r[n];e.set(s,o),o+=s.length}return e};var strings$2={};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(r){STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let r=0;r<256;r++)_utf8len[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;_utf8len[254]=_utf8len[254]=1;strings$2.string2buf=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let t,e,n,o,a,s=r.length,d=0;for(o=0;o<s;o++)e=r.charCodeAt(o),(e&64512)===55296&&o+1<s&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),d+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(d),a=0,o=0;a<d;o++)e=r.charCodeAt(o),(e&64512)===55296&&o+1<s&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),e<128?t[a++]=e:e<2048?(t[a++]=192|e>>>6,t[a++]=128|e&63):e<65536?(t[a++]=224|e>>>12,t[a++]=128|e>>>6&63,t[a++]=128|e&63):(t[a++]=240|e>>>18,t[a++]=128|e>>>12&63,t[a++]=128|e>>>6&63,t[a++]=128|e&63);return t};const buf2binstring=(r,t)=>{if(t<65534&&r.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,r.length===t?r:r.subarray(0,t));let e="";for(let n=0;n<t;n++)e+=String.fromCharCode(r[n]);return e};strings$2.buf2string=(r,t)=>{const e=t||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,t));let n,o;const a=new Array(e*2);for(o=0,n=0;n<e;){let s=r[n++];if(s<128){a[o++]=s;continue}let d=_utf8len[s];if(d>4){a[o++]=65533,n+=d-1;continue}for(s&=d===2?31:d===3?15:7;d>1&&n<e;)s=s<<6|r[n++]&63,d--;if(d>1){a[o++]=65533;continue}s<65536?a[o++]=s:(s-=65536,a[o++]=55296|s>>10&1023,a[o++]=56320|s&1023)}return buf2binstring(a,o)};strings$2.utf8border=(r,t)=>{t=t||r.length,t>r.length&&(t=r.length);let e=t-1;for(;e>=0&&(r[e]&192)===128;)e--;return e<0||e===0?t:e+_utf8len[r[e]]>t?e:t};function ZStream$2(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream$2;const zlib_deflate=deflate$3,utils$1=common,strings$1=strings$2,msg$1=messages,ZStream$1=zstream,toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(r){this.options=utils$1.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},r||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream$1,this.strm.avail_out=0;let e=zlib_deflate.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Z_OK$2)throw new Error(msg$1[e]);if(t.header&&zlib_deflate.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=strings$1.string2buf(t.dictionary):toString$1.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,e=zlib_deflate.deflateSetDictionary(this.strm,n),e!==Z_OK$2)throw new Error(msg$1[e]);this._dict_set=!0}}Deflate$1.prototype.push=function(r,t){const e=this.strm,n=this.options.chunkSize;let o,a;if(this.ended)return!1;for(t===~~t?a=t:a=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof r=="string"?e.input=strings$1.string2buf(r):toString$1.call(r)==="[object ArrayBuffer]"?e.input=new Uint8Array(r):e.input=r,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(a===Z_SYNC_FLUSH||a===Z_FULL_FLUSH)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(o=zlib_deflate.deflate(e,a),o===Z_STREAM_END$2)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),o=zlib_deflate.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Z_OK$2;if(e.avail_out===0){this.onData(e.output);continue}if(a>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(r){this.chunks.push(r)};Deflate$1.prototype.onEnd=function(r){r===Z_OK$2&&(this.result=utils$1.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function deflate$1(r,t){const e=new Deflate$1(t);if(e.push(r,!0),e.err)throw e.msg||msg$1[e.err];return e.result}function deflateRaw$1(r,t){return t=t||{},t.raw=!0,deflate$1(r,t)}function gzip$1(r,t){return t=t||{},t.gzip=!0,deflate$1(r,t)}deflate$4.Deflate=Deflate$1;deflate$4.deflate=deflate$1;deflate$4.deflateRaw=deflateRaw$1;deflate$4.gzip=gzip$1;deflate$4.constants=constants$2;var inflate$4={},inflate$3={};const BAD$1=30,TYPE$1=12;var inffast=function r(t,e){let n,o,a,s,d,u,c,l,f,h,p,m,S,g,y,E,T,C,P,x,$,I,A,v;const b=t.state;n=t.next_in,A=t.input,o=n+(t.avail_in-5),a=t.next_out,v=t.output,s=a-(e-t.avail_out),d=a+(t.avail_out-257),u=b.dmax,c=b.wsize,l=b.whave,f=b.wnext,h=b.window,p=b.hold,m=b.bits,S=b.lencode,g=b.distcode,y=(1<<b.lenbits)-1,E=(1<<b.distbits)-1;e:do{m<15&&(p+=A[n++]<<m,m+=8,p+=A[n++]<<m,m+=8),T=S[p&y];t:for(;;){if(C=T>>>24,p>>>=C,m-=C,C=T>>>16&255,C===0)v[a++]=T&65535;else if(C&16){P=T&65535,C&=15,C&&(m<C&&(p+=A[n++]<<m,m+=8),P+=p&(1<<C)-1,p>>>=C,m-=C),m<15&&(p+=A[n++]<<m,m+=8,p+=A[n++]<<m,m+=8),T=g[p&E];i:for(;;){if(C=T>>>24,p>>>=C,m-=C,C=T>>>16&255,C&16){if(x=T&65535,C&=15,m<C&&(p+=A[n++]<<m,m+=8,m<C&&(p+=A[n++]<<m,m+=8)),x+=p&(1<<C)-1,x>u){t.msg="invalid distance too far back",b.mode=BAD$1;break e}if(p>>>=C,m-=C,C=a-s,x>C){if(C=x-C,C>l&&b.sane){t.msg="invalid distance too far back",b.mode=BAD$1;break e}if($=0,I=h,f===0){if($+=c-C,C<P){P-=C;do v[a++]=h[$++];while(--C);$=a-x,I=v}}else if(f<C){if($+=c+f-C,C-=f,C<P){P-=C;do v[a++]=h[$++];while(--C);if($=0,f<P){C=f,P-=C;do v[a++]=h[$++];while(--C);$=a-x,I=v}}}else if($+=f-C,C<P){P-=C;do v[a++]=h[$++];while(--C);$=a-x,I=v}for(;P>2;)v[a++]=I[$++],v[a++]=I[$++],v[a++]=I[$++],P-=3;P&&(v[a++]=I[$++],P>1&&(v[a++]=I[$++]))}else{$=a-x;do v[a++]=v[$++],v[a++]=v[$++],v[a++]=v[$++],P-=3;while(P>2);P&&(v[a++]=v[$++],P>1&&(v[a++]=v[$++]))}}else if((C&64)===0){T=g[(T&65535)+(p&(1<<C)-1)];continue i}else{t.msg="invalid distance code",b.mode=BAD$1;break e}break}}else if((C&64)===0){T=S[(T&65535)+(p&(1<<C)-1)];continue t}else if(C&32){b.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",b.mode=BAD$1;break e}break}}while(n<o&&a<d);P=m>>3,n-=P,m-=P<<3,p&=(1<<m)-1,t.next_in=n,t.next_out=a,t.avail_in=n<o?5+(o-n):5-(n-o),t.avail_out=a<d?257+(d-a):257-(a-d),b.hold=p,b.bits=m};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table$1=(r,t,e,n,o,a,s,d)=>{const u=d.bits;let c=0,l=0,f=0,h=0,p=0,m=0,S=0,g=0,y=0,E=0,T,C,P,x,$,I=null,A=0,v;const b=new Uint16Array(MAXBITS+1),k=new Uint16Array(MAXBITS+1);let D=null,R=0,O,B,F;for(c=0;c<=MAXBITS;c++)b[c]=0;for(l=0;l<n;l++)b[t[e+l]]++;for(p=u,h=MAXBITS;h>=1&&b[h]===0;h--);if(p>h&&(p=h),h===0)return o[a++]=1<<24|64<<16|0,o[a++]=1<<24|64<<16|0,d.bits=1,0;for(f=1;f<h&&b[f]===0;f++);for(p<f&&(p=f),g=1,c=1;c<=MAXBITS;c++)if(g<<=1,g-=b[c],g<0)return-1;if(g>0&&(r===CODES$1||h!==1))return-1;for(k[1]=0,c=1;c<MAXBITS;c++)k[c+1]=k[c]+b[c];for(l=0;l<n;l++)t[e+l]!==0&&(s[k[t[e+l]]++]=l);if(r===CODES$1?(I=D=s,v=19):r===LENS$1?(I=lbase,A-=257,D=lext,R-=257,v=256):(I=dbase,D=dext,v=-1),E=0,l=0,c=f,$=a,m=p,S=0,P=-1,y=1<<p,x=y-1,r===LENS$1&&y>ENOUGH_LENS$1||r===DISTS$1&&y>ENOUGH_DISTS$1)return 1;for(;;){O=c-S,s[l]<v?(B=0,F=s[l]):s[l]>v?(B=D[R+s[l]],F=I[A+s[l]]):(B=32+64,F=0),T=1<<c-S,C=1<<m,f=C;do C-=T,o[$+(E>>S)+C]=O<<24|B<<16|F|0;while(C!==0);for(T=1<<c-1;E&T;)T>>=1;if(T!==0?(E&=T-1,E+=T):E=0,l++,--b[c]===0){if(c===h)break;c=t[e+s[l]]}if(c>p&&(E&x)!==P){for(S===0&&(S=p),$+=f,m=c-S,g=1<<m;m+S<h&&(g-=b[m+S],!(g<=0));)m++,g<<=1;if(y+=1<<m,r===LENS$1&&y>ENOUGH_LENS$1||r===DISTS$1&&y>ENOUGH_DISTS$1)return 1;P=E&x,o[P]=p<<24|m<<16|$-a|0}}return E!==0&&(o[$+E]=c-S<<24|64<<16|0),d.bits=p,0};var inftrees=inflate_table$1;const adler32=adler32_1,crc32=crc32_1,inflate_fast=inffast,inflate_table=inftrees,CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateResetKeep=r=>{if(!r||!r.state)return Z_STREAM_ERROR$1;const t=r.state;return r.total_in=r.total_out=t.total=0,r.msg="",t.wrap&&(r.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=r=>{if(!r||!r.state)return Z_STREAM_ERROR$1;const t=r.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(r)},inflateReset2=(r,t)=>{let e;if(!r||!r.state)return Z_STREAM_ERROR$1;const n=r.state;return t<0?(e=0,t=-t):(e=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=e,n.wbits=t,inflateReset(r))},inflateInit2=(r,t)=>{if(!r)return Z_STREAM_ERROR$1;const e=new InflateState;r.state=e,e.window=null;const n=inflateReset2(r,t);return n!==Z_OK$1&&(r.state=null),n},inflateInit=r=>inflateInit2(r,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=r=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)r.lens[t++]=8;for(;t<256;)r.lens[t++]=9;for(;t<280;)r.lens[t++]=7;for(;t<288;)r.lens[t++]=8;for(inflate_table(LENS,r.lens,0,288,lenfix,0,r.work,{bits:9}),t=0;t<32;)r.lens[t++]=5;inflate_table(DISTS,r.lens,0,32,distfix,0,r.work,{bits:5}),virgin=!1}r.lencode=lenfix,r.lenbits=9,r.distcode=distfix,r.distbits=5},updatewindow=(r,t,e,n)=>{let o;const a=r.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>n&&(o=n),a.window.set(t.subarray(e-n,e-n+o),a.wnext),n-=o,n?(a.window.set(t.subarray(e-n,e),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0},inflate$2=(r,t)=>{let e,n,o,a,s,d,u,c,l,f,h,p,m,S,g=0,y,E,T,C,P,x,$,I;const A=new Uint8Array(4);let v,b;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return Z_STREAM_ERROR$1;e=r.state,e.mode===TYPE&&(e.mode=TYPEDO),s=r.next_out,o=r.output,u=r.avail_out,a=r.next_in,n=r.input,d=r.avail_in,c=e.hold,l=e.bits,f=d,h=u,I=Z_OK$1;e:for(;;)switch(e.mode){case HEAD:if(e.wrap===0){e.mode=TYPEDO;break}for(;l<16;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(e.wrap&2&&c===35615){e.check=0,A[0]=c&255,A[1]=c>>>8&255,e.check=crc32(e.check,A,2,0),c=0,l=0,e.mode=FLAGS;break}if(e.flags=0,e.head&&(e.head.done=!1),!(e.wrap&1)||(((c&255)<<8)+(c>>8))%31){r.msg="incorrect header check",e.mode=BAD;break}if((c&15)!==Z_DEFLATED){r.msg="unknown compression method",e.mode=BAD;break}if(c>>>=4,l-=4,$=(c&15)+8,e.wbits===0)e.wbits=$;else if($>e.wbits){r.msg="invalid window size",e.mode=BAD;break}e.dmax=1<<e.wbits,r.adler=e.check=1,e.mode=c&512?DICTID:TYPE,c=0,l=0;break;case FLAGS:for(;l<16;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(e.flags=c,(e.flags&255)!==Z_DEFLATED){r.msg="unknown compression method",e.mode=BAD;break}if(e.flags&57344){r.msg="unknown header flags set",e.mode=BAD;break}e.head&&(e.head.text=c>>8&1),e.flags&512&&(A[0]=c&255,A[1]=c>>>8&255,e.check=crc32(e.check,A,2,0)),c=0,l=0,e.mode=TIME;case TIME:for(;l<32;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}e.head&&(e.head.time=c),e.flags&512&&(A[0]=c&255,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,e.check=crc32(e.check,A,4,0)),c=0,l=0,e.mode=OS;case OS:for(;l<16;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}e.head&&(e.head.xflags=c&255,e.head.os=c>>8),e.flags&512&&(A[0]=c&255,A[1]=c>>>8&255,e.check=crc32(e.check,A,2,0)),c=0,l=0,e.mode=EXLEN;case EXLEN:if(e.flags&1024){for(;l<16;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}e.length=c,e.head&&(e.head.extra_len=c),e.flags&512&&(A[0]=c&255,A[1]=c>>>8&255,e.check=crc32(e.check,A,2,0)),c=0,l=0}else e.head&&(e.head.extra=null);e.mode=EXTRA;case EXTRA:if(e.flags&1024&&(p=e.length,p>d&&(p=d),p&&(e.head&&($=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(a,a+p),$)),e.flags&512&&(e.check=crc32(e.check,n,p,a)),d-=p,a+=p,e.length-=p),e.length))break e;e.length=0,e.mode=NAME;case NAME:if(e.flags&2048){if(d===0)break e;p=0;do $=n[a+p++],e.head&&$&&e.length<65536&&(e.head.name+=String.fromCharCode($));while($&&p<d);if(e.flags&512&&(e.check=crc32(e.check,n,p,a)),d-=p,a+=p,$)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=COMMENT;case COMMENT:if(e.flags&4096){if(d===0)break e;p=0;do $=n[a+p++],e.head&&$&&e.length<65536&&(e.head.comment+=String.fromCharCode($));while($&&p<d);if(e.flags&512&&(e.check=crc32(e.check,n,p,a)),d-=p,a+=p,$)break e}else e.head&&(e.head.comment=null);e.mode=HCRC;case HCRC:if(e.flags&512){for(;l<16;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(c!==(e.check&65535)){r.msg="header crc mismatch",e.mode=BAD;break}c=0,l=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),r.adler=e.check=0,e.mode=TYPE;break;case DICTID:for(;l<32;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}r.adler=e.check=zswap32(c),c=0,l=0,e.mode=DICT;case DICT:if(e.havedict===0)return r.next_out=s,r.avail_out=u,r.next_in=a,r.avail_in=d,e.hold=c,e.bits=l,Z_NEED_DICT$1;r.adler=e.check=1,e.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(e.last){c>>>=l&7,l-=l&7,e.mode=CHECK;break}for(;l<3;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}switch(e.last=c&1,c>>>=1,l-=1,c&3){case 0:e.mode=STORED;break;case 1:if(fixedtables(e),e.mode=LEN_,t===Z_TREES){c>>>=2,l-=2;break e}break;case 2:e.mode=TABLE;break;case 3:r.msg="invalid block type",e.mode=BAD}c>>>=2,l-=2;break;case STORED:for(c>>>=l&7,l-=l&7;l<32;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if((c&65535)!==(c>>>16^65535)){r.msg="invalid stored block lengths",e.mode=BAD;break}if(e.length=c&65535,c=0,l=0,e.mode=COPY_,t===Z_TREES)break e;case COPY_:e.mode=COPY;case COPY:if(p=e.length,p){if(p>d&&(p=d),p>u&&(p=u),p===0)break e;o.set(n.subarray(a,a+p),s),d-=p,a+=p,u-=p,s+=p,e.length-=p;break}e.mode=TYPE;break;case TABLE:for(;l<14;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(e.nlen=(c&31)+257,c>>>=5,l-=5,e.ndist=(c&31)+1,c>>>=5,l-=5,e.ncode=(c&15)+4,c>>>=4,l-=4,e.nlen>286||e.ndist>30){r.msg="too many length or distance symbols",e.mode=BAD;break}e.have=0,e.mode=LENLENS;case LENLENS:for(;e.have<e.ncode;){for(;l<3;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}e.lens[k[e.have++]]=c&7,c>>>=3,l-=3}for(;e.have<19;)e.lens[k[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,v={bits:e.lenbits},I=inflate_table(CODES,e.lens,0,19,e.lencode,0,e.work,v),e.lenbits=v.bits,I){r.msg="invalid code lengths set",e.mode=BAD;break}e.have=0,e.mode=CODELENS;case CODELENS:for(;e.have<e.nlen+e.ndist;){for(;g=e.lencode[c&(1<<e.lenbits)-1],y=g>>>24,E=g>>>16&255,T=g&65535,!(y<=l);){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(T<16)c>>>=y,l-=y,e.lens[e.have++]=T;else{if(T===16){for(b=y+2;l<b;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(c>>>=y,l-=y,e.have===0){r.msg="invalid bit length repeat",e.mode=BAD;break}$=e.lens[e.have-1],p=3+(c&3),c>>>=2,l-=2}else if(T===17){for(b=y+3;l<b;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}c>>>=y,l-=y,$=0,p=3+(c&7),c>>>=3,l-=3}else{for(b=y+7;l<b;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}c>>>=y,l-=y,$=0,p=11+(c&127),c>>>=7,l-=7}if(e.have+p>e.nlen+e.ndist){r.msg="invalid bit length repeat",e.mode=BAD;break}for(;p--;)e.lens[e.have++]=$}}if(e.mode===BAD)break;if(e.lens[256]===0){r.msg="invalid code -- missing end-of-block",e.mode=BAD;break}if(e.lenbits=9,v={bits:e.lenbits},I=inflate_table(LENS,e.lens,0,e.nlen,e.lencode,0,e.work,v),e.lenbits=v.bits,I){r.msg="invalid literal/lengths set",e.mode=BAD;break}if(e.distbits=6,e.distcode=e.distdyn,v={bits:e.distbits},I=inflate_table(DISTS,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,v),e.distbits=v.bits,I){r.msg="invalid distances set",e.mode=BAD;break}if(e.mode=LEN_,t===Z_TREES)break e;case LEN_:e.mode=LEN;case LEN:if(d>=6&&u>=258){r.next_out=s,r.avail_out=u,r.next_in=a,r.avail_in=d,e.hold=c,e.bits=l,inflate_fast(r,h),s=r.next_out,o=r.output,u=r.avail_out,a=r.next_in,n=r.input,d=r.avail_in,c=e.hold,l=e.bits,e.mode===TYPE&&(e.back=-1);break}for(e.back=0;g=e.lencode[c&(1<<e.lenbits)-1],y=g>>>24,E=g>>>16&255,T=g&65535,!(y<=l);){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(E&&(E&240)===0){for(C=y,P=E,x=T;g=e.lencode[x+((c&(1<<C+P)-1)>>C)],y=g>>>24,E=g>>>16&255,T=g&65535,!(C+y<=l);){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}c>>>=C,l-=C,e.back+=C}if(c>>>=y,l-=y,e.back+=y,e.length=T,E===0){e.mode=LIT;break}if(E&32){e.back=-1,e.mode=TYPE;break}if(E&64){r.msg="invalid literal/length code",e.mode=BAD;break}e.extra=E&15,e.mode=LENEXT;case LENEXT:if(e.extra){for(b=e.extra;l<b;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=DIST;case DIST:for(;g=e.distcode[c&(1<<e.distbits)-1],y=g>>>24,E=g>>>16&255,T=g&65535,!(y<=l);){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if((E&240)===0){for(C=y,P=E,x=T;g=e.distcode[x+((c&(1<<C+P)-1)>>C)],y=g>>>24,E=g>>>16&255,T=g&65535,!(C+y<=l);){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}c>>>=C,l-=C,e.back+=C}if(c>>>=y,l-=y,e.back+=y,E&64){r.msg="invalid distance code",e.mode=BAD;break}e.offset=T,e.extra=E&15,e.mode=DISTEXT;case DISTEXT:if(e.extra){for(b=e.extra;l<b;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){r.msg="invalid distance too far back",e.mode=BAD;break}e.mode=MATCH;case MATCH:if(u===0)break e;if(p=h-u,e.offset>p){if(p=e.offset-p,p>e.whave&&e.sane){r.msg="invalid distance too far back",e.mode=BAD;break}p>e.wnext?(p-=e.wnext,m=e.wsize-p):m=e.wnext-p,p>e.length&&(p=e.length),S=e.window}else S=o,m=s-e.offset,p=e.length;p>u&&(p=u),u-=p,e.length-=p;do o[s++]=S[m++];while(--p);e.length===0&&(e.mode=LEN);break;case LIT:if(u===0)break e;o[s++]=e.length,u--,e.mode=LEN;break;case CHECK:if(e.wrap){for(;l<32;){if(d===0)break e;d--,c|=n[a++]<<l,l+=8}if(h-=u,r.total_out+=h,e.total+=h,h&&(r.adler=e.check=e.flags?crc32(e.check,o,h,s-h):adler32(e.check,o,h,s-h)),h=u,(e.flags?c:zswap32(c))!==e.check){r.msg="incorrect data check",e.mode=BAD;break}c=0,l=0}e.mode=LENGTH;case LENGTH:if(e.wrap&&e.flags){for(;l<32;){if(d===0)break e;d--,c+=n[a++]<<l,l+=8}if(c!==(e.total&4294967295)){r.msg="incorrect length check",e.mode=BAD;break}c=0,l=0}e.mode=DONE;case DONE:I=Z_STREAM_END$1;break e;case BAD:I=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return r.next_out=s,r.avail_out=u,r.next_in=a,r.avail_in=d,e.hold=c,e.bits=l,(e.wsize||h!==r.avail_out&&e.mode<BAD&&(e.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(r,r.output,r.next_out,h-r.avail_out),f-=r.avail_in,h-=r.avail_out,r.total_in+=f,r.total_out+=h,e.total+=h,e.wrap&&h&&(r.adler=e.check=e.flags?crc32(e.check,o,h,r.next_out-h):adler32(e.check,o,h,r.next_out-h)),r.data_type=e.bits+(e.last?64:0)+(e.mode===TYPE?128:0)+(e.mode===LEN_||e.mode===COPY_?256:0),(f===0&&h===0||t===Z_FINISH$1)&&I===Z_OK$1&&(I=Z_BUF_ERROR),I},inflateEnd=r=>{if(!r||!r.state)return Z_STREAM_ERROR$1;let t=r.state;return t.window&&(t.window=null),r.state=null,Z_OK$1},inflateGetHeader=(r,t)=>{if(!r||!r.state)return Z_STREAM_ERROR$1;const e=r.state;return(e.wrap&2)===0?Z_STREAM_ERROR$1:(e.head=t,t.done=!1,Z_OK$1)},inflateSetDictionary=(r,t)=>{const e=t.length;let n,o,a;return!r||!r.state||(n=r.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(o=1,o=adler32(o,t,e,0),o!==n.check)?Z_DATA_ERROR$1:(a=updatewindow(r,t,e,e),a?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};inflate$3.inflateReset=inflateReset;inflate$3.inflateReset2=inflateReset2;inflate$3.inflateResetKeep=inflateResetKeep;inflate$3.inflateInit=inflateInit;inflate$3.inflateInit2=inflateInit2;inflate$3.inflate=inflate$2;inflate$3.inflateEnd=inflateEnd;inflate$3.inflateGetHeader=inflateGetHeader;inflate$3.inflateSetDictionary=inflateSetDictionary;inflate$3.inflateInfo="pako inflate (from Nodeca project)";function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader$1;const zlib_inflate=inflate$3,utils=common,strings=strings$2,msg=messages,ZStream=zstream,GZheader=gzheader,toString=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(r){this.options=utils.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(r&&r.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;let e=zlib_inflate.inflateInit2(this.strm,t.windowBits);if(e!==Z_OK)throw new Error(msg[e]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=zlib_inflate.inflateSetDictionary(this.strm,t.dictionary),e!==Z_OK)))throw new Error(msg[e])}Inflate$1.prototype.push=function(r,t){const e=this.strm,n=this.options.chunkSize,o=this.options.dictionary;let a,s,d;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Z_FINISH:Z_NO_FLUSH,toString.call(r)==="[object ArrayBuffer]"?e.input=new Uint8Array(r):e.input=r,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),a=zlib_inflate.inflate(e,s),a===Z_NEED_DICT&&o&&(a=zlib_inflate.inflateSetDictionary(e,o),a===Z_OK?a=zlib_inflate.inflate(e,s):a===Z_DATA_ERROR&&(a=Z_NEED_DICT));e.avail_in>0&&a===Z_STREAM_END&&e.state.wrap>0&&r[e.next_in]!==0;)zlib_inflate.inflateReset(e),a=zlib_inflate.inflate(e,s);switch(a){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(a),this.ended=!0,!1}if(d=e.avail_out,e.next_out&&(e.avail_out===0||a===Z_STREAM_END))if(this.options.to==="string"){let u=strings.utf8border(e.output,e.next_out),c=e.next_out-u,l=strings.buf2string(e.output,u);e.next_out=c,e.avail_out=n-c,c&&e.output.set(e.output.subarray(u,u+c),0),this.onData(l)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===Z_OK&&d===0)){if(a===Z_STREAM_END)return a=zlib_inflate.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(r){this.chunks.push(r)};Inflate$1.prototype.onEnd=function(r){r===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function inflate$1(r,t){const e=new Inflate$1(t);if(e.push(r),e.err)throw e.msg||msg[e.err];return e.result}function inflateRaw$1(r,t){return t=t||{},t.raw=!0,inflate$1(r,t)}inflate$4.Inflate=Inflate$1;inflate$4.inflate=inflate$1;inflate$4.inflateRaw=inflateRaw$1;inflate$4.ungzip=inflate$1;inflate$4.constants=constants$2;const{Deflate,deflate,deflateRaw,gzip}=deflate$4,{Inflate,inflate,inflateRaw,ungzip}=inflate$4,constants$1=constants$2;pako$1.Deflate=Deflate;pako$1.deflate=deflate;pako$1.deflateRaw=deflateRaw;pako$1.gzip=gzip;pako$1.Inflate=Inflate;pako$1.inflate=inflate;pako$1.inflateRaw=inflateRaw;pako$1.ungzip=ungzip;pako$1.constants=constants$1;Object.defineProperty(ZLIBTextCompressor$1,"__esModule",{value:!0});const pako=pako$1;class ZLIBTextCompressor{constructor(t){this.logger=t}compress(t,e){if(e.length>0){const a=Math.min(e.length,ZLIBTextCompressor.MAX_DICTIONARY_SIZE);e=e.slice(0,a)}const n={memLevel:ZLIBTextCompressor.Z_MEM_LEVEL,dictionary:e};return pako.deflateRaw(t,n)}decompress(t,e){if(e.length>0){const a=Math.min(e.length,ZLIBTextCompressor.MAX_DICTIONARY_SIZE);e=e.slice(0,a)}const n={to:"string",dictionary:e,chunkSize:4096};let o="";try{o=pako.inflateRaw(t,n)}catch(a){this.logger.error(`failed to decompress the string with error: [${a}]`)}return o}}ZLIBTextCompressor$1.default=ZLIBTextCompressor;ZLIBTextCompressor.Z_MEM_LEVEL=9;ZLIBTextCompressor.MAX_DICTIONARY_SIZE=31744;var SignalingClientSubscribe$1={};Object.defineProperty(SignalingClientSubscribe$1,"__esModule",{value:!0});class SignalingClientSubscribe{constructor(t,e,n,o,a,s,d,u,c,l){this.attendeeId=t,this.sdpOffer=e,this.audioHost=n,this.audioMuted=o,this.audioCheckin=a,this.receiveStreamIds=s,this.localVideoEnabled=d,this.videoStreamDescriptions=u,this.connectionTypeHasVideo=c,this.compressedSdpOffer=l,this.videoSubscriptionConfiguration=[]}}SignalingClientSubscribe$1.default=SignalingClientSubscribe;var __awaiter$s=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SubscribeAndReceiveSubscribeAckTask$1,"__esModule",{value:!0});const MeetingSessionStatus_1=MeetingSessionStatus$1,MeetingSessionStatusCode_1$1=MeetingSessionStatusCode,SDP_1=SDP$1,ZLIBTextCompressor_1=ZLIBTextCompressor$1,ServerSideNetworkAdaption_1$2=ServerSideNetworkAdaption,SignalingClientEventType_1=SignalingClientEventType,SignalingClientSubscribe_1=SignalingClientSubscribe$1,SignalingClientVideoSubscriptionConfiguration_1=SignalingClientVideoSubscriptionConfiguration$1,SignalingProtocol_js_1$3=SignalingProtocol,BaseTask_1$4=BaseTask$1;class SubscribeAndReceiveSubscribeAckTask extends BaseTask_1$4.default{constructor(t){super(t.logger),this.context=t,this.taskName="SubscribeAndReceiveSubscribeAckTask",this.taskCanceler=null,this.textCompressor=new ZLIBTextCompressor_1.default(t.logger)}cancel(){this.taskCanceler&&(this.taskCanceler.cancel(),this.taskCanceler=null)}run(){return __awaiter$s(this,void 0,void 0,function*(){let t="";if(this.context.peer&&this.context.peer.localDescription&&(t=new SDP_1.default(this.context.peer.localDescription.sdp).withUnifiedPlanFormat().sdp),!this.context.enableSimulcast){let c=0,l=0;this.context.videoCaptureAndEncodeParameter&&(c=this.context.videoCaptureAndEncodeParameter.captureFrameRate(),l=this.context.videoCaptureAndEncodeParameter.encodeBitrates()[0]);const f={rid:"hi",maxBitrate:l*1e3,maxFramerate:c,active:!0};this.context.videoStreamIndex.integrateUplinkPolicyDecision([f])}this.context.videoStreamIndex.subscribeFrameSent();const e=this.fixUpSubscriptionOrder(t,this.context.videoSubscriptions),n=this.context.videoDuplexMode===SignalingProtocol_js_1$3.SdkStreamServiceType.TX||this.context.videoDuplexMode===SignalingProtocol_js_1$3.SdkStreamServiceType.DUPLEX;let o;const a=t;if(this.context.serverSupportsCompression){const c=this.context.previousSdpOffer?this.context.previousSdpOffer.sdp:"";o=this.textCompressor.compress(a,c),this.context.logger.info(`Compressed the SDP message from ${a.length} to ${o.length} bytes.`),t=""}this.context.previousSdpOffer=new SDP_1.default(a);const s=new SignalingClientSubscribe_1.default(this.context.meetingSessionConfiguration.credentials.attendeeId,t,this.context.meetingSessionConfiguration.urls.audioHostURL,this.context.realtimeController.realtimeIsLocalAudioMuted(),!1,e,n,this.context.videoStreamIndex.localStreamDescriptions(),!0,o);this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption!==void 0&&this.context.videoDownlinkBandwidthPolicy.getServerSideNetworkAdaption()!==ServerSideNetworkAdaption_1$2.default.None&&this.context.videoDownlinkBandwidthPolicy.getVideoPreferences!==void 0&&(s.videoSubscriptionConfiguration=this.convertVideoPreferencesToVideoSubscriptionConfiguration(e,this.context.videoDownlinkBandwidthPolicy.getVideoPreferences())),this.context.logger.info(`sending subscribe: ${JSON.stringify(s)}`),this.context.signalingClient.subscribe(s);const d=yield this.receiveSubscribeAck();this.context.logger.info(`got subscribe ack: ${JSON.stringify(d)}`);let u="";d.compressedSdpAnswer&&d.compressedSdpAnswer.length?(u=this.textCompressor.decompress(d.compressedSdpAnswer,this.context.previousSdpAnswerAsString),u.length===0&&(this.context.sdpAnswer="",this.context.previousSdpAnswerAsString="",this.logAndThrow("Error occurred while trying to decompress the SDP answer.")),this.context.logger.info(`Decompressed the SDP message from ${d.compressedSdpAnswer.length} to ${u.length} bytes.`),this.context.sdpAnswer=u):this.context.sdpAnswer=d.sdpAnswer,this.context.previousSdpAnswerAsString=this.context.sdpAnswer,this.context.videoStreamIndex.integrateSubscribeAckFrame(d)})}fixUpSubscriptionOrder(t,e){if(this.context.transceiverController.getMidForStreamId===void 0)return e;const n=new Map;for(const s of e){const d=this.context.transceiverController.getMidForStreamId(s);if(d===void 0){s!==0&&this.logger.warn(`Could not find MID for stream ID: ${s}`);continue}n.set(d,s)}const o=new SDP_1.default(t).mediaSections(),a=[];for(const s of o)if(s.mediaType==="video")if(s.direction==="recvonly"){const d=n.get(s.mid);if(d===void 0){this.logger.warn(`Could not find stream ID for MID: ${s.mid}`);continue}a.push(d)}else a.push(0);return this.logger.info(`Fixed up ${JSON.stringify(e)} to ${JSON.stringify(a)} (may be same))}`),a}convertVideoPreferencesToVideoSubscriptionConfiguration(t,e){if(this.context.transceiverController.getMidForStreamId===void 0||e===void 0)return[];const n=new Array,o=new Map,a=new Map;for(const s of t){const d=this.context.transceiverController.getMidForStreamId(s);if(d===void 0){s!==0&&this.context.logger.warn(`Could not find MID for stream ID: ${s}`);continue}const u=this.context.videoStreamIndex.attendeeIdForStreamId(s);o.set(u,d),a.set(u,this.context.videoStreamIndex.groupIdForStreamId(s))}for(const s of e){const d=new SignalingClientVideoSubscriptionConfiguration_1.default,u=o.get(s.attendeeId);if(u===void 0){this.context.logger.warn(`Could not find MID for attendee ID: ${s.attendeeId}`);continue}d.mid=u,d.attendeeId=s.attendeeId,d.groupId=a.get(s.attendeeId),d.priority=Number.MAX_SAFE_INTEGER-s.priority,d.targetBitrateKbps=s.targetSizeToBitrateKbps(s.targetSize),n.push(d)}return n}receiveSubscribeAck(){return new Promise((t,e)=>{const n=this.context;class o{constructor(d){this.signalingClient=d}cancel(){this.signalingClient.removeObserver(this),e(new Error("SubscribeAndReceiveSubscribeAckTask got canceled while waiting for SdkSubscribeAckFrame"))}handleSignalingClientEvent(d){if(d.isConnectionTerminated()){const c=`SubscribeAndReceiveSubscribeAckTask connection was terminated with code ${d.closeCode} and reason: ${d.closeReason}`;n.logger.warn(c);let l=MeetingSessionStatusCode_1$1.default.TaskFailed;d.closeCode>=4500&&d.closeCode<4600&&(l=MeetingSessionStatusCode_1$1.default.SignalingInternalServerError),n.audioVideoController.handleMeetingSessionStatus(new MeetingSessionStatus_1.default(l),new Error(c));return}if(d.type!==SignalingClientEventType_1.default.ReceivedSignalFrame||d.message.type!==SignalingProtocol_js_1$3.SdkSignalFrame.Type.SUBSCRIBE_ACK)return;this.signalingClient.removeObserver(this);const u=d.message.suback;t(u)}}const a=new o(this.context.signalingClient);this.context.signalingClient.registerObserver(a),this.taskCanceler=a})}}SubscribeAndReceiveSubscribeAckTask$1.default=SubscribeAndReceiveSubscribeAckTask;var TimeoutTask$1={},__awaiter$r=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(TimeoutTask$1,"__esModule",{value:!0});const TimeoutScheduler_1$1=TimeoutScheduler$1,BaseTask_1$3=BaseTask$1;class TimeoutTask extends BaseTask_1$3.default{constructor(t,e,n){super(t),this.taskToRunBeforeTimeout=e,this.timeoutMs=n,this.taskName=`Timeout${this.timeoutMs}ms`,e.setParent(this)}cancel(){this.logger.info(`canceling timeout task ${this.name()} subtask ${this.taskToRunBeforeTimeout}`),this.taskToRunBeforeTimeout.cancel()}run(){return __awaiter$r(this,void 0,void 0,function*(){const t=new TimeoutScheduler_1$1.default(this.timeoutMs);t.start(()=>{this.logger.info(`timeout reached for task ${this.name()}`),this.taskToRunBeforeTimeout.cancel()});try{yield this.taskToRunBeforeTimeout.run()}finally{t.stop()}this.logger.info(`timeout task ${this.name()} completed`)})}}TimeoutTask$1.default=TimeoutTask;var WaitForAttendeePresenceTask$1={},__awaiter$q=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(WaitForAttendeePresenceTask$1,"__esModule",{value:!0});const MeetingSessionStatusCode_1=MeetingSessionStatusCode,BaseTask_1$2=BaseTask$1;class WaitForAttendeePresenceTask extends BaseTask_1$2.default{constructor(t){super(t.logger),this.context=t,this.taskName="WaitForAttendeePresenceTask"}cancel(){if(this.cancelPromise){const t=new Error(`canceling ${this.name()} due to the meeting status code: ${MeetingSessionStatusCode_1.default.NoAttendeePresent}`);this.cancelPromise(t),delete this.cancelPromise}}run(){return __awaiter$q(this,void 0,void 0,function*(){const t=this.context.meetingSessionConfiguration.credentials.attendeeId;return new Promise((e,n)=>{const o=(a,s,d,u,c)=>{t===a&&s&&(this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(o),e(),delete this.cancelPromise)};this.cancelPromise=a=>{this.context.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(o),n(a)},this.context.realtimeController.realtimeSubscribeToAttendeeIdPresence(o)})})}}WaitForAttendeePresenceTask$1.default=WaitForAttendeePresenceTask;var DefaultTransceiverController$1={},__awaiter$p=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultTransceiverController$1,"__esModule",{value:!0});class DefaultTransceiverController{constructor(t,e){this.logger=t,this.browserBehavior=e,this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null,this.streamIdToTransceiver=new Map}setEncodingParameters(t){return __awaiter$p(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const e=this._localCameraTransceiver.sender;if(!t||t.size===0)return;const n=Array.from(t.values()),o=e.getParameters();if(!o.encodings||o.encodings.length===0)o.encodings=n;else for(const a of o.encodings)for(const s of n){if((a.rid||s.rid)&&a.rid!==s.rid)continue;let d;for(d in s)d==="rid"||d==="codecPayloadType"||s.hasOwnProperty(d)&&(a[d]=s[d])}yield e.setParameters(o)})}localAudioTransceiver(){return this._localAudioTransceiver}localVideoTransceiver(){return this._localCameraTransceiver}setVideoSendingBitrateKbps(t){return __awaiter$p(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const e=this._localCameraTransceiver.sender;if(!e||t<=0)return;const n=e.getParameters();n.encodings||(n.encodings=[{}]);for(const o of n.encodings)o.maxBitrate=t*1e3;yield e.setParameters(n)})}setPeer(t){this.peer=t}reset(){this._localCameraTransceiver=null,this._localAudioTransceiver=null,this.videoSubscriptions=[],this.defaultMediaStream=null,this.peer=null}useTransceivers(){return!!this.peer&&typeof this.peer.getTransceivers<"u"}hasVideoInput(){return!(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")}trackIsVideoInput(t){return this._localCameraTransceiver?t===this._localCameraTransceiver.sender.track||t===this._localCameraTransceiver.receiver.track:!1}setupLocalTransceivers(){!this.useTransceivers()||(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]})),this._localCameraTransceiver||(this._localCameraTransceiver=this.peer.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}replaceAudioTrack(t){return __awaiter$p(this,void 0,void 0,function*(){return!this._localAudioTransceiver||this._localAudioTransceiver.direction!=="sendrecv"?(this.logger.info("audio transceiver direction is not set up or not activated"),!1):(yield this._localAudioTransceiver.sender.replaceTrack(t),!0)})}setAudioInput(t){return __awaiter$p(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localAudioTransceiver,t)})}setVideoInput(t){return __awaiter$p(this,void 0,void 0,function*(){yield this.setTransceiverInput(this._localCameraTransceiver,t)})}updateVideoTransceivers(t,e){if(!this.useTransceivers())return e.array();const n=this.peer.getTransceivers();return this.videoSubscriptions=[0],e=e.clone(),this.updateTransceivers(n,t,e),this.logger.debug(()=>this.debugDumpTransceivers()),this.videoSubscriptions}updateTransceivers(t,e,n){const o=n.array();t.length!==0&&!t[0].stop?(this.logger.info("Updating transceivers without `stop` function"),this.updateTransceiverWithoutStop(t,e,o)):t.length!==0&&this.updateTransceiverWithStop(t,e,o);for(const a of o){const s=this.peer.addTransceiver("video",{direction:"recvonly",streams:[new MediaStream]});this.streamIdToTransceiver.set(a,s),this.videoSubscriptions.push(a),this.logger.info(`adding transceiver mid: ${s.mid} subscription: ${a} direction: recvonly`)}}updateTransceiverWithStop(t,e,n){let o=1;this.videoSubscriptions=[0];for(const a of t){if(a===this._localCameraTransceiver||!this.transceiverIsVideo(a)||!a.mid)continue;let s=!1;const d=e.streamIdForTrack("v_"+a.mid);if(a.direction!=="inactive"&&d!==void 0){for(const[u,c]of n.entries())if(e.StreamIdsInSameGroup(d,c)){a.direction="recvonly",this.videoSubscriptions[o]=c,s=!0,this.streamIdToTransceiver.delete(d),this.streamIdToTransceiver.set(c,a),n.splice(u,1);break}}if(!s){this.videoSubscriptions[o]=0,this.logger.info(`Stopping MID: ${a.mid}, direction: ${a.direction}, current direction: ${a.currentDirection}`),a.stop();for(const[u,c]of this.streamIdToTransceiver.entries())a.mid===c.mid&&this.streamIdToTransceiver.delete(u)}o+=1}}updateTransceiverWithoutStop(t,e,n){let o=1;for(const a of t)if(!(a===this._localCameraTransceiver||!this.transceiverIsVideo(a))){if(this.videoSubscriptions[o]=0,a.direction!=="inactive"){const s=e.streamIdForTrack("v_"+a.mid);if(s!==void 0){for(const[d,u]of n.entries())if(e.StreamIdsInSameGroup(s,u)){a.direction="recvonly",this.videoSubscriptions[o]=u,this.streamIdToTransceiver.delete(s),this.streamIdToTransceiver.set(u,a),n.splice(d,1);break}}}o+=1}o=1;for(const a of t)if(!(a===this._localCameraTransceiver||!this.transceiverIsVideo(a))){if(a.direction==="inactive"&&n.length>0){a.direction="recvonly";const s=n.shift();this.videoSubscriptions[o]=s,this.streamIdToTransceiver.set(s,a)}else if(this.videoSubscriptions[o]===0){a.direction="inactive";for(const[s,d]of this.streamIdToTransceiver.entries())a===d&&this.streamIdToTransceiver.delete(s)}o+=1}}getMidForStreamId(t){var e;return(e=this.streamIdToTransceiver.get(t))===null||e===void 0?void 0:e.mid}setStreamIdForMid(t,e){for(const[n,o]of this.streamIdToTransceiver.entries())if(o.mid===t){this.streamIdToTransceiver.delete(n),this.streamIdToTransceiver.set(e,o);return}}transceiverIsVideo(t){return t.receiver&&t.receiver.track&&t.receiver.track.kind==="video"||t.sender&&t.sender.track&&t.sender.track.kind==="video"}debugDumpTransceivers(){let t="",e=0;for(const n of this.peer.getTransceivers())!this.transceiverIsVideo(n)||(t+=`transceiver index=${e} mid=${n.mid} subscription=${this.videoSubscriptions[e]} direction=${n.direction}
`,e+=1);return t}setTransceiverInput(t,e){return __awaiter$p(this,void 0,void 0,function*(){!t||(e?t.direction="sendrecv":t.direction="inactive",yield t.sender.replaceTrack(e))})}}DefaultTransceiverController$1.default=DefaultTransceiverController;var SimulcastContentShareTransceiverController$1={},SimulcastTransceiverController$1={},__awaiter$o=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SimulcastTransceiverController$1,"__esModule",{value:!0});const DefaultTransceiverController_1$1=DefaultTransceiverController$1;class SimulcastTransceiverController extends DefaultTransceiverController_1$1.default{constructor(t,e){super(t,e),this.videoQualityControlParameterMap=new Map;let n=4;for(let o=0;o<SimulcastTransceiverController.NAME_ARR_ASCENDING.length;o++){const a=SimulcastTransceiverController.NAME_ARR_ASCENDING[o];this.videoQualityControlParameterMap.set(a,{rid:a,scaleResolutionDownBy:n,maxBitrate:SimulcastTransceiverController.BITRATE_ARR_ASCENDING[o]*1e3}),n=n/2}}setEncodingParameters(t){return __awaiter$o(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const e=this._localCameraTransceiver.sender,n=Array.from(t.values());if(n.length<=0)return;const o=e.getParameters();if(!o.encodings)o.encodings=n;else for(let a=0;a<o.encodings.length;a++)o.encodings[a].rid===SimulcastTransceiverController.LOW_LEVEL_NAME&&this.copyEncodingParams(t.get(SimulcastTransceiverController.LOW_LEVEL_NAME),o.encodings[a]),o.encodings[a].rid===SimulcastTransceiverController.MID_LEVEL_NAME&&this.copyEncodingParams(t.get(SimulcastTransceiverController.MID_LEVEL_NAME),o.encodings[a]),o.encodings[a].rid===SimulcastTransceiverController.HIGH_LEVEL_NAME&&this.copyEncodingParams(t.get(SimulcastTransceiverController.HIGH_LEVEL_NAME),o.encodings[a]);yield e.setParameters(o),this.logVideoTransceiverParameters()})}setVideoSendingBitrateKbps(t){return __awaiter$o(this,void 0,void 0,function*(){})}setupLocalTransceivers(){if(!!this.useTransceivers()&&(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localAudioTransceiver||(this._localAudioTransceiver=this.peer.addTransceiver("audio",{direction:"inactive",streams:[this.defaultMediaStream]})),!this._localCameraTransceiver)){const t=Array.from(this.videoQualityControlParameterMap.values());this._localCameraTransceiver=this.peer.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream],sendEncodings:t})}}logVideoTransceiverParameters(){const e=this._localCameraTransceiver.sender.getParameters().encodings;let n=`simulcast: current encoding parameters 
`;for(const o of e)n+=`rid=${o.rid} maxBitrate=${o.maxBitrate} active=${o.active} scaleDownBy=${o.scaleResolutionDownBy} maxFrameRate = ${o.maxFramerate} 
`;this.logger.info(n)}copyEncodingParams(t,e){e.active=t.active,e.maxBitrate=t.maxBitrate,e.scaleResolutionDownBy=t.scaleResolutionDownBy,e.maxFramerate=t.maxFramerate}}SimulcastTransceiverController$1.default=SimulcastTransceiverController;SimulcastTransceiverController.LOW_LEVEL_NAME="low";SimulcastTransceiverController.MID_LEVEL_NAME="mid";SimulcastTransceiverController.HIGH_LEVEL_NAME="hi";SimulcastTransceiverController.NAME_ARR_ASCENDING=["low","mid","hi"];SimulcastTransceiverController.BITRATE_ARR_ASCENDING=[200,400,1100];var __awaiter$n=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SimulcastContentShareTransceiverController$1,"__esModule",{value:!0});const SimulcastTransceiverController_1$1=SimulcastTransceiverController$1;class SimulcastContentShareTransceiverController extends SimulcastTransceiverController_1$1.default{constructor(t,e){super(t,e);let n=2;this.videoQualityControlParameterMap=new Map;for(let o=0;o<SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING.length;o++){const a=SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING[o];this.videoQualityControlParameterMap.set(a,{rid:a,scaleResolutionDownBy:n,maxBitrate:SimulcastContentShareTransceiverController.BITRATE_ARR_ASCENDING[o]*1e3}),n=n/2}}setEncodingParameters(t){return __awaiter$n(this,void 0,void 0,function*(){if(!this._localCameraTransceiver||this._localCameraTransceiver.direction!=="sendrecv")return;const e=this._localCameraTransceiver.sender,n=Array.from(t.values());if(n.length<=0)return;const o=e.getParameters();if(!o.encodings)o.encodings=n;else for(let a=0;a<o.encodings.length;a++)o.encodings[a].rid===SimulcastTransceiverController_1$1.default.LOW_LEVEL_NAME&&this.copyEncodingParams(t.get(SimulcastTransceiverController_1$1.default.LOW_LEVEL_NAME),o.encodings[a]),o.encodings[a].rid===SimulcastTransceiverController_1$1.default.HIGH_LEVEL_NAME&&this.copyEncodingParams(t.get(SimulcastTransceiverController_1$1.default.HIGH_LEVEL_NAME),o.encodings[a]);yield e.setParameters(o),this.logVideoTransceiverParameters()})}}SimulcastContentShareTransceiverController$1.default=SimulcastContentShareTransceiverController;SimulcastContentShareTransceiverController.NAME_ARR_ASCENDING=["low","hi"];SimulcastContentShareTransceiverController.BITRATE_ARR_ASCENDING=[300,1200];var VideoOnlyTransceiverController$1={};Object.defineProperty(VideoOnlyTransceiverController$1,"__esModule",{value:!0});const DefaultTransceiverController_1=DefaultTransceiverController$1;class VideoOnlyTransceiverController extends DefaultTransceiverController_1.default{constructor(t,e){super(t,e)}setupLocalTransceivers(){!this.useTransceivers()||(!this.defaultMediaStream&&typeof MediaStream<"u"&&(this.defaultMediaStream=new MediaStream),this._localCameraTransceiver||(this._localCameraTransceiver=this.peer.addTransceiver("video",{direction:"inactive",streams:[this.defaultMediaStream]})))}}VideoOnlyTransceiverController$1.default=VideoOnlyTransceiverController;var DefaultVideoCaptureAndEncodeParameter$1={};Object.defineProperty(DefaultVideoCaptureAndEncodeParameter$1,"__esModule",{value:!0});class DefaultVideoCaptureAndEncodeParameter{constructor(t,e,n,o,a,s=1){this.cameraWidth=t,this.cameraHeight=e,this.cameraFrameRate=n,this.maxEncodeBitrateKbps=o,this.isSimulcast=a,this.scaleResolutionDownBy=s}equal(t){let e=t.captureWidth()===this.cameraWidth&&t.captureHeight()===this.cameraHeight&&t.captureFrameRate()===this.cameraFrameRate&&t.encodeBitrates().length===this.encodeBitrates().length&&t.encodeScaleResolutionDownBy().length===this.encodeScaleResolutionDownBy().length&&t.encodeWidths().length===this.encodeWidths().length&&t.encodeHeights().length===this.encodeHeights().length;if(e){for(let n=0;n<t.encodeWidths().length;n++)if(t.encodeWidths()[n]!==this.encodeWidths()[n]||t.encodeHeights()[n]!==this.encodeHeights()[n]||t.encodeBitrates()[n]!==this.encodeBitrates()[n]||t.encodeScaleResolutionDownBy()[n]!==this.encodeScaleResolutionDownBy()[n])return e=!1,e}return e}clone(){return new DefaultVideoCaptureAndEncodeParameter(this.cameraWidth,this.cameraHeight,this.cameraFrameRate,this.maxEncodeBitrateKbps,this.isSimulcast,this.scaleResolutionDownBy)}captureWidth(){return this.cameraWidth}captureHeight(){return this.cameraHeight}captureFrameRate(){return this.cameraFrameRate}encodeBitrates(){return[this.maxEncodeBitrateKbps]}encodeScaleResolutionDownBy(){return[this.scaleResolutionDownBy]}encodeWidths(){return[this.cameraWidth]}encodeHeights(){return[this.cameraHeight]}}DefaultVideoCaptureAndEncodeParameter$1.default=DefaultVideoCaptureAndEncodeParameter;var VideoAdaptiveProbePolicy$1={},VideoPreference$1={},TargetDisplaySize={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.TargetDisplaySize=void 0;var t;(function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"})(t=r.TargetDisplaySize||(r.TargetDisplaySize={})),r.default=t})(TargetDisplaySize);Object.defineProperty(VideoPreference$1,"__esModule",{value:!0});const TargetDisplaySize_1$1=TargetDisplaySize;class VideoPreference{constructor(t,e,n){this.attendeeId=t,this.priority=e,this.targetSize=n!==void 0?n:TargetDisplaySize_1$1.default.High}partialCompare(t){return this.priority-t.priority}equals(t){return this.attendeeId===t.attendeeId&&this.targetSize===t.targetSize&&this.priority===t.priority}clone(){return new VideoPreference(this.attendeeId,this.priority,this.targetSize)}targetSizeToBitrateKbps(t){switch(t){case TargetDisplaySize_1$1.default.High:return VideoPreference.HIGH_BITRATE_KBPS;case TargetDisplaySize_1$1.default.Medium:return VideoPreference.MID_BITRATE_KBPS;case TargetDisplaySize_1$1.default.Low:return VideoPreference.LOW_BITRATE_KBPS}}}VideoPreference$1.default=VideoPreference;VideoPreference.LOW_BITRATE_KBPS=300;VideoPreference.MID_BITRATE_KBPS=600;VideoPreference.HIGH_BITRATE_KBPS=1200;var VideoPreferences$1={};Object.defineProperty(VideoPreferences$1,"__esModule",{value:!0});VideoPreferences$1.VideoPreferences=VideoPreferences$1.MutableVideoPreferences=void 0;class ObjectSet{constructor(t=[]){this.items=t}static default(){return new ObjectSet([])}[Symbol.iterator](){let t=0;const e=this.items;return{next(){return t<e.length?{done:!1,value:e[t++]}:{done:!0,value:null}}}}first(){return this.items[0]}add(t){this.items.push(t)}replaceFirst(t,e){const n=this.items.findIndex(e);n===-1?this.items.push(t):this.has(t)?this.items.splice(n,1):this.items[n]=t}remove(t){this.items=this.items.filter(e=>!e.equals(t))}clear(){this.items=[]}isEmpty(){return this.items.length===0}equals(t){if(t===this)return!0;if(t.items.length!==this.items.length)return!1;for(const e of this.items)if(!t.items.some(n=>n.equals(e)))return!1;return!0}has(t){return this.items.some(e=>e.equals(t))}some(t){return this.items.some(t)}clone(){return new ObjectSet([...this.items])}sort(){this.items.sort((t,e)=>t.partialCompare(e))}modify(){return new SetBuilder(this)}}class SetBuilder{constructor(t=new ObjectSet){this.items=t,this.copied=!1}cow(){this.copied||(this.items=this.items.clone(),this.copied=!0)}add(t){this.items.has(t)||(this.cow(),this.items.add(t))}replaceFirst(t,e){this.items.has(t)&&!this.items.some(e)||(this.cow(),this.items.replaceFirst(t,e))}remove(t){!this.items.has(t)||(this.cow(),this.items.remove(t))}some(t){return this.items.some(t)}clear(){this.items.isEmpty()||(this.cow(),this.items.clear())}build(){return this.copied&&this.items.sort(),this.copied=!1,this.items}}class MutableVideoPreferences{constructor(t){this.builder=t}add(t){this.builder.add(t)}replaceFirst(t,e){this.builder.replaceFirst(t,e)}remove(t){this.builder.remove(t)}some(t){return this.builder.some(t)}clear(){this.builder.clear()}build(){return new VideoPreferences(this.builder.build())}}VideoPreferences$1.MutableVideoPreferences=MutableVideoPreferences;class VideoPreferences{constructor(t){this.items=t}static prepare(){return new MutableVideoPreferences(new SetBuilder)}static default(){return new VideoPreferences(ObjectSet.default())}[Symbol.iterator](){return this.items[Symbol.iterator]()}highestPriority(){var t;return(t=this.items.first())===null||t===void 0?void 0:t.priority}sorted(){return this.items[Symbol.iterator]()}equals(t){return t===this||this.items.equals(t.items)}modify(){return new MutableVideoPreferences(this.items.modify())}some(t){return this.items.some(t)}isEmpty(){return this.items.isEmpty()}clone(){const t=VideoPreferences.prepare();for(const e of this.items)t.add(e.clone());return t.build()}}VideoPreferences$1.VideoPreferences=VideoPreferences;VideoPreferences$1.default=VideoPreferences;var VideoPriorityBasedPolicy$1={},VideoPriorityBasedPolicyConfig$1={};Object.defineProperty(VideoPriorityBasedPolicyConfig$1,"__esModule",{value:!0});const ServerSideNetworkAdaption_1$1=ServerSideNetworkAdaption;class VideoPriorityBasedPolicyConfig{constructor(t=0,e=0){this.networkIssueResponseDelayFactor=t,this.networkIssueRecoveryDelayFactor=e,this.currentNetworkEvent=0,this.bandwidthDecreaseTimestamp=0,this.referenceBitrate=0,this.serverSideNetworkAdaption=ServerSideNetworkAdaption_1$1.default.Default,t<0?t=0:t>1&&(t=1),this.networkIssueResponseDelayFactor=t,e<0?e=0:e>1&&(e=1),this.networkIssueRecoveryDelayFactor=e}allowSubscribe(t,e){let n=0;const o=this.currentNetworkEvent;if(e>this.referenceBitrate)return this.currentNetworkEvent=2,this.referenceBitrate=e,!0;if(e<this.referenceBitrate){if(this.currentNetworkEvent=1,n=this.getSubscribeDelay(this.currentNetworkEvent,t),o!==1)this.bandwidthDecreaseTimestamp=Date.now();else if(Date.now()-this.bandwidthDecreaseTimestamp>n)return this.referenceBitrate=e,!0;return!1}else return this.currentNetworkEvent=0,!1}getSubscribeDelay(t,e){let n=VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS;const o=VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS-VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS,a=this.networkIssueResponseDelayFactor;switch(t){case 1:n+=o*a*(1+e/10),n=Math.min(VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS,n);break}return n}}VideoPriorityBasedPolicyConfig$1.default=VideoPriorityBasedPolicyConfig;VideoPriorityBasedPolicyConfig.MINIMUM_DELAY_MS=2e3;VideoPriorityBasedPolicyConfig.MAXIMUM_DELAY_MS=8e3;VideoPriorityBasedPolicyConfig.Default=new VideoPriorityBasedPolicyConfig(0,0);VideoPriorityBasedPolicyConfig.UnstableNetworkPreset=new VideoPriorityBasedPolicyConfig(0,1);VideoPriorityBasedPolicyConfig.StableNetworkPreset=new VideoPriorityBasedPolicyConfig(1,0);Object.defineProperty(VideoPriorityBasedPolicy$1,"__esModule",{value:!0});const ClientMetricReportDirection_1=ClientMetricReportDirection,ClientMetricReportMediaType_1=ClientMetricReportMediaType,ContentShareConstants_1$2=ContentShareConstants$1,LogLevel_1$4=LogLevel,ServerSideNetworkAdaption_1=ServerSideNetworkAdaption,DefaultVideoStreamIdSet_1$2=DefaultVideoStreamIdSet$1,TargetDisplaySize_1=TargetDisplaySize,VideoPreference_1$1=VideoPreference$1,VideoPreferences_1$1=VideoPreferences$1,VideoPriorityBasedPolicyConfig_1=VideoPriorityBasedPolicyConfig$1;class LinkMediaStats{constructor(){this.bandwidthEstimateKbps=0,this.usedBandwidthKbps=0,this.packetsLost=0,this.nackCount=0,this.rttMs=0}}class VideoPriorityBasedPolicy{constructor(t,e=VideoPriorityBasedPolicyConfig_1.default.Default){this.logger=t,this.videoPriorityBasedPolicyConfig=e,this.shouldPauseTiles=!0,this.observerQueue=new Set,this.pausedBwAttendeeIds=new Set,this.reset()}reset(){this.optimalReceiveSet=new DefaultVideoStreamIdSet_1$2.default,this.optimalReceiveStreams=[],this.optimalNonPausedReceiveStreams=[],this.subscribedReceiveSet=new DefaultVideoStreamIdSet_1$2.default,this.subscribedReceiveStreams=[],this.videoPreferences=void 0,this.defaultVideoPreferences=void 0,this.shouldPauseTiles=!0,this.pausedStreamIds=new DefaultVideoStreamIdSet_1$2.default,this.pausedBwAttendeeIds=new Set,this.videoPreferencesUpdated=!1,this.logCount=0,this.startupPeriod=!0,this.usingPrevTargetRate=!1,this.rateProbeState="Not Probing",this.firstEstimateTimestamp=0,this.lastUpgradeRateKbps=0,this.timeBeforeAllowSubscribeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.lastProbeTimestamp=Date.now(),this.timeBeforeAllowProbeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS,this.downlinkStats=new LinkMediaStats,this.prevDownlinkStats=new LinkMediaStats,this.probeFailed=!1,this.serverSideNetworkAdaption=this.videoPriorityBasedPolicyConfig.serverSideNetworkAdaption}bindToTileController(t){this.tileController=t,this.logger.info("tileController bound")}chooseRemoteVideoSources(t){var e;!((e=this.videoPreferences)===null||e===void 0)&&e.equals(t)||(this.videoPreferences=t==null?void 0:t.clone(),this.videoPreferencesUpdated=!0,this.logger.info(`bwe: setVideoPreferences bwe: new preferences: ${JSON.stringify(t)}`))}updateIndex(t){this.videoIndex=t,this.videoPreferences||this.updateDefaultVideoPreferences()}updateDefaultVideoPreferences(){const t=new Set;for(const a of this.videoIndex.remoteStreamDescriptions())t.add(a.attendeeId);const e=VideoPreferences_1$1.VideoPreferences.prepare(),n=t.size;let o=TargetDisplaySize_1.default.High;n>8?o=TargetDisplaySize_1.default.Low:n>4&&(o=TargetDisplaySize_1.default.Medium);for(const a of t)e.add(new VideoPreference_1$1.default(a,1,o));this.defaultVideoPreferences=e.build()}updateMetrics(t){if(!this.videoIndex||this.videoIndex.allStreams().empty())return;this.prevDownlinkStats=this.downlinkStats,this.downlinkStats=new LinkMediaStats;const e=t.getObservableMetrics();this.downlinkStats.bandwidthEstimateKbps=e.availableIncomingBitrate/1e3;for(const n in t.streamMetricReports){const o=Number.parseInt(n,10),a=t.streamMetricReports[o];a.direction===ClientMetricReportDirection_1.default.DOWNSTREAM&&a.mediaType===ClientMetricReportMediaType_1.default.VIDEO&&(a.currentMetrics.hasOwnProperty("nackCount")&&(this.downlinkStats.nackCount+=t.countPerSecond("nackCount",o)),a.currentMetrics.hasOwnProperty("packetsLost")&&(this.downlinkStats.packetsLost+=t.countPerSecond("packetsLost",o)),a.currentMetrics.hasOwnProperty("bytesReceived")&&(this.downlinkStats.usedBandwidthKbps+=t.bitsPerSecond("bytesReceived",o)/1e3))}}wantsResubscribe(){return this.calculateOptimalReceiveSet(),!this.subscribedReceiveSet.equal(this.optimalReceiveSet)}chooseSubscriptions(){return this.subscribedReceiveSet.equal(this.optimalReceiveSet)||(this.lastSubscribeTimestamp=Date.now()),this.subscribedReceiveSet=this.optimalReceiveSet.clone(),this.subscribedReceiveStreams=this.optimalReceiveStreams.slice(),this.subscribedReceiveSet.clone()}addObserver(t){this.observerQueue.add(t)}removeObserver(t){this.observerQueue.delete(t)}forEachObserver(t){for(const e of this.observerQueue)t(e)}setVideoPriorityBasedPolicyConfigs(t){this.videoPriorityBasedPolicyConfig=t}calculateOptimalReceiveStreams(){var t;const e=[],n=this.videoIndex.remoteStreamDescriptions();if(n.length===0||((t=this.videoPreferences)===null||t===void 0?void 0:t.isEmpty())){this.optimalReceiveStreams=[];return}const o=this.rateProbeState;this.cleanBwPausedTiles(n),this.handleAppPausedStreams(e,n);const a=this.availStreamsSameAsLast(n),s=!this.startupPeriod&&a;if(s&&Date.now()-this.lastSubscribeTimestamp<this.timeBeforeAllowSubscribeMs)return;n.sort((S,g)=>S.maxBitrateKbps===g.maxBitrateKbps?S.streamId-g.streamId:S.maxBitrateKbps-g.maxBitrateKbps);for(const S of n)(S.avgBitrateKbps===0||S.avgBitrateKbps>S.maxBitrateKbps)&&(S.attendeeId.endsWith(ContentShareConstants_1$2.default.Modality)&&S.maxBitrateKbps<100?S.maxBitrateKbps=S.avgBitrateKbps:S.avgBitrateKbps=S.maxBitrateKbps);const d={targetDownlinkBitrate:0,chosenTotalBitrate:0,deltaToNextUpgrade:0};d.targetDownlinkBitrate=this.determineTargetRate();const u=this.subscribedReceiveSet.size(),c=this.downlinkStats.bandwidthEstimateKbps,l=!this.videoPriorityBasedPolicyConfig.allowSubscribe(u,c);if(this.probeFailed&&(this.probeFailed=!1,this.timeBeforeAllowSubscribeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,s&&l))return;const f=this.priorityPolicy(d,n,e),h=this.serverSideNetworkAdaption!==ServerSideNetworkAdaption_1.default.None&&this.serverSideNetworkAdaption!==ServerSideNetworkAdaption_1.default.Default;let p=0;if(!h&&!this.startupPeriod&&a?this.rateProbeState==="Probing"?p=this.handleProbe(e,d.targetDownlinkBitrate):d.deltaToNextUpgrade!==0&&(p=this.maybeOverrideOrProbe(e,d,f)):(this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0),this.prevRemoteInfos=n,this.videoPreferencesUpdated=!1,p===1){this.logger.info(`bwe: keepSameSubscriptions stats:${JSON.stringify(this.downlinkStats)}`),this.prevTargetRateKbps=d.targetDownlinkBitrate;return}if(p===2){const S=this.calculateSubscribeRate(this.preProbeNonPausedReceiveStreams);this.optimalReceiveStreams=this.preProbeReceiveStreams.slice(),this.processBwPausedStreams(n,this.preProbeNonPausedReceiveStreams),this.logger.info("bwe: Use Pre-Probe subscription subscribedRate:"+S);return}this.optimalNonPausedReceiveStreams=e.slice();const m=this.pausedBwAttendeeIds.size;this.processBwPausedStreams(n,e),this.logger.getLogLevel()<=LogLevel_1$4.LogLevel.INFO&&(this.logCount%15===0||this.rateProbeState!==o||this.optimalReceiveStreams.length!==e.length||m!==this.pausedBwAttendeeIds.size)&&(this.logger.info(this.policyStateLogStr(n,d.targetDownlinkBitrate)),this.logCount=0),this.logCount++,this.prevTargetRateKbps=d.targetDownlinkBitrate,this.optimalReceiveStreams=e.slice()}calculateOptimalReceiveSet(){const t=new DefaultVideoStreamIdSet_1$2.default;this.calculateOptimalReceiveStreams();for(const e of this.optimalReceiveStreams)t.add(e.streamId);if(!this.optimalReceiveSet.equal(t)){const e=this.calculateSubscribeRate(this.optimalReceiveStreams);this.logger.info(`bwe: new streamSelection: ${JSON.stringify(t)} subscribedRate:${e}`)}this.optimalReceiveSet=t}determineTargetRate(){let t=0;const e=Date.now();return this.downlinkStats.bandwidthEstimateKbps!==0?(this.firstEstimateTimestamp===0&&(this.firstEstimateTimestamp=e),this.startupPeriod&&(this.downlinkStats.bandwidthEstimateKbps>VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS||this.downlinkStats.packetsLost>0||e-this.firstEstimateTimestamp>VideoPriorityBasedPolicy.STARTUP_PERIOD_MS&&this.downlinkStats.bandwidthEstimateKbps<=this.prevDownlinkStats.bandwidthEstimateKbps)&&(this.startupPeriod=!1,this.prevTargetRateKbps=this.downlinkStats.bandwidthEstimateKbps),this.startupPeriod?t=VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS:this.rateProbeState==="Probing"&&this.downlinkStats.usedBandwidthKbps>this.downlinkStats.bandwidthEstimateKbps&&this.downlinkStats.packetsLost<VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD?(this.logger.info(`bwe: In probe state, overriding estimate ${this.downlinkStats.bandwidthEstimateKbps} with actual receive bitrate ${this.downlinkStats.usedBandwidthKbps}`),t=this.downlinkStats.usedBandwidthKbps+VideoPriorityBasedPolicy.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS):t=this.downlinkStats.bandwidthEstimateKbps):this.firstEstimateTimestamp===0?t=VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS:t=this.prevTargetRateKbps,!this.startupPeriod&&(this.usingPrevTargetRate&&this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps||this.downlinkStats.bandwidthEstimateKbps<this.prevTargetRateKbps*(100-VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT)/100||this.downlinkStats.bandwidthEstimateKbps<this.downlinkStats.usedBandwidthKbps*VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT/100)&&this.downlinkStats.packetsLost===0?(this.logger.debug(()=>"bwe: ValidateRate: Using Previous rate "+this.prevTargetRateKbps),this.usingPrevTargetRate=!0,t=this.prevTargetRateKbps):this.usingPrevTargetRate=!1,t}setProbeState(t){if(this.rateProbeState===t)return!1;const e=Date.now();switch(t){case"Not Probing":this.probePendingStartTimestamp=0;break;case"Probe Pending":if(this.lastProbeTimestamp===0||e-this.lastProbeTimestamp>VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS)this.probePendingStartTimestamp=e;else return!1;break;case"Probing":if(e-this.probePendingStartTimestamp>this.timeBeforeAllowProbeMs)this.lastProbeTimestamp=e,this.preProbeReceiveStreams=this.subscribedReceiveStreams.slice(),this.preProbeNonPausedReceiveStreams=this.optimalNonPausedReceiveStreams,this.timeBeforeAllowProbeMs=Math.min(this.timeBeforeAllowProbeMs*2,VideoPriorityBasedPolicy.MAX_HOLD_BEFORE_PROBE_MS);else return!1;break}return this.logger.info("bwe: setProbeState to "+t+" from "+this.rateProbeState),this.rateProbeState=t,!0}upgradeToStream(t,e){for(let n=0;n<t.length;n++)if(t[n].groupId===e.groupId){const o=e.avgBitrateKbps-t[n].avgBitrateKbps;return this.logger.info("bwe: upgradeStream from "+JSON.stringify(t[n])+" to "+e),this.lastUpgradeRateKbps=o,t[n]=e,o}return t.push(e),this.lastUpgradeRateKbps=e.avgBitrateKbps,this.lastUpgradeRateKbps}handleProbe(t,e){if(Date.now()-this.lastProbeTimestamp>VideoPriorityBasedPolicy.MAX_ALLOWED_PROBE_TIME_MS)return this.logger.info("bwe: Canceling probe due to timeout"),this.setProbeState("Not Probing"),0;if(this.downlinkStats.packetsLost>0&&(this.logger.info(`bwe: Probe encountering packets lost:${this.downlinkStats.packetsLost}`),this.downlinkStats.packetsLost>VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD))return this.setProbeState("Not Probing"),this.logger.info(`bwe: Canceling probe due to packets lost:${this.downlinkStats.packetsLost}`),this.probeFailed=!0,this.timeBeforeAllowSubscribeMs=Math.max(VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS,this.timeBeforeAllowSubscribeMs)*3,2;const n=this.calculateSubscribeRate(this.optimalReceiveStreams);return this.chosenStreamsSameAsLast(t)||e>n?(this.logger.info("bwe: Probe successful"),this.setProbeState("Not Probing"),this.timeBeforeAllowProbeMs=VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS,0):1}maybeOverrideOrProbe(t,e,n){const o=this.chosenStreamsSameAsLast(t);let a=0;const s=e.targetDownlinkBitrate>VideoPriorityBasedPolicy.LOW_BITRATE_THRESHOLD_KBPS?VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT:VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT*2,d=e.targetDownlinkBitrate*s/100;if(this.targetRateBaselineForDeltaCheckKbps=this.targetRateBaselineForDeltaCheckKbps!==void 0?this.targetRateBaselineForDeltaCheckKbps:this.prevTargetRateKbps,!o&&Math.abs(e.targetDownlinkBitrate-this.targetRateBaselineForDeltaCheckKbps)<d?(this.logger.info("bwe: MaybeOverrideOrProbe: Reuse last decision based on delta rate. {"+JSON.stringify(this.subscribedReceiveSet)+"}"),a=1):this.targetRateBaselineForDeltaCheckKbps=e.targetDownlinkBitrate,this.downlinkStats.packetsLost>this.prevDownlinkStats.packetsLost)return this.setProbeState("Not Probing"),this.lastUpgradeRateKbps=0,a;if(o||a===1)switch(this.rateProbeState){case"Not Probing":this.setProbeState("Probe Pending");break;case"Probe Pending":this.setProbeState("Probing")&&(this.upgradeToStream(t,n),a=0);break}else this.setProbeState("Not Probing");return a}calculateSubscribeRate(t){let e=0;for(const n of t)!this.pausedStreamIds.contain(n.streamId)&&!this.pausedBwAttendeeIds.has(n.attendeeId)&&(e+=n.maxBitrateKbps);return e}handleAppPausedStreams(t,e){if(!this.tileController){this.logger.warn("tileController not found!");return}this.pausedStreamIds=new DefaultVideoStreamIdSet_1$2.default;const n=this.tileController.getAllRemoteVideoTiles();for(const o of n){const a=o.state();if(a.paused&&!this.pausedBwAttendeeIds.has(a.boundAttendeeId)){let s=e.length;for(;s--;)e[s].attendeeId===a.boundAttendeeId&&(this.logger.info("bwe: removed paused attendee "+a.boundAttendeeId+" streamId: "+e[s].streamId),this.pausedStreamIds.add(e[s].streamId),this.subscribedReceiveSet.contain(e[s].streamId)&&t.push(e[s]),e.splice(s,1))}}}processBwPausedStreams(t,e){if(!this.tileController){this.logger.warn("tileController not found!");return}const n=this.getCurrentVideoPreferences();if(n&&this.shouldPauseTiles){const o=this.tileController.getAllVideoTiles();for(const a of n){const s=this.getVideoTileForAttendeeId(a.attendeeId,o),d=(s==null?void 0:s.state().paused)||!1;if(e.some(u=>u.attendeeId===a.attendeeId))d&&this.pausedBwAttendeeIds.has(a.attendeeId)&&(this.logger.info(`bwe: unpausing attendee ${a.attendeeId} due to bandwidth`),this.forEachObserver(u=>{u.tileWillBeUnpausedByDownlinkPolicy(s.id())}),this.tileController.unpauseVideoTile(s.id()),this.pausedBwAttendeeIds.delete(a.attendeeId));else{const u=t.some(c=>c.attendeeId===a.attendeeId);if(s&&u){const c=this.optimalReceiveStreams.find(l=>l.attendeeId===a.attendeeId);c!==void 0&&(d||(this.logger.info(`bwe: pausing streamId ${c.streamId} attendee ${a.attendeeId} due to bandwidth`),this.forEachObserver(l=>{l.tileWillBePausedByDownlinkPolicy(s.id())}),this.tileController.pauseVideoTile(s.id())),e.push(c)),this.pausedBwAttendeeIds.add(a.attendeeId)}else if(u){const c=this.tileController.addVideoTile();c.bindVideoStream(a.attendeeId,!1,null,0,0,0,null),this.forEachObserver(l=>{l.tileWillBePausedByDownlinkPolicy(c.id())}),c.pause(),this.logger.info(`bwe: Created video tile ${c.id()} for bw paused attendee ${a.attendeeId}`),this.pausedBwAttendeeIds.add(a.attendeeId)}}}}}cleanBwPausedTiles(t){if(!this.tileController){this.logger.warn("tileController not found!");return}const e=this.tileController.getAllRemoteVideoTiles(),n=this.getCurrentVideoPreferences();for(const o of e){const a=o.state();a.boundVideoStream||(t.some(s=>s.attendeeId===a.boundAttendeeId)?n!==void 0&&!n.some(s=>s.attendeeId===a.boundAttendeeId)&&this.tileController.removeVideoTile(a.tileId):(this.tileController.removeVideoTile(a.tileId),this.logger.info(`bwe: Removed video tile ${a.tileId} for bw paused attendee ${a.boundAttendeeId}`)))}}priorityPolicy(t,e,n){let o;const a=this.getCurrentVideoPreferences(),s=a.highestPriority();let d,u=s;for(;u!==-1;){d=-1;for(const c of a)if(c.priority===u)for(const l of e)l.attendeeId===c.attendeeId&&(n.some(f=>f.groupId===l.groupId)||(t.chosenTotalBitrate+l.avgBitrateKbps<=t.targetDownlinkBitrate?(n.push(l),t.chosenTotalBitrate+=l.avgBitrateKbps):t.deltaToNextUpgrade===0&&(t.deltaToNextUpgrade=l.avgBitrateKbps,o=l)));else if(c.priority>u){d=c.priority;break}for(const c of a)if(c.priority===u){for(const l of e)if(l.attendeeId===c.attendeeId){const f=n.findIndex(h=>h.groupId===l.groupId&&h.maxBitrateKbps<l.maxBitrateKbps);if(f!==-1){const h=l.avgBitrateKbps-n[f].avgBitrateKbps;this.hasSimulcastStreams(e,l.attendeeId,l.groupId)&&this.canUpgrade(l.avgBitrateKbps,c.targetSize,c.targetSizeToBitrateKbps(c.targetSize),l.attendeeId.endsWith(ContentShareConstants_1$2.default.Modality))?(this.logger.info(`bwe: attendee: ${l.attendeeId} group: ${l.groupId} has simulcast and can upgrade avgBitrate: ${l.avgBitrateKbps} target: ${c.targetSizeToBitrateKbps(c.targetSize)} targetTotalBitrate: ${t.targetDownlinkBitrate}`),t.chosenTotalBitrate+h<=t.targetDownlinkBitrate?(t.chosenTotalBitrate+=h,n[f]=l):t.deltaToNextUpgrade===0&&(t.deltaToNextUpgrade=h,o=l)):this.logger.info("bwe: cannot upgrade stream quality beyond target size")}}}else if(c.priority>u)break;if(u===s&&t.deltaToNextUpgrade!==0)break;u=d}return o}getVideoTileForAttendeeId(t,e){for(const n of e)if(n.state().boundAttendeeId===t)return n;return null}canUpgrade(t,e,n,o){let a=!1;return o?(e===TargetDisplaySize_1.default.High||e===TargetDisplaySize_1.default.Medium&&t<=n)&&(a=!0):t<=n&&(a=!0),a?(this.logger.info(`bwe: canUpgrade: bitrateKbp: ${t} targetBitrateKbp: ${n}`),!0):(this.logger.info(`bwe: cannot Upgrade: bitrateKbp: ${t} targetBitrateKbp: ${n}`),!1)}hasSimulcastStreams(t,e,n){let o=0;for(const a of t)a.attendeeId===e&&a.groupId===n&&o++;return this.logger.info(`bwe: attendeeId: ${e} groupId: ${n} hasSimulcastStreams: streamCount: ${o}`),o>1}availStreamsSameAsLast(t){if(this.prevRemoteInfos===void 0||t.length!==this.prevRemoteInfos.length||this.videoPreferencesUpdated===!0)return!1;for(const e of t)if(this.prevRemoteInfos.find(o=>o.groupId===e.groupId&&o.streamId===e.streamId&&o.maxBitrateKbps===e.maxBitrateKbps)===void 0)return!1;return!0}chosenStreamsSameAsLast(t){if(this.optimalNonPausedReceiveStreams.length!==t.length)return!1;for(const e of this.optimalNonPausedReceiveStreams)if(!t.some(n=>n.streamId===e.streamId))return!1;return!0}policyStateLogStr(t,e){const n=this.calculateSubscribeRate(this.optimalReceiveStreams),o={targetBitrate:e,subscribedRate:n,probeState:this.rateProbeState,startupPeriod:this.startupPeriod};let a="remoteInfos: [";for(const d of t)a+=`{grpId:${d.groupId} strId:${d.streamId} maxBr:${d.maxBitrateKbps} avgBr:${d.avgBitrateKbps}}, `;a+="]";let s=`bwe: optimalReceiveSet ${JSON.stringify(o)}
bwe:   prev ${JSON.stringify(this.prevDownlinkStats)}
bwe:   now  ${JSON.stringify(this.downlinkStats)}
bwe:   ${a}
`;return(this.pausedStreamIds.size()>0||this.pausedBwAttendeeIds.size>0)&&(s+=`bwe:   paused: app stream ids ${JSON.stringify(this.pausedStreamIds)}  bw attendees { ${Array.from(this.pausedBwAttendeeIds).join(" ")} }
`),this.videoPreferences?s+=`bwe:   preferences: ${JSON.stringify(this.videoPreferences)}`:s+=`bwe:   default preferences: ${JSON.stringify(this.defaultVideoPreferences)}`,s}getCurrentVideoPreferences(){return this.videoPreferences||this.defaultVideoPreferences}getServerSideNetworkAdaption(){return this.serverSideNetworkAdaption}setServerSideNetworkAdaption(t){this.serverSideNetworkAdaption=t,this.setProbeState("Not Probing")}supportedServerSideNetworkAdaptions(){return[ServerSideNetworkAdaption_1.default.None,ServerSideNetworkAdaption_1.default.BandwidthProbing]}getVideoPreferences(){let t=this.getCurrentVideoPreferences();return t||(t=VideoPreferences_1$1.VideoPreferences.prepare().build()),t}}VideoPriorityBasedPolicy$1.default=VideoPriorityBasedPolicy;VideoPriorityBasedPolicy.DEFAULT_BANDWIDTH_KBPS=2800;VideoPriorityBasedPolicy.STARTUP_PERIOD_MS=6e3;VideoPriorityBasedPolicy.LARGE_RATE_CHANGE_TRIGGER_PERCENT=20;VideoPriorityBasedPolicy.TARGET_RATE_CHANGE_TRIGGER_PERCENT=15;VideoPriorityBasedPolicy.LOW_BITRATE_THRESHOLD_KBPS=300;VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_PROBE_MS=5e3;VideoPriorityBasedPolicy.MIN_TIME_BETWEEN_SUBSCRIBE_MS=2e3;VideoPriorityBasedPolicy.MAX_HOLD_BEFORE_PROBE_MS=3e4;VideoPriorityBasedPolicy.MAX_ALLOWED_PROBE_TIME_MS=6e4;VideoPriorityBasedPolicy.SPURIOUS_PACKET_LOST_THRESHOLD=2;VideoPriorityBasedPolicy.USED_BANDWIDTH_OVERRIDE_BUFFER_KBPS=100;Object.defineProperty(VideoAdaptiveProbePolicy$1,"__esModule",{value:!0});const ContentShareConstants_1$1=ContentShareConstants$1,VideoPreference_1=VideoPreference$1,VideoPreferences_1=VideoPreferences$1,VideoPriorityBasedPolicy_1=VideoPriorityBasedPolicy$1;class VideoAdaptiveProbePolicy extends VideoPriorityBasedPolicy_1.default{constructor(t){super(t),this.logger=t,super.shouldPauseTiles=!1,this.videoPreferences=void 0}reset(){super.reset(),super.shouldPauseTiles=!1,this.videoPreferences=void 0}updateIndex(t){super.updateIndex(t);const e=VideoPreferences_1.VideoPreferences.prepare();let n=!1;const o=t.remoteStreamDescriptions();for(const a of o)e.some(s=>s.attendeeId===a.attendeeId)||(a.attendeeId.endsWith(ContentShareConstants_1$1.default.Modality)?(e.add(new VideoPreference_1.default(a.attendeeId,1)),n=!0):e.add(new VideoPreference_1.default(a.attendeeId,2)));n?(this.videoPreferences=e.build(),this.videoPreferencesUpdated=!0):this.videoPreferences=void 0}chooseRemoteVideoSources(t){this.logger.error("chooseRemoteVideoSources should not be called by VideoAdaptiveProbePolicy")}}VideoAdaptiveProbePolicy$1.default=VideoAdaptiveProbePolicy;var DefaultVideoStreamIndex$1={},VideoStreamDescription$1={};Object.defineProperty(VideoStreamDescription$1,"__esModule",{value:!0});const SignalingProtocol_js_1$2=SignalingProtocol;class VideoStreamDescription{constructor(t,e,n,o,a){this.attendeeId="",this.groupId=0,this.streamId=0,this.ssrc=0,this.trackLabel="",this.maxBitrateKbps=0,this.avgBitrateKbps=0,this.maxFrameRate=0,this.timeEnabled=0,this.disabledByWebRTC=!1,this.disabledByUplinkPolicy=!1,this.attendeeId=t,this.groupId=e,this.streamId=n,this.maxBitrateKbps=o,this.avgBitrateKbps=a}clone(){const t=new VideoStreamDescription;return t.attendeeId=this.attendeeId,t.groupId=this.groupId,t.streamId=this.streamId,t.ssrc=this.ssrc,t.trackLabel=this.trackLabel,t.maxBitrateKbps=this.maxBitrateKbps,t.avgBitrateKbps=this.avgBitrateKbps,t.maxFrameRate=this.maxFrameRate,t.timeEnabled=this.timeEnabled,t.disabledByWebRTC=this.disabledByWebRTC,t.disabledByUplinkPolicy=this.disabledByUplinkPolicy,t}toStreamDescriptor(){const t=SignalingProtocol_js_1$2.SdkStreamDescriptor.create();return t.mediaType=SignalingProtocol_js_1$2.SdkStreamMediaType.VIDEO,t.trackLabel=this.trackLabel,t.attendeeId=this.attendeeId,t.streamId=this.streamId,t.groupId=this.groupId,t.framerate=this.maxFrameRate,t.maxBitrateKbps=this.disabledByUplinkPolicy||this.disabledByWebRTC?0:this.maxBitrateKbps,t.avgBitrateBps=this.avgBitrateKbps,t}}VideoStreamDescription$1.default=VideoStreamDescription;Object.defineProperty(DefaultVideoStreamIndex$1,"__esModule",{value:!0});const SignalingProtocol_js_1$1=SignalingProtocol,DefaultVideoStreamIdSet_1$1=DefaultVideoStreamIdSet$1,VideoStreamDescription_1$1=VideoStreamDescription$1;class DefaultVideoStreamIndex{constructor(t){this.logger=t,this.currentIndex=null,this.indexForSubscribe=null,this.currentSubscribeAck=null,this.subscribeTrackToStreamMap=null,this.subscribeStreamToAttendeeMap=null,this.subscribeStreamToExternalUserIdMap=null,this.subscribeSsrcToStreamMap=null,this.streamToAttendeeMap=null,this.streamToExternalUserIdMap=null,this.videoStreamDescription=new VideoStreamDescription_1$1.default,this.videoStreamDescription.trackLabel="AmazonChimeExpressVideo",this.videoStreamDescription.streamId=2,this.videoStreamDescription.groupId=2}localStreamDescriptions(){return[this.videoStreamDescription.clone()]}convertBpsToKbps(t){return t>0&&t<1e3?1:Math.trunc(t/1e3)}remoteStreamDescriptions(){if(!this.currentIndex||!this.currentIndex.sources)return[];const t=[];return this.currentIndex.sources.forEach(e=>{const n=new VideoStreamDescription_1$1.default;n.attendeeId=e.attendeeId,n.groupId=e.groupId,n.streamId=e.streamId,n.maxBitrateKbps=e.maxBitrateKbps,n.avgBitrateKbps=this.convertBpsToKbps(e.avgBitrateBps),t.push(n)}),t}integrateUplinkPolicyDecision(t){if(!!t&&t.length){const e=t[0];this.videoStreamDescription.maxBitrateKbps=e.maxBitrate/1e3,this.videoStreamDescription.maxFrameRate=e.maxFramerate}}integrateIndexFrame(t){this.currentIndex=t;const e=new Map;let n=!1;for(const o of t.sources){if(!e.has(o.attendeeId)){e.set(o.attendeeId,o.groupId);continue}const a=e.get(o.attendeeId);a<o.groupId&&(this.logger.warn(`Old group ID ${a} found for attendee ID ${o.attendeeId}, replacing with newer group ID ${o.groupId}`),e.set(o.attendeeId,o.groupId)),n=!0}n&&(this.currentIndex.sources=this.currentIndex.sources.filter(o=>e.get(o.attendeeId)===o.groupId)),this.streamToAttendeeMap=null,this.streamToExternalUserIdMap=null}subscribeFrameSent(){this.indexForSubscribe=this.currentIndex}integrateSubscribeAckFrame(t){this.currentSubscribeAck=t,this.subscribeTrackToStreamMap=this.buildTrackToStreamMap(this.currentSubscribeAck),this.subscribeSsrcToStreamMap=this.buildSSRCToStreamMap(this.currentSubscribeAck),this.subscribeStreamToAttendeeMap=this.buildStreamToAttendeeMap(this.indexForSubscribe),this.subscribeStreamToExternalUserIdMap=this.buildStreamExternalUserIdMap(this.indexForSubscribe)}integrateBitratesFrame(t){if(this.currentIndex)for(const e of t.bitrates){const n=this.currentIndex.sources.find(o=>o.streamId===e.sourceStreamId);n!==void 0&&(n.avgBitrateBps=e.avgBitrateBps)}}allStreams(){const t=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex)for(const e of this.currentIndex.sources)t.add(e.streamId);return t}allVideoSendingSourcesExcludingSelf(t){const e=[],n=new Set;if(this.currentIndex&&this.currentIndex.sources&&this.currentIndex.sources.length)for(const o of this.currentIndex.sources){const{attendeeId:a,externalUserId:s,mediaType:d}=o;a!==t&&d===SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO&&(n.has(a)||(e.push({attendee:{attendeeId:a,externalUserId:s}}),n.add(a)))}return e}streamSelectionUnderBandwidthConstraint(t,e,n,o){const a=new Set;if(this.currentIndex)for(const l of this.currentIndex.sources)l.attendeeId===t||l.mediaType!==SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO||!e.has(l.attendeeId)&&!n.has(l.attendeeId)&&a.add(l.attendeeId);const s=this.buildAttendeeToSortedStreamDescriptorMapExcludingSelf(t),d=new Map;let u=0;s.forEach((l,f)=>{d.set(f,l[0]),u+=l[0].maxBitrateKbps}),u=this.trySelectHighBitrateForAttendees(s,e,u,o,d),this.trySelectHighBitrateForAttendees(s,a,u,o,d);const c=new DefaultVideoStreamIdSet_1$1.default;for(const l of d.values())c.add(l.streamId);return c}highestQualityStreamFromEachGroupExcludingSelf(t){const e=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex){const n=new Map;for(const o of this.currentIndex.sources)o.attendeeId===t||o.mediaType!==SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO||(!n.has(o.groupId)||o.maxBitrateKbps>n.get(o.groupId).maxBitrateKbps)&&n.set(o.groupId,o);for(const o of n.values())e.add(o.streamId)}return e}numberOfVideoPublishingParticipantsExcludingSelf(t){return this.highestQualityStreamFromEachGroupExcludingSelf(t).array().length}numberOfParticipants(){return this.currentIndex.numParticipants?this.currentIndex.numParticipants:-1}attendeeIdForTrack(t){const e=this.streamIdForTrack(t);if(e===void 0||!this.subscribeStreamToAttendeeMap)return this.logger.warn(`no attendee found for track ${t}`),"";const n=this.subscribeStreamToAttendeeMap.get(e);return n||(this.logger.info(`track ${t} (stream ${e}) does not correspond to a known attendee`),"")}externalUserIdForTrack(t){const e=this.streamIdForTrack(t);if(e===void 0||!this.subscribeStreamToExternalUserIdMap)return this.logger.warn(`no external user id found for track ${t}`),"";const n=this.subscribeStreamToExternalUserIdMap.get(e);return n||(this.logger.info(`track ${t} (stream ${e}) does not correspond to a known externalUserId`),"")}attendeeIdForStreamId(t){if(!this.streamToAttendeeMap)if(this.currentIndex)this.streamToAttendeeMap=this.buildStreamToAttendeeMap(this.currentIndex);else return"";const e=this.streamToAttendeeMap.get(t);return e||(this.logger.info(`stream ${t}) does not correspond to a known attendee`),"")}groupIdForStreamId(t){if(!(!this.currentIndex||!this.currentIndex.sources)){for(const e of this.currentIndex.sources)if(e.streamId===t)return e.groupId;if(this.indexForSubscribe){for(const e of this.indexForSubscribe.sources)if(e.streamId===t)return e.groupId}}}StreamIdsInSameGroup(t,e){return this.groupIdForStreamId(t)===this.groupIdForStreamId(e)}streamIdForTrack(t){if(!!this.subscribeTrackToStreamMap)return this.subscribeTrackToStreamMap.get(t)}streamIdForSSRC(t){if(!!this.subscribeSsrcToStreamMap)return this.subscribeSsrcToStreamMap.get(t)}overrideStreamIdMappings(t,e){if(this.subscribeTrackToStreamMap){for(const[n,o]of this.subscribeTrackToStreamMap.entries())if(t===o){this.subscribeTrackToStreamMap.set(n,e);break}}if(this.subscribeSsrcToStreamMap){for(const[n,o]of this.subscribeSsrcToStreamMap.entries())if(t===o){this.subscribeSsrcToStreamMap.set(n,e);break}}}streamsPausedAtSource(){const t=new DefaultVideoStreamIdSet_1$1.default;if(this.currentIndex)for(const e of this.currentIndex.pausedAtSourceIds)t.add(e);return t}buildTrackToStreamMap(t){const e=new Map;this.logger.debug(()=>`trackMap ${JSON.stringify(t.tracks)}`);for(const n of t.tracks)n.trackLabel.length>0&&n.streamId>0&&e.set(n.trackLabel,n.streamId);return e}buildSSRCToStreamMap(t){const e=new Map;this.logger.debug(()=>`ssrcMap ${JSON.stringify(t.tracks)}`);for(const n of t.tracks)n.trackLabel.length>0&&n.streamId>0&&e.set(n.ssrc,n.streamId);return e}buildStreamToAttendeeMap(t){const e=new Map;if(t)for(const n of t.sources)e.set(n.streamId,n.attendeeId);return e}buildStreamExternalUserIdMap(t){const e=new Map;if(t)for(const n of t.sources)n.externalUserId&&e.set(n.streamId,n.externalUserId);return e}trySelectHighBitrateForAttendees(t,e,n,o,a){for(const s of e){if(n>=o)break;if(t.has(s)){const d=t.get(s);for(const u of d.reverse())if(n-a.get(s).maxBitrateKbps+u.maxBitrateKbps<o){n=n-a.get(s).maxBitrateKbps+u.maxBitrateKbps,a.set(s,u);break}}}return n}buildAttendeeToSortedStreamDescriptorMapExcludingSelf(t){const e=new Map;if(this.currentIndex)for(const n of this.currentIndex.sources)n.attendeeId===t||n.mediaType!==SignalingProtocol_js_1$1.SdkStreamMediaType.VIDEO||(e.has(n.attendeeId)?e.get(n.attendeeId).push(n):e.set(n.attendeeId,[n]));return e.forEach((n,o)=>{n.sort((a,s)=>a.maxBitrateKbps>s.maxBitrateKbps?1:a.maxBitrateKbps<s.maxBitrateKbps?-1:0)}),e}}DefaultVideoStreamIndex$1.default=DefaultVideoStreamIndex;var SimulcastVideoStreamIndex$1={};Object.defineProperty(SimulcastVideoStreamIndex$1,"__esModule",{value:!0});const SignalingProtocol_js_1=SignalingProtocol,DefaultVideoStreamIndex_1=DefaultVideoStreamIndex$1,VideoStreamDescription_1=VideoStreamDescription$1;class SimulcastVideoStreamIndex extends DefaultVideoStreamIndex_1.default{constructor(t){super(t),this.streamIdToBitrateKbpsMap=new Map,this._localStreamInfos=[],this._lastBitRateMsgTime=Date.now()}localStreamDescriptions(){const t=[];return this._localStreamInfos.forEach(e=>{t.push(e.clone())}),t}integrateUplinkPolicyDecision(t){let e=!0,n=0;for(let o=0;o<t.length;o++){const a=t[o].maxBitrate/1e3,s=t[o].maxFramerate;if(!e||o===this._localStreamInfos.length){e=!1;const d=new VideoStreamDescription_1.default;d.maxBitrateKbps=a,d.maxFrameRate=s,d.disabledByUplinkPolicy=a===0,a!==0&&(d.timeEnabled=Date.now()),this._localStreamInfos.push(d),n++;continue}this._localStreamInfos[n].maxBitrateKbps===0&&a>0&&(this._localStreamInfos[n].timeEnabled=Date.now()),this._localStreamInfos[n].maxBitrateKbps=a,this._localStreamInfos[n].maxFrameRate=s,this._localStreamInfos[n].disabledByUplinkPolicy=a===0,this._localStreamInfos[n].disabledByUplinkPolicy===!0&&(this._localStreamInfos[n].disabledByWebRTC=!1),n++}e&&this._localStreamInfos.splice(n)}integrateBitratesFrame(t){super.integrateBitratesFrame(t);const e=new Set,n=new Set(this.streamIdToBitrateKbpsMap.keys());for(const o of t.bitrates)e.add(o.sourceStreamId),this.streamIdToBitrateKbpsMap.set(o.sourceStreamId,this.convertBpsToKbps(o.avgBitrateBps));for(const o of n)e.has(o)||(this.streamIdToBitrateKbpsMap.get(o)===SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE?this.streamIdToBitrateKbpsMap.set(o,SimulcastVideoStreamIndex.RECENTLY_INACTIVE_STREAM_BITRATE):this.streamIdToBitrateKbpsMap.set(o,SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE));for(let o=0;o<this._localStreamInfos.length;o++){this._localStreamInfos[o].disabledByWebRTC=!1;const a=this._localStreamInfos[o].streamId;this._localStreamInfos[o].disabledByUplinkPolicy||(this.streamIdToBitrateKbpsMap.has(a)?this.streamIdToBitrateKbpsMap.get(a)===SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE&&this._lastBitRateMsgTime-this._localStreamInfos[o].timeEnabled>SimulcastVideoStreamIndex.BitratesMsgFrequencyMs&&(this._localStreamInfos[o].disabledByWebRTC=!0):this._lastBitRateMsgTime-this._localStreamInfos[o].timeEnabled>SimulcastVideoStreamIndex.BitratesMsgFrequencyMs&&(this._localStreamInfos[o].disabledByWebRTC=!0))}this._lastBitRateMsgTime=Date.now(),this.logLocalStreamDescriptions()}logLocalStreamDescriptions(){let t="";for(const e of this._localStreamInfos)t+=`streamId=${e.streamId} maxBitrate=${e.maxBitrateKbps} disabledByWebRTC=${e.disabledByWebRTC} disabledByUplink=${e.disabledByUplinkPolicy}
`;this.logger.debug(()=>t)}integrateIndexFrame(t){super.integrateIndexFrame(t);const e=new Set,n=new Set(this.streamIdToBitrateKbpsMap.keys());for(const o of this.currentIndex.sources)o.mediaType===SignalingProtocol_js_1.SdkStreamMediaType.VIDEO&&(e.add(o.streamId),this.streamIdToBitrateKbpsMap.has(o.streamId)||this.streamIdToBitrateKbpsMap.set(o.streamId,SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE));for(const o of n)e.has(o)||this.streamIdToBitrateKbpsMap.delete(o)}integrateSubscribeAckFrame(t){if(super.integrateSubscribeAckFrame(t),!t.allocations||t.allocations===void 0)return;let e=0;for(const n of t.allocations){if(this._localStreamInfos.length<e+1){this.logger.info("simulcast: allocation has more than number of local streams");break}this._localStreamInfos[e].groupId=n.groupId,this._localStreamInfos[e].streamId=n.streamId,this.streamIdToBitrateKbpsMap.has(n.streamId)||this.streamIdToBitrateKbpsMap.set(n.streamId,SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE),e++}}}SimulcastVideoStreamIndex$1.default=SimulcastVideoStreamIndex;SimulcastVideoStreamIndex.UNSEEN_STREAM_BITRATE=-2;SimulcastVideoStreamIndex.RECENTLY_INACTIVE_STREAM_BITRATE=-1;SimulcastVideoStreamIndex.NOT_SENDING_STREAM_BITRATE=0;SimulcastVideoStreamIndex.BitratesMsgFrequencyMs=4e3;var DefaultVideoTileController$1={},DefaultDevicePixelRatioMonitor$1={},__awaiter$m=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultDevicePixelRatioMonitor$1,"__esModule",{value:!0});class DefaultDevicePixelRatioMonitor{constructor(t,e){if(this.devicePixelRatioSource=t,this.observerQueue=new Set,this.mediaQueryListener=()=>{this.observerQueue.forEach(o=>{o.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())})},typeof window>"u")return;const n=matchMedia(`(resolution: ${this.devicePixelRatioSource.devicePixelRatio()}dppx)`);typeof n.addEventListener=="function"?(n.addEventListener("change",this.mediaQueryListener),this.mediaQueryList=n):typeof n.addListener=="function"?(n.addListener(this.mediaQueryListener),this.mediaQueryList=n):e.warn("ignoring DefaultDevicePixelRatioMonitor")}destroy(){return __awaiter$m(this,void 0,void 0,function*(){this.mediaQueryList&&(typeof this.mediaQueryList.addEventListener=="function"?this.mediaQueryList.removeEventListener("change",this.mediaQueryListener):this.mediaQueryList.removeListener(this.mediaQueryListener)),delete this.mediaQueryListener,this.observerQueue.clear()})}registerObserver(t){this.observerQueue.add(t),t.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}removeObserver(t){this.observerQueue.delete(t)}}DefaultDevicePixelRatioMonitor$1.default=DefaultDevicePixelRatioMonitor;var DevicePixelRatioWindowSource$1={};Object.defineProperty(DevicePixelRatioWindowSource$1,"__esModule",{value:!0});class DevicePixelRatioWindowSource{devicePixelRatio(){return typeof window>"u"||!window||!window.devicePixelRatio?1:window.devicePixelRatio}}DevicePixelRatioWindowSource$1.default=DevicePixelRatioWindowSource;var __awaiter$l=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultVideoTileController$1,"__esModule",{value:!0});const DefaultDevicePixelRatioMonitor_1=DefaultDevicePixelRatioMonitor$1,DevicePixelRatioWindowSource_1=DevicePixelRatioWindowSource$1,Types_1$2=Types,DefaultVideoTile_1$1=DefaultVideoTile$1;class DefaultVideoTileController{constructor(t,e,n){this.tileFactory=t,this.audioVideoController=e,this.logger=n,this.tileMap=new Map,this.nextTileId=1,this.currentLocalTile=null,this.currentPausedTilesByIds=new Set,this.keepLastFrameWhenPaused=!1,this.keepLastFrameWhenPaused=e.configuration.keepLastFrameWhenPaused}createDevicePixelRatioMonitorIfNeeded(){this.devicePixelRatioMonitor||(this.devicePixelRatioMonitor=new DefaultDevicePixelRatioMonitor_1.default(new DevicePixelRatioWindowSource_1.default,this.logger))}discardDevicePixelRatioMonitorIfNotNeeded(){return __awaiter$l(this,void 0,void 0,function*(){if(this.tileMap.size||!this.devicePixelRatioMonitor)return;const t=this.devicePixelRatioMonitor;return this.devicePixelRatioMonitor=void 0,t.destroy()})}bindVideoElement(t,e){const n=this.getVideoTile(t);if(n===null){this.logger.warn(`Ignoring video element binding for unknown tile id ${t}`);return}n.bindVideoElement(e)}unbindVideoElement(t,e=!0){const n=this.getVideoTile(t);if(n===null){this.logger.warn(`Ignoring video element unbinding for unknown tile id ${t}`);return}this.logger.info("Unbinding the video element");const o=n.stateRef().boundVideoElement;n.bindVideoElement(null),e&&(this.logger.info("Cleaning up the video element"),DefaultVideoTile_1$1.default.disconnectVideoStreamFromVideoElement(o,!1))}startLocalVideoTile(){const t=this.findOrCreateLocalVideoTile();return this.currentLocalTile.stateRef().localTileStarted=!0,this.audioVideoController.update({needsRenegotiation:!0}),t.id()}stopLocalVideoTile(){!this.currentLocalTile||(this.currentLocalTile.stateRef().localTileStarted=!1,this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.audioVideoController.update({needsRenegotiation:!0}))}hasStartedLocalVideoTile(){return!!(this.currentLocalTile&&this.currentLocalTile.stateRef().localTileStarted)}removeLocalVideoTile(){this.currentLocalTile&&this.removeVideoTile(this.currentLocalTile.id())}getLocalVideoTile(){return this.currentLocalTile}pauseVideoTile(t){const e=this.getVideoTile(t);e&&(this.currentPausedTilesByIds.has(t)||(this.audioVideoController.pauseReceivingStream(e.stateRef().streamId),this.currentPausedTilesByIds.add(t)),e.pause())}unpauseVideoTile(t){const e=this.getVideoTile(t);e&&(this.currentPausedTilesByIds.has(t)&&(this.audioVideoController.resumeReceivingStream(e.stateRef().streamId),this.currentPausedTilesByIds.delete(t)),e.unpause())}getVideoTile(t){return this.tileMap.has(t)?this.tileMap.get(t):null}getVideoTileArea(t){const e=t.state();let n=0,o=0;return e.boundVideoElement&&(n=e.boundVideoElement.clientHeight*e.devicePixelRatio,o=e.boundVideoElement.clientWidth*e.devicePixelRatio),n*o}getAllRemoteVideoTiles(){const t=new Array;return this.tileMap.forEach((e,n)=>{(!this.currentLocalTile||n!==this.currentLocalTile.id())&&t.push(e)}),t}getAllVideoTiles(){return Array.from(this.tileMap.values())}addVideoTile(t=!1){const e=this.nextTileId;this.nextTileId+=1,this.createDevicePixelRatioMonitorIfNeeded();const n=this.tileFactory.makeTile(e,t,this,this.devicePixelRatioMonitor);return this.tileMap.set(e,n),n}removeVideoTile(t){if(!this.tileMap.has(t))return;const e=this.tileMap.get(t);this.currentLocalTile===e&&(this.currentLocalTile=null),e.destroy(),this.tileMap.delete(t),this.audioVideoController.forEachObserver(n=>{Types_1$2.Maybe.of(n.videoTileWasRemoved).map(o=>o.bind(n)(t))}),this.discardDevicePixelRatioMonitorIfNotNeeded()}removeVideoTilesByAttendeeId(t){const e=[];for(const n of this.getAllVideoTiles()){const o=n.state();o.boundAttendeeId===t&&(this.removeVideoTile(o.tileId),e.push(o.tileId))}return e}removeAllVideoTiles(){const t=Array.from(this.tileMap.keys());for(const e of t)this.removeVideoTile(e)}sendTileStateUpdate(t){this.audioVideoController.forEachObserver(e=>{Types_1$2.Maybe.of(e.videoTileDidUpdate).map(n=>n.bind(e)(t))})}haveVideoTilesWithStreams(){for(const t of this.getAllVideoTiles())if(t.state().boundVideoStream)return!0;return!1}haveVideoTileForAttendeeId(t){return!!this.getVideoTileForAttendeeId(t)}getVideoTileForAttendeeId(t){for(const e of this.getAllVideoTiles())if(e.state().boundAttendeeId===t)return e}captureVideoTile(t){const e=this.getVideoTile(t);return e?e.capture():null}findOrCreateLocalVideoTile(){return this.currentLocalTile?this.currentLocalTile:(this.currentLocalTile=this.addVideoTile(!0),this.currentLocalTile.bindVideoStream(this.audioVideoController.configuration.credentials.attendeeId,!0,null,null,null,null,this.audioVideoController.configuration.credentials.externalUserId),this.currentLocalTile)}}DefaultVideoTileController$1.default=DefaultVideoTileController;var DefaultVideoTileFactory$1={};Object.defineProperty(DefaultVideoTileFactory$1,"__esModule",{value:!0});const DefaultVideoTile_1=DefaultVideoTile$1;class DefaultVideoTileFactory{makeTile(t,e,n,o){return new DefaultVideoTile_1.default(t,e,n,o)}}DefaultVideoTileFactory$1.default=DefaultVideoTileFactory;var DefaultSimulcastUplinkPolicy$1={},SimulcastLayers={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.SimulcastLayers=void 0;var t;(function(e){e[e.Low=0]="Low",e[e.LowAndMedium=1]="LowAndMedium",e[e.LowAndHigh=2]="LowAndHigh",e[e.Medium=3]="Medium",e[e.MediumAndHigh=4]="MediumAndHigh",e[e.High=5]="High"})(t=r.SimulcastLayers||(r.SimulcastLayers={})),r.default=t})(SimulcastLayers);Object.defineProperty(DefaultSimulcastUplinkPolicy$1,"__esModule",{value:!0});const SimulcastLayers_1=SimulcastLayers,SimulcastTransceiverController_1=SimulcastTransceiverController$1,Types_1$1=Types,DefaultVideoCaptureAndEncodeParameter_1$2=DefaultVideoCaptureAndEncodeParameter$1,BitrateParameters_1=BitrateParameters$1;class DefaultSimulcastUplinkPolicy{constructor(t,e){this.selfAttendeeId=t,this.logger=e,this.numSenders=0,this.shouldDisableSimulcast=!1,this.newQualityMap=new Map,this.currentQualityMap=new Map,this.newActiveStreams=1,this.currentActiveStreams=1,this.lastUplinkBandwidthKbps=DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps,this.startTimeMs=0,this.lastUpdatedMs=Date.now(),this.videoIndex=null,this.currLocalDescriptions=[],this.nextLocalDescriptions=[],this.observerQueue=new Set,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$2.default(0,0,0,0,!0),this.parametersInEffect=new DefaultVideoCaptureAndEncodeParameter_1$2.default(0,0,0,0,!0),this.lastUplinkBandwidthKbps=DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps,this.currentQualityMap=this.fillEncodingParamWithBitrates([300,0,1200]),this.newQualityMap=this.fillEncodingParamWithBitrates([300,0,1200])}updateConnectionMetric({uplinkKbps:t=0}){if(isNaN(t))return;this.startTimeMs===0&&(this.startTimeMs=Date.now()),Date.now()-this.startTimeMs<DefaultSimulcastUplinkPolicy.startupDurationMs?this.lastUplinkBandwidthKbps=DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps:this.lastUplinkBandwidthKbps=t,this.logger.debug(()=>`simulcast: uplink policy update metrics ${this.lastUplinkBandwidthKbps}`);let e=DefaultSimulcastUplinkPolicy.holdDownDurationMs;this.currentActiveStreams===3?e=DefaultSimulcastUplinkPolicy.holdDownDurationMs*2:(this.currentActiveStreams===2&&t<=DefaultSimulcastUplinkPolicy.kMidDisabledRate||this.currentActiveStreams===1&&t<=DefaultSimulcastUplinkPolicy.kHiDisabledRate)&&(e=DefaultSimulcastUplinkPolicy.holdDownDurationMs/2),!(Date.now()<this.lastUpdatedMs+e)&&(this.newQualityMap=this.calculateEncodingParameters(!1))}calculateEncodingParameters(t){const e=[new BitrateParameters_1.default,new BitrateParameters_1.default,new BitrateParameters_1.default];let n=0,o=0;if(this.currentActiveStreams===0?(n=this.lastUplinkBandwidthKbps+1,o=0):this.currentActiveStreams===1?(n=2400,o=DefaultSimulcastUplinkPolicy.kHiDisabledRate):this.currentActiveStreams===2?(n=1e3,o=DefaultSimulcastUplinkPolicy.kMidDisabledRate):(n=300,o=0),t||this.lastUplinkBandwidthKbps>=n||this.lastUplinkBandwidthKbps<=o){this.shouldDisableSimulcast?(this.newActiveStreams=0,e[0].maxBitrateKbps=0,e[1].maxBitrateKbps=1200,e[2].maxBitrateKbps=0):this.numSenders<=4&&this.lastUplinkBandwidthKbps>=DefaultSimulcastUplinkPolicy.kHiDisabledRate?(this.newActiveStreams=1,e[0].maxBitrateKbps=300,e[1].maxBitrateKbps=0,e[2].maxBitrateKbps=1200):this.lastUplinkBandwidthKbps>=DefaultSimulcastUplinkPolicy.kMidDisabledRate?(this.newActiveStreams=2,e[0].maxBitrateKbps=this.lastUplinkBandwidthKbps>=350?200:150,e[1].maxBitrateKbps=this.numSenders<=6?600:350,e[2].maxBitrateKbps=0):(this.newActiveStreams=3,e[0].maxBitrateKbps=300,e[1].maxBitrateKbps=0,e[2].maxBitrateKbps=0);const a=e.map((s,d,u)=>s.maxBitrateKbps);this.newQualityMap=this.fillEncodingParamWithBitrates(a),this.encodingParametersEqual()||this.logger.info(`simulcast: policy:calculateEncodingParameters bw:${this.lastUplinkBandwidthKbps} numSources:${this.numSenders} shouldDisableSimulcast:${this.shouldDisableSimulcast} newQualityMap: ${this.getQualityMapString(this.newQualityMap)}`)}return this.newQualityMap}chooseMediaTrackConstraints(){return{width:{ideal:1280},height:{ideal:768},frameRate:{ideal:15}}}chooseEncodingParameters(){return this.currentQualityMap=this.newQualityMap,this.currentActiveStreams=this.newActiveStreams,this.activeStreamsToPublish!==this.newActiveStreams&&(this.activeStreamsToPublish=this.newActiveStreams,this.publishEncodingSimulcastLayer()),this.currentQualityMap}updateIndex(t){const e=t.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+1,n=e!==this.numSenders,o=t.numberOfParticipants(),a=o>=0&&o<=2,s=this.shouldDisableSimulcast!==a;this.numSenders=e,this.shouldDisableSimulcast=a,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$2.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1),this.videoIndex=t,this.newQualityMap=this.calculateEncodingParameters(n||s)}wantsResubscribe(){let t=!this.encodingParametersEqual();this.nextLocalDescriptions=this.videoIndex.localStreamDescriptions();for(let e=0;e<this.nextLocalDescriptions.length;e++){const n=this.nextLocalDescriptions[e].streamId;if(n!==0&&!!n){const o=this.currLocalDescriptions.findIndex(a=>a.streamId===n);o!==-1&&this.nextLocalDescriptions[e].disabledByWebRTC!==this.currLocalDescriptions[o].disabledByWebRTC&&(t=!0)}}return t&&(this.lastUpdatedMs=Date.now()),this.currLocalDescriptions=this.nextLocalDescriptions,t}compareEncodingParameter(t,e){return JSON.stringify(t)===JSON.stringify(e)}encodingParametersEqual(){let t=!1;for(const e of SimulcastTransceiverController_1.default.NAME_ARR_ASCENDING)if(t=t||!this.compareEncodingParameter(this.newQualityMap.get(e),this.currentQualityMap.get(e)),t)break;return!t}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}captureWidth(){return 1280}captureHeight(){return 768}captureFrameRate(){return 15}maxBandwidthKbps(){return 1400}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}fillEncodingParamWithBitrates(t){const e=new Map,n=1e3,o=SimulcastTransceiverController_1.default.NAME_ARR_ASCENDING,a=t;let s=this.shouldDisableSimulcast?1:4;for(let d=0;d<o.length;d++){const u=o[d];e.set(u,{rid:u,active:a[d]>0,scaleResolutionDownBy:Math.max(s,1),maxBitrate:a[d]*n}),s=s/2}return e}getQualityMapString(t){let e="";const n=this.videoIndex.localStreamDescriptions();return n.length===3&&t.forEach(o=>{let a=!1;o.rid==="low"?a=n[0].disabledByWebRTC:o.rid==="mid"?a=n[1].disabledByWebRTC:a=n[2].disabledByWebRTC,e+=`{ rid: ${o.rid} active:${o.active} disabledByWebRTC: ${a} maxBitrate:${o.maxBitrate}}`}),e}getEncodingSimulcastLayer(t){switch(t){case 0:return SimulcastLayers_1.default.High;case 1:return SimulcastLayers_1.default.LowAndHigh;case 2:return SimulcastLayers_1.default.LowAndMedium;case 3:return SimulcastLayers_1.default.Low}}publishEncodingSimulcastLayer(){const t=this.getEncodingSimulcastLayer(this.activeStreamsToPublish);this.forEachObserver(e=>{Types_1$1.Maybe.of(e.encodingSimulcastLayersDidChange).map(n=>n.bind(e)(t))})}addObserver(t){this.logger.info("adding simulcast uplink observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing simulcast uplink observer"),this.observerQueue.delete(t)}forEachObserver(t){for(const e of this.observerQueue)t(e)}}DefaultSimulcastUplinkPolicy$1.default=DefaultSimulcastUplinkPolicy;DefaultSimulcastUplinkPolicy.defaultUplinkBandwidthKbps=1200;DefaultSimulcastUplinkPolicy.startupDurationMs=6e3;DefaultSimulcastUplinkPolicy.holdDownDurationMs=4e3;DefaultSimulcastUplinkPolicy.defaultMaxFrameRate=15;DefaultSimulcastUplinkPolicy.kHiDisabledRate=700;DefaultSimulcastUplinkPolicy.kMidDisabledRate=240;var NScaleVideoUplinkBandwidthPolicy$1={},__awaiter$k=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(NScaleVideoUplinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoCaptureAndEncodeParameter_1$1=DefaultVideoCaptureAndEncodeParameter$1;class NScaleVideoUplinkBandwidthPolicy{constructor(t,e=!0,n=void 0,o=void 0){this.selfAttendeeId=t,this.scaleResolution=e,this.logger=n,this.browserBehavior=o,this.numberOfPublishedVideoSources=0,this.idealMaxBandwidthKbps=1400,this.hasBandwidthPriority=!1,this.encodingParamMap=new Map,this.reset()}reset(){this.numberOfPublishedVideoSources=0,this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$1.default(0,0,0,0,!1),this.parametersInEffect=new DefaultVideoCaptureAndEncodeParameter_1$1.default(0,0,0,0,!1),this.encodingParamMap.set(NScaleVideoUplinkBandwidthPolicy.encodingMapKey,{maxBitrate:0})}updateConnectionMetric(t){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(t){var e;let n=!0,o=1;this.transceiverController&&(n=this.transceiverController.hasVideoInput());const a=t.numberOfVideoPublishingParticipantsExcludingSelf(this.selfAttendeeId)+(n?1:0);if(this.numberOfPublishedVideoSources===a){(e=this.logger)===null||e===void 0||e.debug("Skipping update index; Number of participants has not changed");return}if(this.numberOfPublishedVideoSources=a,this.transceiverController){const s=this.getStreamCaptureSetting();s&&(o=this.calculateEncodingParameters(s).scaleResolutionDownBy)}this.optimalParameters=new DefaultVideoCaptureAndEncodeParameter_1$1.default(this.captureWidth(),this.captureHeight(),this.captureFrameRate(),this.maxBandwidthKbps(),!1,o)}wantsResubscribe(){return!this.parametersInEffect.equal(this.optimalParameters)}chooseCaptureAndEncodeParameters(){return this.parametersInEffect=this.optimalParameters.clone(),this.parametersInEffect.clone()}captureWidth(){let t=640;return this.getNumberOfPublishedVideoSources()>4&&(t=320),t}captureHeight(){let t=384;return this.getNumberOfPublishedVideoSources()>4&&(t=192),t}captureFrameRate(){return 15}maxBandwidthKbps(){if(this.hasBandwidthPriority)return Math.trunc(this.idealMaxBandwidthKbps);let t=0;return this.getNumberOfPublishedVideoSources()<=2?t=this.idealMaxBandwidthKbps:this.getNumberOfPublishedVideoSources()<=4?t=this.idealMaxBandwidthKbps*2/3:t=(544/11+14880/(11*this.getNumberOfPublishedVideoSources()))/600*this.idealMaxBandwidthKbps,Math.trunc(t)}setIdealMaxBandwidthKbps(t){this.idealMaxBandwidthKbps=t}setHasBandwidthPriority(t){this.hasBandwidthPriority=t}setTransceiverController(t){this.transceiverController=t}updateTransceiverController(){return __awaiter$k(this,void 0,void 0,function*(){const t=this.getStreamCaptureSetting();if(!t)return;const e=this.calculateEncodingParameters(t);this.shouldUpdateEndcodingParameters(e)&&(this.encodingParamMap.set(NScaleVideoUplinkBandwidthPolicy.encodingMapKey,e),this.transceiverController.setEncodingParameters(this.encodingParamMap))})}shouldUpdateEndcodingParameters(t){var e,n;const o=(n=(e=this.transceiverController.localVideoTransceiver().sender.getParameters())===null||e===void 0?void 0:e.encodings)===null||n===void 0?void 0:n[0];return t.maxBitrate!==(o==null?void 0:o.maxBitrate)||t.scaleResolutionDownBy!==(o==null?void 0:o.scaleResolutionDownBy)}calculateEncodingParameters(t){var e,n;const o=this.maxBandwidthKbps()*1e3;let a=1;if(t.height!==void 0&&t.width!==void 0&&this.scaleResolution&&!this.hasBandwidthPriority&&this.getNumberOfPublishedVideoSources()>2){let s=NScaleVideoUplinkBandwidthPolicy.targetHeightArray[Math.min(this.getNumberOfPublishedVideoSources(),NScaleVideoUplinkBandwidthPolicy.targetHeightArray.length-1)];s===480&&((e=this.browserBehavior)===null||e===void 0?void 0:e.disable480pResolutionScaleDown())&&(s=360),a=Math.max(Math.min(t.height,t.width)/s,1),(n=this.logger)===null||n===void 0||n.info(`Resolution scale factor is ${a} for capture resolution ${t.width}x${t.height}. New dimension is ${t.width/a}x${t.height/a}`)}return{scaleResolutionDownBy:a,maxBitrate:o}}getStreamCaptureSetting(){var t,e,n,o;return(o=(n=(e=(t=this.transceiverController)===null||t===void 0?void 0:t.localVideoTransceiver())===null||e===void 0?void 0:e.sender)===null||n===void 0?void 0:n.track)===null||o===void 0?void 0:o.getSettings()}getNumberOfPublishedVideoSources(){var t;return(t=this.numberOfPublishedVideoSources)!==null&&t!==void 0?t:0}}NScaleVideoUplinkBandwidthPolicy$1.default=NScaleVideoUplinkBandwidthPolicy;NScaleVideoUplinkBandwidthPolicy.encodingMapKey="video";NScaleVideoUplinkBandwidthPolicy.targetHeightArray=[0,0,0,540,540,480,480,480,480,360,360,360,360,270,270,270,270,180,180,180,180,180,180,180,180,180];var DefaultVolumeIndicatorAdapter$1={};Object.defineProperty(DefaultVolumeIndicatorAdapter$1,"__esModule",{value:!0});class DefaultVolumeIndicatorAdapter{constructor(t,e,n,o,a){this.logger=t,this.realtimeController=e,this.minVolumeDecibels=n,this.maxVolumeDecibels=o,this.selfAttendeeId=a,this.streamIdToAttendeeId={},this.streamIdToExternalUserId={},this.warnedAboutMissingStreamIdMapping={},this.attendeeIdToStreamId={},this.sessionReconnected=!1}onReconnect(){this.sessionReconnected=!0}sendRealtimeUpdatesForAudioStreamIdInfo(t){let e=0;for(const n of t.streams){const o=!!n.attendeeId,a=!!n.externalUserId,s=n.hasOwnProperty("muted"),d=!!n.dropped;if(o){!!this.attendeeIdToStreamId[n.attendeeId]&&this.attendeeIdToStreamId[n.attendeeId]<n.audioStreamId&&delete this.attendeeIdToStreamId[n.attendeeId],this.streamIdToAttendeeId[n.audioStreamId]=n.attendeeId;const u=a?n.externalUserId:n.attendeeId;this.streamIdToExternalUserId[n.audioStreamId]=u,this.attendeeIdToStreamId[n.attendeeId]=n.audioStreamId,this.realtimeController.realtimeSetAttendeeIdPresence(n.attendeeId,!0,u,!1,{attendeeIndex:e++,attendeesInFrame:t.streams.length})}if(s){const u=this.streamIdToAttendeeId[n.audioStreamId],c=this.streamIdToExternalUserId[n.audioStreamId];this.realtimeController.realtimeUpdateVolumeIndicator(u,null,n.muted,null,c)}if(!o&&!s){const u=this.streamIdToAttendeeId[n.audioStreamId];if(u){const c=this.streamIdToExternalUserId[n.audioStreamId];delete this.streamIdToAttendeeId[n.audioStreamId],delete this.streamIdToExternalUserId[n.audioStreamId],delete this.warnedAboutMissingStreamIdMapping[n.audioStreamId],this.attendeeIdToStreamId[u]===n.audioStreamId&&delete this.attendeeIdToStreamId[u];let l=!1;for(const f of Object.keys(this.streamIdToAttendeeId)){const h=parseInt(f);if(h>n.audioStreamId&&this.streamIdToAttendeeId[h]===u){l=!0;break}}l||this.realtimeController.realtimeSetAttendeeIdPresence(u,!1,c,d,{attendeeIndex:e++,attendeesInFrame:t.streams.length})}}}this.sessionReconnected&&(this.cleanUpState(t),this.sessionReconnected=!1)}cleanUpState(t){const e=Object.values(this.streamIdToAttendeeId),n=t.streams.map(a=>a.attendeeId),o=e.filter(a=>!n.includes(a));for(const[a,s]of o.entries()){const d=this.attendeeIdToStreamId[s],u=this.streamIdToExternalUserId[d];if(delete this.streamIdToAttendeeId[d],delete this.streamIdToExternalUserId[d],delete this.warnedAboutMissingStreamIdMapping[d],delete this.attendeeIdToStreamId[s],s===this.selfAttendeeId){this.logger.warn("the volume indicator adapter cleans up the current attendee (presence = false) after reconnection");continue}this.realtimeController.realtimeSetAttendeeIdPresence(s,!1,u,!1,{attendeeIndex:a,attendeesInFrame:s.length})}}sendRealtimeUpdatesForAudioMetadata(t){let e=null,n=null;for(const o of t.attendeeStates){const a=this.attendeeIdForStreamId(o.audioStreamId);o.hasOwnProperty("volume")&&(e===null&&(e={}),a!==null&&(e[a]=this.normalizedVolume(o))),o.hasOwnProperty("signalStrength")&&(n===null&&(n={}),a!==null&&(n[a]=this.normalizedSignalStrength(o)))}this.applyRealtimeUpdatesForAudioMetadata(e,n)}normalizedVolume(t){const e=-t.volume,n=1-(e-this.maxVolumeDecibels)/(this.minVolumeDecibels-this.maxVolumeDecibels);return Math.min(Math.max(n,0),1)}normalizedSignalStrength(t){const e=t.signalStrength/DefaultVolumeIndicatorAdapter.MAX_SIGNAL_STRENGTH_LEVELS;return Math.min(Math.max(e,0),1)}applyRealtimeUpdatesForAudioMetadata(t,e){for(const n in this.streamIdToAttendeeId){const o=this.streamIdToAttendeeId[n],a=this.streamIdToExternalUserId[n];let s=null,d=null;t!==null&&(t.hasOwnProperty(o)?s=t[o]:s=DefaultVolumeIndicatorAdapter.IMPLICIT_VOLUME),e!==null&&(e.hasOwnProperty(o)?d=e[o]:d=DefaultVolumeIndicatorAdapter.IMPLICIT_SIGNAL_STRENGTH),(s!==null||d!==null)&&this.realtimeController.realtimeUpdateVolumeIndicator(o,s,null,d,a)}}attendeeIdForStreamId(t){if(t===0)return null;const e=this.streamIdToAttendeeId[t];return e||(this.warnedAboutMissingStreamIdMapping[t]||(this.warnedAboutMissingStreamIdMapping[t]=!0,this.logger.warn(`volume indicator stream id ${t} seen before being defined`)),null)}}DefaultVolumeIndicatorAdapter$1.default=DefaultVolumeIndicatorAdapter;DefaultVolumeIndicatorAdapter.MAX_SIGNAL_STRENGTH_LEVELS=2;DefaultVolumeIndicatorAdapter.IMPLICIT_VOLUME=0;DefaultVolumeIndicatorAdapter.IMPLICIT_SIGNAL_STRENGTH=1;var hasRequiredDefaultAudioVideoController;function requireDefaultAudioVideoController(){if(hasRequiredDefaultAudioVideoController)return DefaultAudioVideoController;hasRequiredDefaultAudioVideoController=1;var r=commonjsGlobal&&commonjsGlobal.__awaiter||function(Se,_,w,M){function j(J){return J instanceof w?J:new w(function(K){K(J)})}return new(w||(w=Promise))(function(J,K){function Y(W){try{Q(M.next(W))}catch(te){K(te)}}function se(W){try{Q(M.throw(W))}catch(te){K(te)}}function Q(W){W.done?J(W.value):j(W.value).then(Y,se)}Q((M=M.apply(Se,_||[])).next())})};Object.defineProperty(DefaultAudioVideoController,"__esModule",{value:!0});const t=DefaultActiveSpeakerDetector$1,e=DefaultAudioMixController$1,n=AudioProfile$1,o=DefaultBrowserBehavior$1,a=ConnectionHealthData$1,s=SignalingAndMetricsConnectionMonitor$1,d=MeetingSessionStatus$1,u=MeetingSessionStatusCode,c=MeetingSessionVideoAvailability$1,l=DefaultModality$1,f=DefaultPingPong$1,h=DefaultRealtimeController$1,p=AsyncScheduler$1,m=DefaultSessionStateController$1,S=SessionStateControllerAction,g=SessionStateControllerState,y=SessionStateControllerTransitionResult,E=DefaultSignalingClient$1,T=SignalingClientEventType,C=SignalingClientVideoSubscriptionConfiguration$1,P=SignalingProtocol,x=StatsCollector$1,$=AttachMediaInputTask$1,I=CleanRestartedSessionTask$1,A=CleanStoppedSessionTask$1,v=CreatePeerConnectionTask$1,b=CreateSDPTask$1,k=FinishGatheringICECandidatesTask$1,D=JoinAndReceiveIndexTask$1,R=LeaveAndReceiveLeaveAckTask$1,O=ListenForVolumeIndicatorsTask$1,B=MonitorTask$1,F=OpenSignalingConnectionTask$1,ie=ParallelGroupTask$1,V=requirePromoteToPrimaryMeetingTask(),X=ReceiveAudioInputTask$1,re=ReceiveTURNCredentialsTask$1,z=ReceiveVideoInputTask$1,oe=ReceiveVideoStreamIndexTask$1,le=SendAndReceiveDataMessagesTask$1,q=SerialGroupTask$1,ce=SetLocalDescriptionTask$1,de=SetRemoteDescriptionTask$1,me=SubscribeAndReceiveSubscribeAckTask$1,ee=TimeoutTask$1,ve=WaitForAttendeePresenceTask$1,fe=DefaultTransceiverController$1,Ce=SimulcastContentShareTransceiverController$1,_e=SimulcastTransceiverController$1,he=VideoOnlyTransceiverController$1,ae=Types,Te=DefaultVideoCaptureAndEncodeParameter$1,be=AllHighestVideoBandwidthPolicy$1,ye=VideoAdaptiveProbePolicy$1,ne=DefaultVideoStreamIdSet$1,ue=DefaultVideoStreamIndex$1,ge=SimulcastVideoStreamIndex$1,N=DefaultVideoTileController$1,G=DefaultVideoTileFactory$1,L=DefaultSimulcastUplinkPolicy$1,Z=NScaleVideoUplinkBandwidthPolicy$1,U=DefaultVolumeIndicatorAdapter$1,pe=AudioVideoControllerState$1;class H{constructor(_,w,M,j,J,K){this._audioProfile=new n.default,this.connectionHealthData=new a.default,this.observerQueue=new Set,this.meetingSessionContext=new pe.default,this.enableSimulcast=!1,this.useUpdateTransceiverControllerForUplink=!1,this.totalRetryCount=0,this.startAudioVideoTimestamp=0,this.mayNeedRenegotiationForSimulcastLayerChange=!1,this.promotedToPrimaryMeeting=!1,this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!1,this.receiveIndexTask=void 0,this.monitorTask=void 0,this.destroyed=!1,this.usePromises=!0,this._logger=w,this.sessionStateController=new m.default(this._logger),this._configuration=_,this._webSocketAdapter=M,this._realtimeController=new h.default(j),this._realtimeController.realtimeSetLocalAttendeeId(_.credentials.attendeeId,_.credentials.externalUserId),this._mediaStreamBroker=j,this._reconnectController=J,this._videoTileController=new N.default(new G.default,this,this._logger),this._audioMixController=new e.default(this._logger),this._mediaStreamBroker.addMediaStreamBrokerObserver(this._audioMixController),this.meetingSessionContext.logger=this._logger,this._eventController=K}destroy(){return r(this,void 0,void 0,function*(){this.observerQueue.clear(),this._mediaStreamBroker.removeMediaStreamBrokerObserver(this._audioMixController),this.destroyed=!0})}get configuration(){return this._configuration}get realtimeController(){return this._realtimeController}get activeSpeakerDetector(){return this._activeSpeakerDetector||(this._activeSpeakerDetector=new t.default(this._realtimeController,this._configuration.credentials.attendeeId,this.handleHasBandwidthPriority.bind(this))),this._activeSpeakerDetector}get videoTileController(){return this._videoTileController}get audioMixController(){return this._audioMixController}get logger(){return this._logger}get rtcPeerConnection(){return this.meetingSessionContext&&this.meetingSessionContext.peer||null}get mediaStreamBroker(){return this._mediaStreamBroker}get eventController(){return this._eventController}getRTCPeerConnectionStats(_){return this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent||(this.logger.warn("The `getRTCPeerConnectionStats()` is on its way to be deprecated. It makes an additional call to the `getStats` API and therefore may cause slight performance degradation. Please use the new API `clientMetricReport.getRTCStatsReport()` returned by `metricsDidReceive(clientMetricReport)` callback instead."),this.hasGetRTCPeerConnectionStatsDeprecationMessageBeenSent=!0),this.rtcPeerConnection?this.rtcPeerConnection.getStats(_):null}setAudioProfile(_){this._audioProfile=_}addObserver(_){this.logger.info("adding meeting observer"),this.observerQueue.add(_)}removeObserver(_){this.logger.info("removing meeting observer"),this.observerQueue.delete(_)}forEachObserver(_){for(const w of this.observerQueue)p.default.nextTick(()=>{this.observerQueue.has(w)&&_(w)})}initSignalingClient(){this.meetingSessionContext.signalingClient||(this.connectionHealthData.reset(),this.meetingSessionContext=new pe.default,this.meetingSessionContext.logger=this.logger,this.meetingSessionContext.eventController=this.eventController,this.meetingSessionContext.browserBehavior=new o.default,this.meetingSessionContext.videoSendCodecPreferences=this.videoSendCodecPreferences,this.meetingSessionContext.meetingSessionConfiguration=this.configuration,this.meetingSessionContext.signalingClient=new E.default(this._webSocketAdapter,this.logger))}uninstallPreStartObserver(){var _;(_=this.meetingSessionContext.signalingClient)===null||_===void 0||_.removeObserver(this.preStartObserver),this.preStartObserver=void 0}prestart(){return this.logger.info("Pre-connecting signaling connection."),this.createOrReuseSignalingTask().run().then(()=>{const _=()=>r(this,void 0,void 0,function*(){this.logger.info("Early connection closed; discarding signaling task."),this.signalingTask=void 0,this.uninstallPreStartObserver()});this.preStartObserver={handleSignalingClientEvent(w){w.type===T.default.WebSocketClosed&&_()}},this.meetingSessionContext.signalingClient.registerObserver(this.preStartObserver)}).catch(_=>{this.logger.error(`Signaling task pre-start failed: ${_}`),this.signalingTask=void 0})}start(_){this.startReturningPromise(_).then(()=>{this.logger.info("start completed")}).catch(w=>{this.logger.error(`start failed: ${w}`)})}startReturningPromise(_){return(_==null?void 0:_.signalingOnly)===!0?this.prestart():(this.activeSpeakerDetector,new Promise((w,M)=>{this.sessionStateController.perform(S.default.Connect,()=>{this.actionConnect(!1).then(w).catch(M)})}))}connectWithPromises(_){const w=this.meetingSessionContext,M=(ke,Ie)=>new ee.default(this.logger,Ie,ke);this.monitorTask=new B.default(w,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData);const j=this.monitorTask.once(),J=new X.default(w).once();this.receiveIndexTask=new oe.default(w),this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();const K=new q.default(this.logger,"Signaling",[this.createOrReuseSignalingTask(),new O.default(w),new le.default(w),new D.default(w),new re.default(w),this.receiveIndexTask]).once(),Y=new v.default(w).once(K),se=new $.default(w).once(Y,J),Q=new b.default(w).once(se),W=new ce.default(w).once(Q),te=new k.default(w).once(W),we=new me.default(w).once(te);return new q.default(this.logger,this.wrapTaskName("AudioVideoStart"),[j,M(this.configuration.connectionTimeoutMs,new q.default(this.logger,"Peer",[we,_?new ee.default(this.logger,new ie.default(this.logger,"FinalizeConnection",[new ve.default(w),new de.default(w)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new de.default(w)]))])}connectWithTasks(_){return this.receiveIndexTask=new oe.default(this.meetingSessionContext),this.monitorTask=new B.default(this.meetingSessionContext,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData),this.receiveIndexTask.pauseIngestion(),this.monitorTask.pauseResubscribeCheck(),new q.default(this.logger,this.wrapTaskName("AudioVideoStart"),[this.monitorTask,new X.default(this.meetingSessionContext),new ee.default(this.logger,new q.default(this.logger,"Media",[new q.default(this.logger,"Signaling",[new F.default(this.meetingSessionContext),new O.default(this.meetingSessionContext),new le.default(this.meetingSessionContext),new D.default(this.meetingSessionContext),new re.default(this.meetingSessionContext),this.receiveIndexTask]),new q.default(this.logger,"Peer",[new v.default(this.meetingSessionContext),new $.default(this.meetingSessionContext),new b.default(this.meetingSessionContext),new ce.default(this.meetingSessionContext),new k.default(this.meetingSessionContext),new me.default(this.meetingSessionContext),_?new ee.default(this.logger,new ie.default(this.logger,"FinalizeConnection",[new ve.default(this.meetingSessionContext),new de.default(this.meetingSessionContext)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new de.default(this.meetingSessionContext)])]),this.configuration.connectionTimeoutMs)])}actionConnect(_){var w;return r(this,void 0,void 0,function*(){this.initSignalingClient(),this.uninstallPreStartObserver(),this.meetingSessionContext.mediaStreamBroker=this._mediaStreamBroker,this.meetingSessionContext.realtimeController=this._realtimeController,this.meetingSessionContext.audioMixController=this._audioMixController,this.meetingSessionContext.audioVideoController=this,this.enableSimulcast=this.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&new o.default().hasChromiumWebRTC();const M=!!this.configuration.urls.audioHostURL;if(M?this.enableSimulcast?(this.logger.info("Using transceiver controller with simulcast support"),new l.default(this.configuration.credentials.attendeeId).hasModality(l.default.MODALITY_CONTENT)?this.meetingSessionContext.transceiverController=new Ce.default(this.logger,this.meetingSessionContext.browserBehavior):this.meetingSessionContext.transceiverController=new _e.default(this.logger,this.meetingSessionContext.browserBehavior)):(this.logger.info("Using default transceiver controller"),this.meetingSessionContext.transceiverController=new fe.default(this.logger,this.meetingSessionContext.browserBehavior)):(this.logger.info("Using video only transceiver controller"),this.meetingSessionContext.transceiverController=new he.default(this.logger,this.meetingSessionContext.browserBehavior)),this.meetingSessionContext.volumeIndicatorAdapter=new U.default(this.logger,this._realtimeController,H.MIN_VOLUME_DECIBELS,H.MAX_VOLUME_DECIBELS,this.configuration.credentials.attendeeId),this.meetingSessionContext.videoTileController=this._videoTileController,this.meetingSessionContext.videoDownlinkBandwidthPolicy=this.configuration.videoDownlinkBandwidthPolicy,this.meetingSessionContext.videoUplinkBandwidthPolicy=this.configuration.videoUplinkBandwidthPolicy,this.meetingSessionContext.enableSimulcast=this.enableSimulcast,this.enableSimulcast){let K=this.meetingSessionContext.videoUplinkBandwidthPolicy;K||(K=new L.default(this.configuration.credentials.attendeeId,this.meetingSessionContext.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy=K),K.addObserver(this),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new ye.default(this.meetingSessionContext.logger)),this.meetingSessionContext.videoStreamIndex=new ge.default(this.logger)}else this.meetingSessionContext.enableSimulcast=!1,this.meetingSessionContext.videoStreamIndex=new ue.default(this.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy||(this.meetingSessionContext.videoUplinkBandwidthPolicy=new Z.default(this.configuration.credentials.attendeeId,!this.meetingSessionContext.browserBehavior.disableResolutionScaleDown(),this.meetingSessionContext.logger,this.meetingSessionContext.browserBehavior)),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new be.default(this.configuration.credentials.attendeeId)),this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController&&this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController&&(this.useUpdateTransceiverControllerForUplink=!0,this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController(this.meetingSessionContext.transceiverController)),this.meetingSessionContext.audioProfile=this._audioProfile;this.meetingSessionContext.videoUplinkBandwidthPolicy&&this.maxUplinkBandwidthKbps&&this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(this.maxUplinkBandwidthKbps),this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController(this._videoTileController),this.meetingSessionContext.lastKnownVideoAvailability=new c.default,this.meetingSessionContext.videoCaptureAndEncodeParameter=new Te.default(0,0,0,0,!1),this.meetingSessionContext.videosToReceive=new ne.default,this.meetingSessionContext.videosPaused=new ne.default,this.meetingSessionContext.statsCollector=new x.default(this,this.logger),this.meetingSessionContext.connectionMonitor=new s.default(this,this._realtimeController,this.connectionHealthData,new f.default(this.meetingSessionContext.signalingClient,H.PING_PONG_INTERVAL_MS,this.logger),this.meetingSessionContext.statsCollector),this.meetingSessionContext.reconnectController=this._reconnectController,this.meetingSessionContext.videoDeviceInformation={},_||(this.totalRetryCount=0,this._reconnectController.reset(),this.startAudioVideoTimestamp=Date.now(),this.forEachObserver(K=>{ae.Maybe.of(K.audioVideoDidStartConnecting).map(Y=>Y.bind(K)(!1))}),(w=this.eventController)===null||w===void 0||w.publishEvent("meetingStartRequested")),this.meetingSessionContext.startAudioVideoTimestamp=this.startAudioVideoTimestamp,this._reconnectController.hasStartedConnectionAttempt()?this._reconnectController.startedConnectionAttempt(!1):this._reconnectController.startedConnectionAttempt(!0);const j=M&&this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs>0;this.logger.info("Needs to wait for attendee presence? "+j);let J;this.usePromises?J=this.connectWithPromises(j):J=this.connectWithTasks(j);try{yield J.run(),this.connectionHealthData.setConnectionStartTime(),this._mediaStreamBroker.addMediaStreamBrokerObserver(this),this.sessionStateController.perform(S.default.FinishConnecting,()=>{this.eventController&&(this.meetingSessionContext.meetingStartDurationMs=Date.now()-this.startAudioVideoTimestamp,this.eventController.publishEvent("meetingStartSucceeded",{maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,poorConnectionCount:this.meetingSessionContext.poorConnectionCount,retryCount:this.totalRetryCount,signalingOpenDurationMs:this.meetingSessionContext.signalingOpenDurationMs,iceGatheringDurationMs:this.meetingSessionContext.iceGatheringDurationMs,meetingStartDurationMs:this.meetingSessionContext.meetingStartDurationMs})),this.meetingSessionContext.startTimeMs=Date.now(),this.actionFinishConnecting()})}catch(K){this.signalingTask=void 0;const Y=new d.default(this.getMeetingStatusCode(K)||u.default.TaskFailed);if(this.logger.info(`Start failed: ${Y} due to error ${K}.`),this.sessionStateController.state()===g.default.NotConnected){this.logger.info("Start failed and not connected. Not cleaning up.");return}this.sessionStateController.perform(S.default.Fail,()=>r(this,void 0,void 0,function*(){yield this.actionDisconnect(Y,!0,K),this.handleMeetingSessionStatus(Y,K)||this.notifyStop(Y,K)}))}})}createOrReuseSignalingTask(){return this.signalingTask||(this.initSignalingClient(),this.signalingTask=new ee.default(this.logger,new F.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs).once()),this.signalingTask}actionFinishConnecting(){this.signalingTask=void 0,this.meetingSessionContext.videoDuplexMode=P.SdkStreamServiceType.RX,this.meetingSessionContext.enableSimulcast||(this.useUpdateTransceiverControllerForUplink?this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController():this.enforceBandwidthLimitationForSender(this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0])),this.forEachObserver(_=>{ae.Maybe.of(_.audioVideoDidStart).map(w=>w.bind(_)())}),this._reconnectController.reset(),this.receiveIndexTask.resumeIngestion(),this.monitorTask.resumeResubscribeCheck()}stopReturningPromise(){var _;return this.sessionStateController.state()===g.default.NotConnected?((_=this.meetingSessionContext.signalingClient)===null||_===void 0||_.closeConnection(),this.meetingSessionContext.signalingClient=null,this.cleanUpMediaStreamsAfterStop(),Promise.resolve()):new Promise((w,M)=>{this.sessionStateController.perform(S.default.Disconnect,()=>{this._reconnectController.disableReconnect(),this.logger.info("attendee left meeting, session will not be reconnected"),this.actionDisconnect(new d.default(u.default.Left),!1,null).then(w).catch(M)})})}stop(){this.stopReturningPromise()}actionDisconnect(_,w,M){return r(this,void 0,void 0,function*(){try{yield new q.default(this.logger,this.wrapTaskName("AudioVideoStop"),[new ee.default(this.logger,new R.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)]).run()}catch{this.logger.info("fail to stop")}try{const j=[new ee.default(this.logger,new A.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)];this.cleanUpMediaStreamsAfterStop(),yield new q.default(this.logger,this.wrapTaskName("AudioVideoClean"),j).run()}catch{this.logger.info("fail to clean")}this.sessionStateController.perform(S.default.FinishDisconnecting,()=>{w||(this.meetingSessionContext.signalingClient=null,this.notifyStop(_,M))})})}update(_={needsRenegotiation:!0}){let w=_.needsRenegotiation;if(w||(w=this.meetingSessionContext.peer===void 0),w||(w=!this.updateRemoteVideosFromLastVideosToReceive()),w||(w=!this.updateLocalVideoFromPolicy()),this.meetingSessionContext.lastVideosToReceive=this.meetingSessionContext.videosToReceive,!w)return this.logger.info("Update request does not require resubscribe"),this.actionFinishUpdating(),!0;this.logger.info("Update request requires resubscribe");const M=this.sessionStateController.perform(S.default.Update,()=>{this.actionUpdateWithRenegotiation(!0)});return M===y.default.Transitioned||M===y.default.DeferredTransition}updateRemoteVideosFromLastVideosToReceive(){var _,w;const M=this.meetingSessionContext;if(((_=M.videosToReceive)===null||_===void 0?void 0:_.empty())||((w=M.lastVideosToReceive)===null||w===void 0?void 0:w.empty())||!M.transceiverController||!M.transceiverController.getMidForStreamId||!M.transceiverController.setStreamIdForMid||!M.videosToReceive.forEach||!M.signalingClient.remoteVideoUpdate||!M.videoStreamIndex.overrideStreamIdMappings)return!1;let j=[];const J=new Map;let K=[];if(M.lastVideosToReceive===null)j=M.videosToReceive.array();else{const se=M.videoStreamIndex;M.videosToReceive.forEach(Q=>{if(M.lastVideosToReceive.contain(Q))return;let W=!1;M.lastVideosToReceive.forEach(te=>{W||se.StreamIdsInSameGroup(te,Q)&&(J.set(te,Q),W=!0)}),W||j.push(Q)}),K=M.lastVideosToReceive.array().filter(Q=>{const W=M.videosToReceive.contain(Q),te=J.has(Q);return!W&&!te})}this.logger.info(`Request to update remote videos with added: ${j}, updated: ${[...J.entries()]}, removed: ${K}`);const Y=[];for(const[se,Q]of J.entries()){const W=new C.default;if(W.streamId=Q,W.attendeeId=M.videoStreamIndex.attendeeIdForStreamId(Q),W.mid=M.transceiverController.getMidForStreamId(se),W.mid===void 0)return this.logger.info(`No MID found for stream ID ${se}, cannot update stream without renegotiation`),!1;if(Y.push(W),M.transceiverController.setStreamIdForMid(W.mid,Q),M.videoStreamIndex.overrideStreamIdMappings(se,Q),M.videoTileController.haveVideoTileForAttendeeId(W.attendeeId)){const te=M.videoTileController.getVideoTileForAttendeeId(W.attendeeId);if(!te.setStreamId)return!1;te.setStreamId(Q)}}return Y.length!==0&&M.signalingClient.remoteVideoUpdate(Y,[]),!(j.length!==0||K.length!==0)}updateLocalVideoFromPolicy(){if(this.meetingSessionContext.enableSimulcast){const _=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseEncodingParameters();if(this.mayNeedRenegotiationForSimulcastLayerChange&&!this.negotiatedBitrateLayersAllocationRtpHeaderExtension())return this.logger.info("Needs regenotiation for local video simulcast layer change"),this.mayNeedRenegotiationForSimulcastLayerChange=!1,!1;this.meetingSessionContext.transceiverController.setEncodingParameters(_)}else this.meetingSessionContext.videoCaptureAndEncodeParameter=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters();return this.logger.info("Updated local video from policy without renegotiation"),!0}negotiatedBitrateLayersAllocationRtpHeaderExtension(){if(!this.meetingSessionContext.transceiverController.localVideoTransceiver())return!1;const _=this.meetingSessionContext.transceiverController.localVideoTransceiver().sender.getParameters();return!_||!_.headerExtensions?!1:_.headerExtensions.some(w=>w.uri==="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00")}restartLocalVideo(_){const w=()=>r(this,void 0,void 0,function*(){this._videoTileController.hasStartedLocalVideoTile()&&(this.logger.info("stopping local video tile prior to local video restart"),this._videoTileController.stopLocalVideoTile(),this.logger.info("preparing local video restart update"),yield this.actionUpdateWithRenegotiation(!1),this.logger.info("starting local video tile for local video restart"),this._videoTileController.startLocalVideoTile()),this.logger.info("finalizing local video restart update"),yield this.actionUpdateWithRenegotiation(!0),_()}),M=this.sessionStateController.perform(S.default.Update,()=>{w()});return M===y.default.Transitioned||M===y.default.DeferredTransition}replaceLocalVideo(_){return r(this,void 0,void 0,function*(){if(!_||_.getVideoTracks().length<1)throw new Error("could not acquire video track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");const w=this.meetingSessionContext.videoTileController.getLocalVideoTile();if(w){const M=w.state(),j=_.getVideoTracks()[0].getSettings();w.bindVideoStream(M.boundAttendeeId,!0,_,j.width,j.height,M.streamId,M.boundExternalUserId)}yield this.meetingSessionContext.transceiverController.setVideoInput(_.getVideoTracks()[0]),this.meetingSessionContext.activeVideoInput=_,this.logger.info("Local video input is updated")})}replaceLocalAudio(_){return r(this,void 0,void 0,function*(){if(!_||_.getAudioTracks().length<1)throw new Error("could not acquire audio track");if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");if(this.connectionHealthData.reset(),this.connectionHealthData.setConnectionStartTime(),!(yield this.meetingSessionContext.transceiverController.replaceAudioTrack(_.getAudioTracks()[0])))throw new Error("Failed to replace audio track");this.meetingSessionContext.activeAudioInput=_,this.logger.info("Local audio input is updated")})}actionUpdateWithRenegotiation(_){return r(this,void 0,void 0,function*(){this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();try{yield new q.default(this.logger,this.wrapTaskName("AudioVideoUpdate"),[new z.default(this.meetingSessionContext),new ee.default(this.logger,new q.default(this.logger,"UpdateSession",[new $.default(this.meetingSessionContext),new b.default(this.meetingSessionContext),new ce.default(this.meetingSessionContext),new k.default(this.meetingSessionContext),new me.default(this.meetingSessionContext),new de.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),_&&this.sessionStateController.perform(S.default.FinishUpdating,()=>{this.actionFinishUpdating()})}catch(w){this.sessionStateController.perform(S.default.FinishUpdating,()=>{const M=new d.default(this.getMeetingStatusCode(w)||u.default.TaskFailed);M.statusCode()!==u.default.IncompatibleSDP&&this.logger.info("failed to update audio-video session"),this.handleMeetingSessionStatus(M,w)})}})}notifyStop(_,w){var M;if(this.forEachObserver(j=>{ae.Maybe.of(j.audioVideoDidStop).map(J=>J.bind(j)(_))}),this.promotedToPrimaryMeeting&&w&&this.forEachObserver(j=>{this.promotedToPrimaryMeeting=!1,ae.Maybe.of(j.audioVideoWasDemotedFromPrimaryMeeting).map(J=>J.bind(j)(new d.default(u.default.SignalingInternalServerError)))}),this.eventController){const{signalingOpenDurationMs:j,poorConnectionCount:J,startTimeMs:K,iceGatheringDurationMs:Y,attendeePresenceDurationMs:se,meetingStartDurationMs:Q}=this.meetingSessionContext,W={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:K===null?0:Math.round(Date.now()-K),meetingStatus:u.default[_.statusCode()],signalingOpenDurationMs:j,iceGatheringDurationMs:Y,attendeePresenceDurationMs:se,poorConnectionCount:J,meetingStartDurationMs:Q,retryCount:this.totalRetryCount},te=w&&w.message||((M=_.toString)===null||M===void 0?void 0:M.call(_))||"";W.meetingDurationMs===0?(W.meetingErrorMessage=te,delete W.meetingDurationMs,delete W.attendeePresenceDurationMs,delete W.meetingStartDurationMs,this.eventController.publishEvent("meetingStartFailed",W)):_.isFailure()||_.isAudioConnectionFailure()?(W.meetingErrorMessage=te,this.eventController.publishEvent("meetingFailed",W)):this.eventController.publishEvent("meetingEnded",W)}}actionFinishUpdating(){if(!this.meetingSessionContext.enableSimulcast)if(this.useUpdateTransceiverControllerForUplink)this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();else{const _=this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0];this.enforceBandwidthLimitationForSender(_)}this.monitorTask.resumeResubscribeCheck(),this.receiveIndexTask.resumeIngestion(),this.logger.info("updated audio-video session")}reconnect(_,w){const M=this._reconnectController.retryWithBackoff(()=>r(this,void 0,void 0,function*(){this.sessionStateController.state()===g.default.NotConnected?this.sessionStateController.perform(S.default.Connect,()=>{this.actionConnect(!0)}):this.sessionStateController.perform(S.default.Reconnect,()=>{this.actionReconnect(_)}),this.totalRetryCount+=1}),()=>{this.logger.info("canceled retry")});return M||this.sessionStateController.perform(S.default.Fail,()=>{this.actionDisconnect(_,!1,w)}),M}actionReconnect(_){return r(this,void 0,void 0,function*(){this._reconnectController.hasStartedConnectionAttempt()||(this._reconnectController.startedConnectionAttempt(!1),this.forEachObserver(w=>{ae.Maybe.of(w.audioVideoDidStartConnecting).map(M=>M.bind(w)(!0))})),this.meetingSessionContext.volumeIndicatorAdapter.onReconnect(),this.connectionHealthData.reset();try{yield new q.default(this.logger,this.wrapTaskName("AudioVideoReconnect"),[new ee.default(this.logger,new q.default(this.logger,"Media",[new I.default(this.meetingSessionContext),new q.default(this.logger,"Signaling",[new F.default(this.meetingSessionContext),new D.default(this.meetingSessionContext),new re.default(this.meetingSessionContext)]),new v.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs),new z.default(this.meetingSessionContext),new ee.default(this.logger,new q.default(this.logger,"UpdateSession",[new $.default(this.meetingSessionContext),new b.default(this.meetingSessionContext),new ce.default(this.meetingSessionContext),new k.default(this.meetingSessionContext),new me.default(this.meetingSessionContext),new de.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),this.sessionStateController.perform(S.default.FinishConnecting,()=>{if(this.eventController){const{signalingOpenDurationMs:w,poorConnectionCount:M,startTimeMs:j,iceGatheringDurationMs:J,attendeePresenceDurationMs:K,meetingStartDurationMs:Y}=this.meetingSessionContext,se={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:Math.round(Date.now()-j),meetingStatus:u.default[_.statusCode()],signalingOpenDurationMs:w,iceGatheringDurationMs:J,attendeePresenceDurationMs:K,poorConnectionCount:M,meetingStartDurationMs:Y,retryCount:this.totalRetryCount};this.eventController.publishEvent("meetingReconnected",se)}this.actionFinishConnecting()})}catch(w){this.sessionStateController.perform(S.default.FinishConnecting,()=>{this.logger.info("failed to reconnect audio-video session");const M=new d.default(this.getMeetingStatusCode(w)||u.default.TaskFailed);this.handleMeetingSessionStatus(M,w)})}this.connectionHealthData.setConnectionStartTime()})}wrapTaskName(_){return`${_}/${this.configuration.meetingId}/${this.configuration.credentials.attendeeId}`}cleanUpMediaStreamsAfterStop(){this._mediaStreamBroker.removeMediaStreamBrokerObserver(this),this.meetingSessionContext.activeAudioInput=void 0,this.meetingSessionContext.activeVideoInput=void 0}getMeetingStatusCode(_){const w=/the meeting status code: (\d+)/.exec(_&&_.message);return w&&w.length>1?Number.parseInt(w[1],10):null}enforceBandwidthLimitationForSender(_){return r(this,void 0,void 0,function*(){yield this.meetingSessionContext.transceiverController.setVideoSendingBitrateKbps(_)})}handleMeetingSessionStatus(_,w){if(this.logger.info(`handling status: ${u.default[_.statusCode()]}`),_.isTerminal()||this.meetingSessionContext.statsCollector&&this.meetingSessionContext.statsCollector.logMeetingSessionStatus(_),_.statusCode()===u.default.IncompatibleSDP)return this.restartLocalVideo(()=>{this.logger.info("handled incompatible SDP by attempting to restart video")}),!0;if(_.statusCode()===u.default.VideoCallSwitchToViewOnly)return this._videoTileController.removeLocalVideoTile(),this.forEachObserver(M=>{ae.Maybe.of(M.videoSendDidBecomeUnavailable).map(j=>j.bind(M)())}),!1;if(_.statusCode()===u.default.AudioVideoWasRemovedFromPrimaryMeeting)return this.forEachObserver(M=>{ae.Maybe.of(M.audioVideoWasDemotedFromPrimaryMeeting).map(j=>j.bind(M)(_))}),!1;if(_.isTerminal()&&(this.logger.error("session will not be reconnected"),this.meetingSessionContext.reconnectController&&this.meetingSessionContext.reconnectController.disableReconnect()),(_.isFailure()||_.isTerminal())&&this.meetingSessionContext.reconnectController){const M=this.reconnect(_,w);return M?this.logger.warn(`will retry due to status code ${u.default[_.statusCode()]}${w?` and error: ${w.message}`:""}`):this.logger.error(`failed with status code ${u.default[_.statusCode()]}${w?` and error: ${w.message}`:""}`),M}return!1}setVideoMaxBandwidthKbps(_){if(_<=0)throw new Error("Max bandwidth kbps has to be greater than 0");this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&(this.logger.info(`video send has ideal max bandwidth ${_} kbps`),this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(_)),this.maxUplinkBandwidthKbps=_}handleHasBandwidthPriority(_){return r(this,void 0,void 0,function*(){if(this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&!this.meetingSessionContext.enableSimulcast){if(this.useUpdateTransceiverControllerForUplink){this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(_),yield this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();return}const w=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(_);const M=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();w!==M&&(this.logger.info(`video send bandwidth priority ${_} max has changed from ${w} kbps to ${M} kbps`),yield this.enforceBandwidthLimitationForSender(M))}})}pauseReceivingStream(_){!!this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.pause([_])}resumeReceivingStream(_){!!this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.resume([_])}setVideoCodecSendPreferences(_){this.videoSendCodecPreferences=_,this.meetingSessionContext.videoSendCodecPreferences=_,this.update({needsRenegotiation:!0})}getRemoteVideoSources(){const{videoStreamIndex:_}=this.meetingSessionContext;if(!_)return this.logger.info("meeting has not started"),[];const w=this.configuration.credentials.attendeeId;return _.allVideoSendingSourcesExcludingSelf(w)}encodingSimulcastLayersDidChange(_){this.mayNeedRenegotiationForSimulcastLayerChange=!0,this.forEachObserver(w=>{ae.Maybe.of(w.encodingSimulcastLayersDidChange).map(M=>M.bind(w)(_))})}promoteToPrimaryMeeting(_){return this.actionPromoteToPrimaryMeeting(_)}actionPromoteToPrimaryMeeting(_){return r(this,void 0,void 0,function*(){let w=new d.default(u.default.SignalingRequestFailed);return yield new q.default(this.logger,this.wrapTaskName("PromoteToPrimaryMeeting"),[new ee.default(this.logger,new V.default(this.meetingSessionContext,_,M=>{w=M}),this.configuration.connectionTimeoutMs)]).run(),this.promotedToPrimaryMeeting=w.statusCode()===u.default.OK,w})}demoteFromPrimaryMeeting(){this.meetingSessionContext.signalingClient.demoteFromPrimaryMeeting(),this.forEachObserver(_=>{ae.Maybe.of(_.audioVideoWasDemotedFromPrimaryMeeting).map(w=>w.bind(_)(new d.default(u.default.OK)))})}videoInputDidChange(_){return r(this,void 0,void 0,function*(){if(this.logger.info("Receive a video input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating video input because there is no active meeting and peer connection");return}this._videoTileController.hasStartedLocalVideoTile()&&(_?yield this.replaceLocalVideo(_):this._videoTileController.stopLocalVideoTile())})}audioInputDidChange(_){return r(this,void 0,void 0,function*(){if(this.logger.info("Receive an audio input change event"),!this.meetingSessionContext||!this.meetingSessionContext.peer){this.logger.info("Skip updating audio input because there is no active meeting and peer connection");return}if(!_)try{_=yield this.mediaStreamBroker.acquireAudioInputStream()}catch{this.logger.error("Could not acquire audio track from mediaStreamBroker");return}yield this.replaceLocalAudio(_)})}}return DefaultAudioVideoController.default=H,H.MIN_VOLUME_DECIBELS=-42,H.MAX_VOLUME_DECIBELS=-14,H.PING_PONG_INTERVAL_MS=1e4,DefaultAudioVideoController}var DefaultAudioVideoFacade$1={},__awaiter$j=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultAudioVideoFacade$1,"__esModule",{value:!0});const VideoTransformDevice_1=VideoTransformDevice;class DefaultAudioVideoFacade{constructor(t,e,n,o,a,s){this.audioVideoController=t,this.videoTileController=e,this.realtimeController=n,this.audioMixController=o,this.deviceController=a,this.contentShareController=s}addObserver(t){this.audioVideoController.addObserver(t),this.trace("addObserver")}removeObserver(t){this.audioVideoController.removeObserver(t),this.trace("removeObserver")}setAudioProfile(t){this.trace("setAudioProfile",t),this.audioVideoController.setAudioProfile(t)}start(t){this.audioVideoController.start(t),this.trace("start")}stop(){this.audioVideoController.stop(),this.trace("stop")}getRTCPeerConnectionStats(t){return this.trace("getRTCPeerConnectionStats",t?t.id:null),this.audioVideoController.getRTCPeerConnectionStats(t)}bindAudioElement(t){const e=this.audioMixController.bindAudioElement(t);return this.trace("bindAudioElement",t.id,e),e}unbindAudioElement(){this.audioMixController.unbindAudioElement(),this.trace("unbindAudioElement")}getCurrentMeetingAudioStream(){return this.trace("getCurrentConferenceStream"),this.audioMixController.getCurrentMeetingAudioStream()}addAudioMixObserver(t){this.trace("addAudioMixObserver"),this.audioMixController.addAudioMixObserver(t)}removeAudioMixObserver(t){this.trace("removeAudioMixObserver"),this.audioMixController.removeAudioMixObserver(t)}bindVideoElement(t,e){this.videoTileController.bindVideoElement(t,e),this.trace("bindVideoElement",{tileId:t,videoElementId:e.id})}unbindVideoElement(t,e=!0){this.videoTileController.unbindVideoElement(t,e),this.trace("unbindVideoElement",{tileId:t,cleanUpVideoElement:e})}startLocalVideoTile(){const t=this.videoTileController.startLocalVideoTile();return this.trace("startLocalVideoTile",null,t),t}stopLocalVideoTile(){this.videoTileController.stopLocalVideoTile(),this.trace("stopLocalVideoTile")}hasStartedLocalVideoTile(){const t=this.videoTileController.hasStartedLocalVideoTile();return this.trace("hasStartedLocalVideoTile",null,t),t}removeLocalVideoTile(){this.videoTileController.removeLocalVideoTile(),this.trace("removeLocalVideoTile")}getLocalVideoTile(){const t=this.videoTileController.getLocalVideoTile();return this.trace("getLocalVideoTile"),t}pauseVideoTile(t){this.videoTileController.pauseVideoTile(t),this.trace("pauseVideoTile",t)}unpauseVideoTile(t){this.videoTileController.unpauseVideoTile(t),this.trace("unpauseVideoTile",t)}getVideoTile(t){const e=this.videoTileController.getVideoTile(t);return this.trace("getVideoTile",t),e}getAllRemoteVideoTiles(){const t=this.videoTileController.getAllRemoteVideoTiles();return this.trace("getAllRemoteVideoTiles"),t}getAllVideoTiles(){const t=this.videoTileController.getAllVideoTiles();return this.trace("getAllVideoTiles"),t}addVideoTile(){const t=this.videoTileController.addVideoTile();return this.trace("addVideoTile",null,t.state()),t}removeVideoTile(t){this.videoTileController.removeVideoTile(t),this.trace("removeVideoTile",t)}removeVideoTilesByAttendeeId(t){const e=this.videoTileController.removeVideoTilesByAttendeeId(t);return this.trace("removeVideoTilesByAttendeeId",t,e),e}removeAllVideoTiles(){this.videoTileController.removeAllVideoTiles(),this.trace("removeAllVideoTiles")}captureVideoTile(t){const e=this.videoTileController.captureVideoTile(t);return this.trace("captureVideoTile",t),e}realtimeSubscribeToAttendeeIdPresence(t){this.realtimeController.realtimeSubscribeToAttendeeIdPresence(t),this.trace("realtimeSubscribeToAttendeeIdPresence")}realtimeUnsubscribeToAttendeeIdPresence(t){this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t),this.trace("realtimeUnsubscribeToAttendeeIdPresence")}realtimeSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeSetCanUnmuteLocalAudio(t),this.trace("realtimeSetCanUnmuteLocalAudio",t)}realtimeSubscribeToSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeSubscribeToSetCanUnmuteLocalAudio(t),this.trace("realtimeSubscribeToSetCanUnmuteLocalAudio")}realtimeUnsubscribeToSetCanUnmuteLocalAudio(t){this.realtimeController.realtimeUnsubscribeToSetCanUnmuteLocalAudio(t),this.trace("realtimeUnsubscribeToSetCanUnmuteLocalAudio")}realtimeCanUnmuteLocalAudio(){const t=this.realtimeController.realtimeCanUnmuteLocalAudio();return this.trace("realtimeCanUnmuteLocalAudio",null,t),t}realtimeMuteLocalAudio(){this.realtimeController.realtimeMuteLocalAudio(),this.trace("realtimeMuteLocalAudio")}realtimeUnmuteLocalAudio(){const t=this.realtimeController.realtimeUnmuteLocalAudio();return this.trace("realtimeUnmuteLocalAudio"),t}realtimeSubscribeToMuteAndUnmuteLocalAudio(t){this.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(t),this.trace("realtimeSubscribeToMuteAndUnmuteLocalAudio")}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t){this.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(t),this.trace("realtimeUnsubscribeToMuteAndUnmuteLocalAudio")}realtimeIsLocalAudioMuted(){const t=this.realtimeController.realtimeIsLocalAudioMuted();return this.trace("realtimeIsLocalAudioMuted"),t}realtimeSubscribeToVolumeIndicator(t,e){this.realtimeController.realtimeSubscribeToVolumeIndicator(t,e),this.trace("realtimeSubscribeToVolumeIndicator",t)}realtimeUnsubscribeFromVolumeIndicator(t,e){this.realtimeController.realtimeUnsubscribeFromVolumeIndicator(t,e),this.trace("realtimeUnsubscribeFromVolumeIndicator",t,e)}realtimeSubscribeToLocalSignalStrengthChange(t){this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(t),this.trace("realtimeSubscribeToLocalSignalStrengthChange")}realtimeUnsubscribeToLocalSignalStrengthChange(t){this.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(t),this.trace("realtimeUnsubscribeToLocalSignalStrengthChange")}realtimeSendDataMessage(t,e,n){this.realtimeController.realtimeSendDataMessage(t,e,n),this.trace("realtimeSendDataMessage")}realtimeSubscribeToReceiveDataMessage(t,e){this.realtimeController.realtimeSubscribeToReceiveDataMessage(t,e),this.trace("realtimeSubscribeToReceiveDataMessage")}realtimeUnsubscribeFromReceiveDataMessage(t){this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(t),this.trace("realtimeUnsubscribeFromReceiveDataMessage")}realtimeSubscribeToFatalError(t){this.realtimeController.realtimeSubscribeToFatalError(t),this.trace("realtimeSubscribeToFatalError")}realtimeUnsubscribeToFatalError(t){this.realtimeController.realtimeUnsubscribeToFatalError(t),this.trace("realtimeUnsubscribeToFatalError")}subscribeToActiveSpeakerDetector(t,e,n,o){this.audioVideoController.activeSpeakerDetector.subscribe(t,e,n,o),this.trace("subscribeToActiveSpeakerDetector")}unsubscribeFromActiveSpeakerDetector(t){this.audioVideoController.activeSpeakerDetector.unsubscribe(t),this.trace("unsubscribeFromActiveSpeakerDetector")}listAudioInputDevices(t=!1){return __awaiter$j(this,void 0,void 0,function*(){const e=yield this.deviceController.listAudioInputDevices(t);return this.trace("listAudioInputDevices",t,e),e})}listVideoInputDevices(t=!1){return __awaiter$j(this,void 0,void 0,function*(){const e=yield this.deviceController.listVideoInputDevices(t);return this.trace("listVideoInputDevices",t,e),e})}listAudioOutputDevices(t=!1){return __awaiter$j(this,void 0,void 0,function*(){const e=yield this.deviceController.listAudioOutputDevices(t);return this.trace("listAudioOutputDevices",t,e),e})}startAudioInput(t){return __awaiter$j(this,void 0,void 0,function*(){return this.trace("startAudioInput",t),this.deviceController.startAudioInput(t)})}stopAudioInput(){return __awaiter$j(this,void 0,void 0,function*(){return this.trace("stopAudioInput"),this.deviceController.stopAudioInput()})}startVideoInput(t){return __awaiter$j(this,void 0,void 0,function*(){return VideoTransformDevice_1.isVideoTransformDevice(t)?this.trace("startVideoInput with transform device"):this.trace("startVideoInput",t),this.deviceController.startVideoInput(t)})}stopVideoInput(){return __awaiter$j(this,void 0,void 0,function*(){return this.trace("stopVideoInput"),this.deviceController.stopVideoInput()})}chooseAudioOutput(t){const e=this.deviceController.chooseAudioOutput(t);return this.trace("chooseAudioOutput",t),e}addDeviceChangeObserver(t){this.deviceController.addDeviceChangeObserver(t),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(t){this.deviceController.removeDeviceChangeObserver(t),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){const t=this.deviceController.createAnalyserNodeForAudioInput();return this.trace("createAnalyserNodeForAudioInput"),t}startVideoPreviewForVideoInput(t){this.deviceController.startVideoPreviewForVideoInput(t),this.trace("startVideoPreviewForVideoInput",t.id)}stopVideoPreviewForVideoInput(t){this.deviceController.stopVideoPreviewForVideoInput(t),this.trace("stopVideoPreviewForVideoInput",t.id)}setDeviceLabelTrigger(t){this.deviceController.setDeviceLabelTrigger(t),this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(t){const e=this.deviceController.mixIntoAudioInput(t);return this.trace("mixIntoAudioInput",t.id),e}chooseVideoInputQuality(t,e,n){this.deviceController.chooseVideoInputQuality(t,e,n),this.trace("chooseVideoInputQuality",{width:t,height:e,frameRate:n})}setVideoMaxBandwidthKbps(t){this.audioVideoController.setVideoMaxBandwidthKbps(t),this.trace("setVideoMaxBandwidthKbps",t)}setVideoCodecSendPreferences(t){this.audioVideoController.setVideoCodecSendPreferences(t),this.trace("setVideoCodecSendPreferences",t)}getVideoInputQualitySettings(){const t=this.deviceController.getVideoInputQualitySettings();return this.trace("getVideoInputQualitySettings"),t}setContentAudioProfile(t){this.trace("setContentAudioProfile",t),this.contentShareController.setContentAudioProfile(t)}enableSimulcastForContentShare(t,e){this.trace("enableSimulcastForContentShare"),this.contentShareController.enableSimulcastForContentShare(t,e)}startContentShare(t){const e=this.contentShareController.startContentShare(t);return this.trace("startContentShare"),e}startContentShareFromScreenCapture(t,e){const n=this.contentShareController.startContentShareFromScreenCapture(t,e);return this.trace("startContentShareFromScreenCapture"),n}pauseContentShare(){this.contentShareController.pauseContentShare(),this.trace("pauseContentShare")}unpauseContentShare(){this.contentShareController.unpauseContentShare(),this.trace("unpauseContentShare")}stopContentShare(){this.contentShareController.stopContentShare(),this.trace("stopContentShare")}addContentShareObserver(t){this.contentShareController.addContentShareObserver(t),this.trace("addContentShareObserver")}removeContentShareObserver(t){this.contentShareController.removeContentShareObserver(t),this.trace("removeContentShareObserver")}setContentShareVideoCodecPreferences(t){this.contentShareController.setContentShareVideoCodecPreferences(t),this.trace("setContentShareVideoCodecPreferences")}trace(t,e,n){const o=this.audioVideoController.configuration.meetingId,a=this.audioVideoController.configuration.credentials.attendeeId;let s=`API/DefaultAudioVideoFacade/${o}/${a}/${t}`;typeof e<"u"&&(s+=` ${JSON.stringify(e)}`),typeof n<"u"&&(s+=` -> ${JSON.stringify(n)}`),this.audioVideoController.logger.info(s)}getRemoteVideoSources(){const t=this.audioVideoController.getRemoteVideoSources();return this.trace("getRemoteVideoSources",null,t),t}get transcriptionController(){return this.realtimeController.transcriptionController}promoteToPrimaryMeeting(t){this.audioVideoController.removeObserver(this),this.audioVideoController.addObserver(this);const e=this.audioVideoController.promoteToPrimaryMeeting(t);return this.trace("promoteToPrimaryMeeting",null,e),e}demoteFromPrimaryMeeting(){this.trace("demoteFromPrimaryMeeting"),this.audioVideoController.demoteFromPrimaryMeeting()}audioVideoWasDemotedFromPrimaryMeeting(t){this.contentShareController.stopContentShare(),this.audioVideoController.removeObserver(this)}}DefaultAudioVideoFacade$1.default=DefaultAudioVideoFacade;var DefaultContentShareController$1={},MeetingSessionConfiguration$1={},Utils={};Object.defineProperty(Utils,"__esModule",{value:!0});Utils.toLowerCasePropertyNames=Utils.isIFramed=Utils.wait=void 0;function wait(r){return new Promise(t=>setTimeout(t,r))}Utils.wait=wait;function isIFramed(){var r;try{return((r=window.frameElement)===null||r===void 0?void 0:r.nodeName)==="IFRAME"||parent!==top}catch{return!0}}Utils.isIFramed=isIFramed;function toLowerCasePropertyNames(r){return r===null?null:typeof r!="object"?r:Array.isArray(r)?r.map(toLowerCasePropertyNames):Object.keys(r).reduce((t,e)=>{const n=r[e],o=typeof n=="object"?toLowerCasePropertyNames(n):n;return t[e.toLowerCase()]=o,t},{})}Utils.toLowerCasePropertyNames=toLowerCasePropertyNames;var MeetingSessionCredentials$1={};Object.defineProperty(MeetingSessionCredentials$1,"__esModule",{value:!0});class MeetingSessionCredentials{constructor(){this.attendeeId=null,this.externalUserId=null,this.joinToken=null}toJSON(){return{attendeeId:this.attendeeId,joinToken:this.joinToken===null?null:"<redacted>"}}}MeetingSessionCredentials$1.default=MeetingSessionCredentials;var MeetingSessionURLs$1={};Object.defineProperty(MeetingSessionURLs$1,"__esModule",{value:!0});class MeetingSessionURLs{constructor(){this._audioHostURL=null,this._signalingURL=null,this._turnControlURL=null,this._eventIngestionURL=null,this.urlRewriter=t=>t}get audioHostURL(){return this.urlRewriter(this._audioHostURL)}set audioHostURL(t){this._audioHostURL=t}get signalingURL(){return this.urlRewriter(this._signalingURL)}set signalingURL(t){this._signalingURL=t}get turnControlURL(){return this.urlRewriter(this._turnControlURL)}set turnControlURL(t){this._turnControlURL=t}get eventIngestionURL(){return this.urlRewriter(this._eventIngestionURL)}set eventIngestionURL(t){this._eventIngestionURL=t}}MeetingSessionURLs$1.default=MeetingSessionURLs;Object.defineProperty(MeetingSessionConfiguration$1,"__esModule",{value:!0});const ConnectionHealthPolicyConfiguration_1=ConnectionHealthPolicyConfiguration$1,Utils_1$2=Utils,MeetingSessionCredentials_1$1=MeetingSessionCredentials$1,MeetingSessionURLs_1=MeetingSessionURLs$1;class MeetingSessionConfiguration{constructor(t,e){this.meetingId=null,this.externalMeetingId=null,this.credentials=null,this.urls=null,this.connectionTimeoutMs=15e3,this.attendeePresenceTimeoutMs=0,this.connectionHealthPolicyConfiguration=new ConnectionHealthPolicyConfiguration_1.default,this.reconnectTimeoutMs=120*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackOffMs=1*1e3,this.reconnectLongBackOffMs=5*1e3,this.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.keepLastFrameWhenPaused=!1,t&&(t=Utils_1$2.toLowerCasePropertyNames(t),t.meeting&&(t=t.meeting),this.meetingId=t.meetingid,this.externalMeetingId=t.externalmeetingid,this.urls=new MeetingSessionURLs_1.default,this.urls.audioHostURL=t.mediaplacement.audiohosturl,this.urls.signalingURL=t.mediaplacement.signalingurl,this.urls.turnControlURL=t.mediaplacement.turncontrolurl,t.mediaplacement.eventingestionurl&&(this.urls.eventIngestionURL=t.mediaplacement.eventingestionurl)),e&&(e=Utils_1$2.toLowerCasePropertyNames(e),e.attendee&&(e=e.attendee),this.credentials=new MeetingSessionCredentials_1$1.default,this.credentials.attendeeId=e.attendeeid,this.credentials.externalUserId=e.externaluserid,this.credentials.joinToken=e.jointoken)}}MeetingSessionConfiguration$1.default=MeetingSessionConfiguration;var DefaultSimulcastUplinkPolicyForContentShare$1={};Object.defineProperty(DefaultSimulcastUplinkPolicyForContentShare$1,"__esModule",{value:!0});const SimulcastContentShareTransceiverController_1=SimulcastContentShareTransceiverController$1;class DefaultSimulcastUplinkPolicyForContentShare{constructor(t,e){this.logger=t,this.encodingParams=e,this.videoIndex=null,this.currLocalDescriptions=[],this.nextLocalDescriptions=[]}updateConnectionMetric(t){}chooseMediaTrackConstraints(){}chooseEncodingParameters(){var t,e,n,o,a,s,d,u,c,l,f,h;const p=new Map,m=1e3,S=SimulcastContentShareTransceiverController_1.default.NAME_ARR_ASCENDING;return p.set(S[0],{rid:S[0],active:!0,scaleResolutionDownBy:((e=(t=this.encodingParams)===null||t===void 0?void 0:t.low)===null||e===void 0?void 0:e.scaleResolutionDownBy)||2,maxBitrate:(((o=(n=this.encodingParams)===null||n===void 0?void 0:n.low)===null||o===void 0?void 0:o.maxBitrateKbps)||300)*m,maxFramerate:((s=(a=this.encodingParams)===null||a===void 0?void 0:a.low)===null||s===void 0?void 0:s.maxFramerate)||5}),p.set(S[1],{rid:S[1],active:!0,scaleResolutionDownBy:((u=(d=this.encodingParams)===null||d===void 0?void 0:d.high)===null||u===void 0?void 0:u.scaleResolutionDownBy)||1,maxBitrate:(((l=(c=this.encodingParams)===null||c===void 0?void 0:c.high)===null||l===void 0?void 0:l.maxBitrateKbps)||1200)*m,maxFramerate:(h=(f=this.encodingParams)===null||f===void 0?void 0:f.high)===null||h===void 0?void 0:h.maxFramerate}),this.getQualityMapString(p),p}updateIndex(t){this.videoIndex=t}wantsResubscribe(){var t,e;let n=!1;this.nextLocalDescriptions=(t=this.videoIndex)===null||t===void 0?void 0:t.localStreamDescriptions();for(let o=0;o<((e=this.nextLocalDescriptions)===null||e===void 0?void 0:e.length);o++){const a=this.nextLocalDescriptions[o].streamId;if(a!==0&&!!a){const s=this.currLocalDescriptions.findIndex(d=>d.streamId===a);s!==-1&&this.nextLocalDescriptions[o].disabledByWebRTC!==this.currLocalDescriptions[s].disabledByWebRTC&&(n=!0)}}return this.currLocalDescriptions=this.nextLocalDescriptions,n}chooseCaptureAndEncodeParameters(){}maxBandwidthKbps(){return 1200}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}getQualityMapString(t){var e;let n="";const o=(e=this.videoIndex)===null||e===void 0?void 0:e.localStreamDescriptions();(o==null?void 0:o.length)>0&&(t.forEach(a=>{let s=!1;a.rid==="low"?s=o[0].disabledByWebRTC:s=o[1].disabledByWebRTC,n+=`{ rid: ${a.rid} active:${a.active} disabledByWebRTC: ${s} maxBitrate:${a.maxBitrate} scaleResolutionDownBy:${a.scaleResolutionDownBy} maxFrameRate:${a.maxFramerate}`}),this.logger.info(`simulcast: content policy:chooseEncodingParameters newQualityMap: ${n}`))}addObserver(t){}removeObserver(t){}forEachObserver(t){}}DefaultSimulcastUplinkPolicyForContentShare$1.default=DefaultSimulcastUplinkPolicyForContentShare;var __awaiter$i=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultContentShareController$1,"__esModule",{value:!0});const MeetingSessionConfiguration_1=MeetingSessionConfiguration$1,MeetingSessionCredentials_1=MeetingSessionCredentials$1,DefaultModality_1=DefaultModality$1,AsyncScheduler_1$2=AsyncScheduler$1,Types_1=Types,DefaultSimulcastUplinkPolicyForContentShare_1=DefaultSimulcastUplinkPolicyForContentShare$1,ContentShareConstants_1=ContentShareConstants$1;class DefaultContentShareController{constructor(t,e,n){this.mediaStreamBroker=t,this.contentAudioVideo=e,this.attendeeAudioVideo=n,this.observerQueue=new Set,this.destroyed=!1,this.contentAudioVideo.addObserver(this),this.setupContentShareEvents()}static createContentShareMeetingSessionConfigure(t){const e=new MeetingSessionConfiguration_1.default;return e.meetingId=t.meetingId,e.externalMeetingId=t.externalMeetingId,e.urls=t.urls,e.credentials=new MeetingSessionCredentials_1.default,e.credentials.attendeeId=t.credentials.attendeeId+ContentShareConstants_1.default.Modality,e.credentials.externalUserId=t.credentials.externalUserId,e.credentials.joinToken=t.credentials.joinToken+ContentShareConstants_1.default.Modality,e}setContentAudioProfile(t){this.contentAudioVideo.setAudioProfile(t)}enableSimulcastForContentShare(t,e){t?(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=new DefaultSimulcastUplinkPolicyForContentShare_1.default(this.contentAudioVideo.logger,e)):(this.contentAudioVideo.configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.contentAudioVideo.configuration.videoUplinkBandwidthPolicy=void 0)}startContentShare(t){return __awaiter$i(this,void 0,void 0,function*(){if(!!t){this.mediaStreamBroker.mediaStream=t;for(let e=0;e<this.mediaStreamBroker.mediaStream.getTracks().length;e++)this.mediaStreamBroker.mediaStream.getTracks()[e].addEventListener("ended",()=>{this.stopContentShare()});this.contentAudioVideo.start()}})}startContentShareFromScreenCapture(t,e){return __awaiter$i(this,void 0,void 0,function*(){const n=yield this.mediaStreamBroker.acquireScreenCaptureDisplayInputStream(t,e);return yield this.startContentShare(n),n})}pauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!1)&&this.forEachContentShareObserver(t=>{Types_1.Maybe.of(t.contentShareDidPause).map(e=>e.call(t))})}unpauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!0)&&this.forEachContentShareObserver(t=>{Types_1.Maybe.of(t.contentShareDidUnpause).map(e=>e.call(t))})}setContentShareVideoCodecPreferences(t){this.contentAudioVideo.setVideoCodecSendPreferences(t)}destroy(){return __awaiter$i(this,void 0,void 0,function*(){!this.contentAudioVideo||(this.destroyed=!0,this.contentAudioVideo.removeObserver(this),this.stopContentShare(),this.observerQueue.clear(),this.contentAudioVideo=void 0,this.attendeeAudioVideo=void 0,this.mediaStreamBroker=void 0)})}stopContentShare(){this.contentAudioVideo.stop(),this.mediaStreamBroker.cleanup()}addContentShareObserver(t){this.observerQueue.add(t)}removeContentShareObserver(t){this.observerQueue.delete(t)}forEachContentShareObserver(t){for(const e of this.observerQueue)AsyncScheduler_1$2.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}audioVideoDidStart(){this.mediaStreamBroker.mediaStream.getVideoTracks().length>0&&this.contentAudioVideo.videoTileController.startLocalVideoTile()}audioVideoDidStop(t){this.mediaStreamBroker.cleanup(),this.contentShareTile&&(this.attendeeAudioVideo.videoTileController.removeVideoTile(this.contentShareTile.id()),this.contentShareTile=null),this.forEachContentShareObserver(e=>{Types_1.Maybe.of(e.contentShareDidStop).map(n=>n.call(e))})}setupContentShareEvents(){this.attendeeAudioVideo.realtimeController.realtimeSubscribeToAttendeeIdPresence((t,e,n,o)=>{const a=new DefaultModality_1.default(t).hasModality(DefaultModality_1.default.MODALITY_CONTENT),s=new DefaultModality_1.default(t).base()===this.attendeeAudioVideo.configuration.credentials.attendeeId;if(!a||!s||!e||this.contentShareTile)return;const d=this.mediaStreamBroker.mediaStream;if(d!=null&&d.getVideoTracks().length){this.contentShareTile=this.attendeeAudioVideo.videoTileController.addVideoTile();const u=d.getVideoTracks()[0];let c,l;if(u.getSettings){const f=u.getSettings();c=f.width,l=f.height}else{const f=u.getCapabilities();c=f.width,l=f.height}this.contentShareTile.bindVideoStream(this.contentAudioVideo.configuration.credentials.attendeeId,!1,d,c,l,null,this.contentAudioVideo.configuration.credentials.externalUserId)}this.forEachContentShareObserver(u=>{Types_1.Maybe.of(u.contentShareDidStart).map(c=>c.call(u))})})}}DefaultContentShareController$1.default=DefaultContentShareController;var DefaultEventController$1={},uaParser={exports:{}};(function(r,t){(function(e,n){var o="1.0.2",a="",s="?",d="function",u="undefined",c="object",l="string",f="major",h="model",p="name",m="type",S="vendor",g="version",y="architecture",E="console",T="mobile",C="tablet",P="smarttv",x="wearable",$="embedded",I=255,A="Amazon",v="Apple",b="ASUS",k="BlackBerry",D="Browser",R="Chrome",O="Edge",B="Firefox",F="Google",ie="Huawei",V="LG",X="Microsoft",re="Motorola",z="Opera",oe="Samsung",le="Sony",q="Xiaomi",ce="Zebra",de="Facebook",me=function(N,G){var L={};for(var Z in N)G[Z]&&G[Z].length%2===0?L[Z]=G[Z].concat(N[Z]):L[Z]=N[Z];return L},ee=function(N){for(var G={},L=0;L<N.length;L++)G[N[L].toUpperCase()]=N[L];return G},ve=function(N,G){return typeof N===l?fe(G).indexOf(fe(N))!==-1:!1},fe=function(N){return N.toLowerCase()},Ce=function(N){return typeof N===l?N.replace(/[^\d\.]/g,a).split(".")[0]:n},_e=function(N,G){if(typeof N===l)return N=N.replace(/^\s\s*/,a).replace(/\s\s*$/,a),typeof G===u?N:N.substring(0,I)},he=function(N,G){for(var L=0,Z,U,pe,H,Se,_;L<G.length&&!Se;){var w=G[L],M=G[L+1];for(Z=U=0;Z<w.length&&!Se;)if(Se=w[Z++].exec(N),Se)for(pe=0;pe<M.length;pe++)_=Se[++U],H=M[pe],typeof H===c&&H.length>0?H.length===2?typeof H[1]==d?this[H[0]]=H[1].call(this,_):this[H[0]]=H[1]:H.length===3?typeof H[1]===d&&!(H[1].exec&&H[1].test)?this[H[0]]=_?H[1].call(this,_,H[2]):n:this[H[0]]=_?_.replace(H[1],H[2]):n:H.length===4&&(this[H[0]]=_?H[3].call(this,_.replace(H[1],H[2])):n):this[H]=_||n;L+=2}},ae=function(N,G){for(var L in G)if(typeof G[L]===c&&G[L].length>0){for(var Z=0;Z<G[L].length;Z++)if(ve(G[L][Z],N))return L===s?n:L}else if(ve(G[L],N))return L===s?n:L;return N},Te={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},be={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ye={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,z+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[p,z]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+D]],[/\bqbcore\/([\w\.]+)/i],[g,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+D],g],[/\bfocus\/([\w\.]+)/i],[g,[p,B+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,z+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,z+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI "+D]],[/fxios\/([-\w\.]+)/i],[g,[p,B]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+D]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+D],g],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,de],g],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,R+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+D]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,ae,Te]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,B+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,g]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,fe]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,a,fe]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,fe]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[S,oe],[m,C]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[S,oe],[m,T]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[S,v],[m,T]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[S,v],[m,C]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[S,ie],[m,C]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[h,[S,ie],[m,T]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[S,q],[m,T]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[S,q],[m,C]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[S,"OPPO"],[m,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[S,"Vivo"],[m,T]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[S,"Realme"],[m,T]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[S,re],[m,T]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[S,re],[m,C]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[S,V],[m,C]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[S,V],[m,T]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[S,"Lenovo"],[m,C]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[S,"Nokia"],[m,T]],[/(pixel c)\b/i],[h,[S,F],[m,C]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[S,F],[m,T]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[S,le],[m,T]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[S,le],[m,C]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[S,"OnePlus"],[m,T]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[S,A],[m,C]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[S,A],[m,T]],[/(playbook);[-\w\),; ]+(rim)/i],[h,S,[m,C]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[S,k],[m,T]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[S,b],[m,C]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[S,b],[m,T]],[/(nexus 9)/i],[h,[S,"HTC"],[m,C]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[S,[h,/_/g," "],[m,T]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[S,"Acer"],[m,C]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[S,"Meizu"],[m,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[S,"Sharp"],[m,T]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,h,[m,T]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,h,[m,C]],[/(surface duo)/i],[h,[S,X],[m,C]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[S,"Fairphone"],[m,T]],[/(u304aa)/i],[h,[S,"AT&T"],[m,T]],[/\bsie-(\w*)/i],[h,[S,"Siemens"],[m,T]],[/\b(rct\w+) b/i],[h,[S,"RCA"],[m,C]],[/\b(venue[\d ]{2,7}) b/i],[h,[S,"Dell"],[m,C]],[/\b(q(?:mv|ta)\w+) b/i],[h,[S,"Verizon"],[m,C]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[S,"Barnes & Noble"],[m,C]],[/\b(tm\d{3}\w+) b/i],[h,[S,"NuVision"],[m,C]],[/\b(k88) b/i],[h,[S,"ZTE"],[m,C]],[/\b(nx\d{3}j) b/i],[h,[S,"ZTE"],[m,T]],[/\b(gen\d{3}) b.+49h/i],[h,[S,"Swiss"],[m,T]],[/\b(zur\d{3}) b/i],[h,[S,"Swiss"],[m,C]],[/\b((zeki)?tb.*\b) b/i],[h,[S,"Zeki"],[m,C]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],h,[m,C]],[/\b(ns-?\w{0,9}) b/i],[h,[S,"Insignia"],[m,C]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[S,"NextBook"],[m,C]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],h,[m,T]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],h,[m,T]],[/\b(ph-1) /i],[h,[S,"Essential"],[m,T]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[S,"Envizen"],[m,C]],[/\b(trio[-\w\. ]+) b/i],[h,[S,"MachSpeed"],[m,C]],[/\btu_(1491) b/i],[h,[S,"Rotor"],[m,C]],[/(shield[\w ]+) b/i],[h,[S,"Nvidia"],[m,C]],[/(sprint) (\w+)/i],[S,h,[m,T]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[S,X],[m,T]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[S,ce],[m,C]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[S,ce],[m,T]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,h,[m,E]],[/droid.+; (shield) bui/i],[h,[S,"Nvidia"],[m,E]],[/(playstation [345portablevi]+)/i],[h,[S,le],[m,E]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[S,X],[m,E]],[/smart-tv.+(samsung)/i],[S,[m,P]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[S,oe],[m,P]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,V],[m,P]],[/(apple) ?tv/i],[S,[h,v+" TV"],[m,P]],[/crkey/i],[[h,R+"cast"],[S,F],[m,P]],[/droid.+aft(\w)( bui|\))/i],[h,[S,A],[m,P]],[/\(dtv[\);].+(aquos)/i],[h,[S,"Sharp"],[m,P]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[S,_e],[h,_e],[m,P]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,P]],[/((pebble))app/i],[S,h,[m,x]],[/droid.+; (glass) \d/i],[h,[S,F],[m,x]],[/droid.+; (wt63?0{2,3})\)/i],[h,[S,ce],[m,x]],[/(quest( 2)?)/i],[h,[S,de],[m,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[m,$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[m,T]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[m,C]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,C]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[m,T]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,O+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[g,ae,be]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[g,ae,be]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,"Mac OS"],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[g,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,g],[/\(bb(10);/i],[g,[p,k]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,B+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/crkey\/([\d\.]+)/i],[g,[p,R+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[p,"Chromium OS"],g],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,g]]},ne=function(N,G){if(typeof N===c&&(G=N,N=n),!(this instanceof ne))return new ne(N,G).getResult();var L=N||(typeof e!==u&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:a),Z=G?me(ye,G):ye;return this.getBrowser=function(){var U={};return U[p]=n,U[g]=n,he.call(U,L,Z.browser),U.major=Ce(U.version),U},this.getCPU=function(){var U={};return U[y]=n,he.call(U,L,Z.cpu),U},this.getDevice=function(){var U={};return U[S]=n,U[h]=n,U[m]=n,he.call(U,L,Z.device),U},this.getEngine=function(){var U={};return U[p]=n,U[g]=n,he.call(U,L,Z.engine),U},this.getOS=function(){var U={};return U[p]=n,U[g]=n,he.call(U,L,Z.os),U},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return L},this.setUA=function(U){return L=typeof U===l&&U.length>I?_e(U,I):U,this},this.setUA(L),this};ne.VERSION=o,ne.BROWSER=ee([p,g,f]),ne.CPU=ee([y]),ne.DEVICE=ee([h,S,m,E,T,P,C,x,$]),ne.ENGINE=ne.OS=ee([p,g]),r.exports&&(t=r.exports=ne),t.UAParser=ne;var ue=typeof e!==u&&(e.jQuery||e.Zepto);if(ue&&!ue.ua){var ge=new ne;ue.ua=ge.getResult(),ue.ua.get=function(){return ge.getUA()},ue.ua.set=function(N){ge.setUA(N);var G=ge.getResult();for(var L in G)ue.ua[L]=G[L]}}})(typeof window=="object"?window:commonjsGlobal)})(uaParser,uaParser.exports);var Destroyable={};Object.defineProperty(Destroyable,"__esModule",{value:!0});Destroyable.isDestroyable=void 0;function isDestroyable(r){return r&&"destroy"in r}Destroyable.isDestroyable=isDestroyable;var EventIngestionConfiguration$1={},EventBufferConfiguration$1={};Object.defineProperty(EventBufferConfiguration$1,"__esModule",{value:!0});class EventBufferConfiguration{constructor(t=5e3,e=2,n=64,o=100,a=15){this.flushIntervalMs=t,this.flushSize=e,this.maxBufferCapacityKb=n,this.totalBufferItems=o,this.retryCountLimit=a}}EventBufferConfiguration$1.default=EventBufferConfiguration;Object.defineProperty(EventIngestionConfiguration$1,"__esModule",{value:!0});const EventBufferConfiguration_1=EventBufferConfiguration$1;class EventIngestionConfiguration{constructor(t,e,n=new EventBufferConfiguration_1.default){this.eventsClientConfiguration=t,this.ingestionURL=e,this.eventBufferConfiguration=n}}EventIngestionConfiguration$1.default=EventIngestionConfiguration;var DefaultMeetingEventReporter$1={},InMemoryJSONEventBuffer$1={},FullJitterBackoff$1={};Object.defineProperty(FullJitterBackoff$1,"__esModule",{value:!0});class FullJitterBackoff{constructor(t,e,n){this.fixedWaitMs=t,this.shortBackoffMs=e,this.longBackoffMs=n,this.currentRetry=0,this.fixedWaitMs<0&&(this.fixedWaitMs=0),this.shortBackoffMs<0&&(this.shortBackoffMs=0),this.longBackoffMs<0&&(this.longBackoffMs=0),this.reset()}reset(){this.currentRetry=0}nextBackoffAmountMs(){const t=Math.random()*Math.min(this.longBackoffMs,this.shortBackoffMs*Math.pow(2,this.currentRetry))+this.fixedWaitMs;return this.currentRetry+=1,t}}FullJitterBackoff$1.default=FullJitterBackoff;var DefaultUserAgentParser$1={};Object.defineProperty(DefaultUserAgentParser$1,"__esModule",{value:!0});const ua_parser_js_1$1=uaParser.exports,Versioning_1$4=Versioning$1;class DefaultUserAgentParser{constructor(t){var e,n,o,a,s,d,u;try{this.parserResult=navigator&&navigator.userAgent?new ua_parser_js_1$1.UAParser(navigator.userAgent).getResult():void 0}catch(c){t.error(c.message)}this.browserMajorVersion=((o=(n=(e=this.parserResult)===null||e===void 0?void 0:e.browser)===null||n===void 0?void 0:n.version)===null||o===void 0?void 0:o.split(".")[0])||DefaultUserAgentParser.UNAVAILABLE,this.browserName=((a=this.parserResult)===null||a===void 0?void 0:a.browser.name)||DefaultUserAgentParser.UNAVAILABLE,this.browserVersion=((s=this.parserResult)===null||s===void 0?void 0:s.browser.version)||DefaultUserAgentParser.UNAVAILABLE,this.deviceName=[((d=this.parserResult)===null||d===void 0?void 0:d.device.vendor)||"",((u=this.parserResult)===null||u===void 0?void 0:u.device.model)||""].join(" ").trim()||DefaultUserAgentParser.UNAVAILABLE}getParserResult(){var t,e;return{browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,osName:((t=this.parserResult)===null||t===void 0?void 0:t.os.name)||DefaultUserAgentParser.UNAVAILABLE,osVersion:((e=this.parserResult)===null||e===void 0?void 0:e.os.version)||DefaultUserAgentParser.UNAVAILABLE,sdkVersion:Versioning_1$4.default.sdkVersion,sdkName:Versioning_1$4.default.sdkName}}}DefaultUserAgentParser$1.default=DefaultUserAgentParser;DefaultUserAgentParser.UNAVAILABLE="Unavailable";var __awaiter$h=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})},__rest=commonjsGlobal&&commonjsGlobal.__rest||function(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(e[n[o]]=r[n[o]]);return e};Object.defineProperty(InMemoryJSONEventBuffer$1,"__esModule",{value:!0});const FullJitterBackoff_1$3=FullJitterBackoff$1,IntervalScheduler_1$1=IntervalScheduler$1,DefaultUserAgentParser_1=DefaultUserAgentParser$1,Utils_1$1=Utils;class InMemoryJSONEventBuffer{constructor(t,e,n,o,a){this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.retryCountLimit=15,this.lock=!1,this.cancellableEvents=new Map,this.attributesToFilter=["externalUserId","externalMeetingId","timestampMs"],this.deepCopyCurrentIngestionEvent=y=>({type:y.type,v:y.v,payloads:[...y.payloads]}),this.sendEvents=()=>__awaiter$h(this,void 0,void 0,function*(){if(this.lock)return;const y=this.getItems(this.flushSize);if(y.length===0)return;this.lock=!0;const E=this.makeRequestBody(y);let T=!1;const C=Date.now();this.metadata.browserName.toLowerCase()==="firefox"&&this.cancellableEvents.set(C,y);try{this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - sending body ${E}`);const P=yield this.send(E);if(this.cancellableEvents.delete(C),!P.ok)this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Failed to send events ${E} with response status ${P.status}`),T=!0;else try{const x=yield P.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - send successful events: ${E} message: ${JSON.stringify(x)}`)}catch(x){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents error reading OK response ${x} for events ${E}`)}}catch(P){T=!0,this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Error in sending events ${E} to the ingestion endpoint ${P}`)}finally{this.lock=!1}T&&(this.cancellableEvents.delete(C),this.failedIngestionEvents.push(...y))});const s=new DefaultUserAgentParser_1.default(a).getParserResult(),d=__rest(s,["browserMajorVersion"]),u=e.toJSON(),{type:c,v:l}=u,f=__rest(u,["type","v"]);this.authenticationToken=e.getAuthenticationToken(),this.metadata=Object.assign(Object.assign({},d),f),Object.keys(this.metadata).forEach(y=>this.attributesToFilter.push(y)),this.type=c,this.v=l,this.ingestionURL=n,this.logger=a,this.importantEvents=new Set(o);const{maxBufferCapacityKb:h,totalBufferItems:p,flushSize:m,flushIntervalMs:S,retryCountLimit:g}=t;this.maxBufferCapacityBytes=h*1024,this.totalBufferItems=p,this.maxBufferItemCapacityBytes=Math.round(this.maxBufferCapacityBytes/p),this.flushIntervalMs=S,this.flushSize=m,this.retryCountLimit=g,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.beaconEventListener=y=>this.beaconEventHandler(y),this.addEventListeners()}addEventListeners(){!this.beaconEventListener||!("window"in commonjsGlobal)||!window.addEventListener||!("document"in commonjsGlobal)||!document.addEventListener||(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - addEventListeners - adding pagehide and visibility change event listeners"),window.addEventListener("pagehide",this.beaconEventListener),document.addEventListener("visibilitychange",this.beaconEventListener))}beaconEventHandler(t){(t.type==="visibilitychange"&&document.visibilityState==="hidden"||t.type==="pagehide")&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - beaconEventHandler is triggered calling sendBeacon"),this.sendBeacon())}removeEventListeners(){!this.beaconEventListener||!("window"in commonjsGlobal)||!window.removeEventListener||!("document"in commonjsGlobal)||!document.removeEventListener||(window.removeEventListener("pagehide",this.beaconEventListener),document.removeEventListener("visibilitychange",this.beaconEventListener),this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - removeEventListeners - removing pagehide and visibility change event listeners"))}start(){var t;this.removeEventListeners(),this.addEventListeners(),(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=new IntervalScheduler_1$1.default(this.flushIntervalMs),this.intervalScheduler.start(()=>this.sendEvents())}stop(){var t;(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=void 0,this.sendBeacon(),this.removeEventListeners()}addItem(t){return __awaiter$h(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - received event ${JSON.stringify(t)}`);const{name:e,ts:n,attributes:o}=t,a=o&&this.filterAttributes(o,this.attributesToFilter),s=Object.assign({name:e,ts:n},a);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - event after filtering attributes ${JSON.stringify(s)}`);const d=this.getSize(s);if(d>InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED)throw new Error(`Event Reporting - Item to be added has size ${d} bytes. Item cannot exceed max item size allowed of ${InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED} bytes.`);if(this.importantEvents.has(e)){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - sending important event ${JSON.stringify(s)}`),this.sendEventImmediately({name:e,ts:n,attributes:a});return}if(this.isFull())throw this.logger.warn("Event Reporting - Event buffer is full"),new Error("Buffer full");if(this.currentIngestionEvent.payloads.push(s),this.ingestionEventSize+=d,this.bufferItemThresholdReached(d)){const u=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);this.buffer.push(u),this.bufferSize+=this.ingestionEventSize,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - buffer item threshold reached updated buffer ${JSON.stringify(this.buffer)}`)}})}filterAttributes(t,e){const n=new Set(e);return Object.keys(t).filter(a=>n.has(a)).forEach(a=>delete t[a]),t}initializeAndGetCurrentIngestionEvent(){const t={type:this.type,v:this.v,payloads:[]};return this.ingestionEventSize=this.getSize(t),t}bufferItemThresholdReached(t){return t+this.ingestionEventSize>=this.maxBufferItemCapacityBytes||this.currentIngestionEvent.payloads.length===InMemoryJSONEventBuffer.MAX_PAYLOAD_ITEMS}getSize(t){let e=0;if(typeof t=="object")for(const[n,o]of Object.entries(t))e+=this.getPrimitiveSize(n),e+=this.getSize(o);else e+=this.getPrimitiveSize(t);return e}getPrimitiveSize(t){let e=0;return typeof t=="string"?e+=t.length*2:typeof t=="number"&&(e+=8),e}isFull(){return this.bufferSize===this.maxBufferCapacityBytes||this.buffer.length===this.totalBufferItems}isEmpty(){return this.buffer.length===0||this.bufferSize===0}getItems(t,e=0){return this.isEmpty()?[]:(t=Math.min(this.buffer.length,t+1),this.buffer.splice(e,t))}makeBeaconRequestBody(t){const e={metadata:this.metadata,events:t,authorization:this.authenticationToken};return JSON.stringify(e)}makeRequestBody(t){const e={metadata:this.metadata,events:t};return JSON.stringify(e)}sendEventImmediately(t){return __awaiter$h(this,void 0,void 0,function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - important event received ${JSON.stringify(t)}`);const{name:e,ts:n,attributes:o}=t,a={type:this.type,v:this.v,payloads:[Object.assign({name:e,ts:n},o)]};let s=!1,d=null;const u=this.makeRequestBody([a]);try{if(d=yield this.send(u),d.ok){try{const c=yield d.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - send successful event: ${u}, message: ${JSON.stringify(c)}`)}catch(c){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Error reading OK response ${c} for event ${u}`)}return}else this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Failed to send an important event ${u} with response status ${d.status}`),s=!0}catch(c){this.logger.warn(`Event Reporting - There may be a failure in sending an important event ${u} to the ingestion endpoint ${c}.`),s=!0;try{if(this.metadata.browserName.toLowerCase()==="firefox"){const l=this.makeBeaconRequestBody([a]);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - beaconing data out ${l}`),navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,l)?s=!1:s=!0}}catch{this.logger.warn(`Event Reporting - Error sending beacon for an important event ${u}`),s=!0}}s&&(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - pushing to failed events ${u}`),this.failedIngestionEvents.push(a))})}send(t){return __awaiter$h(this,void 0,void 0,function*(){const e=new FullJitterBackoff_1$3.default(InMemoryJSONEventBuffer.RETRY_FIXED_BACKOFF_WAIT_MS,InMemoryJSONEventBuffer.RETRY_SHORT_BACKOFF_MS,InMemoryJSONEventBuffer.RETRY_LONG_BACKOFF_MS);try{let n=0;for(;n<this.retryCountLimit;){const o=yield fetch(this.ingestionURL,{method:"POST",headers:{Authorization:`Bearer ${this.authenticationToken}`},body:t});if(o.ok||!InMemoryJSONEventBuffer.SENDING_FAILURE_CODES.has(o.status))return o;if(this.logger.warn(`Will retry sending failure for ${t} due to status code ${o.status}.`),n++,n<this.retryCountLimit){const a=e.nextBackoffAmountMs();yield Utils_1$1.wait(a)}}if(n===this.retryCountLimit)throw new Error(`Retry count limit reached for ${t}`)}catch(n){throw n}})}sendBeacon(){return __awaiter$h(this,void 0,void 0,function*(){const t=this.buffer;if(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out buffer events ${JSON.stringify(t)}`),this.buffer=[],this.currentIngestionEvent.payloads.length>0){const n=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);t.push(n),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out current ingestion event ${JSON.stringify(n)}`),this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent()}if(this.failedIngestionEvents.length>0){const n=this.failedIngestionEvents.map(o=>this.deepCopyCurrentIngestionEvent(o));t.push(...n),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out any failed ingestion event ${JSON.stringify(n)}`),this.failedIngestionEvents=[]}if(this.cancellableEvents.size>0&&(this.cancellableEvents.forEach(n=>{t.push(...n),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out each cancellable event ${JSON.stringify(n)}`)}),this.cancellableEvents.clear()),t.length===0)return;const e=this.makeBeaconRequestBody(t);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - beacon data to send ${e}`);try{navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,e)||this.logger.warn(`Event Reporting - Browser failed to queue beacon data ${e}`)}catch(n){this.logger.warn(`Event Reporting - Sending beacon data ${e} failed with error ${n}`)}})}reset(){this.maxBufferCapacityBytes=0,this.totalBufferItems=0,this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.lock=!1,this.beaconEventListener=void 0,this.cancellableEvents.clear()}destroy(){return __awaiter$h(this,void 0,void 0,function*(){this.stop(),this.reset()})}}InMemoryJSONEventBuffer$1.default=InMemoryJSONEventBuffer;InMemoryJSONEventBuffer.SENDING_FAILURE_CODES=new Set([408,429,500,502,503,504]);InMemoryJSONEventBuffer.RETRY_FIXED_BACKOFF_WAIT_MS=0;InMemoryJSONEventBuffer.RETRY_SHORT_BACKOFF_MS=1e3;InMemoryJSONEventBuffer.RETRY_LONG_BACKOFF_MS=15e3;InMemoryJSONEventBuffer.MAX_PAYLOAD_ITEMS=2;InMemoryJSONEventBuffer.MAX_ITEM_SIZE_BYTES_ALLOWED=3e3;var __awaiter$g=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultMeetingEventReporter$1,"__esModule",{value:!0});const Destroyable_1$1=Destroyable,InMemoryJSONEventBuffer_1=InMemoryJSONEventBuffer$1;class DefaultMeetingEventReporter{constructor(t,e){this.reportingEvents=!1,this.importantEvents=["meetingEnded","meetingFailed","meetingStartFailed","audioInputFailed","videoInputFailed","meetingStartSucceeded"],this.destroyed=!1;const{eventsClientConfiguration:n,ingestionURL:o,eventBufferConfiguration:a}=t,{eventsToIgnore:s}=n;this.eventBuffer=new InMemoryJSONEventBuffer_1.default(a,n,o,this.importantEvents,e),this.logger=e,this.eventsToIgnore=s,this.start()}start(){if(!this.reportingEvents)try{this.eventBuffer.start(),this.logger.info("Event reporting started"),this.reportingEvents=!0}catch(t){this.logger.error(`Event Reporting - Error starting the event buffer ${t}`)}}stop(){if(!!this.reportingEvents)try{this.eventBuffer.stop(),this.logger.info("Event reporting stopped"),this.reportingEvents=!1}catch(t){this.logger.error(`Event Reporting - Error stopping the event buffer ${t}`)}}reportEvent(t,e,n){return __awaiter$g(this,void 0,void 0,function*(){if(this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - event received in reportEvent ${t}, ${e}, ${JSON.stringify(n)}`),this.eventsToIgnore.includes(e)){this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - ${e} event will be ignored as it is in events to ignore`);return}try{this.logger.debug("Event Reporting - DefaultMeetingEventReporter - adding item to event buffer"),yield this.eventBuffer.addItem({ts:t,name:e,attributes:n})}catch(o){this.logger.error(`Event Reporting - Error adding event to buffer ${o}`)}})}destroy(){return __awaiter$g(this,void 0,void 0,function*(){this.destroyed=!0,this.stop(),Destroyable_1$1.isDestroyable(this.eventBuffer)&&this.eventBuffer.destroy(),this.eventBuffer=void 0})}}DefaultMeetingEventReporter$1.default=DefaultMeetingEventReporter;var MeetingEventsClientConfiguration$1={};Object.defineProperty(MeetingEventsClientConfiguration$1,"__esModule",{value:!0});class MeetingEventsClientConfiguration{constructor(t,e,n,o=[]){this.type="Meet",this.v=1,this.meetingId=t,this.attendeeId=e,this.eventsToIgnore=o,this.authenticationToken=n}getAuthenticationToken(){return this.authenticationToken}toJSON(){const t={};return t.type=this.type,t.v=this.v,t.meetingId=this.meetingId,t.attendeeId=this.attendeeId,t}}MeetingEventsClientConfiguration$1.default=MeetingEventsClientConfiguration;var flattenEventAttributes$1={};Object.defineProperty(flattenEventAttributes$1,"__esModule",{value:!0});const flattenEventAttributes=r=>{const t={};for(const[e,n]of Object.entries(r))if(!(n==null||n===""))if(typeof n=="number"||typeof n=="string")t[e]=n;else throw new TypeError("Unhandled type received while flattening attributes.");return t};flattenEventAttributes$1.default=flattenEventAttributes;var __awaiter$f=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultEventController$1,"__esModule",{value:!0});const ua_parser_js_1=uaParser.exports,Destroyable_1=Destroyable,EventIngestionConfiguration_1=EventIngestionConfiguration$1,DefaultMeetingEventReporter_1=DefaultMeetingEventReporter$1,MeetingEventsClientConfiguration_1=MeetingEventsClientConfiguration$1,AsyncScheduler_1$1=AsyncScheduler$1,Versioning_1$3=Versioning$1,flattenEventAttributes_1=flattenEventAttributes$1;class DefaultEventController{constructor(t,e,n){var o,a,s,d,u,c,l;this.meetingHistoryStates=[],this.observerSet=new Set,this.destroyed=!1,this.logger=e,this.configuration=t,this.setupEventReporter(t,e,n);try{this.parserResult=navigator&&navigator.userAgent?new ua_parser_js_1.UAParser(navigator.userAgent).getResult():null}catch(f){this.logger.error(f.message)}this.browserMajorVersion=((s=(a=(o=this.parserResult)===null||o===void 0?void 0:o.browser)===null||a===void 0?void 0:a.version)===null||s===void 0?void 0:s.split(".")[0])||DefaultEventController.UNAVAILABLE,this.browserName=((d=this.parserResult)===null||d===void 0?void 0:d.browser.name)||DefaultEventController.UNAVAILABLE,this.browserVersion=((u=this.parserResult)===null||u===void 0?void 0:u.browser.version)||DefaultEventController.UNAVAILABLE,this.deviceName=[((c=this.parserResult)===null||c===void 0?void 0:c.device.vendor)||"",((l=this.parserResult)===null||l===void 0?void 0:l.device.model)||""].join(" ").trim()||DefaultEventController.UNAVAILABLE}addObserver(t){this.observerSet.add(t)}removeObserver(t){this.observerSet.delete(t)}forEachObserver(t){for(const e of this.observerSet)AsyncScheduler_1$1.default.nextTick(()=>{this.observerSet.has(e)&&t(e)})}publishEvent(t,e){return __awaiter$f(this,void 0,void 0,function*(){const n=Date.now();this.meetingHistoryStates.push({name:t,timestampMs:n});const o=Object.freeze(Object.assign(this.getAttributes(n),e));this.forEachObserver(a=>{a.eventDidReceive(t,o)}),this.reportEvent(t,n,e)})}reportEvent(t,e,n){var o;return __awaiter$f(this,void 0,void 0,function*(){let a;try{n&&(a=flattenEventAttributes_1.default(n)),yield(o=this.eventReporter)===null||o===void 0?void 0:o.reportEvent(e,t,a)}catch(s){this.logger.error(`Error reporting event ${s}`)}})}setupEventReporter(t,e,n){if(n)this._eventReporter=n;else if(t.urls){const o=t.urls.eventIngestionURL;if(o){this.logger.info("Event ingestion URL is present in the configuration");const{meetingId:a,credentials:{attendeeId:s,joinToken:d}}=t,u=new MeetingEventsClientConfiguration_1.default(a,s,d),c=new EventIngestionConfiguration_1.default(u,o);this._eventReporter=new DefaultMeetingEventReporter_1.default(c,e)}}}getAttributes(t){var e,n;return{attendeeId:this.configuration.credentials.attendeeId,browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,externalMeetingId:typeof this.configuration.externalMeetingId=="string"?this.configuration.externalMeetingId:"",externalUserId:this.configuration.credentials.externalUserId,meetingHistory:this.meetingHistoryStates,meetingId:this.configuration.meetingId,osName:((e=this.parserResult)===null||e===void 0?void 0:e.os.name)||DefaultEventController.UNAVAILABLE,osVersion:((n=this.parserResult)===null||n===void 0?void 0:n.os.version)||DefaultEventController.UNAVAILABLE,sdkVersion:Versioning_1$3.default.sdkVersion,sdkName:Versioning_1$3.default.sdkName,timestampMs:t}}get eventReporter(){return this._eventReporter}destroy(){return __awaiter$f(this,void 0,void 0,function*(){Destroyable_1.isDestroyable(this.eventReporter)&&(yield this.eventReporter.destroy()),this.logger=void 0,this.configuration=void 0,this._eventReporter=void 0,this.destroyed=!0})}}DefaultEventController$1.default=DefaultEventController;DefaultEventController.UNAVAILABLE="Unavailable";var DefaultMeetingReadinessChecker$1={},MeetingReadinessCheckerConfiguration$1={};Object.defineProperty(MeetingReadinessCheckerConfiguration$1,"__esModule",{value:!0});class MeetingReadinessCheckerConfiguration{constructor(){this.timeoutMs=1e4,this.waitDurationMs=3e3}}MeetingReadinessCheckerConfiguration$1.default=MeetingReadinessCheckerConfiguration;var __awaiter$e=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultMeetingReadinessChecker$1,"__esModule",{value:!0});const DefaultAudioMixController_1=DefaultAudioMixController$1,DefaultBrowserBehavior_1$2=DefaultBrowserBehavior$1,DefaultDeviceController_1=DefaultDeviceController$1,PermissionDeniedError_1=PermissionDeniedError$1,BaseTask_1$1=BaseTask$1,TimeoutTask_1=TimeoutTask$1,CheckAudioConnectivityFeedback_1=CheckAudioConnectivityFeedback,CheckAudioInputFeedback_1=CheckAudioInputFeedback,CheckAudioOutputFeedback_1=CheckAudioOutputFeedback,CheckCameraResolutionFeedback_1=CheckCameraResolutionFeedback,CheckContentShareConnectivityFeedback_1=CheckContentShareConnectivityFeedback,CheckNetworkTCPConnectivityFeedback_1=CheckNetworkTCPConnectivityFeedback,CheckNetworkUDPConnectivityFeedback_1=CheckNetworkUDPConnectivityFeedback,CheckVideoConnectivityFeedback_1=CheckVideoConnectivityFeedback,CheckVideoInputFeedback_1=CheckVideoInputFeedback,MeetingReadinessCheckerConfiguration_1=MeetingReadinessCheckerConfiguration$1;class DefaultMeetingReadinessChecker{constructor(t,e,n=new MeetingReadinessCheckerConfiguration_1.default){this.logger=t,this.meetingSession=e,this.configuration=n,this.browserBehavior=new DefaultBrowserBehavior_1$2.default}static delay(t){return __awaiter$e(this,void 0,void 0,function*(){return new Promise(e=>setTimeout(e,t))})}checkAudioInput(t){return __awaiter$e(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startAudioInput(t),yield this.meetingSession.audioVideo.stopAudioInput(),CheckAudioInputFeedback_1.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Audio input check failed with error ${e}`),e instanceof PermissionDeniedError_1.default?CheckAudioInputFeedback_1.default.PermissionDenied:CheckAudioInputFeedback_1.default.Failed}})}checkAudioOutput(t,e,n=null){return __awaiter$e(this,void 0,void 0,function*(){try{const o=t?DefaultDeviceController_1.default.getIntrinsicDeviceId(t):"";return yield this.playTone(o,440,n),(yield e())?CheckAudioOutputFeedback_1.default.Succeeded:CheckAudioOutputFeedback_1.default.Failed}catch(o){return this.logger.error(`MeetingReadinessChecker: Audio output check failed with error: ${o}`),CheckAudioOutputFeedback_1.default.Failed}finally{this.stopTone()}})}playTone(t,e,n){return __awaiter$e(this,void 0,void 0,function*(){this.oscillatorNode&&this.stopTone(),this.audioContext=DefaultDeviceController_1.default.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.oscillatorNode=this.audioContext.createOscillator(),this.oscillatorNode.frequency.value=e,this.oscillatorNode.connect(this.gainNode),this.destinationStream=this.audioContext.createMediaStreamDestination(),this.gainNode.connect(this.destinationStream);const d=this.audioContext.currentTime+.1;this.gainNode.gain.linearRampToValueAtTime(0,d),this.gainNode.gain.linearRampToValueAtTime(.1,d+.1),this.oscillatorNode.start();const u=new DefaultAudioMixController_1.default(this.logger);try{this.browserBehavior.supportsSetSinkId()&&(yield u.bindAudioDevice({deviceId:t}))}catch(c){this.logger.error(`Failed to bind audio device: ${c}`)}try{yield u.bindAudioElement(n||new Audio)}catch(c){this.logger.error(`Failed to bind audio element: ${c}`)}yield u.bindAudioStream(this.destinationStream.stream)})}stopTone(){if(!this.audioContext||!this.gainNode||!this.oscillatorNode||!this.destinationStream)return;const t=1,e=.1,n=.1,o=this.audioContext.currentTime;this.gainNode.gain.linearRampToValueAtTime(n,o+e+t),this.gainNode.gain.linearRampToValueAtTime(0,o+e*2+t),this.oscillatorNode.stop(),this.oscillatorNode.disconnect(this.gainNode),this.gainNode.disconnect(this.destinationStream),this.oscillatorNode=null,this.gainNode=null,this.destinationStream=null}checkVideoInput(t){return __awaiter$e(this,void 0,void 0,function*(){try{return yield this.meetingSession.audioVideo.startVideoInput(t),yield this.meetingSession.audioVideo.stopVideoInput(),CheckVideoInputFeedback_1.default.Succeeded}catch(e){return this.logger.error(`MeetingReadinessChecker: Video check failed with error ${e}`),e instanceof PermissionDeniedError_1.default?CheckVideoInputFeedback_1.default.PermissionDenied:CheckVideoInputFeedback_1.default.Failed}})}checkCameraResolution(t,e,n){return __awaiter$e(this,void 0,void 0,function*(){let o;try{const a=DefaultDeviceController_1.default.getIntrinsicDeviceId(t),s={video:this.calculateVideoConstraint(a,e,n)};o=yield navigator.mediaDevices.getUserMedia(s)}catch(a){return this.logger.error(`MeetingReadinessChecker: Camera resolution check with width: ${e} height ${n} failed with error ${a}`),a&&a.name==="OverconstrainedError"?CheckCameraResolutionFeedback_1.default.ResolutionNotSupported:a&&a.name==="NotAllowedError"?CheckCameraResolutionFeedback_1.default.PermissionDenied:CheckCameraResolutionFeedback_1.default.Failed}finally{o&&o.getTracks().forEach(function(a){a.stop()})}return CheckCameraResolutionFeedback_1.default.Succeeded})}calculateVideoConstraint(t,e,n){const o=this.browserBehavior.requiresResolutionAlignment(e,n),a={};return this.browserBehavior.requiresNoExactMediaStreamConstraints()?(a.deviceId=t,a.width=e,a.height=n):(a.deviceId={exact:t},a.width={exact:o[0]},a.height={exact:o[1]}),a}checkContentShareConnectivity(t){return __awaiter$e(this,void 0,void 0,function*(){let e=!1,n=!1;const o={contentShareDidStart:()=>{e=!0}},a={audioVideoDidStart:()=>{n=!0}};try{return this.meetingSession.audioVideo.addObserver(a),this.meetingSession.audioVideo.start(),this.meetingSession.audioVideo.addContentShareObserver(o),yield this.meetingSession.audioVideo.startContentShareFromScreenCapture(t),yield this.executeTimeoutTask(()=>__awaiter$e(this,void 0,void 0,function*(){return n&&e})),n?(yield this.stopMeeting(),e?CheckContentShareConnectivityFeedback_1.default.Succeeded:CheckContentShareConnectivityFeedback_1.default.TimedOut):CheckContentShareConnectivityFeedback_1.default.ConnectionFailed}catch(s){return this.logger.error(`MeetingReadinessChecker: Content share check failed with error ${s}`),s.name==="NotAllowedError"?CheckContentShareConnectivityFeedback_1.default.PermissionDenied:CheckContentShareConnectivityFeedback_1.default.Failed}finally{this.meetingSession.audioVideo.removeObserver(a),this.meetingSession.audioVideo.stopContentShare(),this.meetingSession.audioVideo.removeContentShareObserver(o)}})}checkAudioConnectivity(t){return __awaiter$e(this,void 0,void 0,function*(){let e=!1;const n=this.meetingSession.audioVideo,o=(a,s,d,u)=>{a===this.meetingSession.configuration.credentials.attendeeId&&s&&(e=!0)};try{yield n.startAudioInput(t)}catch(a){return this.logger.error(`MeetingReadinessChecker: Failed to get audio input device with error ${a}`),a instanceof PermissionDeniedError_1.default?CheckAudioConnectivityFeedback_1.default.AudioInputPermissionDenied:CheckAudioConnectivityFeedback_1.default.AudioInputRequestFailed}return n.realtimeSubscribeToAttendeeIdPresence(o),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>__awaiter$e(this,void 0,void 0,function*(){return e})),n.realtimeUnsubscribeToAttendeeIdPresence(o),yield this.stopMeeting(),yield this.meetingSession.audioVideo.stopAudioInput(),e?CheckAudioConnectivityFeedback_1.default.Succeeded:CheckAudioConnectivityFeedback_1.default.AudioNotReceived):(n.realtimeUnsubscribeToAttendeeIdPresence(o),yield this.meetingSession.audioVideo.stopAudioInput(),CheckAudioConnectivityFeedback_1.default.ConnectionFailed)})}checkVideoConnectivity(t){return __awaiter$e(this,void 0,void 0,function*(){const e=this.meetingSession.audioVideo;let n=0;const o={metricsDidReceive(a){a.getRTCStatsReport().forEach(d=>{d.type==="outbound-rtp"&&d.mediaType==="video"&&(n=d.packetsSent)})}};try{yield e.startVideoInput(t)}catch(a){return this.logger.error(`MeetingReadinessChecker: Failed to get video input device with error ${a}`),a instanceof PermissionDeniedError_1.default?CheckVideoConnectivityFeedback_1.default.VideoInputPermissionDenied:CheckVideoConnectivityFeedback_1.default.VideoInputRequestFailed}return e.addObserver(o),(yield this.startMeeting())?(e.startLocalVideoTile(),yield this.executeTimeoutTask(()=>__awaiter$e(this,void 0,void 0,function*(){return n>0})),yield e.stopVideoInput(),yield this.stopMeeting(),e.removeObserver(o),n<=0?CheckVideoConnectivityFeedback_1.default.VideoNotSent:CheckVideoConnectivityFeedback_1.default.Succeeded):CheckVideoConnectivityFeedback_1.default.ConnectionFailed})}checkNetworkUDPConnectivity(){return __awaiter$e(this,void 0,void 0,function*(){let t=!1;const e={metricsDidReceive(o){o.getRTCStatsReport().forEach(s=>{s.type==="candidate-pair"&&s.state==="succeeded"&&(t=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(o){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${o}`),CheckNetworkUDPConnectivityFeedback_1.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=o=>{const a=this.originalURLRewriter(o);return a.includes("transport=tcp")?"":a};const n=this.meetingSession.audioVideo;return n.addObserver(e),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>__awaiter$e(this,void 0,void 0,function*(){return t})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),n.removeObserver(e),t?CheckNetworkUDPConnectivityFeedback_1.default.Succeeded:CheckNetworkUDPConnectivityFeedback_1.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,CheckNetworkUDPConnectivityFeedback_1.default.ConnectionFailed)})}checkNetworkTCPConnectivity(){return __awaiter$e(this,void 0,void 0,function*(){let t=!1;const e={metricsDidReceive(o){o.getRTCStatsReport().forEach(s=>{s.type==="candidate-pair"&&s.state==="succeeded"&&(t=!0)})}};try{this.originalURLRewriter=this.meetingSession.configuration.urls.urlRewriter}catch(o){return this.logger.error(`MeetingSessionConfiguration.urls doesn't exist. Error: ${o}`),CheckNetworkTCPConnectivityFeedback_1.default.MeetingSessionURLsNotInitialized}this.meetingSession.configuration.urls.urlRewriter=o=>{const a=this.originalURLRewriter(o);return a.includes("transport=udp")?"":a};const n=this.meetingSession.audioVideo;return n.addObserver(e),(yield this.startMeeting())?(yield this.executeTimeoutTask(()=>__awaiter$e(this,void 0,void 0,function*(){return t})),this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,yield this.stopMeeting(),n.removeObserver(e),t?CheckNetworkTCPConnectivityFeedback_1.default.Succeeded:CheckNetworkTCPConnectivityFeedback_1.default.ICENegotiationFailed):(this.meetingSession.configuration.urls.urlRewriter=this.originalURLRewriter,CheckNetworkTCPConnectivityFeedback_1.default.ConnectionFailed)})}startMeeting(){return __awaiter$e(this,void 0,void 0,function*(){let t=!1;const e={audioVideoDidStart:()=>{t=!0}};return this.meetingSession.audioVideo.addObserver(e),this.meetingSession.audioVideo.start(),yield this.executeTimeoutTask(()=>__awaiter$e(this,void 0,void 0,function*(){return t})),this.meetingSession.audioVideo.removeObserver(e),t})}stopMeeting(){return __awaiter$e(this,void 0,void 0,function*(){let t=!1;const e={audioVideoDidStop:n=>{t=!0}};return this.meetingSession.audioVideo.addObserver(e),this.meetingSession.audioVideo.stop(),yield this.executeTimeoutTask(()=>__awaiter$e(this,void 0,void 0,function*(){return t})),this.meetingSession.audioVideo.removeObserver(e),t})}executeTimeoutTask(t){return __awaiter$e(this,void 0,void 0,function*(){let e=!1;class n extends BaseTask_1$1.default{constructor(s,d){super(s),this.waitDurationMs=d,this.isCancelled=!1}cancel(){this.isCancelled=!0}run(){return __awaiter$e(this,void 0,void 0,function*(){for(;!this.isCancelled;){if(yield t()){e=!0;break}yield DefaultMeetingReadinessChecker.delay(this.waitDurationMs)}})}}return yield new TimeoutTask_1.default(this.logger,new n(this.logger,this.configuration.waitDurationMs),this.configuration.timeoutMs).run(),e})}}DefaultMeetingReadinessChecker$1.default=DefaultMeetingReadinessChecker;var DefaultMeetingSession={},DefaultReconnectController$1={};Object.defineProperty(DefaultReconnectController$1,"__esModule",{value:!0});const TimeoutScheduler_1=TimeoutScheduler$1;class DefaultReconnectController{constructor(t,e){this.reconnectTimeoutMs=t,this.backoffPolicy=e,this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this._isFirstConnection=!0,this.backoffTimer=null,this.backoffCancel=null,this.reset()}timeSpentReconnectingMs(){return this.firstConnectionAttempted?Date.now()-this.firstConnectionAttemptTimestampMs:0}hasPastReconnectDeadline(){return Date.now()-this.lastActiveTimestampMs>=this.reconnectTimeoutMs?!0:this.timeSpentReconnectingMs()>=this.reconnectTimeoutMs}reset(){this.cancel(),this.shouldReconnect=!0,this.onlyRestartPeerConnection=!1,this.firstConnectionAttempted=!1,this.firstConnectionAttemptTimestampMs=0,this.lastActiveTimestampMs=1/0,this.backoffPolicy.reset()}startedConnectionAttempt(t){this._isFirstConnection=t,this.firstConnectionAttempted||(this.firstConnectionAttempted=!0,this.firstConnectionAttemptTimestampMs=Date.now())}hasStartedConnectionAttempt(){return this.firstConnectionAttempted}isFirstConnection(){return this._isFirstConnection}disableReconnect(){this.shouldReconnect=!1}enableRestartPeerConnection(){this.onlyRestartPeerConnection=!0}cancel(){this.disableReconnect(),this.backoffTimer&&(this.backoffTimer.stop(),this.backoffCancel&&(this.backoffCancel(),this.backoffCancel=null))}retryWithBackoff(t,e){const n=this.shouldReconnect&&!this.hasPastReconnectDeadline();return n&&(this.backoffCancel=e,this.backoffTimer=new TimeoutScheduler_1.default(this.backoffPolicy.nextBackoffAmountMs()),this.backoffTimer.start(()=>{this.backoffCancel=null,t()})),n}shouldOnlyRestartPeerConnection(){return this.onlyRestartPeerConnection}clone(){return new DefaultReconnectController(this.reconnectTimeoutMs,this.backoffPolicy)}setLastActiveTimestampMs(t){this.lastActiveTimestampMs=t}}DefaultReconnectController$1.default=DefaultReconnectController;var DefaultWebSocketAdapter$1={};Object.defineProperty(DefaultWebSocketAdapter$1,"__esModule",{value:!0});const Versioning_1$2=Versioning$1,WebSocketReadyState_1$1=WebSocketReadyState;class DefaultWebSocketAdapter{constructor(t){this.logger=t}create(t,e,n){this.connection=new WebSocket(n?t:Versioning_1$2.default.urlWithVersion(t),e),this.connection.binaryType="arraybuffer"}send(t){if(!this.connection)return this.logger.error("WebSocket not yet created or already destroyed."),!1;try{return t instanceof Uint8Array?this.connection.send(t.buffer):this.connection.send(t),!0}catch(e){return this.logger.debug(()=>`send error: ${e.message}, websocket state=${WebSocketReadyState_1$1.default[this.readyState()]}`),!1}}close(t,e){var n;(n=this.connection)===null||n===void 0||n.close(t,e)}destroy(){this.connection=void 0}addEventListener(t,e){if(!this.connection){this.logger.warn("Cannot add event listener with no WebSocket connection.");return}this.connection.addEventListener(t,e)}removeEventListener(t,e){var n;(n=this.connection)===null||n===void 0||n.removeEventListener(t,e)}readyState(){if(!this.connection)return WebSocketReadyState_1$1.default.None;switch(this.connection.readyState){case WebSocket.CONNECTING:return WebSocketReadyState_1$1.default.Connecting;case WebSocket.OPEN:return WebSocketReadyState_1$1.default.Open;case WebSocket.CLOSING:return WebSocketReadyState_1$1.default.Closing;case WebSocket.CLOSED:return WebSocketReadyState_1$1.default.Closed}}}DefaultWebSocketAdapter$1.default=DefaultWebSocketAdapter;var hasRequiredDefaultMeetingSession;function requireDefaultMeetingSession(){if(hasRequiredDefaultMeetingSession)return DefaultMeetingSession;hasRequiredDefaultMeetingSession=1;var r=commonjsGlobal&&commonjsGlobal.__awaiter||function(p,m,S,g){function y(E){return E instanceof S?E:new S(function(T){T(E)})}return new(S||(S=Promise))(function(E,T){function C($){try{x(g.next($))}catch(I){T(I)}}function P($){try{x(g.throw($))}catch(I){T(I)}}function x($){$.done?E($.value):y($.value).then(C,P)}x((g=g.apply(p,m||[])).next())})};Object.defineProperty(DefaultMeetingSession,"__esModule",{value:!0});const t=requireDefaultAudioVideoController(),e=DefaultAudioVideoFacade$1,n=FullJitterBackoff$1,o=DefaultBrowserBehavior$1,a=ContentShareMediaStreamBroker$1,s=DefaultContentShareController$1,d=CSPMonitor$1,u=Destroyable,c=DefaultEventController$1,l=DefaultReconnectController$1,f=DefaultWebSocketAdapter$1;class h{constructor(m,S,g,y){this._eventController=y,this._configuration=m,this._logger=S,this.checkBrowserSupportAndFeatureConfiguration(),d.default.addLogger(this._logger),d.default.register(),this._eventController||(this._eventController=new c.default(m,S)),g.eventController||(g.eventController=this.eventController),this.audioVideoController=new t.default(this._configuration,this._logger,new f.default(this._logger),g,new l.default(this._configuration.reconnectTimeoutMs,new n.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs)),this.eventController),this._deviceController=g;const E=new a.default(this._logger);this.contentShareController=new s.default(E,new t.default(s.default.createContentShareMeetingSessionConfigure(this._configuration),this._logger,new f.default(this._logger),E,new l.default(this._configuration.reconnectTimeoutMs,new n.default(this._configuration.reconnectFixedWaitMs,this._configuration.reconnectShortBackOffMs,this._configuration.reconnectLongBackOffMs))),this.audioVideoController),this.audioVideoFacade=new e.default(this.audioVideoController,this.audioVideoController.videoTileController,this.audioVideoController.realtimeController,this.audioVideoController.audioMixController,this._deviceController,this.contentShareController)}get configuration(){return this._configuration}get logger(){return this._logger}get audioVideo(){return this.audioVideoFacade}get contentShare(){return this.contentShareController}get deviceController(){return this._deviceController}get eventController(){return this._eventController}destroy(){return r(this,void 0,void 0,function*(){u.isDestroyable(this.contentShareController)&&(yield this.contentShareController.destroy()),u.isDestroyable(this.audioVideoController)&&(yield this.audioVideoController.destroy()),u.isDestroyable(this.eventController)&&(yield this.eventController.destroy()),d.default.removeLogger(this._logger),this._logger=void 0,this._configuration=void 0,this._deviceController=void 0,this.audioVideoFacade=void 0,this.audioVideoController=void 0,this.contentShareController=void 0,this._eventController=void 0})}checkBrowserSupportAndFeatureConfiguration(){const m=new o.default,S=`${m.name()} ${m.majorVersion()} (${m.version()})`;if(this.logger.info(`browser is ${S}`),m.isSupported()||this.logger.warn(`this browser is not currently supported. Stability may suffer. Supported browsers are: ${m.supportString()}.`),this._configuration.videoUplinkBandwidthPolicy)if(this.isSimulcastUplinkPolicy(this._configuration.videoUplinkBandwidthPolicy)){if(!m.hasChromiumWebRTC())throw new Error("Simulcast is only supported on Chromium-based browsers");this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!0}else this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1;this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&(m.hasChromiumWebRTC()?this.logger.info(`Simulcast is enabled for ${m.name()}`):(this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers=!1,this.logger.info("Simulcast is only supported on Chromium-based browsers")))}isSimulcastUplinkPolicy(m){return!!(m&&m.addObserver)}}return DefaultMeetingSession.default=h,DefaultMeetingSession}var DefaultMessagingSession$1={},Message$1={};Object.defineProperty(Message$1,"__esModule",{value:!0});class Message{constructor(t,e,n){this.type=t,this.headers=e,this.payload=n}}Message$1.default=Message;var DefaultSigV4$1={},build$1={},tslib={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(r){var t,e,n,o,a,s,d,u,c,l,f,h,p,m,S,g,y,E,T,C,P,x,$;(function(I){var A=typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:{};I(v(A,v(r.exports)));function v(b,k){return b!==A&&(typeof Object.create=="function"?Object.defineProperty(b,"__esModule",{value:!0}):b.__esModule=!0),function(D,R){return b[D]=k?k(D,R):R}}})(function(I){var A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,b){v.__proto__=b}||function(v,b){for(var k in b)b.hasOwnProperty(k)&&(v[k]=b[k])};t=function(v,b){A(v,b);function k(){this.constructor=v}v.prototype=b===null?Object.create(b):(k.prototype=b.prototype,new k)},e=Object.assign||function(v){for(var b,k=1,D=arguments.length;k<D;k++){b=arguments[k];for(var R in b)Object.prototype.hasOwnProperty.call(b,R)&&(v[R]=b[R])}return v},n=function(v,b){var k={};for(var D in v)Object.prototype.hasOwnProperty.call(v,D)&&b.indexOf(D)<0&&(k[D]=v[D]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var R=0,D=Object.getOwnPropertySymbols(v);R<D.length;R++)b.indexOf(D[R])<0&&Object.prototype.propertyIsEnumerable.call(v,D[R])&&(k[D[R]]=v[D[R]]);return k},o=function(v,b,k,D){var R=arguments.length,O=R<3?b:D===null?D=Object.getOwnPropertyDescriptor(b,k):D,B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")O=Reflect.decorate(v,b,k,D);else for(var F=v.length-1;F>=0;F--)(B=v[F])&&(O=(R<3?B(O):R>3?B(b,k,O):B(b,k))||O);return R>3&&O&&Object.defineProperty(b,k,O),O},a=function(v,b){return function(k,D){b(k,D,v)}},s=function(v,b){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(v,b)},d=function(v,b,k,D){function R(O){return O instanceof k?O:new k(function(B){B(O)})}return new(k||(k=Promise))(function(O,B){function F(X){try{V(D.next(X))}catch(re){B(re)}}function ie(X){try{V(D.throw(X))}catch(re){B(re)}}function V(X){X.done?O(X.value):R(X.value).then(F,ie)}V((D=D.apply(v,b||[])).next())})},u=function(v,b){var k={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},D,R,O,B;return B={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function F(V){return function(X){return ie([V,X])}}function ie(V){if(D)throw new TypeError("Generator is already executing.");for(;k;)try{if(D=1,R&&(O=V[0]&2?R.return:V[0]?R.throw||((O=R.return)&&O.call(R),0):R.next)&&!(O=O.call(R,V[1])).done)return O;switch(R=0,O&&(V=[V[0]&2,O.value]),V[0]){case 0:case 1:O=V;break;case 4:return k.label++,{value:V[1],done:!1};case 5:k.label++,R=V[1],V=[0];continue;case 7:V=k.ops.pop(),k.trys.pop();continue;default:if(O=k.trys,!(O=O.length>0&&O[O.length-1])&&(V[0]===6||V[0]===2)){k=0;continue}if(V[0]===3&&(!O||V[1]>O[0]&&V[1]<O[3])){k.label=V[1];break}if(V[0]===6&&k.label<O[1]){k.label=O[1],O=V;break}if(O&&k.label<O[2]){k.label=O[2],k.ops.push(V);break}O[2]&&k.ops.pop(),k.trys.pop();continue}V=b.call(v,k)}catch(X){V=[6,X],R=0}finally{D=O=0}if(V[0]&5)throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}},$=function(v,b,k,D){D===void 0&&(D=k),v[D]=b[k]},c=function(v,b){for(var k in v)k!=="default"&&!b.hasOwnProperty(k)&&(b[k]=v[k])},l=function(v){var b=typeof Symbol=="function"&&Symbol.iterator,k=b&&v[b],D=0;if(k)return k.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&D>=v.length&&(v=void 0),{value:v&&v[D++],done:!v}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},f=function(v,b){var k=typeof Symbol=="function"&&v[Symbol.iterator];if(!k)return v;var D=k.call(v),R,O=[],B;try{for(;(b===void 0||b-- >0)&&!(R=D.next()).done;)O.push(R.value)}catch(F){B={error:F}}finally{try{R&&!R.done&&(k=D.return)&&k.call(D)}finally{if(B)throw B.error}}return O},h=function(){for(var v=[],b=0;b<arguments.length;b++)v=v.concat(f(arguments[b]));return v},p=function(){for(var v=0,b=0,k=arguments.length;b<k;b++)v+=arguments[b].length;for(var D=Array(v),R=0,b=0;b<k;b++)for(var O=arguments[b],B=0,F=O.length;B<F;B++,R++)D[R]=O[B];return D},m=function(v){return this instanceof m?(this.v=v,this):new m(v)},S=function(v,b,k){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var D=k.apply(v,b||[]),R,O=[];return R={},B("next"),B("throw"),B("return"),R[Symbol.asyncIterator]=function(){return this},R;function B(z){D[z]&&(R[z]=function(oe){return new Promise(function(le,q){O.push([z,oe,le,q])>1||F(z,oe)})})}function F(z,oe){try{ie(D[z](oe))}catch(le){re(O[0][3],le)}}function ie(z){z.value instanceof m?Promise.resolve(z.value.v).then(V,X):re(O[0][2],z)}function V(z){F("next",z)}function X(z){F("throw",z)}function re(z,oe){z(oe),O.shift(),O.length&&F(O[0][0],O[0][1])}},g=function(v){var b,k;return b={},D("next"),D("throw",function(R){throw R}),D("return"),b[Symbol.iterator]=function(){return this},b;function D(R,O){b[R]=v[R]?function(B){return(k=!k)?{value:m(v[R](B)),done:R==="return"}:O?O(B):B}:O}},y=function(v){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b=v[Symbol.asyncIterator],k;return b?b.call(v):(v=typeof l=="function"?l(v):v[Symbol.iterator](),k={},D("next"),D("throw"),D("return"),k[Symbol.asyncIterator]=function(){return this},k);function D(O){k[O]=v[O]&&function(B){return new Promise(function(F,ie){B=v[O](B),R(F,ie,B.done,B.value)})}}function R(O,B,F,ie){Promise.resolve(ie).then(function(V){O({value:V,done:F})},B)}},E=function(v,b){return Object.defineProperty?Object.defineProperty(v,"raw",{value:b}):v.raw=b,v},T=function(v){if(v&&v.__esModule)return v;var b={};if(v!=null)for(var k in v)Object.hasOwnProperty.call(v,k)&&(b[k]=v[k]);return b.default=v,b},C=function(v){return v&&v.__esModule?v:{default:v}},P=function(v,b){if(!b.has(v))throw new TypeError("attempted to get private field on non-instance");return b.get(v)},x=function(v,b,k){if(!b.has(v))throw new TypeError("attempted to set private field on non-instance");return b.set(v,k),k},I("__extends",t),I("__assign",e),I("__rest",n),I("__decorate",o),I("__param",a),I("__metadata",s),I("__awaiter",d),I("__generator",u),I("__exportStar",c),I("__createBinding",$),I("__values",l),I("__read",f),I("__spread",h),I("__spreadArrays",p),I("__await",m),I("__asyncGenerator",S),I("__asyncDelegator",g),I("__asyncValues",y),I("__makeTemplateObject",E),I("__importStar",T),I("__importDefault",C),I("__classPrivateFieldGet",P),I("__classPrivateFieldSet",x)})})(tslib);var jsSha256={},constants={};Object.defineProperty(constants,"__esModule",{value:!0});constants.MAX_HASHABLE_LENGTH=constants.INIT=constants.KEY=constants.DIGEST_LENGTH=constants.BLOCK_SIZE=void 0;constants.BLOCK_SIZE=64;constants.DIGEST_LENGTH=32;constants.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);constants.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];constants.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1;var RawSha256$1={};Object.defineProperty(RawSha256$1,"__esModule",{value:!0});RawSha256$1.RawSha256=void 0;var constants_1$1=constants,RawSha256=function(){function r(){this.state=Int32Array.from(constants_1$1.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return r.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var e=0,n=t.byteLength;if(this.bytesHashed+=n,this.bytesHashed*8>constants_1$1.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=t[e++],n--,this.bufferLength===constants_1$1.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},r.prototype.digest=function(){if(!this.finished){var t=this.bytesHashed*8,e=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(e.setUint8(this.bufferLength++,128),n%constants_1$1.BLOCK_SIZE>=constants_1$1.BLOCK_SIZE-8){for(var o=this.bufferLength;o<constants_1$1.BLOCK_SIZE;o++)e.setUint8(o,0);this.hashBuffer(),this.bufferLength=0}for(var o=this.bufferLength;o<constants_1$1.BLOCK_SIZE-8;o++)e.setUint8(o,0);e.setUint32(constants_1$1.BLOCK_SIZE-8,Math.floor(t/4294967296),!0),e.setUint32(constants_1$1.BLOCK_SIZE-4,t),this.hashBuffer(),this.finished=!0}for(var a=new Uint8Array(constants_1$1.DIGEST_LENGTH),o=0;o<8;o++)a[o*4]=this.state[o]>>>24&255,a[o*4+1]=this.state[o]>>>16&255,a[o*4+2]=this.state[o]>>>8&255,a[o*4+3]=this.state[o]>>>0&255;return a},r.prototype.hashBuffer=function(){for(var t=this,e=t.buffer,n=t.state,o=n[0],a=n[1],s=n[2],d=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=0;h<constants_1$1.BLOCK_SIZE;h++){if(h<16)this.temp[h]=(e[h*4]&255)<<24|(e[h*4+1]&255)<<16|(e[h*4+2]&255)<<8|e[h*4+3]&255;else{var p=this.temp[h-2],m=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10;p=this.temp[h-15];var S=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3;this.temp[h]=(m+this.temp[h-7]|0)+(S+this.temp[h-16]|0)}var g=(((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+(u&c^~u&l)|0)+(f+(constants_1$1.KEY[h]+this.temp[h]|0)|0)|0,y=((o>>>2|o<<30)^(o>>>13|o<<19)^(o>>>22|o<<10))+(o&a^o&s^a&s)|0;f=l,l=c,c=u,u=d+g|0,d=s,s=a,a=o,o=g+y|0}n[0]+=o,n[1]+=a,n[2]+=s,n[3]+=d,n[4]+=u,n[5]+=c,n[6]+=l,n[7]+=f},r}();RawSha256$1.RawSha256=RawSha256;var build={},convertToBuffer$1={},fromUtf8$3=function(r){for(var t=[],e=0,n=r.length;e<n;e++){var o=r.charCodeAt(e);if(o<128)t.push(o);else if(o<2048)t.push(o>>6|192,o&63|128);else if(e+1<r.length&&(o&64512)===55296&&(r.charCodeAt(e+1)&64512)===56320){var a=65536+((o&1023)<<10)+(r.charCodeAt(++e)&1023);t.push(a>>18|240,a>>12&63|128,a>>6&63|128,a&63|128)}else t.push(o>>12|224,o>>6&63|128,o&63|128)}return Uint8Array.from(t)},toUtf8$2=function(r){for(var t="",e=0,n=r.length;e<n;e++){var o=r[e];if(o<128)t+=String.fromCharCode(o);else if(192<=o&&o<224){var a=r[++e];t+=String.fromCharCode((o&31)<<6|a&63)}else if(240<=o&&o<365){var s=[o,r[++e],r[++e],r[++e]],d="%"+s.map(function(u){return u.toString(16)}).join("%");t+=decodeURIComponent(d)}else t+=String.fromCharCode((o&15)<<12|(r[++e]&63)<<6|r[++e]&63)}return t};function fromUtf8$2(r){return new TextEncoder().encode(r)}function toUtf8$1(r){return new TextDecoder("utf-8").decode(r)}var fromUtf8$1=function(r){return typeof TextEncoder=="function"?fromUtf8$2(r):fromUtf8$3(r)},toUtf8=function(r){return typeof TextDecoder=="function"?toUtf8$1(r):toUtf8$2(r)};const distEs$1=Object.freeze(Object.defineProperty({__proto__:null,fromUtf8:fromUtf8$1,toUtf8},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(distEs$1);Object.defineProperty(convertToBuffer$1,"__esModule",{value:!0});convertToBuffer$1.convertToBuffer=void 0;var util_utf8_browser_1=require$$0,fromUtf8=typeof Buffer<"u"&&Buffer.from?function(r){return Buffer.from(r,"utf8")}:util_utf8_browser_1.fromUtf8;function convertToBuffer(r){return r instanceof Uint8Array?r:typeof r=="string"?fromUtf8(r):ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(r)}convertToBuffer$1.convertToBuffer=convertToBuffer;var isEmptyData$1={};Object.defineProperty(isEmptyData$1,"__esModule",{value:!0});isEmptyData$1.isEmptyData=void 0;function isEmptyData(r){return typeof r=="string"?r.length===0:r.byteLength===0}isEmptyData$1.isEmptyData=isEmptyData;var numToUint8$1={};Object.defineProperty(numToUint8$1,"__esModule",{value:!0});numToUint8$1.numToUint8=void 0;function numToUint8(r){return new Uint8Array([(r&4278190080)>>24,(r&16711680)>>16,(r&65280)>>8,r&255])}numToUint8$1.numToUint8=numToUint8;var uint32ArrayFrom$1={};Object.defineProperty(uint32ArrayFrom$1,"__esModule",{value:!0});uint32ArrayFrom$1.uint32ArrayFrom=void 0;function uint32ArrayFrom(r){if(!Uint32Array.from){for(var t=new Uint32Array(r.length),e=0;e<r.length;)t[e]=r[e],e+=1;return t}return Uint32Array.from(r)}uint32ArrayFrom$1.uint32ArrayFrom=uint32ArrayFrom;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.uint32ArrayFrom=r.numToUint8=r.isEmptyData=r.convertToBuffer=void 0;var t=convertToBuffer$1;Object.defineProperty(r,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var e=isEmptyData$1;Object.defineProperty(r,"isEmptyData",{enumerable:!0,get:function(){return e.isEmptyData}});var n=numToUint8$1;Object.defineProperty(r,"numToUint8",{enumerable:!0,get:function(){return n.numToUint8}});var o=uint32ArrayFrom$1;Object.defineProperty(r,"uint32ArrayFrom",{enumerable:!0,get:function(){return o.uint32ArrayFrom}})})(build);Object.defineProperty(jsSha256,"__esModule",{value:!0});jsSha256.Sha256=void 0;var tslib_1=tslib.exports,constants_1=constants,RawSha256_1=RawSha256$1,util_1=build,Sha256=function(){function r(t){if(this.hash=new RawSha256_1.RawSha256,t){this.outer=new RawSha256_1.RawSha256;var e=bufferFromSecret(t),n=new Uint8Array(constants_1.BLOCK_SIZE);n.set(e);for(var o=0;o<constants_1.BLOCK_SIZE;o++)e[o]^=54,n[o]^=92;this.hash.update(e),this.outer.update(n);for(var o=0;o<e.byteLength;o++)e[o]=0}}return r.prototype.update=function(t){if(!((0,util_1.isEmptyData)(t)||this.error))try{this.hash.update((0,util_1.convertToBuffer)(t))}catch(e){this.error=e}},r.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},r.prototype.digest=function(){return(0,tslib_1.__awaiter)(this,void 0,void 0,function(){return(0,tslib_1.__generator)(this,function(t){return[2,this.digestSync()]})})},r}();jsSha256.Sha256=Sha256;function bufferFromSecret(r){var t=(0,util_1.convertToBuffer)(r);if(t.byteLength>constants_1.BLOCK_SIZE){var e=new RawSha256_1.RawSha256;e.update(t),t=e.digest()}var n=new Uint8Array(constants_1.BLOCK_SIZE);return n.set(t),n}(function(r){Object.defineProperty(r,"__esModule",{value:!0});var t=tslib.exports;(0,t.__exportStar)(jsSha256,r)})(build$1);var SHORT_TO_HEX={},HEX_TO_SHORT={};for(var i=0;i<256;i++){var encodedByte=i.toString(16).toLowerCase();encodedByte.length===1&&(encodedByte="0".concat(encodedByte)),SHORT_TO_HEX[i]=encodedByte,HEX_TO_SHORT[encodedByte]=i}function fromHex(r){if(r.length%2!==0)throw new Error("Hex encoded strings must have an even number length");for(var t=new Uint8Array(r.length/2),e=0;e<r.length;e+=2){var n=r.slice(e,e+2).toLowerCase();if(n in HEX_TO_SHORT)t[e/2]=HEX_TO_SHORT[n];else throw new Error("Cannot decode unrecognized sequence ".concat(n," as hexadecimal"))}return t}function toHex(r){for(var t="",e=0;e<r.byteLength;e++)t+=SHORT_TO_HEX[r[e]];return t}const distEs=Object.freeze(Object.defineProperty({__proto__:null,fromHex,toHex},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(distEs);var __awaiter$d=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultSigV4$1,"__esModule",{value:!0});const sha256_js_1=build$1,util_hex_encoding_1=require$$1,Versioning_1$1=Versioning$1;class DefaultSigV4{constructor(t){this.chimeClient=t}makeTwoDigits(t){return t>9?t.toString():"0"+t.toString()}hmac(t,e){const n=new sha256_js_1.Sha256(e);return n.update(t),n.digest()}getDateTimeString(){const t=new Date;return t.getUTCFullYear()+this.makeTwoDigits(t.getUTCMonth()+1)+this.makeTwoDigits(t.getUTCDate())+"T"+this.makeTwoDigits(t.getUTCHours())+this.makeTwoDigits(t.getUTCMinutes())+this.makeTwoDigits(t.getUTCSeconds())+"Z"}getDateString(t){return t.substring(0,t.indexOf("T"))}getSignatureKey(t,e,n,o){return __awaiter$d(this,void 0,void 0,function*(){const a=yield this.hmac(e,"AWS4"+t),s=yield this.hmac(n,a),d=yield this.hmac(o,s);return yield this.hmac("aws4_request",d)})}signURL(t,e,n,o,a,s,d){return __awaiter$d(this,void 0,void 0,function*(){const u=this.getDateTimeString(),c=this.getDateString(u),l="AWS4-HMAC-SHA256";let f="";this.chimeClient.config.region instanceof Function?f=yield this.chimeClient.config.region():f=this.chimeClient.config.region;const h="host",p="host:"+o.toLowerCase()+`
`,m=c+"/"+f+"/"+n+"/aws4_request";let S;this.chimeClient.config.credentials instanceof Function?S=yield this.chimeClient.config.credentials():S=this.chimeClient.config.credentials;let g=new Map;g.set("X-Amz-Algorithm",[l]),g.set("X-Amz-Credential",[encodeURIComponent(S.accessKeyId+"/"+m)]),g.set("X-Amz-Date",[u]),g.set("X-Amz-Expires",["10"]),g.set("X-Amz-SignedHeaders",["host"]),S.sessionToken&&g.set("X-Amz-Security-Token",[encodeURIComponent(S.sessionToken)]),g.set(Versioning_1$1.default.X_AMZN_VERSION,[encodeURIComponent(Versioning_1$1.default.sdkVersion)]),g.set(Versioning_1$1.default.X_AMZN_USER_AGENT,[encodeURIComponent(Versioning_1$1.default.sdkUserAgentLowResolution)]),d==null||d.forEach((I,A)=>{const v=encodeURIComponent(A);I.sort().forEach(b=>{g.has(v)||g.set(v,[]),g.get(v).push(encodeURIComponent(b))})});let y="";g=new Map([...g.entries()].sort()),g.forEach((I,A)=>{I.forEach(v=>{y.length&&(y+="&"),y+=A+"="+v})});const E=t+`
`+a+`
`+y+`
`+p+`
`+h+`
`+util_hex_encoding_1.toHex(yield this.hmac(s)),T=util_hex_encoding_1.toHex(yield this.hmac(E)),C=`AWS4-HMAC-SHA256
`+u+`
`+c+"/"+f+"/"+n+`/aws4_request
`+T,P=yield this.getSignatureKey(S.secretAccessKey,c,f,n),x=util_hex_encoding_1.toHex(yield this.hmac(C,P)),$=y+"&X-Amz-Signature="+x;return e+"://"+o+a+"?"+$})}}DefaultSigV4$1.default=DefaultSigV4;var PrefetchOn$1={};Object.defineProperty(PrefetchOn$1,"__esModule",{value:!0});var PrefetchOn;(function(r){r.Connect="connect"})(PrefetchOn||(PrefetchOn={}));PrefetchOn$1.default=PrefetchOn;var __awaiter$c=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultMessagingSession$1,"__esModule",{value:!0});const FullJitterBackoff_1$2=FullJitterBackoff$1,CSPMonitor_1=CSPMonitor$1,Message_1=Message$1,DefaultReconnectController_1=DefaultReconnectController$1,AsyncScheduler_1=AsyncScheduler$1,DefaultSigV4_1=DefaultSigV4$1,DefaultWebSocketAdapter_1=DefaultWebSocketAdapter$1,WebSocketReadyState_1=WebSocketReadyState,PrefetchOn_1=PrefetchOn$1;class DefaultMessagingSession{constructor(t,e,n,o,a){this.configuration=t,this.logger=e,this.webSocket=n,this.reconnectController=o,this.sigV4=a,this.observerQueue=new Set,this.webSocket||(this.webSocket=new DefaultWebSocketAdapter_1.default(this.logger)),this.reconnectController||(this.reconnectController=new DefaultReconnectController_1.default(t.reconnectTimeoutMs,new FullJitterBackoff_1$2.default(t.reconnectFixedWaitMs,t.reconnectShortBackoffMs,t.reconnectLongBackoffMs))),this.sigV4||(this.sigV4=new DefaultSigV4_1.default(this.configuration.chimeClient)),CSPMonitor_1.default.addLogger(this.logger),CSPMonitor_1.default.register()}addObserver(t){this.logger.info("adding messaging observer"),this.observerQueue.add(t)}removeObserver(t){this.logger.info("removing messaging observer"),this.observerQueue.delete(t)}start(){return __awaiter$c(this,void 0,void 0,function*(){this.isClosed()?yield this.startConnecting(!1):this.logger.info("messaging session already started")})}stop(){this.isClosed()?this.logger.info("no existing messaging session needs closing"):(this.isClosing=!0,this.webSocket.close(),CSPMonitor_1.default.removeLogger(this.logger))}forEachObserver(t){for(const e of this.observerQueue)AsyncScheduler_1.default.nextTick(()=>{this.observerQueue.has(e)&&t(e)})}setUpEventListeners(){this.webSocket.addEventListener("open",()=>{this.openEventHandler()}),this.webSocket.addEventListener("message",t=>{this.receiveMessageHandler(t.data)}),this.webSocket.addEventListener("close",t=>{this.closeEventHandler(t)}),this.webSocket.addEventListener("error",()=>{this.logger.error("WebSocket error")})}startConnecting(t){return __awaiter$c(this,void 0,void 0,function*(){const e=yield this.prepareWebSocketUrl();this.logger.info(`opening connection to ${e}`),t||this.reconnectController.reset(),this.reconnectController.hasStartedConnectionAttempt()?this.reconnectController.startedConnectionAttempt(!1):this.reconnectController.startedConnectionAttempt(!0),this.webSocket.create(e,[],!0),this.forEachObserver(n=>{n.messagingSessionDidStartConnecting&&n.messagingSessionDidStartConnecting(t)}),this.setUpEventListeners()})}prepareWebSocketUrl(){return __awaiter$c(this,void 0,void 0,function*(){const t=new Map;return t.set("userArn",[this.configuration.userArn]),t.set("sessionId",[this.configuration.messagingSessionId]),this.configuration.prefetchOn===PrefetchOn_1.default.Connect&&t.set("prefetch-on",[PrefetchOn_1.default.Connect]),yield this.sigV4.signURL("GET","wss","chime",this.configuration.endpointUrl,"/connect","",t)})}isClosed(){return this.webSocket.readyState()===WebSocketReadyState_1.default.None||this.webSocket.readyState()===WebSocketReadyState_1.default.Closed}openEventHandler(){this.reconnectController.reset(),this.isSessionEstablished=!1}receiveMessageHandler(t){try{const e=JSON.parse(t),n=e.Headers["x-amz-chime-event-type"],o=new Message_1.default(n,e.Headers,e.Payload||null);if(!this.isSessionEstablished&&n==="SESSION_ESTABLISHED")this.forEachObserver(a=>{a.messagingSessionDidStart&&a.messagingSessionDidStart()}),this.isSessionEstablished=!0;else if(!this.isSessionEstablished)return;this.forEachObserver(a=>{a.messagingSessionDidReceiveMessage&&a.messagingSessionDidReceiveMessage(o)})}catch(e){this.logger.error(`Messaging parsing failed: ${e}`)}}closeEventHandler(t){this.logger.info(`WebSocket close: ${t.code} ${t.reason}`),this.webSocket.destroy(),!(!this.isClosing&&this.canReconnect(t.code)&&this.reconnectController.retryWithBackoff(()=>__awaiter$c(this,void 0,void 0,function*(){this.startConnecting(!0)}),null))&&(this.isClosing=!1,this.isSessionEstablished&&this.forEachObserver(e=>{e.messagingSessionDidStop&&e.messagingSessionDidStop(t)}))}canReconnect(t){return t===1001||t===1006||t>=1011&&t<=1014||t>4e3&&t!==4002&&t!==4003&&t!==4401}}DefaultMessagingSession$1.default=DefaultMessagingSession;var DefaultVideoFrameProcessorPipeline$1={},__awaiter$b=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultVideoFrameProcessorPipeline$1,"__esModule",{value:!0});const CanvasVideoFrameBuffer_1=CanvasVideoFrameBuffer$1,DEFAULT_FRAMERATE=15;class DefaultVideoFrameProcessorPipeline{constructor(t,e){this.logger=t,this.stages=e,this.fr=DEFAULT_FRAMERATE,this.outputMediaStream=new MediaStream,this.videoInput=document.createElement("video"),this.canvasOutput=document.createElement("canvas"),this.outputCtx=this.canvasOutput.getContext("2d"),this.canvasInput=document.createElement("canvas"),this.inputCtx=this.canvasInput.getContext("2d"),this.inputVideoStream=null,this.sourceBuffers=[],this.destBuffers=[],this.observers=new Set,this.hasStarted=!1,this.process=n=>__awaiter$b(this,void 0,void 0,function*(){if(!this.inputVideoStream)return;const o=performance.now();this.videoInput.videoWidth&&(this.canvasInput.width!==this.videoInput.videoWidth&&(this.canvasInput.width=this.videoInput.videoWidth,this.canvasInput.height=this.videoInput.videoHeight,this.sourceBuffers[0].height=this.canvasInput.height,this.sourceBuffers[0].width=this.canvasInput.width,this.sourceBuffers[0].framerate=this.framerate),this.inputCtx.drawImage(this.videoInput,0,0));let a=[];a.push(this.sourceBuffers[0]);try{for(const h of this.processors)a=yield h.process(a)}catch{this.forEachObserver(p=>{p.processingDidFailToStart&&p.processingDidFailToStart()});return}this.destBuffers=a;let s;try{s=yield this.destBuffers[0].asCanvasImageSource()}catch{this.inputVideoStream&&(this.logger.info("buffers are destroyed and pipeline could not start"),this.forEachObserver(p=>{p.processingDidFailToStart&&p.processingDidFailToStart()}));return}const d=s.width,u=s.height;d!==0&&u!==0&&(this.canvasOutput.width!==d&&this.canvasOutput.height!==u&&(this.canvasOutput.width=d,this.canvasOutput.height=u),this.outputCtx.drawImage(s,0,0,d,u,0,0,d,u),this.hasStarted||(this.hasStarted=!0,this.forEachObserver(h=>{h.processingDidStart&&h.processingDidStart()})));const c=performance.now()-o,l=1e3*2/this.framerate-c,f=Math.max(0,1e3/this.framerate-c);l<=0&&this.forEachObserver(h=>{h.processingLatencyTooHigh&&h.processingLatencyTooHigh(c)}),this.lastTimeOut=setTimeout(this.process,f)})}destroy(){if(this.stop(),this.stages)for(const t of this.stages)t.destroy()}get framerate(){return this.fr}set framerate(t){this.fr=t<0?DEFAULT_FRAMERATE:t}stop(){if(this.videoInput.removeEventListener("loadedmetadata",this.process),this.videoInput.srcObject=null,this.destroyInputMediaStreamAndBuffers(),this.outputMediaStream)for(const t of this.outputMediaStream.getVideoTracks())t.stop();this.lastTimeOut&&(clearTimeout(this.lastTimeOut),this.lastTimeOut=void 0),this.hasStarted&&(this.hasStarted=!1,this.forEachObserver(t=>{t.processingDidStop&&t.processingDidStop()}))}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}getInputMediaStream(){return __awaiter$b(this,void 0,void 0,function*(){return this.inputVideoStream})}getActiveOutputMediaStream(){return this.outputMediaStream&&this.outputMediaStream.active?this.outputMediaStream:this.outputMediaStream=this.canvasOutput.captureStream(this.framerate)}setInputMediaStream(t){return __awaiter$b(this,void 0,void 0,function*(){if(!t){this.stop();return}if(t.getVideoTracks().length===0){this.logger.error("No video tracks in input media stream, ignoring");return}this.inputVideoStream=t;const e=this.inputVideoStream.getVideoTracks()[0].getSettings();this.logger.info(`processing pipeline input stream settings ${JSON.stringify(e)}`),this.canvasOutput.width=e.width,this.canvasOutput.height=e.height,this.videoInput.addEventListener("loadedmetadata",this.process),this.videoInput.srcObject=this.inputVideoStream,this.videoInput.setAttribute("playsinline","true");const n=new CanvasVideoFrameBuffer_1.default(this.canvasInput);this.sourceBuffers.push(n),this.videoInput.load();try{yield this.videoInput.play()}catch{this.logger.warn("Video element play() overrided by another load().")}})}set processors(t){this.stages=t}get processors(){return this.stages}forEachObserver(t){for(const e of this.observers)setTimeout(()=>{t(e)},0)}destroyInputMediaStreamAndBuffers(){if(this.inputVideoStream)for(const t of this.inputVideoStream.getTracks())t.stop();this.inputVideoStream=null;for(const t of this.sourceBuffers)t.destroy();this.sourceBuffers=[]}}DefaultVideoFrameProcessorPipeline$1.default=DefaultVideoFrameProcessorPipeline;var DefaultVideoTransformDevice$1={},__awaiter$a=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(DefaultVideoTransformDevice$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1$1=DefaultBrowserBehavior$1,DefaultVideoFrameProcessorPipeline_1=DefaultVideoFrameProcessorPipeline$1;class DefaultVideoTransformDevice{constructor(t,e,n,o=new DefaultBrowserBehavior_1$1.default){this.logger=t,this.device=e,this.processors=n,this.browserBehavior=o,this.observers=new Set,this.pipe=new DefaultVideoFrameProcessorPipeline_1.default(this.logger,this.processors),this.pipe.addObserver(this)}get outputMediaStream(){return this.pipe.outputMediaStream}chooseNewInnerDevice(t){const e=new DefaultVideoTransformDevice(this.logger,t,this.processors,this.browserBehavior);return e.pipe=this.pipe,e}getInnerDevice(){return this.device}intrinsicDevice(){return __awaiter$a(this,void 0,void 0,function*(){return this.device})}transformStream(t){return __awaiter$a(this,void 0,void 0,function*(){return yield this.pipe.setInputMediaStream(t),this.inputMediaStream=t,this.pipe.getActiveOutputMediaStream()})}onOutputStreamDisconnect(){this.logger.info("DefaultVideoTransformDevice: detach stopping input media stream");const t=this.device&&this.device.id;if(this.pipe.stop(),!t&&this.inputMediaStream)for(const e of this.inputMediaStream.getVideoTracks())e.stop()}stop(){return __awaiter$a(this,void 0,void 0,function*(){if(this.inputMediaStream)for(const t of this.inputMediaStream.getVideoTracks())t.stop();this.pipe.destroy(),this.inputMediaStream=null})}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}processingDidStart(){this.logger.info("video transform device processing started"),this.forEachObserver(t=>{t.processingDidStart&&t.processingDidStart()})}processingLatencyTooHigh(t){this.forEachObserver(e=>{e.processingLatencyTooHigh&&e.processingLatencyTooHigh(t)})}processingDidFailToStart(){this.logger.info("video transform device processing failed to start"),this.forEachObserver(t=>{t.processingDidFailToStart&&t.processingDidFailToStart()})}processingDidStop(){this.logger.info("video transform device processing stopped"),this.forEachObserver(t=>{t.processingDidStop&&t.processingDidStop()})}forEachObserver(t){for(const e of this.observers)setTimeout(()=>{t(e)},0)}}DefaultVideoTransformDevice$1.default=DefaultVideoTransformDevice;var FullJitterBackoffFactory$1={},FullJitterLimitedBackoff$1={};Object.defineProperty(FullJitterLimitedBackoff$1,"__esModule",{value:!0});const FullJitterBackoff_1$1=FullJitterBackoff$1;class FullJitterLimitedBackoff extends FullJitterBackoff_1$1.default{constructor(t,e,n,o){super(t,e,n),this.limit=o,this.attempts=0}nextBackoffAmountMs(){if(this.attempts++,this.attempts>this.limit)throw new Error("retry limit exceeded");return super.nextBackoffAmountMs()}}FullJitterLimitedBackoff$1.default=FullJitterLimitedBackoff;Object.defineProperty(FullJitterBackoffFactory$1,"__esModule",{value:!0});const FullJitterBackoff_1=FullJitterBackoff$1,FullJitterLimitedBackoff_1=FullJitterLimitedBackoff$1;class FullJitterBackoffFactory{constructor(t,e,n){this.fixedWaitMs=t,this.shortBackoffMs=e,this.longBackoffMs=n}create(){return new FullJitterBackoff_1.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs)}createWithLimit(t){return new FullJitterLimitedBackoff_1.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs,t)}}FullJitterBackoffFactory$1.default=FullJitterBackoffFactory;var Log$1={};Object.defineProperty(Log$1,"__esModule",{value:!0});class Log{constructor(t,e,n,o){this.sequenceNumber=t,this.message=e,this.timestampMs=n,this.logLevel=o}}Log$1.default=Log;var MessagingSessionConfiguration$1={};Object.defineProperty(MessagingSessionConfiguration$1,"__esModule",{value:!0});class MessagingSessionConfiguration{constructor(t,e,n,o){this.userArn=t,this.messagingSessionId=e,this.endpointUrl=n,this.chimeClient=o,this.reconnectTimeoutMs=10*1e3,this.reconnectFixedWaitMs=0,this.reconnectShortBackoffMs=1*1e3,this.reconnectLongBackoffMs=5*1e3,this.prefetchOn=void 0,this.messagingSessionId||(this.messagingSessionId=this.generateSessionId())}generateSessionId(){const t=new Uint32Array(1);return window.crypto.getRandomValues(t)[0].toString()}}MessagingSessionConfiguration$1.default=MessagingSessionConfiguration;var MultiLogger$1={};Object.defineProperty(MultiLogger$1,"__esModule",{value:!0});const LogLevel_1$3=LogLevel;class MultiLogger{constructor(...t){this._loggers=t}info(t){for(const e of this._loggers)e.info(t)}warn(t){for(const e of this._loggers)e.warn(t)}error(t){for(const e of this._loggers)e.error(t)}debug(t){let e,n;typeof t=="string"?n=t:t?n=()=>(e||(e=t()),e):n=""+t;for(const o of this._loggers)o.debug(n)}setLogLevel(t){for(const e of this._loggers)e.setLogLevel(t)}getLogLevel(){for(const t of this._loggers)return t.getLogLevel();return LogLevel_1$3.default.OFF}}MultiLogger$1.default=MultiLogger;var NoOpAudioVideoController={},NoOpDebugLogger$1={},NoOpLogger$1={};Object.defineProperty(NoOpLogger$1,"__esModule",{value:!0});const LogLevel_1$2=LogLevel;class NoOpLogger{constructor(t=LogLevel_1$2.default.OFF){this.level=t}info(t){}warn(t){}error(t){}debug(t){LogLevel_1$2.default.DEBUG<this.level||typeof t!="string"&&t()}setLogLevel(t){this.level=t}getLogLevel(){return this.level}}NoOpLogger$1.default=NoOpLogger;Object.defineProperty(NoOpDebugLogger$1,"__esModule",{value:!0});const LogLevel_1$1=LogLevel,NoOpLogger_1=NoOpLogger$1;class NoOpDebugLogger extends NoOpLogger_1.default{constructor(){super(LogLevel_1$1.default.DEBUG)}}NoOpDebugLogger$1.default=NoOpDebugLogger;var NoOpMediaStreamBroker$1={};Object.defineProperty(NoOpMediaStreamBroker$1,"__esModule",{value:!0});class NoOpMediaStreamBroker{acquireAudioInputStream(){return Promise.reject()}acquireVideoInputStream(){return Promise.reject()}acquireDisplayInputStream(t){return Promise.reject()}muteLocalAudioInputStream(){}unmuteLocalAudioInputStream(){}addMediaStreamBrokerObserver(t){}removeMediaStreamBrokerObserver(t){}}NoOpMediaStreamBroker$1.default=NoOpMediaStreamBroker;var hasRequiredNoOpAudioVideoController;function requireNoOpAudioVideoController(){if(hasRequiredNoOpAudioVideoController)return NoOpAudioVideoController;hasRequiredNoOpAudioVideoController=1,Object.defineProperty(NoOpAudioVideoController,"__esModule",{value:!0});const r=FullJitterBackoff$1,t=DefaultEventController$1,e=NoOpDebugLogger$1,n=NoOpMediaStreamBroker$1,o=MeetingSessionConfiguration$1,a=MeetingSessionCredentials$1,s=MeetingSessionStatus$1,d=MeetingSessionStatusCode,u=MeetingSessionURLs$1,c=DefaultReconnectController$1,l=DefaultWebSocketAdapter$1,f=requireDefaultAudioVideoController();class h extends f.default{constructor(m){const S=new o.default;S.meetingId="",S.externalMeetingId="",S.credentials=new a.default,S.credentials.attendeeId="",S.credentials.joinToken="",S.urls=new u.default,S.urls.turnControlURL="",S.urls.audioHostURL="",S.urls.signalingURL="wss://localhost/";const g=new e.default;super(m||S,g,new l.default(new e.default),new n.default,new c.default(0,new r.default(0,0,0)),new t.default(m||S,g))}setAudioProfile(m){}start(){}stop(){}promoteToPrimaryMeeting(m){return Promise.resolve(new s.default(d.default.OK))}demoteFromPrimaryMeeting(){}}return NoOpAudioVideoController.default=h,NoOpAudioVideoController}var NoOpDeviceController$1={},__awaiter$9=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(NoOpDeviceController$1,"__esModule",{value:!0});NoOpDeviceController$1.NoOpDeviceControllerWithEventController=void 0;const NoOpMediaStreamBroker_1=NoOpMediaStreamBroker$1;class NoOpDeviceController extends NoOpMediaStreamBroker_1.default{constructor(t){super(),this.destroyed=!1}destroy(){return __awaiter$9(this,void 0,void 0,function*(){this.destroyed=!0})}listAudioInputDevices(){return Promise.resolve([])}listVideoInputDevices(){return Promise.resolve([])}listAudioOutputDevices(){return Promise.resolve([])}startAudioInput(t){return Promise.reject()}stopAudioInput(){return Promise.resolve()}startVideoInput(t){return Promise.reject()}stopVideoInput(){return Promise.resolve()}chooseAudioOutput(t){return Promise.reject()}addDeviceChangeObserver(t){}removeDeviceChangeObserver(t){}createAnalyserNodeForAudioInput(){return null}startVideoPreviewForVideoInput(t){}stopVideoPreviewForVideoInput(t){}setDeviceLabelTrigger(t){}mixIntoAudioInput(t){return null}chooseVideoInputQuality(t,e,n){}getVideoInputQualitySettings(){return null}}NoOpDeviceController$1.default=NoOpDeviceController;class NoOpDeviceControllerWithEventController extends NoOpDeviceController{constructor(t){super(),this.eventController=t}}NoOpDeviceController$1.NoOpDeviceControllerWithEventController=NoOpDeviceControllerWithEventController;var NoOpEventReporter$1={};Object.defineProperty(NoOpEventReporter$1,"__esModule",{value:!0});class NoOpEventReporter{constructor(){}reportEvent(t,e,n){}start(){}stop(){}}NoOpEventReporter$1.default=NoOpEventReporter;var NoOpTask$1={};Object.defineProperty(NoOpTask$1,"__esModule",{value:!0});class NoOpTask{cancel(){}name(){return"NoOpTask"}run(){return Promise.resolve()}setParent(t){}}NoOpTask$1.default=NoOpTask;var NoOpVideoElementFactory$1={};Object.defineProperty(NoOpVideoElementFactory$1,"__esModule",{value:!0});class NoOpVideoElementFactory{create(){const t={clientWidth:400,clientHeight:300,width:400,height:300,videoWidth:400,videoHeight:300,style:{transform:""},hasAttribute:()=>!1,removeAttribute:()=>{},setAttribute:()=>{},srcObject:!1,paused:!0,pause:()=>{t.paused=!0},play:()=>(t.paused=!1,Promise.resolve())};return t}}NoOpVideoElementFactory$1.default=NoOpVideoElementFactory;var NoVideoDownlinkBandwidthPolicy$1={};Object.defineProperty(NoVideoDownlinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoStreamIdSet_1=DefaultVideoStreamIdSet$1;class NoVideoDownlinkBandwidthPolicy{reset(){}updateIndex(t){}updateMetrics(t){}wantsResubscribe(){return!1}chooseSubscriptions(){return new DefaultVideoStreamIdSet_1.default}}NoVideoDownlinkBandwidthPolicy$1.default=NoVideoDownlinkBandwidthPolicy;var NoVideoUplinkBandwidthPolicy$1={};Object.defineProperty(NoVideoUplinkBandwidthPolicy$1,"__esModule",{value:!0});const DefaultVideoCaptureAndEncodeParameter_1=DefaultVideoCaptureAndEncodeParameter$1;class NoVideoUplinkBandwidthPolicy{constructor(){}updateConnectionMetric(t){}chooseMediaTrackConstraints(){return{}}chooseEncodingParameters(){return new Map}updateIndex(t){}wantsResubscribe(){return!1}chooseCaptureAndEncodeParameters(){return new DefaultVideoCaptureAndEncodeParameter_1.default(0,0,0,0,!1)}maxBandwidthKbps(){return 0}setIdealMaxBandwidthKbps(t){}setHasBandwidthPriority(t){}}NoVideoUplinkBandwidthPolicy$1.default=NoVideoUplinkBandwidthPolicy;var POSTLogger$1={},__awaiter$8=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(POSTLogger$1,"__esModule",{value:!0});const IntervalScheduler_1=IntervalScheduler$1,Log_1=Log$1,LogLevel_1=LogLevel;class POSTLogger{constructor(t){this.logCapture=[],this.lock=!1,this.sequenceNumber=0;const{url:e,batchSize:n=POSTLogger.BATCH_SIZE,intervalMs:o=POSTLogger.INTERVAL_MS,logLevel:a=LogLevel_1.default.WARN,metadata:s,headers:d}=t;this.url=e,this.batchSize=n,this.intervalMs=o,this.logLevel=a,this.metadata=s,this.headers=d,this.start(),this.eventListener=()=>{this.stop()},this.addEventListener()}addEventListener(){!this.eventListener||!("window"in commonjsGlobal)||!window.addEventListener||window.addEventListener("unload",this.eventListener)}removeEventListener(){!this.eventListener||!("window"in commonjsGlobal)||!window.removeEventListener||window.removeEventListener("unload",this.eventListener)}debug(t){LogLevel_1.default.DEBUG<this.logLevel||(typeof t=="string"?this.log(LogLevel_1.default.DEBUG,t):t?this.log(LogLevel_1.default.DEBUG,t()):this.log(LogLevel_1.default.DEBUG,""+t))}info(t){this.log(LogLevel_1.default.INFO,t)}warn(t){this.log(LogLevel_1.default.WARN,t)}error(t){this.log(LogLevel_1.default.ERROR,t)}setLogLevel(t){this.logLevel=t}getLogLevel(){return this.logLevel}getLogCaptureSize(){return this.logCapture.length}start(){this.addEventListener(),this.intervalScheduler=new IntervalScheduler_1.default(this.intervalMs),this.intervalScheduler.start(()=>__awaiter$8(this,void 0,void 0,function*(){if(this.lock===!0||this.getLogCaptureSize()===0)return;this.lock=!0;const t=this.logCapture.slice(0,this.batchSize),e=this.makeRequestBody(t);try{(yield fetch(this.url,Object.assign({method:"POST",body:e},this.headers?{headers:this.headers}:{}))).status===200&&(this.logCapture=this.logCapture.slice(t.length))}catch(n){console.warn("[POSTLogger] "+n.message)}finally{this.lock=!1}}))}stop(){var t;(t=this.intervalScheduler)===null||t===void 0||t.stop(),this.intervalScheduler=void 0,this.removeEventListener();const e=this.makeRequestBody(this.logCapture);navigator.sendBeacon(this.url,e)}destroy(){return __awaiter$8(this,void 0,void 0,function*(){this.stop(),this.metadata=void 0,this.headers=void 0,this.logCapture=[],this.sequenceNumber=0,this.lock=!1,this.batchSize=0,this.intervalMs=0,this.url=void 0})}makeRequestBody(t){return JSON.stringify(Object.assign(Object.assign({},this.metadata),{logs:t}))}log(t,e){if(t<this.logLevel)return;const n=Date.now();this.logCapture.push(new Log_1.default(this.sequenceNumber,e,n,LogLevel_1.default[t])),this.sequenceNumber+=1}}POSTLogger$1.default=POSTLogger;POSTLogger.BATCH_SIZE=85;POSTLogger.INTERVAL_MS=2e3;var RealtimeAttendeePositionInFrame$1={};Object.defineProperty(RealtimeAttendeePositionInFrame$1,"__esModule",{value:!0});class RealtimeAttendeePositionInFrame{constructor(){this.attendeeIndex=null,this.attendeesInFrame=null}}RealtimeAttendeePositionInFrame$1.default=RealtimeAttendeePositionInFrame;var RunnableTask$1={};Object.defineProperty(RunnableTask$1,"__esModule",{value:!0});const BaseTask_1=BaseTask$1;class RunnableTask extends BaseTask_1.default{constructor(t,e,n="RunnableTask"){super(t),this.fn=e,this.taskName=n}run(){return this.fn().then(()=>{})}}RunnableTask$1.default=RunnableTask;var SingleNodeAudioTransformDevice$1={},__awaiter$7=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(SingleNodeAudioTransformDevice$1,"__esModule",{value:!0});class SingleNodeAudioTransformDevice{constructor(t){this.inner=t}mute(t){return __awaiter$7(this,void 0,void 0,function*(){})}stop(){var t;return __awaiter$7(this,void 0,void 0,function*(){(t=this.node)===null||t===void 0||t.disconnect()})}intrinsicDevice(){return __awaiter$7(this,void 0,void 0,function*(){return this.inner})}createAudioNode(t){var e;return __awaiter$7(this,void 0,void 0,function*(){return(e=this.node)===null||e===void 0||e.disconnect(),this.node=yield this.createSingleAudioNode(t),{start:this.node,end:this.node}})}}SingleNodeAudioTransformDevice$1.default=SingleNodeAudioTransformDevice;var TranscriptAlternative$1={};Object.defineProperty(TranscriptAlternative$1,"__esModule",{value:!0});class TranscriptAlternative{}TranscriptAlternative$1.default=TranscriptAlternative;var TranscriptEntity$1={};Object.defineProperty(TranscriptEntity$1,"__esModule",{value:!0});class TranscriptEntity{}TranscriptEntity$1.default=TranscriptEntity;var TranscriptItem$1={};Object.defineProperty(TranscriptItem$1,"__esModule",{value:!0});class TranscriptItem{}TranscriptItem$1.default=TranscriptItem;var TranscriptLanguageWithScore$1={};Object.defineProperty(TranscriptLanguageWithScore$1,"__esModule",{value:!0});class TranscriptLanguageWithScore{}TranscriptLanguageWithScore$1.default=TranscriptLanguageWithScore;var TranscriptResult$1={};Object.defineProperty(TranscriptResult$1,"__esModule",{value:!0});class TranscriptResult{}TranscriptResult$1.default=TranscriptResult;var VideoSource$1={};Object.defineProperty(VideoSource$1,"__esModule",{value:!0});class VideoSource{}VideoSource$1.default=VideoSource;var VoiceFocusDeviceTransformer$1={},voicefocus={},decider={},__awaiter$6=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(decider,"__esModule",{value:!0});decider.decideModel=decider.measureAndDecideExecutionApproach=void 0;const loader_js_1$1=loader,support_js_1$4=support,DEFAULT_EXECUTION_QUANTA=3,SIMD_SCORE_FIXED_POINT=2.5,WASM_SCORE_FIXED_POINT=2.63,SINGLE_INLINE_SCORE_MULTIPLIER=.6,QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER=.65,INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER=.5,WORKER_SCORE_MULTIPLIER=.7,PERFORMANCE_THRESHOLDS={wasm:{noSupport:.07,inline:{c100:1,c50:.36,c20:.16,c10:.07},worker:{c100:.5,c50:.18,c20:.08,c10:.06}},simd:{noSupport:.1,inline:{c100:1,c50:.43,c20:.3,c10:.2},worker:{c100:.5,c50:.21,c20:.15,c10:.1}}};class Estimator{constructor(t,e){this.fetchConfig=t,this.logger=e;const n=`${t.paths.workers}estimator-v1.js`;this.fetchBehavior={headers:t.headers,escapedQueryString:t.escapedQueryString},this.worker=loader_js_1$1.loadWorker(n,"VoiceFocusEstimator",this.fetchBehavior,e)}roundtrip(t,e,n){return new Promise((o,a)=>{this.worker.then(s=>{let d;d=u=>{const{message:c,key:l}=u.data;c===e&&l===n&&(s.removeEventListener("message",d),o(u.data))},s.addEventListener("message",d),s.postMessage(t)}).catch(s=>{var d;(d=this.logger)===null||d===void 0||d.error("Failed to load worker.",s),a(s)})})}supportsSIMD(t){const e="simd",n=t||`${this.fetchConfig.paths.wasm}simd-v1.wasm`,o={message:"supports-simd",fetchBehavior:this.fetchBehavior,path:n,key:e};return this.roundtrip(o,"simd-support",e).then(a=>a.supports)}measure(t,e){const n=`${this.fetchConfig.paths.wasm}bench-v1.wasm`,o=`${this.fetchConfig.paths.wasm}bench-v1_simd.wasm`,a=t?o:n,s=`bench:${t}`,d={message:"measure",fetchBehavior:this.fetchBehavior,budget:e,path:a,key:s};return this.roundtrip(d,"measurement",s).then(u=>{if(u.measurement)return u.measurement;throw new Error("Failed to measure.")})}stop(){this.worker.then(t=>{var e;(e=this.logger)===null||e===void 0||e.debug("Stopping estimator worker."),t.terminate()}).catch(t=>{})}}const inlineScoreMultiplier=(r,t)=>r===1?SINGLE_INLINE_SCORE_MULTIPLIER:t==="quality"?QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER*r:INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER*r,decideExecutionApproach=({supportsSIMD:r,supportsSAB:t,duration:e,executionPreference:n="auto",simdPreference:o,variantPreference:a="auto",namePreference:s="default",usagePreference:d,executionQuantaPreference:u=DEFAULT_EXECUTION_QUANTA},c=PERFORMANCE_THRESHOLDS,l)=>{const h=o==="force"||o!=="disable"&&r,p=e!==-1,m=p?(h?SIMD_SCORE_FIXED_POINT:WASM_SCORE_FIXED_POINT)/e:0,S=h?c.simd:c.wasm,g=p?inlineScoreMultiplier(u,d)*m:0,y=p?WORKER_SCORE_MULTIPLIER*m:0,E=s,T=$=>({supported:!1,reason:$});if(p){if(m<S.noSupport)return T(`Performance score ${m} worse than threshold ${S.noSupport}.`)}else if(n==="auto"||a==="auto")return T(`Missing explicit execution (${n}) or variant (${a}) preference, but no scoring performed.`);l==null||l.debug(`Bench duration ${e} yields inline score ${g} and worker score ${y}.`);const C=($,I,A)=>({supported:!0,useSIMD:h,processor:$,executionApproach:I,variant:A,executionQuanta:I==="inline"?u:void 0,name:E}),P=($,I,A)=>I!=="auto"?!p||$>A[I]?I:"failed":$>A.c100?"c100":$>A.c50?"c50":$>A.c20?"c20":$>A.c10?"c10":"failed",x=$=>{switch($||"auto"){case"auto":{let I=x("inline"),A=x("worker");return l==null||l.debug(`Reducing auto preference: ${JSON.stringify(I)} vs ${JSON.stringify(A)}`),I.supported===!1||A.supported===!1?A:I.variant===A.variant||I.variant==="c50"?I:A}case"worker":return support_js_1$4.supportsSharedArrayBuffer(globalThis,window,l)?x("worker-sab"):x("worker-postMessage");case"inline":{const I=P(g,a,S.inline);return I==="failed"?T(`Performance score ${g} not sufficient for inline use with variant preference ${a}.`):C("voicefocus-inline-processor","inline",I)}case"worker-sab":{if(!t){const A="Requested worker-sab but no SharedArrayBuffer support.";return l==null||l.warn(A),{supported:!1,reason:A}}const I=P(y,a,S.worker);return I==="failed"?T(`Performance score ${y} not sufficient for worker use with variant preference ${a}.`):C("voicefocus-worker-sab-processor","worker-sab",I)}case"worker-postMessage":{const I=P(y,a,S.worker);if(I==="failed")return T(`Performance score ${y} not sufficient for worker use.`);if(E==="ns_es"){const A="Requested echo suppression but postMessage executor does not support it.";return l==null||l.warn(A),{supported:!1,reason:A}}return C("voicefocus-worker-postMessage-processor","worker-postMessage",I)}}};return x(n)},featureCheck=(r,t,e,n)=>__awaiter$6(void 0,void 0,void 0,function*(){const o={supportsSIMD:r,supportsSAB:support_js_1$4.supportsSharedArrayBuffer(globalThis,window,e),duration:-1};if(r)return e==null||e.info("Supports SIMD: true (force)"),o;const a=!n,s=n||new Estimator(t,e);try{const d=!support_js_1$4.isOldChrome(window,e)&&(yield s.supportsSIMD());return e==null||e.info(`Supports SIMD: ${d} (force: ${r})`),o.supportsSIMD=d,o}finally{a&&s.stop()}}),estimateAndFeatureCheck=(r,t,e,n)=>__awaiter$6(void 0,void 0,void 0,function*(){const o=new Estimator(t,n);try{const a=yield featureCheck(r,t,n,o);if(a.supportsSIMD)try{return a.duration=yield o.measure(!0,e),n==null||n.info("SIMD timing:",a.duration),a}catch{n==null||n.warn("Failed SIMD estimation; falling back to non-SIMD."),a.supportsSIMD=!1}return a.duration=yield o.measure(!1,e),n==null||n.info("No-SIMD timing:",a.duration),a}catch(a){throw n==null||n.error("Could not feature check.",a),a}finally{o.stop()}}),measureAndDecideExecutionApproach=(r,t,e,n=PERFORMANCE_THRESHOLDS)=>__awaiter$6(void 0,void 0,void 0,function*(){let o=r.executionPreference;const{usagePreference:a,variantPreference:s,namePreference:d,simdPreference:u,estimatorBudget:c,executionQuantaPreference:l}=r;a==="interactivity"&&o!=="inline"&&(e==null||e.debug(`Overriding execution preference ${o} to reflect interactivity preference.`),o="inline");const f=u==="force",h=s!=="auto",p=o!=="auto";let m;try{h&&p?m=yield featureCheck(f,t,e):m=yield estimateAndFeatureCheck(f,t,c,e)}catch(S){throw e==null||e.error("Could not load estimator.",S),new Error("Could not load Voice Focus estimator.")}return decideExecutionApproach(Object.assign(Object.assign({},m),{simdPreference:u,executionPreference:o,variantPreference:s,namePreference:d,usagePreference:a,executionQuantaPreference:l}),n,e)});decider.measureAndDecideExecutionApproach=measureAndDecideExecutionApproach;const decideModel=({category:r,name:t,variant:e,simd:n,url:o})=>`${r}-${t}-${e}-v1${n?"_simd":""}`;decider.decideModel=decideModel;var workletInlineNode={},types={};Object.defineProperty(types,"__esModule",{value:!0});types.VoiceFocusAudioWorkletNode=void 0;class VoiceFocusAudioWorkletNode extends(typeof globalThis<"u"&&globalThis.AudioWorkletNode||class{}){}types.VoiceFocusAudioWorkletNode=VoiceFocusAudioWorkletNode;var __awaiter$5=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(workletInlineNode,"__esModule",{value:!0});const support_js_1$3=support,types_js_1$2=types,CPU_WARNING_MAX_INTERVAL_MS=5*1e3;class VoiceFocusInlineNode extends types_js_1$2.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.cpuWarningCount=0,this.channelCountMode="explicit",this.channelCount=1;const{modelURL:n,worker:o,fetchBehavior:a,logger:s,delegate:d}=e;this.logger=s,this.port.onmessage=this.onProcessorMessage.bind(this),this.delegate=d,s&&s.debug("VoiceFocusInlineNode:",n),this.worker=o,this.worker.onmessage=this.onWorkerMessage.bind(this);const u=support_js_1$3.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:u,key:"model",fetchBehavior:a,path:n})}onModuleBufferLoaded(t,e){this.port.postMessage({message:"module-buffer",buffer:t,key:e})}onModuleLoaded(t,e){this.port.postMessage({message:"module",module:t,key:e})}enable(){return __awaiter$5(this,void 0,void 0,function*(){this.port.postMessage({message:"enable"})})}disable(){return __awaiter$5(this,void 0,void 0,function*(){this.port.postMessage({message:"disable"})})}stop(){var t;return __awaiter$5(this,void 0,void 0,function*(){this.port.postMessage({message:"stop"});try{(t=this.worker)===null||t===void 0||t.terminate()}catch(e){console.error("failed to terminate worker:",e)}this.disconnect()})}onProcessorMessage(t){var e,n,o;const a=t.data;switch(a.message){case"cpu":this.cpuWarningCount++;const s=Date.now(),d=this.cpuWarningLastTriggered||s,u=Math.abs(s-d);(!this.cpuWarningLastTriggered||u>CPU_WARNING_MAX_INTERVAL_MS)&&((e=this.logger)===null||e===void 0||e.warn(`CPU warning (count: ${this.cpuWarningCount}):`,a.message),this.cpuWarningCount=0,this.cpuWarningLastTriggered=s),(n=this.delegate)===null||n===void 0||n.onCPUWarning();break;default:(o=this.logger)===null||o===void 0||o.debug("Ignoring processor message.")}}onWorkerMessage(t){const e=t.data;switch(e.message){case"module-buffer":if(!e.buffer||!e.key)return;this.onModuleBufferLoaded(e.buffer,e.key);break;case"module":if(!e.module||!e.key)return;this.onModuleLoaded(e.module,e.key);break;case"stopped":this.worker&&this.worker.terminate();break;default:return}}}workletInlineNode.default=VoiceFocusInlineNode;var workletWorkerSabNode={},__awaiter$4=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(workletWorkerSabNode,"__esModule",{value:!0});const support_js_1$2=support,types_js_1$1=types,INDICES={ready:0,enabled:1},STATES={disabled:0,enabled:1,stopped:2};class VoiceFocusWorkerBufferNode extends types_js_1$1.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.channelCountMode="explicit",this.channelCount=1;const{modelURL:n,resamplerURL:o,worker:a,fetchBehavior:s,delegate:d}=e;this.delegate=d,this.worker=a,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);const{enabled:u,supportFarendStream:c}=e.processorOptions;this.worker.postMessage({message:"init",approach:"sab",frames:t.sampleRate===16e3?160:480,enabled:u,model:n,supportFarendStream:c});const l=support_js_1$2.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:l,key:"resampler",fetchBehavior:s,path:o})}enable(){return __awaiter$4(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,INDICES.enabled,STATES.enabled),Atomics.notify(this.state,INDICES.ready,1)):this.worker.postMessage({message:"enable"})})}disable(){return __awaiter$4(this,void 0,void 0,function*(){this.state?(Atomics.store(this.state,INDICES.enabled,STATES.disabled),Atomics.notify(this.state,INDICES.ready,1)):this.worker.postMessage({message:"disable"})})}stop(){return __awaiter$4(this,void 0,void 0,function*(){if(this.state)Atomics.store(this.state,INDICES.enabled,STATES.stopped),Atomics.notify(this.state,INDICES.ready,1);else try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}onWorkerMessage(t){var e;const n=t.data;switch(n.message){case"ready":if(!n.shared)throw new Error("No shared state.");this.state=new Int32Array(n.shared.state),this.port.postMessage(n);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(n);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"processing":this.port.postMessage(n);break;default:return}}onProcessorMessage(t){var e;const n=t.data;switch(n.message){case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(n);break}}}workletWorkerSabNode.default=VoiceFocusWorkerBufferNode;var workletWorkerPostMessageNode={},__awaiter$3=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(workletWorkerPostMessageNode,"__esModule",{value:!0});const support_js_1$1=support,types_js_1=types;class VoiceFocusWorkerPostMessageNode extends types_js_1.VoiceFocusAudioWorkletNode{constructor(t,e){super(t,e.processor,e),this.channelCountMode="explicit",this.channelCount=1;const{modelURL:n,audioBufferURL:o,worker:a,fetchBehavior:s,delegate:d}=e;this.delegate=d,this.worker=a,this.worker.onmessage=this.onWorkerMessage.bind(this),this.port.onmessage=this.onProcessorMessage.bind(this);const{enabled:u,agc:c,supportFarendStream:l}=e.processorOptions;this.worker.postMessage({message:"init",approach:"postMessage",frames:t.sampleRate===16e3?160:480,enabled:u,agc:c,fetchBehavior:s,model:n,supportFarendStream:l});const f=support_js_1$1.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";this.worker.postMessage({message:f,key:"buffer",fetchBehavior:s,path:o})}enable(){return __awaiter$3(this,void 0,void 0,function*(){this.worker.postMessage({message:"enable"})})}disable(){return __awaiter$3(this,void 0,void 0,function*(){this.worker.postMessage({message:"disable"})})}stop(){return __awaiter$3(this,void 0,void 0,function*(){try{this.worker.postMessage({message:"stop"})}catch{}this.disconnect()})}onWorkerMessage(t){var e;const n=t.data;switch(n.message){case"ready":this.port.postMessage({message:"ready",shared:n.shared},n.shared?Object.values(n.shared):[]);break;case"data":if(!n.buffer)return;this.port.postMessage({message:"data",buffer:n.buffer},[n.buffer]);break;case"stopped":this.worker.terminate();break;case"module-buffer":case"module":this.port.postMessage(n);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"processing":this.port.postMessage(n);break;default:return}}onProcessorMessage(t){var e;const n=t.data;switch(n.message){case"data":if(!n.buffer)return;this.worker.postMessage({message:"data",buffer:n.buffer},[n.buffer]);break;case"cpu":(e=this.delegate)===null||e===void 0||e.onCPUWarning();break;case"prepare-for-frames":this.worker.postMessage(n);break;default:return}}}workletWorkerPostMessageNode.default=VoiceFocusWorkerPostMessageNode;var __awaiter$2=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(voicefocus,"__esModule",{value:!0});voicefocus.getAudioInput=voicefocus.createAudioContext=voicefocus.VoiceFocus=void 0;const decider_js_1=decider,fetch_js_1=fetch$1,loader_js_1=loader,support_js_1=support,worklet_inline_node_js_1=workletInlineNode,worklet_worker_sab_node_js_1=workletWorkerSabNode,worklet_worker_postMessage_node_js_1=workletWorkerPostMessageNode,DEFAULT_AGC_DISABLED_SETTING={useVoiceFocusAGC:!1,useBuiltInAGC:!0},DEFAULT_AGC_SETTING=DEFAULT_AGC_DISABLED_SETTING,DEFAULT_ASSET_GROUP="stable-v1",DEFAULT_CDN="https://static.sdkassets.chime.aws",DEFAULT_PATHS={processors:`${DEFAULT_CDN}/processors/`,workers:`${DEFAULT_CDN}/workers/`,wasm:`${DEFAULT_CDN}/wasm/`,models:`${DEFAULT_CDN}/wasm/`},DEFAULT_CONTEXT_HINT={latencyHint:0},BASE_AUDIO_CONSTRAINTS={channelCount:1,echoCancellation:!0,googEchoCancellation:!0,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googTypingNoiseDetection:!1},DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC=Object.assign(Object.assign({},BASE_AUDIO_CONSTRAINTS),{autoGainControl:!0,googAutoGainControl:!0,googAutoGainControl2:!0}),DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC=Object.assign(Object.assign({},BASE_AUDIO_CONSTRAINTS),{autoGainControl:!1,googAutoGainControl:!1,googAutoGainControl2:!1}),PROCESSORS={"voicefocus-worker-sab-processor":{file:"worklet-worker-sab-processor-v1.js",node:worklet_worker_sab_node_js_1.default},"voicefocus-worker-postMessage-processor":{file:"worklet-worker-postMessage-processor-v1.js",node:worklet_worker_postMessage_node_js_1.default},"voicefocus-inline-processor":{file:"worklet-inline-processor-v1.js",node:worklet_inline_node_js_1.default}},validateAssetSpec=(r,t)=>{if(r!==void 0&&!fetch_js_1.isValidAssetGroup(r))throw new Error(`Invalid asset group ${r}`);if(t!==void 0&&!fetch_js_1.isValidRevisionID(t))throw new Error(`Invalid revision ID ${t}`)},mungeConstraints=(r,t)=>{let e;if(t.useBuiltInAGC?e=DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC:e=DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC,!r)return{audio:e};if(!r.audio)return r;if(r.video)throw new Error("Not adding Voice Focus to multi-device getUserMedia call.");return Object.assign(Object.assign({},r),{audio:r.audio===!0?e:Object.assign(Object.assign({},r.audio),e)})},urlForModel=(r,t)=>`${t.models}${decider_js_1.decideModel(r)}.wasm`;class VoiceFocus{constructor(t,e,n,o,a){this.processorURL=e,this.nodeConstructor=n,this.nodeOptions=o,this.executionQuanta=a,this.internal={worker:t,nodeOptions:o}}static isSupported(t,e){const{fetchBehavior:n,logger:o}=e||{};if(typeof globalThis>"u")return o==null||o.debug("Browser does not have globalThis."),Promise.resolve(!1);if(!support_js_1.supportsAudioWorklet(globalThis,o))return o==null||o.debug("Browser does not support Audio Worklet."),Promise.resolve(!1);if(!support_js_1.supportsWASM(globalThis,o))return o==null||o.debug("Browser does not support WASM."),Promise.resolve(!1);support_js_1.supportsWASMStreaming(globalThis,o)||o==null||o.debug("Browser does not support streaming WASM compilation.");const{assetGroup:a=DEFAULT_ASSET_GROUP,revisionID:s,paths:d=DEFAULT_PATHS}=t||{};validateAssetSpec(a,s);const u=s?{revisionID:s}:{assetGroup:a},c=fetch_js_1.addQueryParams(n,u),l=Object.assign(Object.assign({},c),{paths:d});return support_js_1.supportsVoiceFocusWorker(globalThis,l,o)}static mungeExecutionPreference(t,e){const n=t===void 0||t==="auto";if(support_js_1.isSafari(globalThis)){if(n||t==="inline")return"inline";if(!n)throw new Error(`Unsupported execution preference ${t}`)}if(t==="worker-sab"&&!support_js_1.supportsSharedArrayBuffer(globalThis,globalThis,e))throw new Error(`Unsupported execution preference ${t}`);return t||"auto"}static configure(t,e){return __awaiter$2(this,void 0,void 0,function*(){const{fetchBehavior:n,preResolve:o,logger:a}=e||{},{category:s="voicefocus",name:d="default",variant:u="auto",assetGroup:c=DEFAULT_ASSET_GROUP,revisionID:l,simd:f="detect",executionPreference:h="auto",executionQuantaPreference:p,usagePreference:m="interactivity",estimatorBudget:S=100,paths:g=DEFAULT_PATHS,thresholds:y}=t||{};if(a==null||a.debug("Configuring Voice Focus with spec",t),s!==void 0&&s!=="voicefocus")throw new Error(`Unrecognized category ${s}`);if(d!==void 0&&d!=="default"&&d!=="ns_es")throw new Error(`Unrecognized feature name ${d}`);if(u!==void 0&&!["auto","c100","c50","c20","c10"].includes(u))throw new Error(`Unrecognized feature variant ${u}`);if(p!==void 0&&![1,2,3].includes(p))throw new Error(`Unrecognized execution quanta preference ${p}`);if(validateAssetSpec(c,l),f!==void 0&&!["detect","force","disable"].includes(f))throw new Error(`Unrecognized SIMD option ${f}`);if(h!==void 0&&!["auto","inline","worker","worker-sab","worker-postMessage"].includes(h))throw new Error(`Unrecognized execution preference ${h}`);if(m!==void 0&&!["quality","interactivity"].includes(m))throw new Error(`Unrecognized usage preference ${m}`);const E={executionPreference:this.mungeExecutionPreference(h,a),usagePreference:m,executionQuantaPreference:p,variantPreference:u,namePreference:d,simdPreference:f,estimatorBudget:S},T=l?{revisionID:l}:{assetGroup:c},C=fetch_js_1.addQueryParams(n,T),P=Object.assign({paths:g},C),x=yield decider_js_1.measureAndDecideExecutionApproach(E,P,a,y);if(x.supported===!1)return{supported:!1,reason:x.reason};a==null||a.info("Decided execution approach",x);const{useSIMD:$,processor:I,variant:A,executionQuanta:v}=x,b={category:s||"voicefocus",name:d||"default",variant:A,simd:$};if(o){const k=urlForModel(b,g);b.url=yield fetch_js_1.resolveURL(k,C)}return{fetchConfig:P,model:b,processor:I,executionQuanta:v,supported:!0}})}static init(t,{delegate:e,preload:n=!0,logger:o}){return __awaiter$2(this,void 0,void 0,function*(){if(t.supported===!1)throw new Error("Voice Focus not supported. Reason: "+t.reason);const{model:a,processor:s,fetchConfig:d,executionQuanta:u}=t,{simd:c,name:l}=a,{paths:f}=d;if(s!=="voicefocus-inline-processor"&&s!=="voicefocus-worker-postMessage-processor"&&s!=="voicefocus-worker-sab-processor")throw new Error(`Unknown processor ${s}`);const h=a.url||urlForModel(a,f);o==null||o.debug(`Using model URL ${h}.`);const p=`${f.wasm}audio_buffer-v1${c?"_simd":""}.wasm`,m=`${f.wasm}resampler-v1${c?"_simd":""}.wasm`,S=`${f.workers}worker-v1.js`,{file:g,node:y}=PROCESSORS[s],E=`${f.processors}${g}`,T=yield loader_js_1.loadWorker(S,"VoiceFocusWorker",d,o);if(n){o==null||o.debug("Preloading",h);let $=support_js_1.supportsWASMPostMessage(globalThis)?"get-module":"get-module-buffer";T.postMessage({message:$,preload:!0,key:"model",fetchBehavior:d,path:h})}const P={processor:s,worker:T,audioBufferURL:p,resamplerURL:m,fetchBehavior:d,modelURL:h,delegate:e,logger:o,numberOfInputs:l==="ns_es"?2:1},x=new VoiceFocus(T,E,y,P,u);return Promise.resolve(x)})}createNode(t,e){var n;const{voiceFocusSampleRate:o=t.sampleRate===16e3?16e3:48e3,enabled:a=!0,agc:s=DEFAULT_AGC_SETTING}=e||{},d=e==null?void 0:e.es,u={voiceFocusSampleRate:o,enabled:a,sendBufferCount:10,prefill:6,agc:s,executionQuanta:this.executionQuanta,supportFarendStream:d},c=fetch_js_1.withQueryString(this.processorURL,(n=this.nodeOptions)===null||n===void 0?void 0:n.fetchBehavior);return t.audioWorklet.addModule(c).then(()=>new this.nodeConstructor(t,Object.assign(Object.assign({},this.nodeOptions),{processorOptions:u})))}applyToStream(t,e,n){return __awaiter$2(this,void 0,void 0,function*(){const o=e.createMediaStreamSource(t),a=yield this.applyToSourceNode(o,e,n),s=e.createMediaStreamDestination();return a.connect(s),{node:a,source:o,destination:s,stream:s.stream}})}applyToSourceNode(t,e,n){return __awaiter$2(this,void 0,void 0,function*(){const o=yield this.createNode(e,n);return t.connect(o),o})}}voicefocus.VoiceFocus=VoiceFocus;const createAudioContext=(r=DEFAULT_CONTEXT_HINT)=>new(window.AudioContext||window.webkitAudioContext)(r);voicefocus.createAudioContext=createAudioContext;const getAudioInput=(r,t,e)=>__awaiter$2(void 0,void 0,void 0,function*(){var n,o;const{constraints:a,spec:s,delegate:d,preload:u=!0,options:c}=t,{logger:l}=e,f=yield VoiceFocus.configure(s,e);if(!f.supported)return(n=e.logger)===null||n===void 0||n.warn("Voice Focus not supported; returning standard stream."),window.navigator.mediaDevices.getUserMedia(a);const h=yield VoiceFocus.init(f,{delegate:d,preload:u,logger:l}),p=((o=t.options)===null||o===void 0?void 0:o.agc)||DEFAULT_AGC_SETTING,m=yield window.navigator.mediaDevices.getUserMedia(mungeConstraints(a,p));return h.applyToStream(m,r,c).then(S=>S.stream)});voicefocus.getAudioInput=getAudioInput;var LoggerAdapter$1={};Object.defineProperty(LoggerAdapter$1,"__esModule",{value:!0});function stringify(r){return r.map(t=>typeof t=="object"?JSON.stringify(t):`${t}`).join(" ")}class LoggerAdapter{constructor(t){this.base=t}debug(...t){this.base.debug(stringify(t))}info(...t){this.base.info(stringify(t))}warn(...t){this.base.warn(stringify(t))}error(...t){this.base.error(stringify(t))}}LoggerAdapter$1.default=LoggerAdapter;var VoiceFocusTransformDevice$1={},__awaiter$1=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(VoiceFocusTransformDevice$1,"__esModule",{value:!0});const DefaultBrowserBehavior_1=DefaultBrowserBehavior$1;class VoiceFocusTransformDevice{constructor(t,e,n,o,a=!1,s=void 0,d=new DefaultBrowserBehavior_1.default,u=new Map,c=void 0,l=void 0){this.device=t,this.voiceFocus=e,this.delegate=n,this.nodeOptions=o,this.failed=a,this.node=s,this.browserBehavior=d,this.farEndStreamToAudioSourceNode=u,this.mixDestNode=c,this.mixSourceNode=l}getInnerDevice(){return this.device}mute(t){return __awaiter$1(this,void 0,void 0,function*(){!this.node||(t?yield this.node.disable():yield this.node.enable())})}stop(){return __awaiter$1(this,void 0,void 0,function*(){!this.node||(this.node.disconnect(),yield this.node.stop())})}chooseNewInnerDevice(t){return __awaiter$1(this,void 0,void 0,function*(){return this.device===t&&!isDefaultDevice(t)?this:new VoiceFocusTransformDevice(t,this.voiceFocus,this.delegate,this.nodeOptions,this.failed,this.node,this.browserBehavior,this.farEndStreamToAudioSourceNode,this.mixDestNode,this.mixSourceNode)})}intrinsicDevice(){return __awaiter$1(this,void 0,void 0,function*(){if(this.failed)return this.device;const t=this.nodeOptions.es,e={echoCancellation:!t,googEchoCancellation:!t,googEchoCancellation2:!t,noiseSuppression:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googNoiseSuppression2:!1};let n;return this.nodeOptions&&this.nodeOptions.agc!==void 0?n=this.nodeOptions.agc.useBuiltInAGC:n=!0,e.autoGainControl=n,e.googAutoGainControl=n,e.googAutoGainControl2=n,this.device?typeof this.device=="string"?(this.browserBehavior.requiresNoExactMediaStreamConstraints()?e.deviceId=this.device:e.deviceId={exact:this.device},e):this.device.id?this.device:Object.assign(Object.assign({},this.device),e):e})}createAudioNode(t){var e,n;return __awaiter$1(this,void 0,void 0,function*(){if(((e=this.node)===null||e===void 0?void 0:e.context)===t)return{start:this.node,end:this.node};const a=Object.assign({enabled:!0,agc:{useVoiceFocusAGC:!1}},this.nodeOptions);try{if((n=this.node)===null||n===void 0||n.disconnect(),this.node=yield this.voiceFocus.createNode(t,a),this.nodeOptions.es){this.mixDestNode=new MediaStreamAudioDestinationNode(t,{channelCount:1,channelCountMode:"explicit"});for(const u of this.farEndStreamToAudioSourceNode.keys())this.assignFarEndStreamToAudioSourceNode(u);this.createMixSourceNode()}const s=this.node,d=this.node;return{start:s,end:d}}catch(s){throw this.failed=!0,this.delegate.onFallback(this,s),s}})}observeMeetingAudio(t){return __awaiter$1(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;t.addAudioMixObserver(this);const e=yield t.getCurrentMeetingAudioStream();e&&this.addFarEndStream(e)})}unObserveMeetingAudio(t){return __awaiter$1(this,void 0,void 0,function*(){if(!this.nodeOptions.es)return;t.removeAudioMixObserver(this);const e=yield t.getCurrentMeetingAudioStream();e&&this.removeFarendStream(e)})}addObserver(t){this.delegate.addObserver(t)}removeObserver(t){this.delegate.removeObserver(t)}addFarEndStream(t){return __awaiter$1(this,void 0,void 0,function*(){!this.nodeOptions.es||!t||this.farEndStreamToAudioSourceNode.has(t)||(this.node?this.assignFarEndStreamToAudioSourceNode(t):this.farEndStreamToAudioSourceNode.set(t,null))})}removeFarendStream(t){var e;return __awaiter$1(this,void 0,void 0,function*(){(e=this.farEndStreamToAudioSourceNode.get(t))===null||e===void 0||e.disconnect(),this.farEndStreamToAudioSourceNode.delete(t)})}meetingAudioStreamBecameActive(t){return __awaiter$1(this,void 0,void 0,function*(){this.addFarEndStream(t)})}meetingAudioStreamBecameInactive(t){return __awaiter$1(this,void 0,void 0,function*(){this.removeFarendStream(t)})}assignFarEndStreamToAudioSourceNode(t){const e=this.node.context.createMediaStreamSource(t);e.channelCount=1,e.channelCountMode="explicit",this.farEndStreamToAudioSourceNode.set(t,e),e.connect(this.mixDestNode,0)}createMixSourceNode(){this.mixSourceNode=this.node.context.createMediaStreamSource(this.mixDestNode.stream),this.mixSourceNode.channelCount=1,this.mixSourceNode.channelCountMode="explicit",this.mixSourceNode.connect(this.node,0,1)}}function isDefaultDevice(r){return r==="default"?!0:!r||typeof r!="object"?!1:"deviceId"in r&&r.deviceId==="default"||"id"in r&&r.id==="default"}VoiceFocusTransformDevice$1.default=VoiceFocusTransformDevice;var VoiceFocusTransformDeviceDelegate$1={};Object.defineProperty(VoiceFocusTransformDeviceDelegate$1,"__esModule",{value:!0});class VoiceFocusTransformDeviceDelegate{constructor(){this.observers=new Set}addObserver(t){this.observers.add(t)}removeObserver(t){this.observers.delete(t)}onFallback(t,e){var n;for(const o of this.observers)(n=o.voiceFocusFellBackToInnerStream)===null||n===void 0||n.call(o,t,e)}onCPUWarning(){var t;for(const e of this.observers)(t=e.voiceFocusInsufficientResources)===null||t===void 0||t.call(e)}}VoiceFocusTransformDeviceDelegate$1.default=VoiceFocusTransformDeviceDelegate;var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(r,t,e,n){function o(a){return a instanceof e?a:new e(function(s){s(a)})}return new(e||(e=Promise))(function(a,s){function d(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?a(l.value):o(l.value).then(d,u)}c((n=n.apply(r,t||[])).next())})};Object.defineProperty(VoiceFocusDeviceTransformer$1,"__esModule",{value:!0});VoiceFocusDeviceTransformer$1.VoiceFocusDeviceTransformer=void 0;const voicefocus_1=voicefocus,Utils_1=Utils,Versioning_1=Versioning$1,LoggerAdapter_1=LoggerAdapter$1,VoiceFocusTransformDevice_1=VoiceFocusTransformDevice$1,VoiceFocusTransformDeviceDelegate_1=VoiceFocusTransformDeviceDelegate$1;class VoiceFocusDeviceTransformer{constructor(t,{preload:e=!0,logger:n,fetchBehavior:o=VoiceFocusDeviceTransformer.defaultFetchBehavior()},a){this.spec=t,this.supported=!0,this.logger=n,this.vfLogger=n?new LoggerAdapter_1.default(n):void 0,this.preload=e,this.fetchBehavior=o,this.spec=VoiceFocusDeviceTransformer.augmentSpec(this.spec),a&&(this.configuration=Promise.resolve(a))}static isSupported(t,e){var n,o;const a=VoiceFocusDeviceTransformer.defaultFetchBehavior(),s=e!=null&&e.logger?new LoggerAdapter_1.default(e.logger):void 0,d={fetchBehavior:a,logger:s};if(Utils_1.isIFramed()){if((e==null?void 0:e.allowIFrame)===!1)return(n=e==null?void 0:e.logger)===null||n===void 0||n.error("Amazon Voice Focus support check inside iframe: not supported."),Promise.resolve(!1);(o=e==null?void 0:e.logger)===null||o===void 0||o.warn("Amazon Voice Focus support check inside iframe: not recommended.")}return voicefocus_1.VoiceFocus.isSupported(VoiceFocusDeviceTransformer.augmentSpec(t),d)}static create(t={},e={},n,o,a){var s,d,u;return __awaiter(this,void 0,void 0,function*(){o&&o.Meeting.Meeting&&(o=o.Meeting);const c=((u=(d=(s=o==null?void 0:o.Meeting)===null||s===void 0?void 0:s.MeetingFeatures)===null||d===void 0?void 0:d.Audio)===null||u===void 0?void 0:u.EchoReduction)==="AVAILABLE",l=n&&n.supported===!0&&n.model.name==="ns_es"&&!c,f=t.name==="ns_es"&&!c;if(l||f)throw new Error("Echo Reduction requested but not enabled.");const h=new VoiceFocusDeviceTransformer(t,e,n);return yield h.init(),h})}static configure(t={},e={}){return __awaiter(this,void 0,void 0,function*(){return new VoiceFocusDeviceTransformer(t,e,void 0).configure(!0)})}getConfiguration(){return this.configuration}isSupported(){return this.supported}createTransformDevice(t,e){return __awaiter(this,void 0,void 0,function*(){if(!!this.supported)try{const[o,a]=yield this.allocateVoiceFocus(!0),s=Object.assign(Object.assign({},e),{es:this.spec.name==="ns_es"});return new VoiceFocusTransformDevice_1.default(t,o,a,s)}catch{return}})}static augmentSpec(t){return!t||!t.assetGroup&&!t.revisionID?Object.assign(Object.assign({},t),{assetGroup:VoiceFocusDeviceTransformer.currentSDKAssetGroup()}):t}configure(t=!1){return __awaiter(this,void 0,void 0,function*(){const e={fetchBehavior:this.fetchBehavior,preResolve:t,logger:this.vfLogger};return voicefocus_1.VoiceFocus.configure(this.spec,e)})}init(){var t;return __awaiter(this,void 0,void 0,function*(){this.configuration||(this.configuration=this.configure());const e=yield this.configuration;if(!e.supported){this.supported=!1;return}this.pendingVoiceFocus=this.createVoiceFocus(e,this.preload);try{yield this.pendingVoiceFocus}catch(n){(t=this.logger)===null||t===void 0||t.error(`Unable to initialize Amazon Voice Focus: ${n}`),this.supported=!1}})}createVoiceFocus(t,e){return __awaiter(this,void 0,void 0,function*(){const n=new VoiceFocusTransformDeviceDelegate_1.default;return[yield voicefocus_1.VoiceFocus.init(t,{delegate:n,preload:e,logger:this.vfLogger}),n]})}allocateVoiceFocus(t){return __awaiter(this,void 0,void 0,function*(){if(!this.supported)throw new Error("Not supported.");if(this.pendingVoiceFocus){const e=this.pendingVoiceFocus;return this.pendingVoiceFocus=void 0,e}return this.createVoiceFocus(yield this.configuration,t)})}static majorVersion(){return Versioning_1.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|[1-9][0-9]*)/)[0]}static majorMinorVersion(){return Versioning_1.default.sdkVersion.match(/^[1-9][0-9]*\.(?:0|(?:[1-9][0-9]*))\.(?:0|[1-9][0-9]*)/)[0]}static currentSDKAssetGroup(){const t=this.majorVersion();return t?`sdk-${t}`:"stable-v1"}static defaultFetchBehavior(){const t=VoiceFocusDeviceTransformer.majorMinorVersion()||"unknown",e=Versioning_1.default.sdkUserAgentLowResolution;return{escapedQueryString:`sdk=${encodeURIComponent(t)}&ua=${encodeURIComponent(e)}`}}}VoiceFocusDeviceTransformer$1.VoiceFocusDeviceTransformer=VoiceFocusDeviceTransformer;VoiceFocusDeviceTransformer$1.default=VoiceFocusDeviceTransformer;var hasRequiredBuild;function requireBuild(){return hasRequiredBuild||(hasRequiredBuild=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.DefaultEventController=r.DefaultDevicePixelRatioMonitor=r.DefaultDeviceController=r.DefaultContentShareController=r.DefaultBrowserBehavior=r.DefaultAudioVideoFacade=r.DefaultAudioVideoController=r.DefaultAudioMixController=r.DefaultActiveSpeakerPolicy=r.DefaultActiveSpeakerDetector=r.DataMessage=r.CreateSDPTask=r.CreatePeerConnectionTask=r.ContentShareMediaStreamBroker=r.ContentShareConstants=r.ConsoleLogger=r.ConnectionHealthPolicyConfiguration=r.ConnectionHealthData=r.ClientVideoStreamReceivingReport=r.ClientMetricReportMediaType=r.ClientMetricReportDirection=r.ClientMetricReport=r.CleanStoppedSessionTask=r.CleanRestartedSessionTask=r.CheckVideoInputFeedback=r.CheckVideoConnectivityFeedback=r.CheckNetworkUDPConnectivityFeedback=r.CheckNetworkTCPConnectivityFeedback=r.CheckContentShareConnectivityFeedback=r.CheckCameraResolutionFeedback=r.CheckAudioOutputFeedback=r.CheckAudioInputFeedback=r.CheckAudioConnectivityFeedback=r.CanvasVideoFrameBuffer=r.CSPMonitor=r.BitrateParameters=r.BaseTask=r.BaseConnectionHealthPolicy=r.BackgroundReplacementVideoFrameProcessor=r.BackgroundFilterVideoFrameProcessor=r.BackgroundBlurVideoFrameProcessor=r.BackgroundBlurStrength=r.AudioVideoControllerState=r.AudioProfile=r.AudioLogEvent=r.Attendee=r.AttachMediaInputTask=r.AsyncScheduler=r.ApplicationMetadata=r.AllHighestVideoBandwidthPolicy=void 0,r.MeetingSessionCredentials=r.MeetingSessionConfiguration=r.MeetingReadinessCheckerConfiguration=r.MeetingEventsClientConfiguration=r.MediaDeviceProxyHandler=r.Maybe=r.LogLevel=r.Log=r.ListenForVolumeIndicatorsTask=r.LeaveAndReceiveLeaveAckTask=r.JoinAndReceiveIndexTask=r.IntervalScheduler=r.InMemoryJSONEventBuffer=r.GlobalMetricReport=r.GetUserMediaError=r.FullJitterLimitedBackoff=r.FullJitterBackoffFactory=r.FullJitterBackoff=r.FinishGatheringICECandidatesTask=r.EventIngestionConfiguration=r.EventBufferConfiguration=r.DeviceSelection=r.DevicePixelRatioWindowSource=r.DefaultWebSocketAdapter=r.DefaultVolumeIndicatorAdapter=r.DefaultVideoTransformDevice=r.DefaultVideoTileFactory=r.DefaultVideoTileController=r.DefaultVideoTile=r.DefaultVideoStreamIndex=r.DefaultVideoStreamIdSet=r.DefaultVideoFrameProcessorPipeline=r.DefaultVideoCaptureAndEncodeParameter=r.DefaultUserAgentParser=r.DefaultTranscriptionController=r.DefaultTransceiverController=r.DefaultSimulcastUplinkPolicyForContentShare=r.DefaultSimulcastUplinkPolicy=r.DefaultSignalingClient=r.DefaultSigV4=r.DefaultSessionStateController=r.DefaultReconnectController=r.DefaultRealtimeController=r.DefaultPingPong=r.DefaultModality=r.DefaultMessagingSession=r.DefaultMeetingSession=r.DefaultMeetingReadinessChecker=r.DefaultMeetingEventReporter=r.DefaultMediaDeviceFactory=void 0,r.SendAndReceiveDataMessagesTask=r.SDPMediaSection=r.SDPCandidateType=r.SDP=r.RunnableTask=r.ReconnectionHealthPolicy=r.ReceiveVideoStreamIndexTask=r.ReceiveVideoInputTask=r.ReceiveTURNCredentialsTask=r.ReceiveAudioInputTask=r.RealtimeVolumeIndicator=r.RealtimeState=r.RealtimeAttendeePositionInFrame=r.PromoteToPrimaryMeetingTask=r.PromiseQueue=r.PrefetchOn=r.PermissionDeniedError=r.ParallelGroupTask=r.POSTLogger=r.OverconstrainedError=r.OpenSignalingConnectionTask=r.OnceTask=r.NotReadableError=r.NotFoundError=r.None=r.NoVideoUplinkBandwidthPolicy=r.NoVideoDownlinkBandwidthPolicy=r.NoOpVideoFrameProcessor=r.NoOpVideoElementFactory=r.NoOpTask=r.NoOpMediaStreamBroker=r.NoOpLogger=r.NoOpEventReporter=r.NoOpDeviceController=r.NoOpDebugLogger=r.NoOpAudioVideoController=r.NScaleVideoUplinkBandwidthPolicy=r.MutableVideoPreferences=r.MultiLogger=r.MonitorTask=r.ModelSpecBuilder=r.MessagingSessionConfiguration=r.Message=r.MeetingSessionVideoAvailability=r.MeetingSessionURLs=r.MeetingSessionTURNCredentials=r.MeetingSessionStatusCode=r.MeetingSessionStatus=r.MeetingSessionLifecycleEventCondition=r.MeetingSessionLifecycleEvent=void 0,r.VideoStreamDescription=r.VideoSource=r.VideoQualitySettings=r.VideoPriorityBasedPolicyConfig=r.VideoPriorityBasedPolicy=r.VideoPreferences=r.VideoPreference=r.VideoOnlyTransceiverController=r.VideoLogEvent=r.VideoCodecCapability=r.VideoAdaptiveProbePolicy=r.Versioning=r.UnusableAudioWarningConnectionHealthPolicy=r.TypeError=r.TranscriptionStatusType=r.TranscriptionStatus=r.TranscriptResult=r.TranscriptLanguageWithScore=r.TranscriptItemType=r.TranscriptItem=r.TranscriptEntity=r.TranscriptAlternative=r.Transcript=r.TimeoutTask=r.TimeoutScheduler=r.TaskStatus=r.TargetDisplaySize=r.SubscribeAndReceiveSubscribeAckTask=r.StreamMetricReport=r.Some=r.SingleNodeAudioTransformDevice=r.SimulcastVideoStreamIndex=r.SimulcastTransceiverController=r.SimulcastLayers=r.SimulcastContentShareTransceiverController=r.SignalingClientVideoSubscriptionConfiguration=r.SignalingClientSubscribe=r.SignalingClientJoin=r.SignalingClientEventType=r.SignalingClientEvent=r.SignalingClientConnectionRequest=r.SignalingAndMetricsConnectionMonitor=r.SetRemoteDescriptionTask=r.SetLocalDescriptionTask=r.SessionStateControllerTransitionResult=r.SessionStateControllerState=r.SessionStateControllerDeferPriority=r.SessionStateControllerAction=r.ServerSideNetworkAdaption=r.SerialGroupTask=void 0,r.isVideoTransformDevice=r.isDestroyable=r.isAudioTransformDevice=r.ZLIBTextCompressor=r.WebSocketReadyState=r.WaitForAttendeePresenceTask=r.VoiceFocusTransformDevice=r.VoiceFocusDeviceTransformer=r.VideoTileState=void 0;const t=AllHighestVideoBandwidthPolicy$1;r.AllHighestVideoBandwidthPolicy=t.default;const e=ApplicationMetadata$1;r.ApplicationMetadata=e.default;const n=AsyncScheduler$1;r.AsyncScheduler=n.default;const o=AttachMediaInputTask$1;r.AttachMediaInputTask=o.default;const a=Attendee$1;r.Attendee=a.default;const s=AudioLogEvent;r.AudioLogEvent=s.default;const d=AudioProfile$1;r.AudioProfile=d.default;const u=AudioVideoControllerState$1;r.AudioVideoControllerState=u.default;const c=BackgroundBlurStrength;r.BackgroundBlurStrength=c.default;const l=BackgroundBlurVideoFrameProcessor$1;r.BackgroundBlurVideoFrameProcessor=l.default;const f=BackgroundFilterVideoFrameProcessor$1;r.BackgroundFilterVideoFrameProcessor=f.default;const h=BackgroundReplacementVideoFrameProcessor$1;r.BackgroundReplacementVideoFrameProcessor=h.default;const p=BaseConnectionHealthPolicy$1;r.BaseConnectionHealthPolicy=p.default;const m=BaseTask$1;r.BaseTask=m.default;const S=BitrateParameters$1;r.BitrateParameters=S.default;const g=CSPMonitor$1;r.CSPMonitor=g.default;const y=CanvasVideoFrameBuffer$1;r.CanvasVideoFrameBuffer=y.default;const E=CheckAudioConnectivityFeedback;r.CheckAudioConnectivityFeedback=E.default;const T=CheckAudioInputFeedback;r.CheckAudioInputFeedback=T.default;const C=CheckAudioOutputFeedback;r.CheckAudioOutputFeedback=C.default;const P=CheckCameraResolutionFeedback;r.CheckCameraResolutionFeedback=P.default;const x=CheckContentShareConnectivityFeedback;r.CheckContentShareConnectivityFeedback=x.default;const $=CheckNetworkTCPConnectivityFeedback;r.CheckNetworkTCPConnectivityFeedback=$.default;const I=CheckNetworkUDPConnectivityFeedback;r.CheckNetworkUDPConnectivityFeedback=I.default;const A=CheckVideoConnectivityFeedback;r.CheckVideoConnectivityFeedback=A.default;const v=CheckVideoInputFeedback;r.CheckVideoInputFeedback=v.default;const b=CleanRestartedSessionTask$1;r.CleanRestartedSessionTask=b.default;const k=CleanStoppedSessionTask$1;r.CleanStoppedSessionTask=k.default;const D=ClientMetricReport$1;r.ClientMetricReport=D.default;const R=ClientMetricReportDirection;r.ClientMetricReportDirection=R.default;const O=ClientMetricReportMediaType;r.ClientMetricReportMediaType=O.default;const B=ClientVideoStreamReceivingReport$1;r.ClientVideoStreamReceivingReport=B.default;const F=ConnectionHealthData$1;r.ConnectionHealthData=F.default;const ie=ConnectionHealthPolicyConfiguration$1;r.ConnectionHealthPolicyConfiguration=ie.default;const V=ConsoleLogger$1;r.ConsoleLogger=V.default;const X=ContentShareConstants$1;r.ContentShareConstants=X.default;const re=ContentShareMediaStreamBroker$1;r.ContentShareMediaStreamBroker=re.default;const z=CreatePeerConnectionTask$1;r.CreatePeerConnectionTask=z.default;const oe=CreateSDPTask$1;r.CreateSDPTask=oe.default;const le=DataMessage$1;r.DataMessage=le.default;const q=DefaultActiveSpeakerDetector$1;r.DefaultActiveSpeakerDetector=q.default;const ce=DefaultActiveSpeakerPolicy$1;r.DefaultActiveSpeakerPolicy=ce.default;const de=DefaultAudioMixController$1;r.DefaultAudioMixController=de.default;const me=requireDefaultAudioVideoController();r.DefaultAudioVideoController=me.default;const ee=DefaultAudioVideoFacade$1;r.DefaultAudioVideoFacade=ee.default;const ve=DefaultBrowserBehavior$1;r.DefaultBrowserBehavior=ve.default;const fe=DefaultContentShareController$1;r.DefaultContentShareController=fe.default;const Ce=DefaultDeviceController$1;r.DefaultDeviceController=Ce.default;const _e=DefaultDevicePixelRatioMonitor$1;r.DefaultDevicePixelRatioMonitor=_e.default;const he=DefaultEventController$1;r.DefaultEventController=he.default;const ae=DefaultMediaDeviceFactory$1;r.DefaultMediaDeviceFactory=ae.default;const Te=DefaultMeetingEventReporter$1;r.DefaultMeetingEventReporter=Te.default;const be=DefaultMeetingReadinessChecker$1;r.DefaultMeetingReadinessChecker=be.default;const ye=requireDefaultMeetingSession();r.DefaultMeetingSession=ye.default;const ne=DefaultMessagingSession$1;r.DefaultMessagingSession=ne.default;const ue=DefaultModality$1;r.DefaultModality=ue.default;const ge=DefaultPingPong$1;r.DefaultPingPong=ge.default;const N=DefaultRealtimeController$1;r.DefaultRealtimeController=N.default;const G=DefaultReconnectController$1;r.DefaultReconnectController=G.default;const L=DefaultSessionStateController$1;r.DefaultSessionStateController=L.default;const Z=DefaultSigV4$1;r.DefaultSigV4=Z.default;const U=DefaultSignalingClient$1;r.DefaultSignalingClient=U.default;const pe=DefaultSimulcastUplinkPolicy$1;r.DefaultSimulcastUplinkPolicy=pe.default;const H=DefaultSimulcastUplinkPolicyForContentShare$1;r.DefaultSimulcastUplinkPolicyForContentShare=H.default;const Se=DefaultTransceiverController$1;r.DefaultTransceiverController=Se.default;const _=DefaultTranscriptionController;r.DefaultTranscriptionController=_.default;const w=DefaultUserAgentParser$1;r.DefaultUserAgentParser=w.default;const M=DefaultVideoCaptureAndEncodeParameter$1;r.DefaultVideoCaptureAndEncodeParameter=M.default;const j=DefaultVideoFrameProcessorPipeline$1;r.DefaultVideoFrameProcessorPipeline=j.default;const J=DefaultVideoStreamIdSet$1;r.DefaultVideoStreamIdSet=J.default;const K=DefaultVideoStreamIndex$1;r.DefaultVideoStreamIndex=K.default;const Y=DefaultVideoTile$1;r.DefaultVideoTile=Y.default;const se=DefaultVideoTileController$1;r.DefaultVideoTileController=se.default;const Q=DefaultVideoTileFactory$1;r.DefaultVideoTileFactory=Q.default;const W=DefaultVideoTransformDevice$1;r.DefaultVideoTransformDevice=W.default;const te=DefaultVolumeIndicatorAdapter$1;r.DefaultVolumeIndicatorAdapter=te.default;const we=DefaultWebSocketAdapter$1;r.DefaultWebSocketAdapter=we.default;const ke=DevicePixelRatioWindowSource$1;r.DevicePixelRatioWindowSource=ke.default;const Ie=DeviceSelection$1;r.DeviceSelection=Ie.default;const Me=EventBufferConfiguration$1;r.EventBufferConfiguration=Me.default;const Ee=EventIngestionConfiguration$1;r.EventIngestionConfiguration=Ee.default;const Ae=FinishGatheringICECandidatesTask$1;r.FinishGatheringICECandidatesTask=Ae.default;const Oe=FullJitterBackoff$1;r.FullJitterBackoff=Oe.default;const De=FullJitterBackoffFactory$1;r.FullJitterBackoffFactory=De.default;const Pe=FullJitterLimitedBackoff$1;r.FullJitterLimitedBackoff=Pe.default;const Re=GetUserMediaError$1;r.GetUserMediaError=Re.default;const xe=GlobalMetricReport$1;r.GlobalMetricReport=xe.default;const Be=InMemoryJSONEventBuffer$1;r.InMemoryJSONEventBuffer=Be.default;const Ve=IntervalScheduler$1;r.IntervalScheduler=Ve.default;const Ne=JoinAndReceiveIndexTask$1;r.JoinAndReceiveIndexTask=Ne.default;const Le=LeaveAndReceiveLeaveAckTask$1;r.LeaveAndReceiveLeaveAckTask=Le.default;const Fe=ListenForVolumeIndicatorsTask$1;r.ListenForVolumeIndicatorsTask=Fe.default;const Ue=Log$1;r.Log=Ue.default;const je=LogLevel;r.LogLevel=je.default;const He=MediaDeviceProxyHandler$1;r.MediaDeviceProxyHandler=He.default;const We=MeetingEventsClientConfiguration$1;r.MeetingEventsClientConfiguration=We.default;const Ge=MeetingReadinessCheckerConfiguration$1;r.MeetingReadinessCheckerConfiguration=Ge.default;const Ke=MeetingSessionConfiguration$1;r.MeetingSessionConfiguration=Ke.default;const Je=MeetingSessionCredentials$1;r.MeetingSessionCredentials=Je.default;const ze=MeetingSessionLifecycleEvent;r.MeetingSessionLifecycleEvent=ze.default;const Ze=MeetingSessionLifecycleEventCondition;r.MeetingSessionLifecycleEventCondition=Ze.default;const qe=MeetingSessionStatus$1;r.MeetingSessionStatus=qe.default;const Qe=MeetingSessionStatusCode;r.MeetingSessionStatusCode=Qe.default;const Xe=MeetingSessionTURNCredentials$1;r.MeetingSessionTURNCredentials=Xe.default;const Ye=MeetingSessionURLs$1;r.MeetingSessionURLs=Ye.default;const et=MeetingSessionVideoAvailability$1;r.MeetingSessionVideoAvailability=et.default;const tt=Message$1;r.Message=tt.default;const it=MessagingSessionConfiguration$1;r.MessagingSessionConfiguration=it.default;const nt=ModelSpecBuilder$1;r.ModelSpecBuilder=nt.default;const rt=MonitorTask$1;r.MonitorTask=rt.default;const ot=MultiLogger$1;r.MultiLogger=ot.default;const at=NScaleVideoUplinkBandwidthPolicy$1;r.NScaleVideoUplinkBandwidthPolicy=at.default;const st=requireNoOpAudioVideoController();r.NoOpAudioVideoController=st.default;const lt=NoOpDebugLogger$1;r.NoOpDebugLogger=lt.default;const dt=NoOpDeviceController$1;r.NoOpDeviceController=dt.default;const ct=NoOpEventReporter$1;r.NoOpEventReporter=ct.default;const ut=NoOpLogger$1;r.NoOpLogger=ut.default;const ft=NoOpMediaStreamBroker$1;r.NoOpMediaStreamBroker=ft.default;const ht=NoOpTask$1;r.NoOpTask=ht.default;const pt=NoOpVideoElementFactory$1;r.NoOpVideoElementFactory=pt.default;const St=NoOpVideoFrameProcessor$1;r.NoOpVideoFrameProcessor=St.default;const mt=NoVideoDownlinkBandwidthPolicy$1;r.NoVideoDownlinkBandwidthPolicy=mt.default;const gt=NoVideoUplinkBandwidthPolicy$1;r.NoVideoUplinkBandwidthPolicy=gt.default;const vt=NotFoundError$1;r.NotFoundError=vt.default;const _t=NotReadableError$1;r.NotReadableError=_t.default;const bt=OnceTask$1;r.OnceTask=bt.default;const yt=OpenSignalingConnectionTask$1;r.OpenSignalingConnectionTask=yt.default;const Ct=OverconstrainedError$1;r.OverconstrainedError=Ct.default;const Tt=POSTLogger$1;r.POSTLogger=Tt.default;const wt=ParallelGroupTask$1;r.ParallelGroupTask=wt.default;const kt=PermissionDeniedError$1;r.PermissionDeniedError=kt.default;const It=PrefetchOn$1;r.PrefetchOn=It.default;const $t=PromiseQueue$1;r.PromiseQueue=$t.default;const Mt=requirePromoteToPrimaryMeetingTask();r.PromoteToPrimaryMeetingTask=Mt.default;const Et=RealtimeAttendeePositionInFrame$1;r.RealtimeAttendeePositionInFrame=Et.default;const At=RealtimeState$1;r.RealtimeState=At.default;const Ot=RealtimeVolumeIndicator$1;r.RealtimeVolumeIndicator=Ot.default;const Dt=ReceiveAudioInputTask$1;r.ReceiveAudioInputTask=Dt.default;const Pt=ReceiveTURNCredentialsTask$1;r.ReceiveTURNCredentialsTask=Pt.default;const Rt=ReceiveVideoInputTask$1;r.ReceiveVideoInputTask=Rt.default;const xt=ReceiveVideoStreamIndexTask$1;r.ReceiveVideoStreamIndexTask=xt.default;const Bt=ReconnectionHealthPolicy$1;r.ReconnectionHealthPolicy=Bt.default;const Vt=RunnableTask$1;r.RunnableTask=Vt.default;const Nt=SDP$1;r.SDP=Nt.default;const Lt=SDPCandidateType;r.SDPCandidateType=Lt.default;const Ft=SDPMediaSection$1;r.SDPMediaSection=Ft.default;const Ut=SendAndReceiveDataMessagesTask$1;r.SendAndReceiveDataMessagesTask=Ut.default;const jt=SerialGroupTask$1;r.SerialGroupTask=jt.default;const Ht=ServerSideNetworkAdaption;r.ServerSideNetworkAdaption=Ht.default;const Wt=SessionStateControllerAction;r.SessionStateControllerAction=Wt.default;const Gt=SessionStateControllerDeferPriority;r.SessionStateControllerDeferPriority=Gt.default;const Kt=SessionStateControllerState;r.SessionStateControllerState=Kt.default;const Jt=SessionStateControllerTransitionResult;r.SessionStateControllerTransitionResult=Jt.default;const zt=SetLocalDescriptionTask$1;r.SetLocalDescriptionTask=zt.default;const Zt=SetRemoteDescriptionTask$1;r.SetRemoteDescriptionTask=Zt.default;const qt=SignalingAndMetricsConnectionMonitor$1;r.SignalingAndMetricsConnectionMonitor=qt.default;const Qt=SignalingClientConnectionRequest$1;r.SignalingClientConnectionRequest=Qt.default;const Xt=SignalingClientEvent$1;r.SignalingClientEvent=Xt.default;const Yt=SignalingClientEventType;r.SignalingClientEventType=Yt.default;const ei=SignalingClientJoin$1;r.SignalingClientJoin=ei.default;const ti=SignalingClientSubscribe$1;r.SignalingClientSubscribe=ti.default;const ii=SignalingClientVideoSubscriptionConfiguration$1;r.SignalingClientVideoSubscriptionConfiguration=ii.default;const ni=SimulcastContentShareTransceiverController$1;r.SimulcastContentShareTransceiverController=ni.default;const ri=SimulcastLayers;r.SimulcastLayers=ri.default;const oi=SimulcastTransceiverController$1;r.SimulcastTransceiverController=oi.default;const ai=SimulcastVideoStreamIndex$1;r.SimulcastVideoStreamIndex=ai.default;const si=SingleNodeAudioTransformDevice$1;r.SingleNodeAudioTransformDevice=si.default;const li=StreamMetricReport$1;r.StreamMetricReport=li.default;const di=SubscribeAndReceiveSubscribeAckTask$1;r.SubscribeAndReceiveSubscribeAckTask=di.default;const ci=TargetDisplaySize;r.TargetDisplaySize=ci.default;const ui=TaskStatus$1;r.TaskStatus=ui.default;const fi=TimeoutScheduler$1;r.TimeoutScheduler=fi.default;const hi=TimeoutTask$1;r.TimeoutTask=hi.default;const pi=Transcript$1;r.Transcript=pi.default;const Si=TranscriptAlternative$1;r.TranscriptAlternative=Si.default;const mi=TranscriptEntity$1;r.TranscriptEntity=mi.default;const gi=TranscriptItem$1;r.TranscriptItem=gi.default;const vi=TranscriptItemType$1;r.TranscriptItemType=vi.default;const _i=TranscriptLanguageWithScore$1;r.TranscriptLanguageWithScore=_i.default;const bi=TranscriptResult$1;r.TranscriptResult=bi.default;const yi=TranscriptionStatus$1;r.TranscriptionStatus=yi.default;const Ci=TranscriptionStatusType$1;r.TranscriptionStatusType=Ci.default;const Ti=_TypeError;r.TypeError=Ti.default;const wi=UnusableAudioWarningConnectionHealthPolicy$1;r.UnusableAudioWarningConnectionHealthPolicy=wi.default;const ki=Versioning$1;r.Versioning=ki.default;const Ii=VideoAdaptiveProbePolicy$1;r.VideoAdaptiveProbePolicy=Ii.default;const $i=VideoCodecCapability$1;r.VideoCodecCapability=$i.default;const Mi=VideoLogEvent;r.VideoLogEvent=Mi.default;const Ei=VideoOnlyTransceiverController$1;r.VideoOnlyTransceiverController=Ei.default;const Ai=VideoPreference$1;r.VideoPreference=Ai.default;const Oi=VideoPreferences$1;r.VideoPreferences=Oi.default;const Di=VideoPriorityBasedPolicy$1;r.VideoPriorityBasedPolicy=Di.default;const Pi=VideoPriorityBasedPolicyConfig$1;r.VideoPriorityBasedPolicyConfig=Pi.default;const Ri=VideoQualitySettings$1;r.VideoQualitySettings=Ri.default;const xi=VideoSource$1;r.VideoSource=xi.default;const Bi=VideoStreamDescription$1;r.VideoStreamDescription=Bi.default;const Vi=VideoTileState$1;r.VideoTileState=Vi.default;const Ni=VoiceFocusDeviceTransformer$1;r.VoiceFocusDeviceTransformer=Ni.default;const Li=VoiceFocusTransformDevice$1;r.VoiceFocusTransformDevice=Li.default;const Fi=WaitForAttendeePresenceTask$1;r.WaitForAttendeePresenceTask=Fi.default;const Ui=WebSocketReadyState;r.WebSocketReadyState=Ui.default;const ji=ZLIBTextCompressor$1;r.ZLIBTextCompressor=ji.default;const Hi=VideoPreferences$1;Object.defineProperty(r,"MutableVideoPreferences",{enumerable:!0,get:function(){return Hi.MutableVideoPreferences}});const $e=Types;Object.defineProperty(r,"Some",{enumerable:!0,get:function(){return $e.Some}}),Object.defineProperty(r,"None",{enumerable:!0,get:function(){return $e.None}}),Object.defineProperty(r,"Maybe",{enumerable:!0,get:function(){return $e.Maybe}});const Wi=AudioTransformDevice;Object.defineProperty(r,"isAudioTransformDevice",{enumerable:!0,get:function(){return Wi.isAudioTransformDevice}});const Gi=Destroyable;Object.defineProperty(r,"isDestroyable",{enumerable:!0,get:function(){return Gi.isDestroyable}});const Ki=VideoTransformDevice;Object.defineProperty(r,"isVideoTransformDevice",{enumerable:!0,get:function(){return Ki.isVideoTransformDevice}})}(build$2)),build$2}var buildExports=requireBuild();const _hoisted_1$1={class:"p-6 sm:px-20 bg-white border-b border-gray-200"},_sfc_main$1={__name:"Welcome",props:{meeting_credentials:{}},setup(r){const{meeting_credentials:t}=r;window.global=window;const e=ref(null),n=ref(null),o=ref(null),a=new buildExports.ConsoleLogger("MeetingLogs",buildExports.LogLevel.INFO),s=new buildExports.DefaultDeviceController(a),d=new buildExports.MeetingSessionConfiguration(t.meeting_response,t.attendee_response),u=new buildExports.DefaultMeetingSession(d,a,s);async function c(){const f={videoTileDidUpdate:h=>{console.error({tileState:h});const p=o,m=h.tileId===1;u.audioVideo.bindAudioElement(p.value),u.audioVideo.bindVideoElement(h.tileId,m?e.value:n.value)},audioVideoDidStart:()=>{console.error("Started")},audioVideoDidStop:h=>{console.error("Stopped with a session status code: ",h.statusCode())},audioVideoDidStartConnecting:h=>{h&&console.error("Attempting to reconnect")}};u.audioVideo.listAudioInputDevices().then(h=>u.audioVideo.startAudioInput(h[0].deviceId)).then(()=>u.audioVideo.listAudioOutputDevices()).then(()=>{const h=o;return u.audioVideo.bindAudioElement(h.value)}).then(()=>(u.audioVideo.addObserver(f),u.audioVideo.start())).then(()=>{u.audioVideo.listVideoInputDevices().then(h=>u.audioVideo.startVideoInput(h.length?h[0].deviceId:null)).then(()=>u.audioVideo.startLocalVideoTile())}).then(()=>{const h=u.audioVideo.realtimeUnmuteLocalAudio();console.log(h?"Other attendees can hear your audio":"You cannot unmute yourself");const p=u.audioVideo.realtimeIsLocalAudioMuted();console.log(p?"You are muted":"Other attendees can hear your audio")}).catch(h=>{console.error("error",h)})}const l=()=>{c()};return(f,h)=>(openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("button",{class:"bg-blue-500 text-white p-2 rounded",onClick:l}," Start call "),createBaseVNode("audio",{ref_key:"audioTag",ref:o},null,512),createBaseVNode("video",{ref_key:"videoTag",ref:e},null,512),createBaseVNode("video",{ref_key:"videoTagSecond",ref:n},null,512)])]))}},_hoisted_1=createBaseVNode("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Dashboard ",-1),_hoisted_2={class:"py-12"},_hoisted_3={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},_hoisted_4={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},_sfc_main={__name:"Dashboard",props:{meeting_credentials:{}},setup(r){return(t,e)=>(openBlock(),createBlock(_sfc_main$2,{title:"Dashboard"},{header:withCtx(()=>[_hoisted_1]),default:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createVNode(_sfc_main$1,{meeting_credentials:r.meeting_credentials},null,8,["meeting_credentials"])])])])]),_:1}))}};export{_sfc_main as default};
